{
  "timestamp": "2026-02-16T06:30:52.699089",
  "sql": "INSERT INTO s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred  SELECT agr.agr_cred_id,\n    agr.prnt_agr_cred_id,\n    agr.info_system_id,\n    agr.agr_num,\n    agr.grntee_agr_num,\n    agr.signed_dt,\n    agr.issue_crncy_id,\n    agr.eks_overdraft_flag,\n    agr.agr_regls_type_id,\n        CASE\n            WHEN (agr.eks_issue_dt IS NOT NULL) THEN agr.eks_issue_dt\n            WHEN ((agr.agr_cred_type_cd = '1'::text) AND (agr.eks_transhes_issue_dt IS NOT NULL)) THEN agr.eks_transhes_issue_dt\n            ELSE aco_fst_iss.optn_issue_dt\n        END AS issue_dt,\n    agr.close_dt,\n    agr.expiration_dt,\n    agr.host_agr_cred_id,\n    agr.host_crm_id,\n    agr.eks_agr_cred_type_id,\n    agr.agr_frame_id,\n    agr.eks_rvlng_flag,\n    agr.issue_int_org_id,\n    agr.multi_crncy_flag,\n    agr.eks_old_restruct_cnt,\n    agr.eks_old_prolong_cnt,\n    agr.eks_contract_expiration_dt,\n    NULL::text AS diff_intst_rate_flag,\n    agr.grntee_claim_notice_dt,\n    agr.restruct_refin_default_flag,\n    agr.restruct_refin_default_dt,\n    coa_crncy.agra_l001_crncy_id AS debt_due_acc_crncy_id,\n    coa_crncy.agra_l007_crncy_id AS unused_limit_acc_crncy_id,\n    coa_crncy.agra_l009_crncy_id AS grntee_acc_crncy_id,\n    agr.has_higher_flag,\n    agr.zero_id,\n    agr.four_id,\n    agr.eks_cession_dt,\n    agr.agr_cession_id,\n    agr.cession_sell_got_cess_amt,\n    agr.cession_sell_debt_cess_amt,\n    agr.cession_sell_intrst_cess_amt,\n    agr.cession_sell_cess_amt,\n        CASE\n            WHEN (agr.f26_agr_cred_type_cd = '\u0413'::text) THEN COALESCE(coa_crncy.agra_l009_crncy_id, agr.issue_crncy_id)\n            WHEN (agr.agr_cred_type_cd = '0'::text) THEN COALESCE(coa_crncy.agra_l001_crncy_id, agr.issue_crncy_id)\n            WHEN (agr.agr_cred_type_cd = '4'::text) THEN COALESCE(coa_crncy.agra_l001_crncy_id, agr.issue_crncy_id)\n            WHEN (agr.agr_cred_type_cd = '1'::text) THEN COALESCE(coa_crncy.agra_l007_crncy_id, agr.issue_crncy_id)\n            ELSE agr.issue_crncy_id\n        END AS crncy_id,\n    agr.agr_cred_type_id,\n    agr.agr_cred_type_cd,\n    agr.f26_agr_cred_type_id,\n    agr.f26_agr_cred_type_cd,\n    agr.rvlng_flag,\n    agr.overdraft_flag,\n        CASE\n            WHEN (cess_buy_coa.agr_cred_id IS NOT NULL) THEN cess_buy_coa.cess_buy_coa_open_dt\n            ELSE COALESCE(agr.eks_cession_dt,\n            CASE\n                WHEN (cess_sell_debt_coa.cess_debt_coa_open_dt >= COALESCE(cess_sell_debt_coa.coa_bind_dt, '1900-01-01'::date)) THEN cess_sell_debt_coa.cess_debt_coa_open_dt\n                ELSE cess_sell_debt_coa.coa_bind_dt\n            END, agr.cess_last_reg_dt)\n        END AS cession_dt,\n        CASE\n            WHEN (cess_buy_coa.agr_cred_id IS NOT NULL) THEN 'Y'::text\n            ELSE 'N'::text\n        END AS cession_buy_flag,\n        CASE\n            WHEN (((cess_sell_debt_coa.agr_cred_id IS NOT NULL) OR (agr.cess_last_reg_dt IS NOT NULL)) AND (cess_buy_coa.agr_cred_id IS NULL)) THEN 'Y'::text\n            ELSE 'N'::text\n        END AS cess_deferred_flag,\n    rat_first.agr_cred_rate_first_dt,\n    agr.cess_crncy_id,\n    agr.k7m_flag,\n    agr.poci_flag,\n    agr.fin_guarantee_flag,\n    agr.fin_guarantee_loan_flag,\n    agr.limit_use_end_dt,\n    agr.open_dt,\n    agr.eks_grntee_amt,\n    agr.grntee_ast_flag,\n    NULL::bigint AS crncy_id_uvdo,\n    NULL::text AS crncy_cd_uvdo,\n    NULL::text AS iso_crncy_cd_uvdo,\n    NULL::bigint AS cust_id_uvdo,\n    NULL::bigint AS letter_of_credit_type_id,\n    NULL::text AS let_of_cred_revoce_flag,\n    NULL::text AS let_of_cred_cover_flag,\n    NULL::bigint AS host_let_of_cred_cover_id,\n    NULL::numeric(38,8) AS agr_cred_start_amt,\n    agr.k7m_pl_flag,\n    NULL::bigint AS coa_cred_f26_prod_id,\n    cst.subject_area_type_id,\n    NULL::bigint AS let_of_cred_acc_scheme_id\n   FROM ((((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr\n     LEFT JOIN ( SELECT eatc.agrmnt_id AS agr_cred_id,\n            min(eatc.agrmnt_gl_acct_start_dt) AS coa_bind_dt,\n            min(c.coa_start_dt) AS cess_debt_coa_open_dt\n           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.\"v_$eks_agrmnt_to_coa_3\" eatc\n             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c ON ((c.coa_id = eatc.coa_id)))\n             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct glma ON ((glma.gl_main_acct_id = c.gl_main_acct_id)))\n          WHERE (substr(glma.gl_main_acct_num, 1, 7) = '4742325'::text)\n          GROUP BY eatc.agrmnt_id) cess_sell_debt_coa ON ((cess_sell_debt_coa.agr_cred_id = agr.agr_cred_id)))\n     LEFT JOIN ( SELECT c.agr_cred_id,\n            min(c.start_dt) AS cess_buy_coa_open_dt\n           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period c\n          WHERE ((((1 = 1) AND ((c.coa_num ~~ '478%'::text) OR (substr(c.coa_num, 1, 5) = ANY (ARRAY['44111'::text, '44211'::text, '44311'::text, '44411'::text, '44511'::text, '44611'::text, '44711'::text, '44811'::text, '44911'::text, '45011'::text, '45111'::text, '45211'::text, '45311'::text, '45411'::text, '45611'::text])))) AND (substr(c.meas_cd, 1, 6) = 'AGRA_L'::text)) AND (c.meas_rub > (0)::numeric))\n          GROUP BY c.agr_cred_id) cess_buy_coa ON ((cess_buy_coa.agr_cred_id = agr.agr_cred_id)))\n     LEFT JOIN ( SELECT coa_crncs_sub.agr_cred_id,\n            max(\n                CASE\n                    WHEN (coa_crncs_sub.meas_cd = 'AGRA_L001'::text) THEN coa_crncs_sub.crncy_id\n                    ELSE NULL::bigint\n                END) AS agra_l001_crncy_id,\n            max(\n                CASE\n                    WHEN (coa_crncs_sub.meas_cd = 'AGRA_L007'::text) THEN coa_crncs_sub.crncy_id\n                    ELSE NULL::bigint\n                END) AS agra_l007_crncy_id,\n            max(\n                CASE\n                    WHEN (coa_crncs_sub.meas_cd = 'AGRA_L009'::text) THEN coa_crncs_sub.crncy_id\n                    ELSE NULL::bigint\n                END) AS agra_l009_crncy_id\n           FROM ( SELECT t.agr_cred_id,\n                    t.meas_cd,\n                    t.crncy_id\n                   FROM ( SELECT a_agr_cred_coa_period.agr_cred_id,\n                            a_agr_cred_coa_period.meas_cd,\n                            a_agr_cred_coa_period.crncy_id,\n                            row_number() OVER (PARTITION BY a_agr_cred_coa_period.agr_cred_id, a_agr_cred_coa_period.meas_cd ORDER BY NULL::text) AS rn,\n                            min(a_agr_cred_coa_period.crncy_id) OVER (PARTITION BY a_agr_cred_coa_period.agr_cred_id, a_agr_cred_coa_period.meas_cd) AS mn,\n                            max(a_agr_cred_coa_period.crncy_id) OVER (PARTITION BY a_agr_cred_coa_period.agr_cred_id, a_agr_cred_coa_period.meas_cd) AS mx\n                           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period\n                          WHERE (a_agr_cred_coa_period.meas_cd = ANY (ARRAY['AGRA_L001'::text, 'AGRA_L007'::text, 'AGRA_L009'::text]))) t\n                  WHERE ((t.rn = 1) AND (t.mx = t.mn))) coa_crncs_sub\n          GROUP BY coa_crncs_sub.agr_cred_id) coa_crncy ON ((coa_crncy.agr_cred_id = agr.agr_cred_id)))\n     LEFT JOIN ( SELECT t.agr_cred_id,\n            t.optn_issue_dt\n           FROM ( SELECT aco_fst_iss_1.agr_cred_id,\n                    aco_fst_iss_1.optn_dt AS optn_issue_dt,\n                    row_number() OVER (PARTITION BY aco_fst_iss_1.agr_cred_id ORDER BY aco_fst_iss_1.optn_dt) AS rn\n                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn aco_fst_iss_1\n                  WHERE (((aco_fst_iss_1.issue_flag = 'Y'::text) OR (aco_fst_iss_1.move_flag = 'Y'::text)) AND (aco_fst_iss_1.optn_rub <> (0)::numeric))) t\n          WHERE (t.rn = 1)) aco_fst_iss ON ((aco_fst_iss.agr_cred_id = agr.agr_cred_id)))\n     LEFT JOIN ( SELECT rat.agrmnt_id AS agr_cred_id,\n            min(rat.loan_agrmnt_rate_start_dt) AS agr_cred_rate_first_dt\n           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate rat\n          WHERE ((rat.rate_val > (0)::numeric) AND (rat.rate_calc_rule_id = ANY (ARRAY[37004, 13104, 45804, 67904, 35204])))\n          GROUP BY rat.agrmnt_id) rat_first ON ((rat_first.agr_cred_id = agr.agr_cred_id)))\n     LEFT JOIN ( SELECT v_cust.agr_cred_id,\n            max(\n                CASE\n                    WHEN ((COALESCE(v_cust.ind_flag, 'N'::text) = 'Y'::text) AND (COALESCE(v_cust.org_flag, 'N'::text) = 'N'::text)) THEN 2\n                    WHEN (COALESCE(v_cust.bank_flag, 'N'::text) = 'Y'::text) THEN 3\n                    ELSE 1\n                END) AS subject_area_type_id\n           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust v_cust\n          WHERE ((('now'::text)::date >= v_cust.start_dt) AND (('now'::text)::date <= v_cust.end_dt))\n          GROUP BY v_cust.agr_cred_id) cst ON ((agr.agr_cred_id = cst.agr_cred_id)))\nUNION ALL\n SELECT agr_cred.agr_cred_id,\n    NULL::bigint AS prnt_agr_cred_id,\n    agr_cred.info_system_id,\n    agr_cred.agr_num,\n    NULL::text AS grntee_agr_num,\n    agr_cred.open_dt AS signed_dt,\n    NULL::bigint AS issue_crncy_id,\n    NULL::text AS eks_overdraft_flag,\n    agr_cred.uvdo_accred_scheme_id AS agr_regls_type_id,\n    NULL::date AS issue_dt,\n    agr_cred.close_dt,\n    agr_cred.expiration_dt,\n    (agr_cred.host_agr_cred_id)::text AS host_agr_cred_id,\n    NULL::text AS host_crm_id,\n    NULL::bigint AS eks_agr_cred_type_id,\n        CASE\n            WHEN (flt.agr_cred_type_id = '-1034'::integer) THEN agr_cred.agr_cred_id\n            ELSE gen.agr_frame_id\n        END AS agr_frame_id,\n    NULL::text AS eks_rvlng_flag,\n    NULL::bigint AS issue_int_org_id,\n    NULL::text AS multi_crncy_flag,\n    NULL::smallint AS eks_old_restruct_cnt,\n    NULL::smallint AS eks_old_prolong_cnt,\n    NULL::date AS eks_contract_expiration_dt,\n    NULL::text AS diff_intst_rate_flag,\n    NULL::date AS grntee_claim_notice_dt,\n    NULL::text AS restruct_refin_default_flag,\n    NULL::date AS restruct_refin_default_dt,\n    NULL::bigint AS debt_due_acc_crncy_id,\n    NULL::bigint AS unused_limit_acc_crncy_id,\n    NULL::bigint AS grntee_acc_crncy_id,\n    'N'::text AS has_higher_flag,\n    NULL::bigint AS zero_id,\n    NULL::bigint AS four_id,\n    NULL::date AS eks_cession_dt,\n    NULL::bigint AS agr_cession_id,\n    NULL::numeric(38,8) AS cession_sell_got_cess_amt,\n    NULL::numeric(38,8) AS cession_sell_debt_cess_amt,\n    NULL::numeric(38,8) AS cession_sell_intrst_cess_amt,\n    NULL::numeric(38,8) AS cession_sell_cess_amt,\n    agr_crncy.crncy_id_eks AS crncy_id,\n    flt.agr_cred_type_id,\n    NULL::text AS agr_cred_type_cd,\n    NULL::bigint AS f26_agr_cred_type_id,\n    NULL::text AS f26_agr_cred_type_cd,\n    rvlng.rvlng_flag,\n    NULL::text AS overdraft_flag,\n    NULL::date AS cession_dt,\n    NULL::text AS cession_buy_flag,\n    NULL::text AS cess_deferred_flag,\n    NULL::date AS agr_cred_rate_first_dt,\n    NULL::bigint AS cess_crncy_id,\n    NULL::text AS k7m_flag,\n    NULL::text AS poci_flag,\n    NULL::text AS fin_guarantee_flag,\n    NULL::text AS fin_guarantee_loan_flag,\n    NULL::date AS limit_use_end_dt,\n    agr_cred.open_dt,\n    NULL::numeric(38,8) AS eks_grntee_amt,\n    NULL::text AS grntee_ast_flag,\n    agr_crncy.crncy_id AS crncy_id_uvdo,\n    agr_crncy.crncy_cd AS crncy_cd_uvdo,\n    agr_crncy.iso_crncy_cd AS iso_crncy_cd_uvdo,\n    agr_cred.payer_cust_id AS cust_id_uvdo,\n    agr_cred.agr_cred_type_id AS letter_of_credit_type_id,\n    agr_cred.revocable_accred_flag AS let_of_cred_revoce_flag,\n        CASE\n            WHEN ((gen.agr_frame_id IS NOT NULL) OR (flt.agr_cred_type_id = '-1034'::integer)) THEN 'N'::text\n            ELSE 'Y'::text\n        END AS let_of_cred_cover_flag,\n    agr_cred.host_eks_agrmnt_id AS host_let_of_cred_cover_id,\n    agr_cred.start_sum_crncy_amt AS agr_cred_start_amt,\n    NULL::text AS k7m_pl_flag,\n    NULL::bigint AS coa_cred_f26_prod_id,\n    (1)::smallint AS subject_area_type_id,\n    rvlng.accounting_scheme_id AS let_of_cred_acc_scheme_id\n   FROM ((((s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred\n     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))\n     LEFT JOIN ( SELECT curu.crncy_id,\n            max(cure.crncy_id) AS crncy_id_eks,\n            max(COALESCE(cure.crncy_cd, '-1'::text)) AS crncy_cd,\n            max(COALESCE(cure.crncy_name, ''::text)) AS crncy_name,\n            max(curu.iso_crncy_cd) AS iso_crncy_cd,\n            max(curu.info_system_id) AS info_system_id\n           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_crncy curu\n             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy cure ON ((cure.iso_crncy_cd = curu.iso_crncy_cd)))\n          GROUP BY curu.crncy_id) agr_crncy ON ((agr_crncy.crncy_id = agr_cred.crncy_id)))\n     LEFT JOIN ( SELECT t1.agr_cred_id,\n            max(t2.agr_cred_id) AS agr_frame_id\n           FROM (( SELECT \"v_agr_cred_metric_hist$$$\".agr_cred_id,\n                    max(\"v_agr_cred_metric_hist$$$\".agr_cred_metric_txt) AS frame_host_agr_cred_id\n                   FROM s_grnplm_as_t_didsd_029_vd_dwh.\"v_agr_cred_metric_hist$$$\"\n                  WHERE ((((\"v_agr_cred_metric_hist$$$\".agr_cred_metric_type_id = '-1007'::integer) AND (\"v_agr_cred_metric_hist$$$\".agr_cred_metric_txt <> '-1'::text)) AND (btrim(\"v_agr_cred_metric_hist$$$\".agr_cred_metric_txt) >= '0'::text)) AND (btrim(\"v_agr_cred_metric_hist$$$\".agr_cred_metric_txt) <= '99999999999999999999'::text))\n                  GROUP BY \"v_agr_cred_metric_hist$$$\".agr_cred_id) t1\n             JOIN ( SELECT d_agr_cred_core_uvdo.agr_cred_id,\n                    d_agr_cred_core_uvdo.host_agr_cred_id\n                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo\n                  WHERE (d_agr_cred_core_uvdo.agr_cred_type_id = '-1034'::integer)) t2 ON ((t1.frame_host_agr_cred_id = t2.host_agr_cred_id)))\n          GROUP BY t1.agr_cred_id) gen ON ((agr_cred.agr_cred_id = gen.agr_cred_id)))\n     LEFT JOIN ( SELECT agr.agr_cred_id,\n            agr.accounting_scheme_id,\n                CASE\n                    WHEN ((aty.host_agr_cred_type_id = (12)::numeric) AND (ttt.uvdo_ttovarlc_name = '\u041f\u0440\u043e\u0447\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u044b'::text)) THEN 'Y'::text\n                    ELSE 'N'::text\n                END AS rvlng_flag\n           FROM ((s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr\n             LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.\"v_$uvdo_ttovarlc\" ttt ON ((ttt.uvdo_ttovarlc_id = agr.uvdo_ttovarlc_id)))\n             LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type aty ON ((aty.agr_cred_type_id = agr.agr_cred_type_id)))) rvlng ON ((agr_cred.agr_cred_id = rvlng.agr_cred_id)))\nUNION ALL\n SELECT core.agr_cred_id,\n    NULL::bigint AS prnt_agr_cred_id,\n    core.info_system_id,\n    coa.coa_num AS agr_num,\n    NULL::text AS grntee_agr_num,\n    coa.coa_start_dt AS signed_dt,\n    coa.crncy_id AS issue_crncy_id,\n    NULL::text AS eks_overdraft_flag,\n    NULL::bigint AS agr_regls_type_id,\n    NULL::date AS issue_dt,\n    coa.coa_end_dt AS close_dt,\n    NULL::date AS expiration_dt,\n    '-1'::text AS host_agr_cred_id,\n    NULL::text AS host_crm_id,\n    NULL::bigint AS eks_agr_cred_type_id,\n    NULL::bigint AS agr_frame_id,\n    NULL::text AS eks_rvlng_flag,\n    xref.coa_int_org_pty_id AS issue_int_org_id,\n    NULL::text AS multi_crncy_flag,\n    NULL::smallint AS eks_old_restruct_cnt,\n    NULL::smallint AS eks_old_prolong_cnt,\n    NULL::date AS eks_contract_expiration_dt,\n    NULL::text AS diff_intst_rate_flag,\n    NULL::date AS grntee_claim_notice_dt,\n    NULL::text AS restruct_refin_default_flag,\n    NULL::date AS restruct_refin_default_dt,\n    NULL::bigint AS debt_due_acc_crncy_id,\n    NULL::bigint AS unused_limit_acc_crncy_id,\n    NULL::bigint AS grntee_acc_crncy_id,\n    NULL::text AS has_higher_flag,\n    NULL::bigint AS zero_id,\n    NULL::bigint AS four_id,\n    NULL::date AS eks_cession_dt,\n    NULL::bigint AS agr_cession_id,\n    NULL::numeric(38,8) AS cession_sell_got_cess_amt,\n    NULL::numeric(38,8) AS cession_sell_debt_cess_amt,\n    NULL::numeric(38,8) AS cession_sell_intrst_cess_amt,\n    NULL::numeric(38,8) AS cession_sell_cess_amt,\n    coa.crncy_id,\n    core.agr_cred_type_id,\n    NULL::text AS agr_cred_type_cd,\n    (4)::bigint AS f26_agr_cred_type_id,\n    '1'::text AS f26_agr_cred_type_cd,\n    NULL::text AS rvlng_flag,\n    NULL::text AS overdraft_flag,\n    NULL::date AS cession_dt,\n    NULL::text AS cession_buy_flag,\n    NULL::text AS cess_deferred_flag,\n    NULL::date AS agr_cred_rate_first_dt,\n    NULL::bigint AS cess_crncy_id,\n    NULL::text AS k7m_flag,\n    NULL::text AS poci_flag,\n    NULL::text AS fin_guarantee_flag,\n    NULL::text AS fin_guarantee_loan_flag,\n    NULL::date AS limit_use_end_dt,\n    coa.coa_start_dt AS open_dt,\n    NULL::numeric(38,8) AS eks_grntee_amt,\n    NULL::text AS grntee_ast_flag,\n    NULL::bigint AS crncy_id_uvdo,\n    NULL::text AS crncy_cd_uvdo,\n    NULL::text AS iso_crncy_cd_uvdo,\n    NULL::bigint AS cust_id_uvdo,\n    NULL::bigint AS letter_of_credit_type_id,\n    NULL::text AS let_of_cred_revoce_flag,\n    NULL::text AS let_of_cred_cover_flag,\n    NULL::bigint AS host_let_of_cred_cover_id,\n    NULL::numeric(38,8) AS agr_cred_start_amt,\n    NULL::text AS k7m_pl_flag,\n    type1.agrmnt_class_val_id AS coa_cred_f26_prod_id,\n    core.subject_area_type_id,\n    NULL::bigint AS let_of_cred_acc_scheme_id\n   FROM ((((s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core core\n     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa ON ((core.coa_id = coa.coa_id)))\n     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref xref ON (((((coa.coa_id = xref.coa_id) AND (xref.coa_int_org_type_id = '-1001'::integer)) AND (coa.coa_start_dt >= xref.coa_int_org_start_dt)) AND (coa.coa_start_dt <= xref.coa_int_org_end_dt))))\n     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s s ON ((coa.crncy_id = s.crncy_id)))\n     LEFT JOIN ( SELECT max(o.agrmnt_class_val_id) AS agrmnt_class_val_id\n           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val o\n          WHERE ((o.agrmnt_clsfctn_id = ANY (ARRAY['-1024'::integer, '-1025'::integer])) AND (upper(o.agrmnt_clsfctn_val_cd) = 'TYPE_\u041a\u041a'::text))) type1 ON ((1 = 1)));",
  "expected_result": {
    "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
    "sources": [
      "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
      "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val",
      "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
      "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
      "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
      "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
      "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
      "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
      "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
      "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
      "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
      "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
      "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
      "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
      "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
      "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
      "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
      "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
      "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core"
    ]
  },
  "optimization_result": {
    "optimized_prompt": "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n1. **Target Table**:\n   - Identify the main table being inserted into (i.e., the `INSERT INTO` target).\n   - The target must be a fully qualified name (`schema.table`).\n\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `FROM (SELECT ...) AS alias`).\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n   - Do not include temporary or intermediate result sets.\n\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies.",
    "initial_prompt": "Please extract source-to-target lineage from the SQL query with the following requirements:\n\n### SQL Lineage Extraction Task\nExtract source-to-target lineage from the SQL statement below. Return ONLY valid JSON containing:\n- \"target\": The main object being created or modified (fully qualified name)\n- \"sources\": List of DISTINCT base tables/views (fully qualified names)",
    "f1_score": 1.0,
    "is_perfect": true,
    "iterations": 3,
    "iteration_found": 4,
    "final_validation": {
      "status": "SUCCESS",
      "validation_type": "comprehensive",
      "message": "All validations passed",
      "result": {
        "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
        "sources": [
          "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
          "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
          "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
          "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
          "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
          "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
          "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
          "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
          "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
          "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
          "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
          "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
          "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
          "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
        ]
      },
      "metrics": {
        "precision": 1.0,
        "recall": 1.0,
        "f1_score": 1.0
      }
    },
    "all_prompts": [
      "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n1. **Target Table**: Identify the main table being inserted into (i.e., the `INSERT INTO` target). It must be a fully qualified name (`schema.table`).\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause of the query.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `SELECT * FROM (SELECT ...) AS alias`).\n   - Do not include temporary or intermediate result sets.\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies.",
      "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n\n1. **Target Table**:\n   - Identify the main table being inserted into (i.e., the `INSERT INTO` target).\n   - The target must be a fully qualified name (`schema.table`).\n\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `FROM (SELECT ...) AS alias`).\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n   - Do not include temporary or intermediate result sets.\n\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies.",
      "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n1. **Target Table**:\n   - Identify the main table being inserted into (i.e., the `INSERT INTO` target).\n   - The target must be a fully qualified name (`schema.table`).\n\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `FROM (SELECT ...) AS alias`).\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n   - Do not include temporary or intermediate result sets.\n\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies."
    ],
    "validation_history": [
      {
        "status": "SUCCESS",
        "validation_type": "comprehensive",
        "message": "All validations passed",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        },
        "metrics": {
          "precision": 1.0,
          "recall": 0.9473684210526315,
          "f1_score": 0.972972972972973
        }
      },
      {
        "status": "FAILED",
        "validation_type": "uniqueness",
        "message": "Duplicate sources found: ['s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo', 's_grnplm_as_t_didsd_010_vd_dwh.v_coa']",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        }
      },
      {
        "status": "FAILED",
        "validation_type": "uniqueness",
        "message": "Duplicate sources found: ['s_grnplm_as_t_didsd_010_vd_dwh.v_coa']",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        }
      },
      {
        "status": "SUCCESS",
        "validation_type": "comprehensive",
        "message": "All validations passed",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        },
        "metrics": {
          "precision": 1.0,
          "recall": 1.0,
          "f1_score": 1.0
        }
      }
    ],
    "extractor_used": true
  },
  "iteration_details": [
    {
      "iteration": 1,
      "prompt": "Please extract source-to-target lineage from the SQL query with the following requirements:\n\n### SQL Lineage Extraction Task\nExtract source-to-target lineage from the SQL statement below. Return ONLY valid JSON containing:\n- \"target\": The main object being created or modified (fully qualified name)\n- \"sources\": List of DISTINCT base tables/views (fully qualified names)",
      "validation": {
        "status": "SUCCESS",
        "validation_type": "comprehensive",
        "message": "All validations passed",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        },
        "metrics": {
          "precision": 1.0,
          "recall": 0.9473684210526315,
          "f1_score": 0.972972972972973
        }
      }
    },
    {
      "iteration": 2,
      "prompt": "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n1. **Target Table**: Identify the main table being inserted into (i.e., the `INSERT INTO` target). It must be a fully qualified name (`schema.table`).\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause of the query.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `SELECT * FROM (SELECT ...) AS alias`).\n   - Do not include temporary or intermediate result sets.\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies.",
      "validation": {
        "status": "FAILED",
        "validation_type": "uniqueness",
        "message": "Duplicate sources found: ['s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo', 's_grnplm_as_t_didsd_010_vd_dwh.v_coa']",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        }
      }
    },
    {
      "iteration": 3,
      "prompt": "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n\n1. **Target Table**:\n   - Identify the main table being inserted into (i.e., the `INSERT INTO` target).\n   - The target must be a fully qualified name (`schema.table`).\n\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `FROM (SELECT ...) AS alias`).\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n   - Do not include temporary or intermediate result sets.\n\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies.",
      "validation": {
        "status": "FAILED",
        "validation_type": "uniqueness",
        "message": "Duplicate sources found: ['s_grnplm_as_t_didsd_010_vd_dwh.v_coa']",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        }
      }
    },
    {
      "iteration": 4,
      "prompt": "Please extract the source-to-target lineage from the provided SQL INSERT statement. Return **only** a valid JSON object with the following structure:\n\n```json\n{\n  \"target\": \"schema.table\",\n  \"sources\": [\"schema1.table1\", \"schema2.table2\", ...]\n}\n```\n\n1. **Target Table**:\n   - Identify the main table being inserted into (i.e., the `INSERT INTO` target).\n   - The target must be a fully qualified name (`schema.table`).\n\n2. **Source Tables**:\n   - Only include base tables or views directly referenced in the `FROM` clause.\n   - Exclude any derived tables, CTEs, subqueries, or aliases (e.g., `FROM (SELECT ...) AS alias`).\n   - Ensure all source names are fully qualified (`schema.table`).\n   - Remove duplicate entries from the sources list.\n   - Do not include temporary or intermediate result sets.\n\n3. **Output Format**:\n   - The JSON must be valid and contain exactly two keys: `\"target\"` and `\"sources\"`.\n   - The `\"sources\"` value must be a list of unique, fully qualified table/view names.\n   - Do not return any additional text, explanation, or formatting outside of this JSON structure.\n\nAnalyze the given SQL carefully to ensure correct identification of the target and its direct dependencies.",
      "validation": {
        "status": "SUCCESS",
        "validation_type": "comprehensive",
        "message": "All validations passed",
        "result": {
          "target": "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred",
          "sources": [
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_$eks_agrmnt_to_coa_3",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_crncy",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_metric_hist$$$",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_$uvdo_ttovarlc",
            "s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type",
            "s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref",
            "s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s",
            "s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val"
          ]
        },
        "metrics": {
          "precision": 1.0,
          "recall": 1.0,
          "f1_score": 1.0
        }
      }
    }
  ]
}