"table_name","view_def"
d_agr_collat_dmcl_attr," WITH pprb_attr_val AS (
         SELECT a_agr_collat_mkt_period.host_eks_id AS host_agr_collat_id,
            a_agr_collat_mkt_period.start_dt,
            a_agr_collat_mkt_period.end_dt,
            'mkt_price_amt'::text AS attr_name,
            a_agr_collat_mkt_period.mkt_price_amt AS attr_val_numeric,
            NULL::uuid AS attr_val_uuid,
            NULL::bigint AS attr_val_bigint
           FROM s_grnplm_vd_t_bvd_db_dmcl.a_agr_collat_mkt_period
          WHERE (a_agr_collat_mkt_period.mkt_price_amt IS NOT NULL)
        UNION ALL
         SELECT a_agr_collat_mkt_period.host_eks_id AS host_agr_collat_id,
            a_agr_collat_mkt_period.start_dt,
            a_agr_collat_mkt_period.end_dt,
            'mkt_price_rub'::text AS attr_name,
            a_agr_collat_mkt_period.mkt_price_rub AS attr_val_numeric,
            NULL::uuid AS attr_val_uuid,
            NULL::bigint AS attr_val_bigint
           FROM s_grnplm_vd_t_bvd_db_dmcl.a_agr_collat_mkt_period
          WHERE (a_agr_collat_mkt_period.mkt_price_rub IS NOT NULL)
        UNION ALL
         SELECT mkt_prd.host_eks_id AS host_agr_collat_id,
            mkt_prd.start_dt,
            mkt_prd.end_dt,
            'mkt_crncy_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            NULL::uuid AS attr_val_uuid,
            v_crncy.crncy_id AS attr_val_bigint
           FROM (((s_grnplm_vd_t_bvd_db_dmcl.a_agr_collat_mkt_period mkt_prd
             LEFT JOIN s_grnplm_as_t_didsd_701_vd_dwh.v_crncy vc ON ((mkt_prd.mkt_crncy_id = vc.crncy_id)))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmcl.d_prvsn_crncy ON ((d_prvsn_crncy.c_idmdmp = vc.crncy_cd)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy v_crncy ON (((v_crncy.crncy_cd = d_prvsn_crncy.c_code) AND (v_crncy.info_system_id = 1107))))
          WHERE (mkt_prd.mkt_crncy_id IS NOT NULL)
        UNION ALL
         SELECT t.host_eks_agr_collat_id AS host_agr_collat_id,
            a.start_dt,
            a.end_dt,
            'agr_collat_qlty_cat_type_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            a.agr_collat_qlty_cat_type_id AS attr_val_uuid,
            NULL::bigint AS attr_val_bigint
           FROM (s_grnplm_vd_t_bvd_db_dmcl.a_agr_collat_qlty_period a
             JOIN s_grnplm_vd_t_bvd_db_dmcl.d_agr_collat t ON ((a.agr_collat_id = t.agr_collat_id)))
          WHERE (a.agr_collat_qlty_cat_type_id IS NOT NULL)
        UNION ALL
         SELECT t.host_eks_agr_collat_id AS host_agr_collat_id,
            a.start_dt,
            a.end_dt,
            'asset_collat_type_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            a.asset_collat_type_id AS attr_val_uuid,
            NULL::bigint AS attr_val_bigint
           FROM (s_grnplm_vd_t_bvd_db_dmcl.a_agr_collat_qlty_period a
             JOIN s_grnplm_vd_t_bvd_db_dmcl.d_agr_collat t ON ((a.agr_collat_id = t.agr_collat_id)))
          WHERE (a.asset_collat_type_id IS NOT NULL)
        )
 SELECT t2.agr_collat_id,
    t1.host_agr_collat_id,
    t1.start_dt,
    t1.end_dt,
    t1.attr_name,
    t1.attr_val_numeric,
    t1.attr_val_uuid,
    COALESCE(t1.attr_val_bigint, (abs(uuid_hash(t1.attr_val_uuid)))::bigint) AS attr_val_uuid2bigint
   FROM (pprb_attr_val t1
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat t2 ON ((t1.host_agr_collat_id = t2.host_agr_collat_id)));"
d_agr_cred_dmcl_attr," WITH cte_agr_cred_qlty_period AS (
         SELECT crd.host_eks_agr_id,
            t.start_dt,
            t.end_dt,
            t.agr_qlty_cat_type_id,
            t.agr_srv_qlty_type_id,
            t.cred_worthiness_id,
            t.prvsn_port_flag
           FROM (s_grnplm_vd_t_bvd_db_dmcl.a_agr_cred_qlty_period t
             JOIN s_grnplm_vd_t_bvd_db_dmcl.d_agr_cred crd ON ((t.agr_cred_id = crd.agr_cred_id)))
          WHERE (crd.agr_cred_id = crd.prnt_agr_cred_id)
        ), pprb_attr_val AS (
         SELECT cte_agr_cred_qlty_period.host_eks_agr_id,
            cte_agr_cred_qlty_period.start_dt,
            cte_agr_cred_qlty_period.end_dt,
            'agr_qlty_cat_type_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            cte_agr_cred_qlty_period.agr_qlty_cat_type_id AS attr_val_uuid,
            NULL::text AS attr_val_text
           FROM cte_agr_cred_qlty_period
          WHERE (cte_agr_cred_qlty_period.agr_qlty_cat_type_id IS NOT NULL)
        UNION ALL
         SELECT cte_agr_cred_qlty_period.host_eks_agr_id,
            cte_agr_cred_qlty_period.start_dt,
            cte_agr_cred_qlty_period.end_dt,
            'agr_srv_qlty_type_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            cte_agr_cred_qlty_period.agr_srv_qlty_type_id AS attr_val_uuid,
            NULL::text AS attr_val_text
           FROM cte_agr_cred_qlty_period
          WHERE (cte_agr_cred_qlty_period.agr_srv_qlty_type_id IS NOT NULL)
        UNION ALL
         SELECT cte_agr_cred_qlty_period.host_eks_agr_id,
            cte_agr_cred_qlty_period.start_dt,
            cte_agr_cred_qlty_period.end_dt,
            'prvsn_port_flag'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            NULL::uuid AS attr_val_uuid,
            cte_agr_cred_qlty_period.prvsn_port_flag AS attr_val_text
           FROM cte_agr_cred_qlty_period
          WHERE (cte_agr_cred_qlty_period.prvsn_port_flag IS NOT NULL)
        UNION ALL
         SELECT cte_agr_cred_qlty_period.host_eks_agr_id,
            cte_agr_cred_qlty_period.start_dt,
            cte_agr_cred_qlty_period.end_dt,
            'cred_worthiness_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            cte_agr_cred_qlty_period.cred_worthiness_id AS attr_val_uuid,
            NULL::text AS attr_val_text
           FROM cte_agr_cred_qlty_period
          WHERE (cte_agr_cred_qlty_period.cred_worthiness_id IS NOT NULL)
        UNION ALL
         SELECT crd.host_eks_agr_id,
            t.start_dt,
            t.end_dt,
            'cust_fin_pos_type_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            t.cust_fin_pos_type_id AS attr_val_uuid,
            NULL::text AS attr_val_text
           FROM (s_grnplm_vd_t_bvd_db_dmcl.a_agr_cred_clsfctn_fin_pos_period t
             JOIN s_grnplm_vd_t_bvd_db_dmcl.d_agr_cred crd ON (((t.agr_cred_id = crd.agr_cred_id) AND (crd.agr_cred_id = crd.prnt_agr_cred_id))))
        UNION ALL
         SELECT crd.host_eks_agr_id,
            t.start_dt,
            t.end_dt,
            'f303_inf_type_id'::text AS attr_name,
            NULL::numeric AS attr_val_numeric,
            t.f303_inf_type_id AS attr_val_uuid,
            NULL::text AS attr_val_text
           FROM (s_grnplm_vd_t_bvd_db_dmcl.a_agr_cred_f303_inf_type_period t
             JOIN s_grnplm_vd_t_bvd_db_dmcl.d_agr_cred crd ON (((t.agr_cred_id = crd.agr_cred_id) AND (crd.agr_cred_id = crd.prnt_agr_cred_id))))
        UNION ALL
         SELECT crd.host_eks_agr_id,
            t.start_dt,
            t.end_dt,
            'prvsn_rate'::text AS attr_name,
            t.prvsn_rate AS attr_val_numeric,
            NULL::uuid AS attr_val_uuid,
            NULL::text AS attr_val_text
           FROM (s_grnplm_vd_t_bvd_db_dmcl.a_agr_cred_prvsn_period t
             JOIN s_grnplm_vd_t_bvd_db_dmcl.d_agr_cred crd ON (((t.agr_cred_id = crd.agr_cred_id) AND (crd.agr_cred_id = crd.prnt_agr_cred_id))))
        ), high_level_agr AS (
         SELECT t2_1.agr_cred_id,
            t1_1.host_eks_agr_id AS host_agr_cred_id,
            t1_1.start_dt,
            t1_1.end_dt,
            t1_1.attr_name,
            t1_1.attr_val_numeric,
            t1_1.attr_val_uuid,
            (abs(uuid_hash(t1_1.attr_val_uuid)))::bigint AS attr_val_uuid2bigint,
            t1_1.attr_val_text
           FROM (pprb_attr_val t1_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp t2_1 ON ((t1_1.host_eks_agr_id = t2_1.host_agr_cred_id)))
        )
 SELECT t2.agr_cred_id,
    t1.host_agr_cred_id,
    t1.start_dt,
    t1.end_dt,
    t1.attr_name,
    t1.attr_val_numeric,
    t1.attr_val_uuid,
    t1.attr_val_uuid2bigint,
    t1.attr_val_text
   FROM (high_level_agr t1
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t2 ON ((t1.agr_cred_id = t2.prnt_agr_cred_id)));"
d_agr_cred_ifrs9," WITH cte_st AS (
         SELECT COALESCE(max(meta_dm_param.param_val), '010'::text) AS prvsn_attr_src
           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
          WHERE (meta_dm_param.param_cd = 'PRVSN_ATTR_SRC'::text)
        )
 SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    arb.acct_rate AS loss_allowance_bal_rate,
    arvb.acct_rate AS loss_allowance_off_rate,
    aaca_1041.agrmnt_class_val_id AS following_acct_model_id,
    are.acct_rate AS effective_intrst_rate,
    amps.acct_bal_metric_amt AS third_prvsn_stg_issue_amt,
    amrb.acct_bal_metric_amt AS eks_loss_allowance_bal_rub,
    amrvb.acct_bal_metric_amt AS eks_loss_allowance_off_rub,
    aph.prod_id AS ifrs9_prod_id,
    aaca_1043.agrmnt_class_val_id AS bus_model_ifrs9_val_id,
    aaca_1044.agrmnt_class_val_id AS sppi_result_ifrs9_val_id,
    aaca_1045.agrmnt_class_val_id AS markt_tst_res_ifrs9_val_id,
    aaca_1046.agrmnt_class_val_id AS type_used_data_ifrs9_val_id,
        CASE
            WHEN (aaca_1047.agrmnt_class_val_id = '-1001'::integer) THEN 'Y'::text
            WHEN (aaca_1047.agrmnt_class_val_id = '-1002'::integer) THEN 'N'::text
            ELSE NULL::text
        END AS apply_eps_flag,
    are_1002.acct_rate AS market_rate,
    amh_1061.acct_bal_metric_dt AS ifrs9_default_dt,
    COALESCE(dmcl_attr.attr_val_text,
        CASE
            WHEN (aaca_1042.agrmnt_class_val_id = '-1001'::integer) THEN '1'::text
            WHEN (aaca_1042.agrmnt_class_val_id = '-1002'::integer) THEN '2'::text
            WHEN (aaca_1042.agrmnt_class_val_id = '-1003'::integer) THEN '3'::text
            ELSE NULL::text
        END) AS ifrs9_stage_cd,
    msfo9_hist.eks_host_uit_modify_id AS uit_modify_id,
    agr.info_system_id,
    arlmot.acct_rate AS loss_allowance_off_cp_rate,
    amrlmot.acct_bal_metric_amt AS eks_loss_allowance_off_cp_rub
   FROM ((((((((((((((((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT ar.agrmnt_id AS id,
                            ar.acct_rate_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate ar
                          WHERE ((((((ar.rate_type_id = ANY (ARRAY[2, 4, 5, '-1002'::integer, '-1006'::integer])) AND (ar.fin_meas_id = '-1'::integer)) AND (ar.intrst_calc_type_id = '-1'::integer)) AND (ar.intrst_rate_type_id = 1)) AND (ar.intrst_calc_rule_type_id = '-1'::integer)) AND (ar.bal_cat_type_id = 5))
                        UNION ALL
                         SELECT ar.agrmnt_id AS id,
                            (ar.acct_rate_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate ar
                          WHERE (((((((ar.rate_type_id = ANY (ARRAY[2, 4, 5, '-1002'::integer, '-1006'::integer])) AND (ar.fin_meas_id = '-1'::integer)) AND (ar.intrst_calc_type_id = '-1'::integer)) AND (ar.intrst_rate_type_id = 1)) AND (ar.intrst_calc_rule_type_id = '-1'::integer)) AND (ar.bal_cat_type_id = 5)) AND (ar.acct_rate_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT am.agrmnt_id AS id,
                            am.acct_bal_metric_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist am
                          WHERE (am.acct_metric_type_id = ANY (ARRAY['-1056'::integer, '-1057'::integer, '-1058'::integer, '-1061'::integer, '-1076'::integer]))
                        UNION ALL
                         SELECT am.agrmnt_id AS id,
                            (am.acct_bal_metric_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist am
                          WHERE ((am.acct_metric_type_id = ANY (ARRAY['-1056'::integer, '-1057'::integer, '-1058'::integer, '-1061'::integer, '-1076'::integer])) AND (am.acct_bal_metric_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_agmt_agmt_class_assoc.agrmnt_id AS id,
                            v_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
                          WHERE (v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY['-1041'::integer, '-1042'::integer, '-1043'::integer, '-1044'::integer, '-1045'::integer, '-1046'::integer, '-1047'::integer]))
                        UNION ALL
                         SELECT v_agmt_agmt_class_assoc.agrmnt_id AS id,
                            (v_agmt_agmt_class_assoc.agrmnt_class_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
                          WHERE ((v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY['-1041'::integer, '-1042'::integer, '-1043'::integer, '-1044'::integer, '-1045'::integer, '-1046'::integer, '-1047'::integer])) AND (v_agmt_agmt_class_assoc.agrmnt_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_acct_prod_hist.agrmnt_id AS id,
                            v_acct_prod_hist.acct_prod_assoc_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_prod_hist
                          WHERE (v_acct_prod_hist.agrmnt_prod_role_id = '-1007'::integer)
                        UNION ALL
                         SELECT v_acct_prod_hist.agrmnt_id AS id,
                            (v_acct_prod_hist.acct_prod_assoc_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_prod_hist
                          WHERE ((v_acct_prod_hist.agrmnt_prod_role_id = '-1007'::integer) AND (v_acct_prod_hist.acct_prod_assoc_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT ""v_$eks_msfo9_hist"".agrmnt_id AS id,
                            ""v_$eks_msfo9_hist"".eks_msfo9_hist_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_msfo9_hist""
                          WHERE (""v_$eks_msfo9_hist"".eks_host_uit_modify_id IS NOT NULL)
                        UNION ALL
                         SELECT ""v_$eks_msfo9_hist"".agrmnt_id AS id,
                            (""v_$eks_msfo9_hist"".eks_msfo9_hist_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_msfo9_hist""
                          WHERE ((""v_$eks_msfo9_hist"".eks_host_uit_modify_id IS NOT NULL) AND (""v_$eks_msfo9_hist"".eks_msfo9_hist_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT src.id,
                            src.start_dt
                           FROM (( SELECT d_agr_cred_dmcl_attr.agr_cred_id AS id,
                                    d_agr_cred_dmcl_attr.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr
                                  WHERE (d_agr_cred_dmcl_attr.attr_name = 'ifrs9_stage_cd'::text)
                                UNION ALL
                                 SELECT d_agr_cred_dmcl_attr.agr_cred_id AS id,
                                    (d_agr_cred_dmcl_attr.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr
                                  WHERE ((d_agr_cred_dmcl_attr.attr_name = 'ifrs9_stage_cd'::text) AND (d_agr_cred_dmcl_attr.end_dt <> '9999-12-31'::date))) src
                             JOIN cte_st cte_st_1 ON ((1 = 1)))
                          WHERE (cte_st_1.prvsn_attr_src = '701'::text)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((dt.id = agr.agr_cred_id)))
     JOIN cte_st ON ((1 = 1)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate arb ON ((((((((((dt.id = arb.agrmnt_id) AND (arb.fin_meas_id = '-1'::integer)) AND (arb.intrst_calc_type_id = '-1'::integer)) AND (arb.intrst_rate_type_id = 1)) AND (arb.intrst_calc_rule_type_id = '-1'::integer)) AND (arb.rate_type_id = 4)) AND (arb.bal_cat_type_id = 5)) AND (dt.start_dt >= arb.acct_rate_start_dt)) AND (dt.start_dt <= arb.acct_rate_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate arvb ON ((((((((((dt.id = arvb.agrmnt_id) AND (arvb.fin_meas_id = '-1'::integer)) AND (arvb.intrst_calc_type_id = '-1'::integer)) AND (arvb.intrst_rate_type_id = 1)) AND (arvb.intrst_calc_rule_type_id = '-1'::integer)) AND (arvb.rate_type_id = 5)) AND (arvb.bal_cat_type_id = 5)) AND (dt.start_dt >= arvb.acct_rate_start_dt)) AND (dt.start_dt <= arvb.acct_rate_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate are ON ((((((((((dt.id = are.agrmnt_id) AND (are.fin_meas_id = '-1'::integer)) AND (are.intrst_calc_type_id = '-1'::integer)) AND (are.intrst_rate_type_id = 1)) AND (are.intrst_calc_rule_type_id = '-1'::integer)) AND (are.rate_type_id = 2)) AND (are.bal_cat_type_id = 5)) AND (dt.start_dt >= are.acct_rate_start_dt)) AND (dt.start_dt <= are.acct_rate_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate arlmot ON ((((((((((dt.id = arlmot.agrmnt_id) AND (arlmot.fin_meas_id = '-1'::integer)) AND (arlmot.intrst_calc_type_id = '-1'::integer)) AND (arlmot.intrst_rate_type_id = 1)) AND (arlmot.intrst_calc_rule_type_id = '-1'::integer)) AND (arlmot.rate_type_id = '-1006'::integer)) AND (arlmot.bal_cat_type_id = 5)) AND (dt.start_dt >= arlmot.acct_rate_start_dt)) AND (dt.start_dt <= arlmot.acct_rate_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amrb ON (((((dt.id = amrb.agrmnt_id) AND (amrb.acct_metric_type_id = '-1056'::integer)) AND (dt.start_dt >= amrb.acct_bal_metric_start_dt)) AND (dt.start_dt <= amrb.acct_bal_metric_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amrvb ON (((((dt.id = amrvb.agrmnt_id) AND (amrvb.acct_metric_type_id = '-1057'::integer)) AND (dt.start_dt >= amrvb.acct_bal_metric_start_dt)) AND (dt.start_dt <= amrvb.acct_bal_metric_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amps ON (((((dt.id = amps.agrmnt_id) AND (amps.acct_metric_type_id = '-1058'::integer)) AND (dt.start_dt >= amps.acct_bal_metric_start_dt)) AND (dt.start_dt <= amps.acct_bal_metric_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amrlmot ON (((((dt.id = amrlmot.agrmnt_id) AND (amrlmot.acct_metric_type_id = '-1076'::integer)) AND (dt.start_dt >= amrlmot.acct_bal_metric_start_dt)) AND (dt.start_dt <= amrlmot.acct_bal_metric_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1041 ON (((((dt.id = aaca_1041.agrmnt_id) AND (aaca_1041.agrmnt_clsfctn_id = '-1041'::integer)) AND (dt.start_dt >= aaca_1041.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1041.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_prod_hist aph ON (((((dt.id = aph.agrmnt_id) AND (aph.agrmnt_prod_role_id = '-1007'::integer)) AND (dt.start_dt >= aph.acct_prod_assoc_start_dt)) AND (dt.start_dt <= aph.acct_prod_assoc_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1042 ON (((((dt.id = aaca_1042.agrmnt_id) AND (aaca_1042.agrmnt_clsfctn_id = '-1042'::integer)) AND (dt.start_dt >= aaca_1042.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1042.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr dmcl_attr ON ((((((dt.id = dmcl_attr.agr_cred_id) AND (dmcl_attr.attr_name = 'ifrs9_stage_cd'::text)) AND (dt.start_dt >= dmcl_attr.start_dt)) AND (dt.start_dt <= dmcl_attr.end_dt)) AND (cte_st.prvsn_attr_src = '701'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1043 ON (((((dt.id = aaca_1043.agrmnt_id) AND (aaca_1043.agrmnt_clsfctn_id = '-1043'::integer)) AND (dt.start_dt >= aaca_1043.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1043.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1044 ON (((((dt.id = aaca_1044.agrmnt_id) AND (aaca_1044.agrmnt_clsfctn_id = '-1044'::integer)) AND (dt.start_dt >= aaca_1044.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1044.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1045 ON (((((dt.id = aaca_1045.agrmnt_id) AND (aaca_1045.agrmnt_clsfctn_id = '-1045'::integer)) AND (dt.start_dt >= aaca_1045.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1045.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1046 ON (((((dt.id = aaca_1046.agrmnt_id) AND (aaca_1046.agrmnt_clsfctn_id = '-1046'::integer)) AND (dt.start_dt >= aaca_1046.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1046.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_1047 ON (((((dt.id = aaca_1047.agrmnt_id) AND (aaca_1047.agrmnt_clsfctn_id = '-1047'::integer)) AND (dt.start_dt >= aaca_1047.agrmnt_class_start_dt)) AND (dt.start_dt <= aaca_1047.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate are_1002 ON ((((((((((dt.id = are_1002.agrmnt_id) AND (are_1002.fin_meas_id = '-1'::integer)) AND (are_1002.intrst_calc_type_id = '-1'::integer)) AND (are_1002.intrst_rate_type_id = 1)) AND (are_1002.intrst_calc_rule_type_id = '-1'::integer)) AND (are_1002.rate_type_id = '-1002'::integer)) AND (are_1002.bal_cat_type_id = 5)) AND (dt.start_dt >= are_1002.acct_rate_start_dt)) AND (dt.start_dt <= are_1002.acct_rate_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amh_1061 ON (((((dt.id = amh_1061.agrmnt_id) AND (amh_1061.acct_metric_type_id = '-1061'::integer)) AND (dt.start_dt >= amh_1061.acct_bal_metric_start_dt)) AND (dt.start_dt <= amh_1061.acct_bal_metric_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_msfo9_hist"" msfo9_hist ON (((((dt.id = msfo9_hist.agrmnt_id) AND (dt.start_dt >= msfo9_hist.eks_msfo9_hist_start_dt)) AND (dt.start_dt <= msfo9_hist.eks_msfo9_hist_end_dt)) AND (msfo9_hist.eks_host_uit_modify_id IS NOT NULL))))
UNION ALL
 SELECT dt.agr_cred_id,
    '1900-01-01'::date AS start_dt,
    '9999-12-31'::date AS end_dt,
    NULL::numeric(15,12) AS loss_allowance_bal_rate,
    NULL::numeric(15,12) AS loss_allowance_off_rate,
    NULL::bigint AS following_acct_model_id,
    NULL::numeric(15,12) AS effective_intrst_rate,
    NULL::numeric(26,4) AS third_prvsn_stg_issue_amt,
    NULL::numeric(26,4) AS eks_loss_allowance_bal_rub,
    NULL::numeric(26,4) AS eks_loss_allowance_off_rub,
    NULL::bigint AS ifrs9_prod_id,
    NULL::bigint AS bus_model_ifrs9_val_id,
    NULL::bigint AS sppi_result_ifrs9_val_id,
    NULL::bigint AS markt_tst_res_ifrs9_val_id,
    NULL::bigint AS type_used_data_ifrs9_val_id,
    NULL::text AS apply_eps_flag,
    NULL::numeric(15,12) AS market_rate,
    NULL::date AS ifrs9_default_dt,
    '1'::text AS ifrs9_stage_cd,
    NULL::text AS uit_modify_id,
    dt.info_system_id,
    NULL::numeric(15,12) AS loss_allowance_off_cp_rate,
    NULL::numeric(26,4) AS eks_loss_allowance_off_cp_rub
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core dt;"
d_agr_cred_qlty," WITH cte_st AS (
         SELECT COALESCE(max(meta_dm_param.param_val), '010'::text) AS prvsn_attr_src
           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
          WHERE (meta_dm_param.param_cd = 'PRVSN_ATTR_SRC'::text)
        )
 SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(agr_cred_qlty_pprb_1.attr_val_uuid2bigint, qlty_cat.agrmnt_class_val_id) AS agr_qlty_cat_type_id,
    srv_qlty.agrmnt_class_val_id AS eks_agr_srv_qlty_type_id,
    cor.info_system_id,
    COALESCE(agr_cred_qlty_pprb_2.attr_val_uuid2bigint, arg.risk_grade_id) AS cred_worthiness_id
   FROM (((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT c_agmt_agmt_class_assoc.agrmnt_id AS id,
                            c_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                          WHERE (c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY[5, 6]))
                        UNION ALL
                         SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                            (c_agmt_agmt_class_assoc.agrmnt_class_end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                          WHERE ((c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY[5, 6])) AND (c_agmt_agmt_class_assoc.agrmnt_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT c_acct_risk_grade.agrmnt_id AS id,
                            c_acct_risk_grade.acct_risk_grade_start_dt AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.c_acct_risk_grade
                          WHERE (c_acct_risk_grade.risk_grade_scheme_id = '-1003'::integer)
                        UNION ALL
                         SELECT c_acct_risk_grade.agrmnt_id,
                            (c_acct_risk_grade.acct_risk_grade_end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.c_acct_risk_grade
                          WHERE ((c_acct_risk_grade.risk_grade_scheme_id = '-1003'::integer) AND (c_acct_risk_grade.acct_risk_grade_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT src.agr_cred_id AS id,
                            src.start_dt
                           FROM (( SELECT src_1.agr_cred_id,
                                    src_1.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr src_1
                                  WHERE (src_1.attr_name = 'agr_qlty_cat_type_id'::text)
                                UNION ALL
                                 SELECT src_1.agr_cred_id,
                                    (src_1.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr src_1
                                  WHERE ((src_1.attr_name = 'agr_qlty_cat_type_id'::text) AND (src_1.end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT src_1.agr_cred_id,
                                    src_1.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr src_1
                                  WHERE (src_1.attr_name = 'cred_worthiness_id'::text)
                                UNION ALL
                                 SELECT src_1.agr_cred_id,
                                    (src_1.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr src_1
                                  WHERE ((src_1.attr_name = 'cred_worthiness_id'::text) AND (src_1.end_dt <> '9999-12-31'::date))) src
                             JOIN cte_st cte_st_1 ON ((1 = 1)))
                          WHERE (cte_st_1.prvsn_attr_src = '701'::text)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = dt.id)))
     JOIN cte_st ON ((1 = 1)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc qlty_cat ON (((((qlty_cat.agrmnt_id = dt.id) AND (dt.start_dt >= qlty_cat.agrmnt_class_start_dt)) AND (dt.start_dt <= qlty_cat.agrmnt_class_end_dt)) AND (qlty_cat.agrmnt_clsfctn_id = 5))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc srv_qlty ON (((((srv_qlty.agrmnt_id = dt.id) AND (dt.start_dt >= srv_qlty.agrmnt_class_start_dt)) AND (dt.start_dt <= srv_qlty.agrmnt_class_end_dt)) AND (srv_qlty.agrmnt_clsfctn_id = 6))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.c_acct_risk_grade arg ON (((((arg.agrmnt_id = dt.id) AND (dt.start_dt >= arg.acct_risk_grade_start_dt)) AND (dt.start_dt <= arg.acct_risk_grade_end_dt)) AND (arg.risk_grade_scheme_id = '-1003'::integer))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr agr_cred_qlty_pprb_1 ON ((((((agr_cred_qlty_pprb_1.agr_cred_id = dt.id) AND (agr_cred_qlty_pprb_1.attr_name = 'agr_qlty_cat_type_id'::text)) AND (dt.start_dt >= agr_cred_qlty_pprb_1.start_dt)) AND (dt.start_dt <= agr_cred_qlty_pprb_1.end_dt)) AND (cte_st.prvsn_attr_src = '701'::text))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr agr_cred_qlty_pprb_2 ON ((((((agr_cred_qlty_pprb_2.agr_cred_id = dt.id) AND (agr_cred_qlty_pprb_2.attr_name = 'cred_worthiness_id'::text)) AND (dt.start_dt >= agr_cred_qlty_pprb_2.start_dt)) AND (dt.start_dt <= agr_cred_qlty_pprb_2.end_dt)) AND (cte_st.prvsn_attr_src = '701'::text))));"
d_agr_cred_prvsn," WITH cte_new_history AS (
         SELECT src.agr_cred_id,
            min(src.start_dt) AS new_hist_start_dt
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr src
          WHERE (src.attr_name = 'prvsn_rate'::text)
          GROUP BY src.agr_cred_id
        ), cte_st AS (
         SELECT COALESCE(max(meta_dm_param.param_val), '010'::text) AS prvsn_attr_src
           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
          WHERE (meta_dm_param.param_cd = 'PRVSN_ATTR_SRC'::text)
        )
 SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.prvsn_rate,
    t.info_system_id
   FROM (( SELECT agr.agr_cred_id,
            src.acct_rate_start_dt AS start_dt,
            (
                CASE
                    WHEN ((st.agr_cred_id IS NOT NULL) AND (src.acct_rate_end_dt >= st.new_hist_start_dt)) THEN (st.new_hist_start_dt - '1 day'::interval day)
                    ELSE (src.acct_rate_end_dt)::timestamp without time zone
                END)::date AS end_dt,
            src.acct_rate AS prvsn_rate,
            src.info_system_id
           FROM ((s_grnplm_vd_t_bvd_db_dmslcl.c_acct_rate src
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr ON ((src.agrmnt_id = agr.prnt_agr_cred_id)))
             LEFT JOIN cte_new_history st ON ((src.agrmnt_id = st.agr_cred_id)))
          WHERE ((src.bal_cat_type_id = 1) AND (src.acct_rate_start_dt < COALESCE(st.new_hist_start_dt, '9999-12-31'::date)))
        UNION ALL
         SELECT src.agr_cred_id,
            src.start_dt,
            src.end_dt,
            src.attr_val_numeric AS prvsn_rate,
            agr.info_system_id
           FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr src
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr ON ((src.agr_cred_id = agr.agr_cred_id)))
          WHERE (src.attr_name = 'prvsn_rate'::text)) t
     CROSS JOIN cte_st)
  WHERE (cte_st.prvsn_attr_src = '701'::text)
UNION ALL
 SELECT agr.agr_cred_id,
    src.acct_rate_start_dt AS start_dt,
    src.acct_rate_end_dt AS end_dt,
    src.acct_rate AS prvsn_rate,
    src.info_system_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.c_acct_rate src
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr ON ((src.agrmnt_id = agr.prnt_agr_cred_id)))
     CROSS JOIN cte_st)
  WHERE ((src.bal_cat_type_id = 1) AND (cte_st.prvsn_attr_src = '010'::text));"
d_agr_cred_fin_f303_inf," WITH cte_st AS (
         SELECT COALESCE(max(meta_dm_param.param_val), '010'::text) AS prvsn_attr_src
           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
          WHERE (meta_dm_param.param_cd = 'PRVSN_ATTR_SRC'::text)
        )
 SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(dmcl_attr.attr_val_uuid2bigint, ama.agrmnt_multi_val_id) AS f303_inf_type_id,
    agr.info_system_id
   FROM ((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT ama_1.agrmnt_id AS id,
                            ama_1.agrmnt_multi_assoc_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama_1
                          WHERE (ama_1.agrmnt_multi_scheme_id = '-1003'::integer)
                        UNION ALL
                         SELECT ama_1.agrmnt_id AS id,
                            (ama_1.agrmnt_multi_assoc_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama_1
                          WHERE ((ama_1.agrmnt_multi_scheme_id = '-1003'::integer) AND (ama_1.agrmnt_multi_assoc_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT src.id,
                            src.start_dt
                           FROM (( SELECT d_agr_cred_dmcl_attr.agr_cred_id AS id,
                                    d_agr_cred_dmcl_attr.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr
                                  WHERE (d_agr_cred_dmcl_attr.attr_name = 'f303_inf_type_id'::text)
                                UNION ALL
                                 SELECT d_agr_cred_dmcl_attr.agr_cred_id AS id,
                                    (d_agr_cred_dmcl_attr.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr
                                  WHERE ((d_agr_cred_dmcl_attr.attr_name = 'f303_inf_type_id'::text) AND (d_agr_cred_dmcl_attr.end_dt <> '9999-12-31'::date))) src
                             JOIN cte_st cte_st_1 ON ((1 = 1)))
                          WHERE (cte_st_1.prvsn_attr_src = '701'::text)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((dt.id = agr.agr_cred_id)))
     JOIN cte_st ON ((1 = 1)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama ON (((((dt.id = ama.agrmnt_id) AND (ama.agrmnt_multi_scheme_id = '-1003'::integer)) AND (dt.start_dt >= ama.agrmnt_multi_assoc_start_dt)) AND (dt.start_dt <= ama.agrmnt_multi_assoc_end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_dmcl_attr dmcl_attr ON ((((((dt.id = dmcl_attr.agr_cred_id) AND (dmcl_attr.attr_name = 'f303_inf_type_id'::text)) AND (dt.start_dt >= dmcl_attr.start_dt)) AND (dt.start_dt <= dmcl_attr.end_dt)) AND (cte_st.prvsn_attr_src = '701'::text))))
  WHERE (COALESCE(dmcl_attr.attr_val_uuid2bigint, ama.agrmnt_multi_val_id) IS NOT NULL)
  GROUP BY dt.id, dt.start_dt, dt.end_dt, COALESCE(dmcl_attr.attr_val_uuid2bigint, ama.agrmnt_multi_val_id), agr.info_system_id;"
d_agr_collat_mkt," WITH cte_new_history AS (
         SELECT src.agr_collat_id,
            min(src.start_dt) AS new_hist_start_dt
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_dmcl_attr src
          WHERE (src.attr_name = 'mkt_price_amt'::text)
          GROUP BY src.agr_collat_id
        ), cte_st AS (
         SELECT COALESCE(max(meta_dm_param.param_val), '010'::text) AS prvsn_attr_src
           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
          WHERE (meta_dm_param.param_cd = 'PRVSN_ATTR_SRC'::text)
        ), cte_eks_agr_collat_mkt AS (
         SELECT amh.agrmnt_id AS agr_collat_id,
            amh.acct_bal_metric_start_dt AS start_dt,
            amh.acct_bal_metric_end_dt AS end_dt,
            amh.acct_bal_metric_amt AS mkt_price_amt,
            amh.acct_bal_metric_amt AS mkt_price_rub,
            amh.acct_bal_metric_crncy_id AS mkt_crncy_id,
            amh.info_system_id
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amh
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat ac ON ((amh.agrmnt_id = ac.agr_collat_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy ccy ON ((amh.acct_bal_metric_crncy_id = ccy.crncy_id)))
          WHERE (((amh.bal_cat_type_id = '-1'::integer) AND (amh.acct_metric_type_id = '-1047'::integer)) AND ((ccy.crncy_cd = ANY (ARRAY['810'::text, '643'::text])) OR (amh.acct_bal_metric_crncy_id = '-1'::integer)))
        UNION ALL
         SELECT t.agr_collat_id,
            t.start_dt,
            t.end_dt,
            t.mkt_price_amt,
            t.mkt_price_rub,
            t.mkt_crncy_id,
            t.info_system_id
           FROM ( SELECT amh.agrmnt_id AS agr_collat_id,
                        CASE
                            WHEN (r.crncy_trans_start_dt > amh.acct_bal_metric_start_dt) THEN r.crncy_trans_start_dt
                            ELSE amh.acct_bal_metric_start_dt
                        END AS start_dt,
                        CASE
                            WHEN (r.crncy_trans_end_dt < amh.acct_bal_metric_end_dt) THEN r.crncy_trans_end_dt
                            ELSE amh.acct_bal_metric_end_dt
                        END AS end_dt,
                    amh.acct_bal_metric_amt AS mkt_price_amt,
                    ((amh.acct_bal_metric_amt * r.tgt_crncy_amt) / NULLIF(r.src_crncy_amt, (0)::numeric)) AS mkt_price_rub,
                    amh.acct_bal_metric_crncy_id AS mkt_crncy_id,
                    amh.info_system_id
                   FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amh
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat ac ON ((amh.agrmnt_id = ac.agr_collat_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy ccy ON ((amh.acct_bal_metric_crncy_id = ccy.crncy_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy_trans_rate_hist r ON ((((ccy.crncy_cd = r.src_crncy_cd) AND (r.tgt_crncy_cd = '810'::text)) AND (r.crncy_trans_rate_type_id = 1))))
                  WHERE ((((amh.bal_cat_type_id = '-1'::integer) AND (amh.acct_metric_type_id = '-1047'::integer)) AND (ccy.crncy_cd <> ALL (ARRAY['810'::text, '643'::text]))) AND (amh.acct_bal_metric_crncy_id <> '-1'::integer))) t
          WHERE ((1 = 1) AND (t.start_dt <= t.end_dt))
        )
 SELECT cte_eks_agr_collat_mkt.agr_collat_id,
    cte_eks_agr_collat_mkt.start_dt,
    cte_eks_agr_collat_mkt.end_dt,
    cte_eks_agr_collat_mkt.mkt_price_amt,
    cte_eks_agr_collat_mkt.mkt_price_rub,
    cte_eks_agr_collat_mkt.mkt_crncy_id,
    cte_eks_agr_collat_mkt.info_system_id
   FROM (cte_eks_agr_collat_mkt
     JOIN cte_st ON ((1 = 1)))
  WHERE (cte_st.prvsn_attr_src = '010'::text)
UNION ALL
 SELECT t.agr_collat_id,
    t.start_dt,
    t.end_dt,
    t.mkt_price_amt,
    t.mkt_price_rub,
    t.mkt_crncy_id,
    t.info_system_id
   FROM (( SELECT eks.agr_collat_id,
            eks.start_dt,
            (
                CASE
                    WHEN ((st.agr_collat_id IS NOT NULL) AND (eks.end_dt >= st.new_hist_start_dt)) THEN (st.new_hist_start_dt - '1 day'::interval day)
                    ELSE (eks.end_dt)::timestamp without time zone
                END)::date AS end_dt,
            eks.mkt_price_amt,
            eks.mkt_price_rub,
            eks.mkt_crncy_id,
            eks.info_system_id
           FROM ((cte_eks_agr_collat_mkt eks
             JOIN cte_st cte_st_1 ON ((1 = 1)))
             LEFT JOIN cte_new_history st ON ((eks.agr_collat_id = st.agr_collat_id)))
          WHERE (eks.start_dt < COALESCE(st.new_hist_start_dt, '9999-12-31'::date))
        UNION ALL
         SELECT d_agr_collat_dmcl_attr.agr_collat_id,
            d_agr_collat_dmcl_attr.start_dt,
            d_agr_collat_dmcl_attr.end_dt,
            max(
                CASE
                    WHEN (d_agr_collat_dmcl_attr.attr_name = 'mkt_price_amt'::text) THEN d_agr_collat_dmcl_attr.attr_val_numeric
                    ELSE NULL::numeric
                END) AS mkt_price_amt,
            max(
                CASE
                    WHEN (d_agr_collat_dmcl_attr.attr_name = 'mkt_price_rub'::text) THEN d_agr_collat_dmcl_attr.attr_val_numeric
                    ELSE NULL::numeric
                END) AS mkt_price_rub,
            max(
                CASE
                    WHEN (d_agr_collat_dmcl_attr.attr_name = 'mkt_crncy_id'::text) THEN d_agr_collat_dmcl_attr.attr_val_uuid2bigint
                    ELSE NULL::bigint
                END) AS mkt_crncy_id,
            (1108)::smallint AS info_system_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_dmcl_attr
          WHERE (d_agr_collat_dmcl_attr.attr_name = ANY (ARRAY['mkt_price_amt'::text, 'mkt_price_rub'::text, 'mkt_crncy_id'::text]))
          GROUP BY d_agr_collat_dmcl_attr.agr_collat_id, d_agr_collat_dmcl_attr.start_dt, d_agr_collat_dmcl_attr.end_dt) t
     JOIN cte_st ON ((1 = 1)))
  WHERE (cte_st.prvsn_attr_src = '701'::text);"
d_agr_cred_agr_collat_core," SELECT t.agr_cred_id,
    t.agr_collat_id,
    t.start_dt,
    t.end_dt,
    t.info_system_id
   FROM ( SELECT a.agr_cred_id,
            a.agr_collat_id,
            a.start_dt,
            max(a.end_dt) OVER (PARTITION BY a.agr_collat_id, a.agr_cred_id, a.new_part ORDER BY NULL::text) AS end_dt,
            a.info_system_id,
            a.grp_rn
           FROM ( SELECT a_1.agr_cred_id,
                    a_1.agr_collat_id,
                    a_1.start_dt,
                    a_1.info_system_id,
                    sum(
                        CASE
                            WHEN (a_1.grp_rn = 1) THEN 1
                            ELSE 0
                        END) OVER (PARTITION BY a_1.agr_collat_id, a_1.agr_cred_id ORDER BY a_1.start_dt) AS new_part,
                    a_1.end_dt,
                    a_1.grp_rn
                   FROM ( SELECT d_agr_cred_agr_collat.agr_collat_id,
                            d_agr_cred_agr_collat.agr_cred_id,
                            d_agr_cred_agr_collat.start_dt,
                            d_agr_cred_agr_collat.end_dt,
                            d_agr_cred_agr_collat.info_system_id,
                                CASE
                                    WHEN ((d_agr_cred_agr_collat.start_dt - 1) > max(d_agr_cred_agr_collat.end_dt) OVER (PARTITION BY d_agr_cred_agr_collat.agr_collat_id, d_agr_cred_agr_collat.agr_cred_id ORDER BY d_agr_cred_agr_collat.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
                                    ELSE row_number() OVER (PARTITION BY d_agr_cred_agr_collat.agr_collat_id, d_agr_cred_agr_collat.agr_cred_id ORDER BY d_agr_cred_agr_collat.start_dt)
                                END AS grp_rn
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_agr_collat) a_1) a) t
  WHERE (1 = t.grp_rn);"
d_agr_cred_fin_prt_coltp," SELECT c2c.agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    fin.asset_collat_type_id,
    c2c.info_system_id
   FROM (((( SELECT ""Window"".agr_collat_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_collat_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.agr_collat_id,
                    dt_1.start_dt
                   FROM ( SELECT d_agr_collat_fin.agr_collat_id,
                            d_agr_collat_fin.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_fin
                        UNION ALL
                         SELECT d_agr_collat_fin.agr_collat_id,
                            (d_agr_collat_fin.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_fin
                          WHERE (d_agr_collat_fin.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_agr_collat_mkt.agr_collat_id,
                            d_agr_collat_mkt.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt
                        UNION ALL
                         SELECT d_agr_collat_mkt.agr_collat_id,
                            (d_agr_collat_mkt.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt
                          WHERE (d_agr_collat_mkt.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_agr_cred_agr_collat_core.agr_collat_id,
                            d_agr_cred_agr_collat_core.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_agr_collat_core
                        UNION ALL
                         SELECT d_agr_cred_agr_collat_core.agr_collat_id,
                            (d_agr_cred_agr_collat_core.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_agr_collat_core
                          WHERE (d_agr_cred_agr_collat_core.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.agr_collat_id, dt_1.start_dt) ""Window""(agr_collat_id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_agr_collat_core c2c ON ((((dt.start_dt >= c2c.start_dt) AND (dt.start_dt <= c2c.end_dt)) AND (dt.agr_collat_id = c2c.agr_collat_id))))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_fin fin ON (((((dt.start_dt >= fin.start_dt) AND (dt.start_dt <= fin.end_dt)) AND (dt.agr_collat_id = fin.agr_collat_id)) AND (fin.agr_collat_rub > 0.00))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt mkt ON ((((dt.start_dt >= mkt.start_dt) AND (dt.start_dt <= mkt.end_dt)) AND (dt.agr_collat_id = mkt.agr_collat_id))));"
d_agr_cred_ovr_dp," SELECT dp.agr_cred_id,
    dp.ovr_dt,
    min(dp.start_dt) AS start_dt,
    max(dp.end_dt) AS end_dt,
    max(dp.info_system_id) AS info_system_id
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp dp
     JOIN ( SELECT t.agr_cred_id,
            min(t.start_dt) AS start_dt
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp t
          WHERE ((1 = 1) AND (t.ovr_dt IS NOT NULL))
          GROUP BY t.agr_cred_id) gr_dp ON (((dp.agr_cred_id = gr_dp.agr_cred_id) AND (dp.start_dt >= gr_dp.start_dt))))
  WHERE (dp.ovr_dt IS NOT NULL)
  GROUP BY dp.agr_cred_id, dp.ovr_dt;"
d_agr_cred_fin_ji_stat," SELECT 1 AS a
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp)
  WHERE (1 = 0);"
d_agr_cred_old_fin_dt," SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.debt_due_rub,
    t.debt_ovr_rub,
    t.intrst_due_bal_rub,
    t.intrst_due_off_rub,
    t.intrst_ovr_bal_rub,
    t.intrst_ovr_off_rub,
    t.unused_limit_rub,
    t.comiss_rub,
    t.comiss_other_rub,
    t.grntee_rub,
    t.debt_prvsn_write_off_rub,
    t.comiss_opn_lim_due_rub,
    t.comiss_int_due_rub,
    t.comiss_int_ovr_rub,
    t.comiss_opn_due_rub,
    t.comiss_opn_ovr_rub,
    t.int_sbsdy_due_rub,
    t.int_sbsdy_ovr_rub,
    t.txn_costs_rub,
    t.val_adj_incr_rub,
    t.comiss_opn_lim_due_liab_rub,
    t.comiss_int_due_liab_rub,
    t.comiss_opn_due_liab_rub,
    t.int_sbsdy_due_liab_rub,
    t.txn_costs_liab_rub,
    t.val_adj_decr_rub,
    t.prepaid_intrst_rub,
    t.positive_reval_to_fv_pl_rub,
    t.negative_reval_to_fv_pl_rub,
    t.positive_reval_to_fv_oci_rub,
    t.negative_reval_to_fv_oci_rub,
    t.discount_of_acqstn_claims_due_rub,
    t.discount_of_acqstn_claims_ovr_rub,
    t.premium_of_acqstn_claims_rub,
    t.unused_limit_gen_agr_guar_rub,
    t.let_of_cred_cover_rub,
    t.let_of_cred_cond_req_rub,
    t.prvsn_debt_due_rub,
    t.prvsn_debt_ovr_rub,
    t.prvsn_intrst_due_bal_rub,
    t.prvsn_intrst_ovr_bal_rub,
    t.prvsn_unused_limit_rub,
    t.prvsn_comiss_rub,
    t.prvsn_grntee_rub,
    t.prvsn_comiss_opn_lim_due_rub,
    t.prvsn_comiss_int_due_rub,
    t.prvsn_comiss_int_ovr_rub,
    t.prvsn_comiss_opn_due_rub,
    t.prvsn_comiss_opn_ovr_rub,
    t.prvsn_int_sbsdy_due_rub,
    t.prvsn_int_sbsdy_ovr_rub,
    t.prvsn_discount_of_acqstn_claims_due_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_rub,
    t.prvsn_unused_limit_gen_agr_guar_rub,
    t.prvsn_debt_due_a_rub,
    t.prvsn_debt_ovr_a_rub,
    t.prvsn_intrst_due_bal_a_rub,
    t.prvsn_intrst_ovr_bal_a_rub,
    t.prvsn_unused_limit_a_rub,
    t.prvsn_grntee_a_rub,
    t.prvsn_comiss_int_due_a_rub,
    t.prvsn_comiss_int_ovr_a_rub,
    t.prvsn_int_sbsdy_due_a_rub,
    t.prvsn_int_sbsdy_ovr_a_rub,
    t.prvsn_val_adj_a_rub,
    t.prvsn_discount_of_acqstn_claims_due_a_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_a_rub,
    t.prvsn_premium_of_acqstn_claims_a_rub,
    t.prvsn_unused_limit_gen_agr_guar_a_rub,
    t.prvsn_debt_due_l_rub,
    t.prvsn_debt_ovr_l_rub,
    t.prvsn_intrst_due_bal_l_rub,
    t.prvsn_intrst_ovr_bal_l_rub,
    t.prvsn_unused_limit_l_rub,
    t.prvsn_grntee_l_rub,
    t.prvsn_comiss_int_due_l_rub,
    t.prvsn_comiss_int_ovr_l_rub,
    t.prvsn_int_sbsdy_due_l_rub,
    t.prvsn_int_sbsdy_ovr_l_rub,
    t.prvsn_val_adj_l_rub,
    t.prvsn_discount_of_acqstn_claims_due_l_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_l_rub,
    t.prvsn_premium_of_acqstn_claims_l_rub,
    t.prvsn_unused_limit_gen_agr_guar_l_rub,
    t.comiss_ovr_rub,
    t.comiss_due_rub,
    t.prvsn_comiss_ovr_rub,
    (t.prvsn_comiss_rub - t.prvsn_comiss_ovr_rub) AS prvsn_comiss_due_rub,
    t.info_system_id,
    t.bal_crncy_id,
    t.off_crncy_id
   FROM ( SELECT t_1.agr_cred_id,
            t_1.start_dt,
            t_1.end_dt,
            t_1.debt_due_rub,
            t_1.debt_ovr_rub,
            t_1.intrst_due_bal_rub,
            t_1.intrst_due_off_rub,
            t_1.intrst_ovr_bal_rub,
            t_1.intrst_ovr_off_rub,
            t_1.unused_limit_rub,
            t_1.comiss_rub,
            t_1.comiss_other_rub,
            t_1.grntee_rub,
            t_1.debt_prvsn_write_off_rub,
            t_1.comiss_opn_lim_due_rub,
            t_1.comiss_int_due_rub,
            t_1.comiss_int_ovr_rub,
            t_1.comiss_opn_due_rub,
            t_1.comiss_opn_ovr_rub,
            t_1.int_sbsdy_due_rub,
            t_1.int_sbsdy_ovr_rub,
            t_1.txn_costs_rub,
            t_1.val_adj_incr_rub,
            t_1.comiss_opn_lim_due_liab_rub,
            t_1.comiss_int_due_liab_rub,
            t_1.comiss_opn_due_liab_rub,
            t_1.int_sbsdy_due_liab_rub,
            t_1.txn_costs_liab_rub,
            t_1.val_adj_decr_rub,
            t_1.prepaid_intrst_rub,
            t_1.positive_reval_to_fv_pl_rub,
            t_1.negative_reval_to_fv_pl_rub,
            t_1.positive_reval_to_fv_oci_rub,
            t_1.negative_reval_to_fv_oci_rub,
            t_1.discount_of_acqstn_claims_due_rub,
            t_1.discount_of_acqstn_claims_ovr_rub,
            t_1.premium_of_acqstn_claims_rub,
            t_1.unused_limit_gen_agr_guar_rub,
            t_1.let_of_cred_cover_rub,
            t_1.let_of_cred_cond_req_rub,
            t_1.prvsn_debt_due_rub,
            t_1.prvsn_debt_ovr_rub,
            t_1.prvsn_intrst_due_bal_rub,
            t_1.prvsn_intrst_ovr_bal_rub,
            t_1.prvsn_unused_limit_rub,
            t_1.prvsn_comiss_rub,
            t_1.prvsn_grntee_rub,
            t_1.prvsn_comiss_opn_lim_due_rub,
            t_1.prvsn_comiss_int_due_rub,
            t_1.prvsn_comiss_int_ovr_rub,
            t_1.prvsn_comiss_opn_due_rub,
            t_1.prvsn_comiss_opn_ovr_rub,
            t_1.prvsn_int_sbsdy_due_rub,
            t_1.prvsn_int_sbsdy_ovr_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_rub,
            t_1.prvsn_debt_due_a_rub,
            t_1.prvsn_debt_ovr_a_rub,
            t_1.prvsn_intrst_due_bal_a_rub,
            t_1.prvsn_intrst_ovr_bal_a_rub,
            t_1.prvsn_unused_limit_a_rub,
            t_1.prvsn_grntee_a_rub,
            t_1.prvsn_comiss_int_due_a_rub,
            t_1.prvsn_comiss_int_ovr_a_rub,
            t_1.prvsn_int_sbsdy_due_a_rub,
            t_1.prvsn_int_sbsdy_ovr_a_rub,
            t_1.prvsn_val_adj_a_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_a_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_a_rub,
            t_1.prvsn_premium_of_acqstn_claims_a_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_a_rub,
            t_1.prvsn_debt_due_l_rub,
            t_1.prvsn_debt_ovr_l_rub,
            t_1.prvsn_intrst_due_bal_l_rub,
            t_1.prvsn_intrst_ovr_bal_l_rub,
            t_1.prvsn_unused_limit_l_rub,
            t_1.prvsn_grntee_l_rub,
            t_1.prvsn_comiss_int_due_l_rub,
            t_1.prvsn_comiss_int_ovr_l_rub,
            t_1.prvsn_int_sbsdy_due_l_rub,
            t_1.prvsn_int_sbsdy_ovr_l_rub,
            t_1.prvsn_val_adj_l_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_l_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_l_rub,
            t_1.prvsn_premium_of_acqstn_claims_l_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_l_rub,
            t_1.comiss_ovr_rub,
            t_1.comiss_due_rub,
            (t_1.prvsn_comiss_rub * (t_1.comiss_ovr_rub / NULLIF((t_1.comiss_ovr_rub + t_1.comiss_due_rub), (0)::numeric))) AS prvsn_comiss_ovr_rub,
            t_1.info_system_id,
            t_1.bal_crncy_id,
            t_1.off_crncy_id
           FROM ( SELECT t_2.agr_cred_id,
                    t_2.start_dt,
                    t_2.end_dt,
                    t_2.debt_due_rub,
                    t_2.debt_ovr_rub,
                    t_2.intrst_due_bal_rub,
                    t_2.intrst_due_off_rub,
                    t_2.intrst_ovr_bal_rub,
                    t_2.intrst_ovr_off_rub,
                    t_2.unused_limit_rub,
                    t_2.comiss_rub,
                    t_2.comiss_other_rub,
                    t_2.grntee_rub,
                    t_2.debt_prvsn_write_off_rub,
                    t_2.comiss_opn_lim_due_rub,
                    t_2.comiss_int_due_rub,
                    t_2.comiss_int_ovr_rub,
                    t_2.comiss_opn_due_rub,
                    t_2.comiss_opn_ovr_rub,
                    t_2.int_sbsdy_due_rub,
                    t_2.int_sbsdy_ovr_rub,
                    t_2.txn_costs_rub,
                    t_2.val_adj_incr_rub,
                    t_2.comiss_opn_lim_due_liab_rub,
                    t_2.comiss_int_due_liab_rub,
                    t_2.comiss_opn_due_liab_rub,
                    t_2.int_sbsdy_due_liab_rub,
                    t_2.txn_costs_liab_rub,
                    t_2.val_adj_decr_rub,
                    t_2.prepaid_intrst_rub,
                    t_2.positive_reval_to_fv_pl_rub,
                    t_2.negative_reval_to_fv_pl_rub,
                    t_2.positive_reval_to_fv_oci_rub,
                    t_2.negative_reval_to_fv_oci_rub,
                    t_2.discount_of_acqstn_claims_due_rub,
                    t_2.discount_of_acqstn_claims_ovr_rub,
                    t_2.premium_of_acqstn_claims_rub,
                    t_2.unused_limit_gen_agr_guar_rub,
                    t_2.let_of_cred_cover_rub,
                    t_2.let_of_cred_cond_req_rub,
                    t_2.prvsn_debt_due_rub,
                    t_2.prvsn_debt_ovr_rub,
                    t_2.prvsn_intrst_due_bal_rub,
                    t_2.prvsn_intrst_ovr_bal_rub,
                    t_2.prvsn_unused_limit_rub,
                    t_2.prvsn_comiss_rub,
                    t_2.prvsn_grntee_rub,
                    t_2.prvsn_comiss_opn_lim_due_rub,
                    t_2.prvsn_comiss_int_due_rub,
                    t_2.prvsn_comiss_int_ovr_rub,
                    t_2.prvsn_comiss_opn_due_rub,
                    t_2.prvsn_comiss_opn_ovr_rub,
                    t_2.prvsn_int_sbsdy_due_rub,
                    t_2.prvsn_int_sbsdy_ovr_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_rub,
                    t_2.prvsn_debt_due_a_rub,
                    t_2.prvsn_debt_ovr_a_rub,
                    t_2.prvsn_intrst_due_bal_a_rub,
                    t_2.prvsn_intrst_ovr_bal_a_rub,
                    t_2.prvsn_unused_limit_a_rub,
                    t_2.prvsn_grntee_a_rub,
                    t_2.prvsn_comiss_int_due_a_rub,
                    t_2.prvsn_comiss_int_ovr_a_rub,
                    t_2.prvsn_int_sbsdy_due_a_rub,
                    t_2.prvsn_int_sbsdy_ovr_a_rub,
                    t_2.prvsn_val_adj_a_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_a_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_a_rub,
                    t_2.prvsn_premium_of_acqstn_claims_a_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_a_rub,
                    t_2.prvsn_debt_due_l_rub,
                    t_2.prvsn_debt_ovr_l_rub,
                    t_2.prvsn_intrst_due_bal_l_rub,
                    t_2.prvsn_intrst_ovr_bal_l_rub,
                    t_2.prvsn_unused_limit_l_rub,
                    t_2.prvsn_grntee_l_rub,
                    t_2.prvsn_comiss_int_due_l_rub,
                    t_2.prvsn_comiss_int_ovr_l_rub,
                    t_2.prvsn_int_sbsdy_due_l_rub,
                    t_2.prvsn_int_sbsdy_ovr_l_rub,
                    t_2.prvsn_val_adj_l_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_l_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_l_rub,
                    t_2.prvsn_premium_of_acqstn_claims_l_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_l_rub,
                    t_2.comiss_ovr_rub,
                    (t_2.comiss_rub - t_2.comiss_ovr_rub) AS comiss_due_rub,
                    t_2.info_system_id,
                    t_2.bal_crncy_id,
                    t_2.off_crncy_id
                   FROM ( SELECT t_3.agr_cred_id,
                            t_3.start_dt,
                            t_3.end_dt,
                            t_3.debt_due_rub,
                            t_3.debt_ovr_rub,
                            t_3.intrst_due_bal_rub,
                            t_3.intrst_due_off_rub,
                            t_3.intrst_ovr_bal_rub,
                            t_3.intrst_ovr_off_rub,
                            t_3.unused_limit_rub,
                            t_3.comiss_rub,
                            t_3.comiss_other_rub,
                            t_3.grntee_rub,
                            t_3.debt_prvsn_write_off_rub,
                            t_3.comiss_opn_lim_due_rub,
                            t_3.comiss_int_due_rub,
                            t_3.comiss_int_ovr_rub,
                            t_3.comiss_opn_due_rub,
                            t_3.comiss_opn_ovr_rub,
                            t_3.int_sbsdy_due_rub,
                            t_3.int_sbsdy_ovr_rub,
                            t_3.txn_costs_rub,
                            t_3.val_adj_incr_rub,
                            t_3.comiss_opn_lim_due_liab_rub,
                            t_3.comiss_int_due_liab_rub,
                            t_3.comiss_opn_due_liab_rub,
                            t_3.int_sbsdy_due_liab_rub,
                            t_3.txn_costs_liab_rub,
                            t_3.val_adj_decr_rub,
                            t_3.prepaid_intrst_rub,
                            t_3.positive_reval_to_fv_pl_rub,
                            t_3.negative_reval_to_fv_pl_rub,
                            t_3.positive_reval_to_fv_oci_rub,
                            t_3.negative_reval_to_fv_oci_rub,
                            t_3.discount_of_acqstn_claims_due_rub,
                            t_3.discount_of_acqstn_claims_ovr_rub,
                            t_3.premium_of_acqstn_claims_rub,
                            t_3.unused_limit_gen_agr_guar_rub,
                            t_3.let_of_cred_cover_rub,
                            t_3.let_of_cred_cond_req_rub,
                            t_3.prvsn_debt_due_rub,
                            t_3.prvsn_debt_ovr_rub,
                            t_3.prvsn_intrst_due_bal_rub,
                            t_3.prvsn_intrst_ovr_bal_rub,
                            t_3.prvsn_unused_limit_rub,
                            t_3.prvsn_comiss_rub,
                            t_3.prvsn_grntee_rub,
                            t_3.prvsn_comiss_opn_lim_due_rub,
                            t_3.prvsn_comiss_int_due_rub,
                            t_3.prvsn_comiss_int_ovr_rub,
                            t_3.prvsn_comiss_opn_due_rub,
                            t_3.prvsn_comiss_opn_ovr_rub,
                            t_3.prvsn_int_sbsdy_due_rub,
                            t_3.prvsn_int_sbsdy_ovr_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_rub,
                            t_3.prvsn_debt_due_a_rub,
                            t_3.prvsn_debt_ovr_a_rub,
                            t_3.prvsn_intrst_due_bal_a_rub,
                            t_3.prvsn_intrst_ovr_bal_a_rub,
                            t_3.prvsn_unused_limit_a_rub,
                            t_3.prvsn_grntee_a_rub,
                            t_3.prvsn_comiss_int_due_a_rub,
                            t_3.prvsn_comiss_int_ovr_a_rub,
                            t_3.prvsn_int_sbsdy_due_a_rub,
                            t_3.prvsn_int_sbsdy_ovr_a_rub,
                            t_3.prvsn_val_adj_a_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_a_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_a_rub,
                            t_3.prvsn_premium_of_acqstn_claims_a_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_a_rub,
                            t_3.prvsn_debt_due_l_rub,
                            t_3.prvsn_debt_ovr_l_rub,
                            t_3.prvsn_intrst_due_bal_l_rub,
                            t_3.prvsn_intrst_ovr_bal_l_rub,
                            t_3.prvsn_unused_limit_l_rub,
                            t_3.prvsn_grntee_l_rub,
                            t_3.prvsn_comiss_int_due_l_rub,
                            t_3.prvsn_comiss_int_ovr_l_rub,
                            t_3.prvsn_int_sbsdy_due_l_rub,
                            t_3.prvsn_int_sbsdy_ovr_l_rub,
                            t_3.prvsn_val_adj_l_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_l_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_l_rub,
                            t_3.prvsn_premium_of_acqstn_claims_l_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_l_rub,
                            LEAST(GREATEST(COALESCE(t_3.optn_sum_rub, (0)::numeric), (0)::numeric), t_3.comiss_rub) AS comiss_ovr_rub,
                            t_3.info_system_id,
                            t_3.bal_crncy_id,
                            t_3.off_crncy_id
                           FROM ( SELECT dt.id AS agr_cred_id,
                                    dt.start_dt,
                                    max(dt.end_dt) AS end_dt,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_due_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L004'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_due_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_ovr_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L006'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_ovr_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_L007'::text, 'AGRA_L051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS unused_limit_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L008'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L018'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_other_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS grntee_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L020'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_prvsn_write_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L021'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_lim_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L024'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L025'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L028'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS txn_costs_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS val_adj_incr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L031'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_lim_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L032'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L034'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L036'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L038'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS txn_costs_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L039'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS val_adj_decr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L040'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prepaid_intrst_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L041'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS positive_reval_to_fv_pl_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L042'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS negative_reval_to_fv_pl_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L043'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS positive_reval_to_fv_oci_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L044'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS negative_reval_to_fv_oci_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS discount_of_acqstn_claims_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS discount_of_acqstn_claims_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS premium_of_acqstn_claims_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS unused_limit_gen_agr_guar_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L049'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS let_of_cred_cover_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L050'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS let_of_cred_cond_req_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_P007'::text, 'AGRA_P051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P008'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P021'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_lim_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P024'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P025'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_J007'::text, 'AGRA_J051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_val_adj_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_premium_of_acqstn_claims_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_N007'::text, 'AGRA_N051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_val_adj_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_premium_of_acqstn_claims_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_l_rub,
                                    max(dt.info_system_id) AS info_system_id,
                                    sum(com.optn_sum_rub) AS optn_sum_rub,
                                    NULL::bigint AS bal_crncy_id,
                                    NULL::bigint AS off_crncy_id
                                   FROM ((( SELECT ""Window"".id,
    ""Window"".start_dt,
    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    ""Window"".info_system_id
   FROM ( SELECT dt_1.id,
      dt_1.start_dt,
      max(dt_1.info_system_id) AS info_system_id
     FROM ( SELECT coa_1.agr_cred_id AS id,
      CASE
       WHEN (m.i = 1) THEN coa_1.start_dt
       WHEN (m.i = 2) THEN (coa_1.end_dt + 1)
       ELSE NULL::date
      END AS start_dt,
        coa_1.info_system_id
       FROM (( SELECT d_agr_cred_coa_old.agr_cred_id,
          d_agr_cred_coa_old.start_dt,
          d_agr_cred_coa_old.end_dt,
          d_agr_cred_coa_old.info_system_id
         FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_old
        WHERE (d_agr_cred_coa_old.start_dt < '2019-01-01'::date)) coa_1
         JOIN ( SELECT a.i
         FROM ( SELECT 1 AS i) a
      UNION ALL
       SELECT a.i
         FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (coa_1.end_dt <> '9999-12-31'::date)))))
    UNION ALL
     SELECT d_agr_cred_fin_dt_com_tmp.agr_cred_id AS id,
        d_agr_cred_fin_dt_com_tmp.start_dt,
        d_agr_cred_fin_dt_com_tmp.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp
    UNION ALL
     SELECT d_agr_cred_fin_dt_com_tmp.agr_cred_id AS id,
        (d_agr_cred_fin_dt_com_tmp.end_dt + 1) AS start_dt,
        d_agr_cred_fin_dt_com_tmp.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp
      WHERE (d_agr_cred_fin_dt_com_tmp.end_dt <> '9999-12-31'::date)) dt_1
    GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
                                     JOIN ( SELECT d_agr_cred_coa_old.agr_cred_id,
    d_agr_cred_coa_old.start_dt,
    d_agr_cred_coa_old.end_dt,
    d_agr_cred_coa_old.meas_cd,
    d_agr_cred_coa_old.meas_rub,
    d_agr_cred_coa_old.coa_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_old
  WHERE (d_agr_cred_coa_old.start_dt < '2019-01-01'::date)) coa ON (((coa.agr_cred_id = dt.id) AND ((dt.start_dt >= coa.start_dt) AND (dt.start_dt <= coa.end_dt)))))
                                     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp com ON (((dt.id = com.agr_cred_id) AND ((dt.start_dt >= com.start_dt) AND (dt.start_dt <= com.end_dt)))))
                                  GROUP BY dt.id, dt.start_dt) t_3) t_2) t_1) t;"
d_coa_cred_fin_dp," SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.debt_ovr_dt,
    t.intrst_ovr_dt,
    COALESCE(t.debt_ovr_dt, t.intrst_ovr_dt) AS ovr_dr,
    t.info_system_id
   FROM ( SELECT t_1.agr_cred_id,
            t_1.start_dt,
            t_1.end_dt,
                CASE
                    WHEN (t_1.type_ovr = 'debt_ovr'::text) THEN t_1.start_dt
                    ELSE NULL::date
                END AS debt_ovr_dt,
                CASE
                    WHEN (t_1.type_ovr = 'intrst_ovr'::text) THEN t_1.start_dt
                    ELSE NULL::date
                END AS intrst_ovr_dt,
            t_1.info_system_id
           FROM ( SELECT t_2.agr_cred_id,
                    t_2.start_dt,
                    COALESCE((max(t_2.start_dt) OVER (PARTITION BY t_2.agr_cred_id ORDER BY t_2.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    'debt_ovr'::text AS type_ovr,
                    t_2.info_system_id
                   FROM ( SELECT t_3.agr_cred_id,
                            t_3.meas_cd,
                            t_3.start_dt,
                            t_3.has_flag,
                            t_3.info_system_id,
                                CASE
                                    WHEN (t_3.has_flag <> max(t_3.has_flag) OVER (PARTITION BY t_3.agr_cred_id ORDER BY t_3.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
                                    ELSE row_number() OVER (PARTITION BY t_3.agr_cred_id ORDER BY t_3.start_dt)
                                END AS rn
                           FROM ( SELECT d_coa_cred_coa.agr_cred_id,
                                    d_coa_cred_coa.meas_cd,
                                    d_coa_cred_coa.start_dt,
CASE
 WHEN (d_coa_cred_coa.bal_amt <= 0.001) THEN 'N'::text
 ELSE 'Y'::text
END AS has_flag,
                                    d_coa_cred_coa.info_system_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_coa
                                  WHERE (d_coa_cred_coa.meas_cd = 'AGRA_L002'::text)) t_3) t_2
                  WHERE ((t_2.rn = 1) AND (t_2.has_flag = 'Y'::text))
                UNION ALL
                 SELECT t_2.agr_cred_id,
                    t_2.start_dt,
                    COALESCE((max(t_2.start_dt) OVER (PARTITION BY t_2.agr_cred_id ORDER BY t_2.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    'intrst_ovr'::text AS type_ovr,
                    t_2.info_system_id
                   FROM ( SELECT t_3.agr_cred_id,
                            t_3.meas_cd,
                            t_3.start_dt,
                            t_3.has_flag,
                            t_3.info_system_id,
                                CASE
                                    WHEN (t_3.has_flag <> max(t_3.has_flag) OVER (PARTITION BY t_3.agr_cred_id ORDER BY t_3.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
                                    ELSE row_number() OVER (PARTITION BY t_3.agr_cred_id ORDER BY t_3.start_dt)
                                END AS rn
                           FROM ( SELECT d_coa_cred_coa.agr_cred_id,
                                    d_coa_cred_coa.meas_cd,
                                    d_coa_cred_coa.start_dt,
CASE
 WHEN (d_coa_cred_coa.bal_amt <= 0.001) THEN 'N'::text
 ELSE 'Y'::text
END AS has_flag,
                                    d_coa_cred_coa.info_system_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_coa
                                  WHERE (d_coa_cred_coa.meas_cd = 'AGRA_L005'::text)) t_3) t_2
                  WHERE ((t_2.rn = 1) AND (t_2.has_flag = 'Y'::text))) t_1) t;"
d_agr_cred_clsfctn_fin_pos," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
        CASE
            CASE
                WHEN (COALESCE(agr_cred_port.prvsn_port_id, ('-1'::integer)::bigint) < 0) THEN 'N'::text
                ELSE 'Y'::text
            END
            WHEN 'N'::text THEN
            CASE
                WHEN ((agr_cred_clsfctn.cust_fin_pos_type_id IS NULL) OR (agr_cred_clsfctn.cust_fin_pos_type_id = '-1'::integer)) THEN agr.four_id
                ELSE agr_cred_clsfctn.cust_fin_pos_type_id
            END
            WHEN 'Y'::text THEN agr.zero_id
            ELSE NULL::bigint
        END AS f26_cust_fin_pos_type_id,
    agr.info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT d_agr_cred_core.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core
                        UNION ALL
                         SELECT d_agr_cred_port.agr_cred_id AS id,
                            d_agr_cred_port.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port
                        UNION ALL
                         SELECT d_agr_cred_port.agr_cred_id AS id,
                            (d_agr_cred_port.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port
                          WHERE (d_agr_cred_port.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_agr_cred_clsfctn.agr_cred_id AS id,
                            d_agr_cred_clsfctn.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_clsfctn
                        UNION ALL
                         SELECT d_agr_cred_clsfctn.agr_cred_id AS id,
                            (d_agr_cred_clsfctn.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_clsfctn
                          WHERE (d_agr_cred_clsfctn.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr ON ((dt.id = agr.agr_cred_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_clsfctn agr_cred_clsfctn ON (((agr_cred_clsfctn.agr_cred_id = dt.id) AND ((dt.start_dt >= agr_cred_clsfctn.start_dt) AND (dt.start_dt <= agr_cred_clsfctn.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port agr_cred_port ON (((agr_cred_port.agr_cred_id = dt.id) AND ((dt.start_dt >= agr_cred_port.start_dt) AND (dt.start_dt <= agr_cred_port.end_dt)))));"
d_agr_cred_fl_rate_ptr," SELECT src.agr_cred_id,
    max(src.f303_3_9) AS f303_3_9,
    max(src.f303_3_13) AS f303_3_13,
    max(src.f303_3_10) AS f303_3_10,
    max(src.f303_3_14) AS f303_3_14
   FROM ( SELECT t.agr_cred_id,
            t.agr_cred_rate_type_cd,
            t.f303_3_9,
            t.diff_months_cnt,
                CASE
                    WHEN (t.f303_3_9 = ''::text) THEN 1
                    ELSE
                    CASE
                        WHEN ((t.diff_months_cnt >= (0)::double precision) AND (t.diff_months_cnt <= (1)::double precision)) THEN 2
                        WHEN ((t.diff_months_cnt >= (2)::double precision) AND (t.diff_months_cnt <= (3)::double precision)) THEN 3
                        WHEN ((t.diff_months_cnt >= (4)::double precision) AND (t.diff_months_cnt <= (6)::double precision)) THEN 4
                        WHEN ((t.diff_months_cnt >= (7)::double precision) AND (t.diff_months_cnt <= (12)::double precision)) THEN 5
                        WHEN ((t.diff_months_cnt >= (13)::double precision) AND (t.diff_months_cnt <= (36)::double precision)) THEN 6
                        WHEN ((t.diff_months_cnt >= (37)::double precision) AND (t.diff_months_cnt <= (60)::double precision)) THEN 7
                        WHEN (t.diff_months_cnt > (60)::double precision) THEN 8
                        ELSE NULL::integer
                    END
                END AS f303_3_13,
            t.f303_3_10,
            t.f303_3_14
           FROM ( SELECT ac.agr_cred_id,
                    cft.agr_cred_rate_type_cd,
                        CASE
                            WHEN ((COALESCE(cft.agr_cred_rate_type_cd, '-'::text) <> ''::text) AND ((((ac.expiration_dt - ac.signed_dt) > rat.frate_days_cnt) OR (ac.signed_dt < rat.min_start_dt)) OR (ac.expiration_dt > rat.max_end_dt))) THEN (''::text || COALESCE(cft.agr_cred_rate_type_cd, ''::text))
                            ELSE cft.agr_cred_rate_type_cd
                        END AS f303_3_9,
                    abs(
                        CASE
                            WHEN (cft.agr_cred_rate_type_cd = ''::text) THEN (((date_part('year'::text, rat.min_start_dt) - date_part('year'::text, ac.issue_dt)) * (12)::double precision) + (date_part('month'::text, rat.min_start_dt) - date_part('month'::text, ac.issue_dt)))
                            ELSE (((date_part('year'::text, rat.min_end_dt) - date_part('year'::text, ac.issue_dt)) * (12)::double precision) + (date_part('month'::text, rat.min_end_dt) - date_part('month'::text, ac.issue_dt)))
                        END) AS diff_months_cnt,
                    loan_rat.first_rt AS f303_3_10,
                        CASE
                            WHEN (rat.agr_cred_id IS NULL) THEN NULL::text
                            WHEN (COALESCE(rat.first_mkt_idx_id, ('-1'::integer)::bigint) <> '-1'::integer) THEN (
                            CASE
                                WHEN (upper(mi.mkt_idx_type_cd) = '   '::text) THEN '1'::text
                                WHEN (upper(mi.mkt_idx_type_cd) = 'MOSPRIME'::text) THEN '2'::text
                                WHEN (upper(mi.mkt_idx_type_cd) = 'RUONIA'::text) THEN '3'::text
                                WHEN (upper(mi.mkt_idx_type_cd) = 'ROISFIX'::text) THEN '4'::text
                                WHEN (upper(mi.mkt_idx_type_cd) = 'LIBOR'::text) THEN '5'::text
                                WHEN (upper(mi.mkt_idx_type_cd) = 'EURIBOR'::text) THEN '9'::text
                                WHEN (mi.mkt_idx_type_cd IS NOT NULL) THEN '8'::text
                                ELSE NULL::text
                            END ||
                            CASE
                                WHEN (upper(rat.max_margin_reprice_flag) = 'Y'::text) THEN ',7'::text
                                ELSE ''::text
                            END)
                            ELSE '7'::text
                        END AS f303_3_14
                   FROM ((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred ac
                     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_tmp cft ON (((ac.agr_cred_id = cft.agr_cred_id) AND ((ac.issue_dt >= cft.start_dt) AND (ac.issue_dt <= cft.end_dt)))))
                     LEFT JOIN ( SELECT ratval.agr_cred_id,
                            min(ratval.start_dt) AS min_start_dt,
                            min(ratval.end_dt) AS min_end_dt,
                            max(ratval.end_dt) AS max_end_dt,
                            sum((ratval.end_dt - ratval.start_dt)) AS frate_days_cnt,
                            max(ratval.margin_reprice_flag) AS max_margin_reprice_flag,
                            max(ratval.first_mkt_idx_id) AS first_mkt_idx_id
                           FROM ( SELECT d_agr_cred_rate_var_rule.agr_cred_id,
                                    d_agr_cred_rate_var_rule.start_dt,
                                    d_agr_cred_rate_var_rule.end_dt,
                                    d_agr_cred_rate_var_rule.margin_reprice_flag,
CASE
 WHEN (row_number() OVER (PARTITION BY d_agr_cred_rate_var_rule.agr_cred_id ORDER BY sign((d_agr_cred_rate_var_rule.mkt_idx_id)::double precision) DESC NULLS LAST, d_agr_cred_rate_var_rule.start_dt, d_agr_cred_rate_var_rule.mkt_idx_id DESC) = 1) THEN d_agr_cred_rate_var_rule.mkt_idx_id
 ELSE NULL::bigint
END AS first_mkt_idx_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rule
                                  WHERE (d_agr_cred_rate_var_rule.end_dt >= d_agr_cred_rate_var_rule.start_dt)) ratval
                          GROUP BY ratval.agr_cred_id) rat ON ((ac.agr_cred_id = rat.agr_cred_id)))
                     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_mkt_idx mi ON ((rat.first_mkt_idx_id = mi.mkt_idx_id)))
                     LEFT JOIN ( SELECT ac_1.agr_cred_id,
                            COALESCE(max(
                                CASE
                                    WHEN ((ac_1.issue_dt >= rtl.start_dt) AND (ac_1.issue_dt <= rtl.end_dt)) THEN rtl.agr_cred_rate
                                    ELSE NULL::numeric
                                END), max(
                                CASE
                                    WHEN ((ac_1.signed_dt >= rtl.start_dt) AND (ac_1.signed_dt <= rtl.end_dt)) THEN rtl.agr_cred_rate
                                    ELSE NULL::numeric
                                END), max(
                                CASE
                                    WHEN ((ac_1.agr_cred_rate_first_dt >= rtl.start_dt) AND (ac_1.agr_cred_rate_first_dt <= rtl.end_dt)) THEN rtl.agr_cred_rate
                                    ELSE NULL::numeric
                                END)) AS first_rt
                           FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred ac_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate rtl ON ((ac_1.agr_cred_id = rtl.agr_cred_id)))
                          GROUP BY ac_1.agr_cred_id) loan_rat ON ((ac.agr_cred_id = loan_rat.agr_cred_id)))) t) src
  GROUP BY src.agr_cred_id;"
d_agr_cred_fin," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    agr.bus_line_type_id,
    rst.restruct_cnt,
    agr.last_expiration_dt,
    rate.agr_cred_rate,
    agr.last_prolong_dt,
    rst.last_restruct_dt,
    agr.prolong_cnt,
    agr.bki_grant_flag,
    agr.bki_query_flag,
    agr.grntee_claim_notice_flag,
    agr.eks_grntee_claim_noticed_flag,
    agr.f303_ins_types_cd,
    agr.f303_inf_types_cd,
    agr.cond_prec_flag,
    agr.f303_cond_types_cd,
    collat.f303_agr_collat_prvsn_1_amt,
    collat.f303_agr_collat_prvsn_2_amt,
    agr.agr_cred_rate_type_cd,
    agr.mkt_idx_id,
    f303.f303_agr_cred_type_cd,
    f303.cession_buy_flag,
    agr_cred_fin_prt_coltp.asset_collat_type_id,
    agr.mkt_idx_next_rvsn_dt,
    agr.mkt_idx_rvsn_dt,
    miq.mkt_idx_rate AS agr_cred_mkt_idx_rate,
        CASE
            WHEN (agr.mkt_idx_id IS NULL) THEN NULL::numeric
            WHEN (agr.escrow_flag = 1) THEN agr.escrow_margin_rate
            ELSE (rate.agr_cred_rate - miq.mkt_idx_rate)
        END AS agr_cred_margin_rate,
    agr.rate_rvsn_time_period_id,
    agr.rate_rvsn_month_cnt,
    agr.agr_cred_current_rate,
    agr.agr_cred_compens_rate,
    agr.agr_cred_deferral_rate,
    agr.f26_asset_collat_type_id,
    agr.extrajudicial_appeal_flag,
    agr_cred_fin_prt_coltp.asset_pledge_type_id,
    agr.agr_cred_purpose_ext_id,
    agr.adjust_fund_factor,
    agr.security_for_cb_loan_flag,
    dt.info_system_id,
    ((COALESCE(agr.agr_cred_current_rate, (0)::numeric) + COALESCE(agr.agr_cred_compens_rate, (0)::numeric)) + COALESCE(agr.agr_cred_deferral_rate, (0)::numeric)) AS agr_cred_full_rate,
    agr.prvsn_med_rate,
    lcc.letter_cred_id,
    lcc.agr_cred_id AS letter_agr_cred_id,
    lcc.agr_cred_issue_crncy_id AS letter_agr_cred_issue_crncy_id,
    lcc.agr_cred_debt_rub AS letter_agr_cred_debt_rub,
    lcc.issued_amt_by_letter_of_cred,
    agr.rate_irremovable_bia_flag
   FROM ((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT agr_1.agr_cred_id AS id,
                            agr_1.start_dt,
                            agr_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_tmp agr_1
                        UNION ALL
                         SELECT agr_1.agr_cred_id AS id,
                            (agr_1.end_dt + 1) AS start_dt,
                            agr_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_tmp agr_1
                          WHERE (agr_1.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT collat_1.agr_cred_id AS id,
                            collat_1.start_dt,
                            collat_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f303_collat_tmp collat_1
                        UNION ALL
                         SELECT collat_1.agr_cred_id AS id,
                            (collat_1.end_dt + 1) AS start_dt,
                            collat_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f303_collat_tmp collat_1
                          WHERE (collat_1.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT f303_1.agr_cred_id AS id,
                            f303_1.start_dt,
                            f303_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f303_type_prt f303_1
                        UNION ALL
                         SELECT f303_1.agr_cred_id AS id,
                            (f303_1.end_dt + 1) AS start_dt,
                            f303_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f303_type_prt f303_1
                          WHERE (f303_1.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT coltp.agr_cred_id AS id,
                            coltp.start_dt,
                            coltp.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_prt_coltp coltp
                        UNION ALL
                         SELECT coltp.agr_cred_id AS id,
                            (coltp.end_dt + 1) AS start_dt,
                            coltp.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_prt_coltp coltp
                          WHERE (coltp.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT rate_1.agr_cred_id,
                            rate_1.start_dt,
                            rate_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate rate_1
                        UNION ALL
                         SELECT rate_1.agr_cred_id,
                            (rate_1.end_dt + 1) AS start_dt,
                            rate_1.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate rate_1
                          WHERE (rate_1.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_restruct_calc.agr_cred_id,
                            d_restruct_calc.start_dt,
                            d_restruct_calc.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_restruct_calc
                        UNION ALL
                         SELECT d_restruct_calc.agr_cred_id,
                            (d_restruct_calc.end_dt + 1),
                            d_restruct_calc.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_restruct_calc
                          WHERE (d_restruct_calc.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_letter_of_cred_cover_amt.letter_cred_id AS agr_cred_id,
                            d_letter_of_cred_cover_amt.start_dt,
                            d_letter_of_cred_cover_amt.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_letter_of_cred_cover_amt
                        UNION ALL
                         SELECT d_letter_of_cred_cover_amt.letter_cred_id AS agr_cred_id,
                            (d_letter_of_cred_cover_amt.end_dt + 1),
                            d_letter_of_cred_cover_amt.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_letter_of_cred_cover_amt
                          WHERE (d_letter_of_cred_cover_amt.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_tmp agr ON (((dt.id = agr.agr_cred_id) AND ((dt.start_dt >= agr.start_dt) AND (dt.start_dt <= agr.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f303_collat_tmp collat ON (((dt.id = collat.agr_cred_id) AND ((dt.start_dt >= collat.start_dt) AND (dt.start_dt <= collat.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f303_type_prt f303 ON (((dt.id = f303.agr_cred_id) AND ((dt.start_dt >= f303.start_dt) AND (dt.start_dt <= f303.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_prt_coltp agr_cred_fin_prt_coltp ON (((agr_cred_fin_prt_coltp.agr_cred_id = dt.id) AND ((dt.start_dt >= agr_cred_fin_prt_coltp.start_dt) AND (dt.start_dt <= agr_cred_fin_prt_coltp.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_mkt_idx_quote miq ON (((agr.mkt_idx_id = miq.mkt_idx_id) AND ((agr.mkt_idx_quote_dt >= miq.start_dt) AND (agr.mkt_idx_quote_dt <= miq.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_restruct_calc rst ON (((rst.agr_cred_id = dt.id) AND ((dt.start_dt >= rst.start_dt) AND (dt.start_dt <= rst.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate rate ON (((dt.id = rate.agr_cred_id) AND ((dt.start_dt >= rate.start_dt) AND (dt.start_dt <= rate.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_letter_of_cred_cover_amt lcc ON (((dt.id = lcc.letter_cred_id) AND ((dt.start_dt >= lcc.start_dt) AND (dt.start_dt <= lcc.end_dt)))));"
d_set_a2c_stg_prep," SELECT d_set_correct.host_agr_cred_id,
    d_set_correct.coa_num,
    d_set_correct.reg_bank_cd,
    d_set_correct.start_dt,
    d_set_correct.end_dt,
    d_set_correct.coa_to_agrmnt_role_id,
    d_set_correct.coa_id
   FROM s_grnplm_vd_t_bvd_db_dmpsslcl.d_set_correct;"
d_set_a2c_stg," SELECT d_set_correct.host_agr_cred_id,
    d_set_correct.coa_num,
    d_set_correct.reg_bank_cd,
    d_set_correct.start_dt,
    d_set_correct.end_dt,
    d_set_correct.coa_to_agrmnt_role_id,
    d_set_correct.coa_id
   FROM s_grnplm_vd_t_bvd_db_dmpsslcl.d_set_correct;"
d_agr_cred_fin_dt_prt_dacos," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    max(dt.end_dt) AS end_dt,
    sum(optn.issued_amt) AS issued_amt,
    sum(optn.issued_issue_amt) AS issued_issue_amt,
    max(dt.info_system_id) AS info_system_id
   FROM (( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT d_agr_cred_optn_sum.agr_cred_id AS id,
                            d_agr_cred_optn_sum.start_dt,
                            d_agr_cred_optn_sum.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum
                          WHERE (d_agr_cred_optn_sum.meas_cd = 'AGRA_L001'::text)
                        UNION ALL
                         SELECT d_agr_cred_optn_sum.agr_cred_id AS id,
                            (d_agr_cred_optn_sum.end_dt + 1) AS start_dt,
                            d_agr_cred_optn_sum.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum
                          WHERE ((d_agr_cred_optn_sum.end_dt <> '9999-12-31'::date) AND (d_agr_cred_optn_sum.meas_cd = 'AGRA_L001'::text))
                        UNION ALL
                         SELECT d_agr_cred_core.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt,
                            d_agr_cred_core.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core
                        UNION ALL
                         SELECT d_coa_cred_core.agr_cred_id,
                            '1900-01-01'::date AS start_dt,
                            d_coa_cred_core.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core
                        UNION ALL
                         SELECT d_agr_cred_core_uvdo.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt,
                            d_agr_cred_core_uvdo.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum optn ON (((((optn.agr_cred_id = dt.id) AND (dt.start_dt >= optn.start_dt)) AND (dt.start_dt <= optn.end_dt)) AND (optn.meas_cd = 'AGRA_L001'::text))))
  GROUP BY dt.id, dt.start_dt;"
d_agr_cred_fin_dt_mat," WITH t1 AS (
         SELECT d_agr_cred_fin_dt.agr_cred_id,
            d_agr_cred_fin_dt.start_dt,
            d_agr_cred_fin_dt.end_dt,
            d_agr_cred_fin_dt.debt_due_rub,
            d_agr_cred_fin_dt.debt_ovr_rub,
            d_agr_cred_fin_dt.intrst_due_bal_rub,
            d_agr_cred_fin_dt.intrst_due_off_rub,
            d_agr_cred_fin_dt.intrst_ovr_bal_rub,
            d_agr_cred_fin_dt.intrst_ovr_off_rub,
            d_agr_cred_fin_dt.unused_limit_rub,
            d_agr_cred_fin_dt.comiss_rub,
            d_agr_cred_fin_dt.comiss_other_rub,
            d_agr_cred_fin_dt.grntee_rub,
            d_agr_cred_fin_dt.debt_prvsn_write_off_rub,
            d_agr_cred_fin_dt.comiss_opn_lim_due_rub,
            d_agr_cred_fin_dt.comiss_int_due_rub,
            d_agr_cred_fin_dt.comiss_int_ovr_rub,
            d_agr_cred_fin_dt.comiss_opn_due_rub,
            d_agr_cred_fin_dt.comiss_opn_ovr_rub,
            d_agr_cred_fin_dt.int_sbsdy_due_rub,
            d_agr_cred_fin_dt.int_sbsdy_ovr_rub,
            d_agr_cred_fin_dt.txn_costs_rub,
            d_agr_cred_fin_dt.val_adj_incr_rub,
            d_agr_cred_fin_dt.comiss_opn_lim_due_liab_rub,
            d_agr_cred_fin_dt.comiss_int_due_liab_rub,
            d_agr_cred_fin_dt.comiss_opn_due_liab_rub,
            d_agr_cred_fin_dt.int_sbsdy_due_liab_rub,
            d_agr_cred_fin_dt.txn_costs_liab_rub,
            d_agr_cred_fin_dt.val_adj_decr_rub,
            d_agr_cred_fin_dt.prepaid_intrst_rub,
            d_agr_cred_fin_dt.positive_reval_to_fv_pl_rub,
            d_agr_cred_fin_dt.negative_reval_to_fv_pl_rub,
            d_agr_cred_fin_dt.positive_reval_to_fv_oci_rub,
            d_agr_cred_fin_dt.negative_reval_to_fv_oci_rub,
            d_agr_cred_fin_dt.discount_of_acqstn_claims_due_rub,
            d_agr_cred_fin_dt.discount_of_acqstn_claims_ovr_rub,
            d_agr_cred_fin_dt.premium_of_acqstn_claims_rub,
            d_agr_cred_fin_dt.unused_limit_gen_agr_guar_rub,
            d_agr_cred_fin_dt.let_of_cred_cover_rub,
            d_agr_cred_fin_dt.let_of_cred_cond_req_rub,
            d_agr_cred_fin_dt.prvsn_debt_due_rub,
            d_agr_cred_fin_dt.prvsn_debt_ovr_rub,
            d_agr_cred_fin_dt.prvsn_intrst_due_bal_rub,
            d_agr_cred_fin_dt.prvsn_intrst_ovr_bal_rub,
            d_agr_cred_fin_dt.prvsn_unused_limit_rub,
            d_agr_cred_fin_dt.prvsn_comiss_rub,
            d_agr_cred_fin_dt.prvsn_grntee_rub,
            d_agr_cred_fin_dt.prvsn_comiss_opn_lim_due_rub,
            d_agr_cred_fin_dt.prvsn_comiss_int_due_rub,
            d_agr_cred_fin_dt.prvsn_comiss_int_ovr_rub,
            d_agr_cred_fin_dt.prvsn_comiss_opn_due_rub,
            d_agr_cred_fin_dt.prvsn_comiss_opn_ovr_rub,
            d_agr_cred_fin_dt.prvsn_int_sbsdy_due_rub,
            d_agr_cred_fin_dt.prvsn_int_sbsdy_ovr_rub,
            d_agr_cred_fin_dt.prvsn_discount_of_acqstn_claims_due_rub,
            d_agr_cred_fin_dt.prvsn_discount_of_acqstn_claims_ovr_rub,
            d_agr_cred_fin_dt.prvsn_unused_limit_gen_agr_guar_rub,
            d_agr_cred_fin_dt.prvsn_debt_due_a_rub,
            d_agr_cred_fin_dt.prvsn_debt_ovr_a_rub,
            d_agr_cred_fin_dt.prvsn_intrst_due_bal_a_rub,
            d_agr_cred_fin_dt.prvsn_intrst_ovr_bal_a_rub,
            d_agr_cred_fin_dt.prvsn_unused_limit_a_rub,
            d_agr_cred_fin_dt.prvsn_grntee_a_rub,
            d_agr_cred_fin_dt.prvsn_comiss_int_due_a_rub,
            d_agr_cred_fin_dt.prvsn_comiss_int_ovr_a_rub,
            d_agr_cred_fin_dt.prvsn_int_sbsdy_due_a_rub,
            d_agr_cred_fin_dt.prvsn_int_sbsdy_ovr_a_rub,
            d_agr_cred_fin_dt.prvsn_val_adj_a_rub,
            d_agr_cred_fin_dt.prvsn_discount_of_acqstn_claims_due_a_rub,
            d_agr_cred_fin_dt.prvsn_discount_of_acqstn_claims_ovr_a_rub,
            d_agr_cred_fin_dt.prvsn_premium_of_acqstn_claims_a_rub,
            d_agr_cred_fin_dt.prvsn_unused_limit_gen_agr_guar_a_rub,
            d_agr_cred_fin_dt.prvsn_debt_due_l_rub,
            d_agr_cred_fin_dt.prvsn_debt_ovr_l_rub,
            d_agr_cred_fin_dt.prvsn_intrst_due_bal_l_rub,
            d_agr_cred_fin_dt.prvsn_intrst_ovr_bal_l_rub,
            d_agr_cred_fin_dt.prvsn_unused_limit_l_rub,
            d_agr_cred_fin_dt.prvsn_grntee_l_rub,
            d_agr_cred_fin_dt.prvsn_comiss_int_due_l_rub,
            d_agr_cred_fin_dt.prvsn_comiss_int_ovr_l_rub,
            d_agr_cred_fin_dt.prvsn_int_sbsdy_due_l_rub,
            d_agr_cred_fin_dt.prvsn_int_sbsdy_ovr_l_rub,
            d_agr_cred_fin_dt.prvsn_val_adj_l_rub,
            d_agr_cred_fin_dt.prvsn_discount_of_acqstn_claims_due_l_rub,
            d_agr_cred_fin_dt.prvsn_discount_of_acqstn_claims_ovr_l_rub,
            d_agr_cred_fin_dt.prvsn_premium_of_acqstn_claims_l_rub,
            d_agr_cred_fin_dt.prvsn_unused_limit_gen_agr_guar_l_rub,
            d_agr_cred_fin_dt.comiss_ovr_rub,
            d_agr_cred_fin_dt.comiss_due_rub,
            d_agr_cred_fin_dt.prvsn_comiss_ovr_rub,
            d_agr_cred_fin_dt.prvsn_comiss_due_rub,
            d_agr_cred_fin_dt.info_system_id,
            d_agr_cred_fin_dt.bal_crncy_id,
            d_agr_cred_fin_dt.off_crncy_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt
        UNION ALL
         SELECT d_agr_cred_arc_fin_dt.agr_cred_id,
            d_agr_cred_arc_fin_dt.start_dt,
            d_agr_cred_arc_fin_dt.end_dt,
            d_agr_cred_arc_fin_dt.debt_due_rub,
            d_agr_cred_arc_fin_dt.debt_ovr_rub,
            d_agr_cred_arc_fin_dt.intrst_due_bal_rub,
            d_agr_cred_arc_fin_dt.intrst_due_off_rub,
            d_agr_cred_arc_fin_dt.intrst_ovr_bal_rub,
            d_agr_cred_arc_fin_dt.intrst_ovr_off_rub,
            d_agr_cred_arc_fin_dt.unused_limit_rub,
            d_agr_cred_arc_fin_dt.comiss_rub,
            d_agr_cred_arc_fin_dt.comiss_other_rub,
            d_agr_cred_arc_fin_dt.grntee_rub,
            d_agr_cred_arc_fin_dt.debt_prvsn_write_off_rub,
            d_agr_cred_arc_fin_dt.comiss_opn_lim_due_rub,
            d_agr_cred_arc_fin_dt.comiss_int_due_rub,
            d_agr_cred_arc_fin_dt.comiss_int_ovr_rub,
            d_agr_cred_arc_fin_dt.comiss_opn_due_rub,
            d_agr_cred_arc_fin_dt.comiss_opn_ovr_rub,
            d_agr_cred_arc_fin_dt.int_sbsdy_due_rub,
            d_agr_cred_arc_fin_dt.int_sbsdy_ovr_rub,
            d_agr_cred_arc_fin_dt.txn_costs_rub,
            d_agr_cred_arc_fin_dt.val_adj_incr_rub,
            d_agr_cred_arc_fin_dt.comiss_opn_lim_due_liab_rub,
            d_agr_cred_arc_fin_dt.comiss_int_due_liab_rub,
            d_agr_cred_arc_fin_dt.comiss_opn_due_liab_rub,
            d_agr_cred_arc_fin_dt.int_sbsdy_due_liab_rub,
            d_agr_cred_arc_fin_dt.txn_costs_liab_rub,
            d_agr_cred_arc_fin_dt.val_adj_decr_rub,
            d_agr_cred_arc_fin_dt.prepaid_intrst_rub,
            d_agr_cred_arc_fin_dt.positive_reval_to_fv_pl_rub,
            d_agr_cred_arc_fin_dt.negative_reval_to_fv_pl_rub,
            d_agr_cred_arc_fin_dt.positive_reval_to_fv_oci_rub,
            d_agr_cred_arc_fin_dt.negative_reval_to_fv_oci_rub,
            d_agr_cred_arc_fin_dt.discount_of_acqstn_claims_due_rub,
            d_agr_cred_arc_fin_dt.discount_of_acqstn_claims_ovr_rub,
            d_agr_cred_arc_fin_dt.premium_of_acqstn_claims_rub,
            d_agr_cred_arc_fin_dt.unused_limit_gen_agr_guar_rub,
            d_agr_cred_arc_fin_dt.let_of_cred_cover_rub,
            d_agr_cred_arc_fin_dt.let_of_cred_cond_req_rub,
            d_agr_cred_arc_fin_dt.prvsn_debt_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_debt_ovr_rub,
            d_agr_cred_arc_fin_dt.prvsn_intrst_due_bal_rub,
            d_agr_cred_arc_fin_dt.prvsn_intrst_ovr_bal_rub,
            d_agr_cred_arc_fin_dt.prvsn_unused_limit_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_rub,
            d_agr_cred_arc_fin_dt.prvsn_grntee_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_opn_lim_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_int_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_int_ovr_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_opn_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_opn_ovr_rub,
            d_agr_cred_arc_fin_dt.prvsn_int_sbsdy_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_int_sbsdy_ovr_rub,
            d_agr_cred_arc_fin_dt.prvsn_discount_of_acqstn_claims_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_discount_of_acqstn_claims_ovr_rub,
            d_agr_cred_arc_fin_dt.prvsn_unused_limit_gen_agr_guar_rub,
            d_agr_cred_arc_fin_dt.prvsn_debt_due_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_debt_ovr_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_intrst_due_bal_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_intrst_ovr_bal_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_unused_limit_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_grntee_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_int_due_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_int_ovr_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_int_sbsdy_due_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_int_sbsdy_ovr_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_val_adj_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_discount_of_acqstn_claims_due_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_discount_of_acqstn_claims_ovr_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_premium_of_acqstn_claims_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_unused_limit_gen_agr_guar_a_rub,
            d_agr_cred_arc_fin_dt.prvsn_debt_due_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_debt_ovr_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_intrst_due_bal_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_intrst_ovr_bal_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_unused_limit_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_grntee_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_int_due_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_int_ovr_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_int_sbsdy_due_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_int_sbsdy_ovr_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_val_adj_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_discount_of_acqstn_claims_due_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_discount_of_acqstn_claims_ovr_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_premium_of_acqstn_claims_l_rub,
            d_agr_cred_arc_fin_dt.prvsn_unused_limit_gen_agr_guar_l_rub,
            d_agr_cred_arc_fin_dt.comiss_ovr_rub,
            d_agr_cred_arc_fin_dt.comiss_due_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_ovr_rub,
            d_agr_cred_arc_fin_dt.prvsn_comiss_due_rub,
            d_agr_cred_arc_fin_dt.info_system_id,
            d_agr_cred_arc_fin_dt.bal_crncy_id,
            d_agr_cred_arc_fin_dt.off_crncy_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_arc_fin_dt
        UNION ALL
         SELECT d_agr_cred_old_fin_dt.agr_cred_id,
            d_agr_cred_old_fin_dt.start_dt,
            d_agr_cred_old_fin_dt.end_dt,
            d_agr_cred_old_fin_dt.debt_due_rub,
            d_agr_cred_old_fin_dt.debt_ovr_rub,
            d_agr_cred_old_fin_dt.intrst_due_bal_rub,
            d_agr_cred_old_fin_dt.intrst_due_off_rub,
            d_agr_cred_old_fin_dt.intrst_ovr_bal_rub,
            d_agr_cred_old_fin_dt.intrst_ovr_off_rub,
            d_agr_cred_old_fin_dt.unused_limit_rub,
            d_agr_cred_old_fin_dt.comiss_rub,
            d_agr_cred_old_fin_dt.comiss_other_rub,
            d_agr_cred_old_fin_dt.grntee_rub,
            d_agr_cred_old_fin_dt.debt_prvsn_write_off_rub,
            d_agr_cred_old_fin_dt.comiss_opn_lim_due_rub,
            d_agr_cred_old_fin_dt.comiss_int_due_rub,
            d_agr_cred_old_fin_dt.comiss_int_ovr_rub,
            d_agr_cred_old_fin_dt.comiss_opn_due_rub,
            d_agr_cred_old_fin_dt.comiss_opn_ovr_rub,
            d_agr_cred_old_fin_dt.int_sbsdy_due_rub,
            d_agr_cred_old_fin_dt.int_sbsdy_ovr_rub,
            d_agr_cred_old_fin_dt.txn_costs_rub,
            d_agr_cred_old_fin_dt.val_adj_incr_rub,
            d_agr_cred_old_fin_dt.comiss_opn_lim_due_liab_rub,
            d_agr_cred_old_fin_dt.comiss_int_due_liab_rub,
            d_agr_cred_old_fin_dt.comiss_opn_due_liab_rub,
            d_agr_cred_old_fin_dt.int_sbsdy_due_liab_rub,
            d_agr_cred_old_fin_dt.txn_costs_liab_rub,
            d_agr_cred_old_fin_dt.val_adj_decr_rub,
            d_agr_cred_old_fin_dt.prepaid_intrst_rub,
            d_agr_cred_old_fin_dt.positive_reval_to_fv_pl_rub,
            d_agr_cred_old_fin_dt.negative_reval_to_fv_pl_rub,
            d_agr_cred_old_fin_dt.positive_reval_to_fv_oci_rub,
            d_agr_cred_old_fin_dt.negative_reval_to_fv_oci_rub,
            d_agr_cred_old_fin_dt.discount_of_acqstn_claims_due_rub,
            d_agr_cred_old_fin_dt.discount_of_acqstn_claims_ovr_rub,
            d_agr_cred_old_fin_dt.premium_of_acqstn_claims_rub,
            d_agr_cred_old_fin_dt.unused_limit_gen_agr_guar_rub,
            d_agr_cred_old_fin_dt.let_of_cred_cover_rub,
            d_agr_cred_old_fin_dt.let_of_cred_cond_req_rub,
            d_agr_cred_old_fin_dt.prvsn_debt_due_rub,
            d_agr_cred_old_fin_dt.prvsn_debt_ovr_rub,
            d_agr_cred_old_fin_dt.prvsn_intrst_due_bal_rub,
            d_agr_cred_old_fin_dt.prvsn_intrst_ovr_bal_rub,
            d_agr_cred_old_fin_dt.prvsn_unused_limit_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_rub,
            d_agr_cred_old_fin_dt.prvsn_grntee_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_opn_lim_due_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_int_due_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_int_ovr_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_opn_due_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_opn_ovr_rub,
            d_agr_cred_old_fin_dt.prvsn_int_sbsdy_due_rub,
            d_agr_cred_old_fin_dt.prvsn_int_sbsdy_ovr_rub,
            d_agr_cred_old_fin_dt.prvsn_discount_of_acqstn_claims_due_rub,
            d_agr_cred_old_fin_dt.prvsn_discount_of_acqstn_claims_ovr_rub,
            d_agr_cred_old_fin_dt.prvsn_unused_limit_gen_agr_guar_rub,
            d_agr_cred_old_fin_dt.prvsn_debt_due_a_rub,
            d_agr_cred_old_fin_dt.prvsn_debt_ovr_a_rub,
            d_agr_cred_old_fin_dt.prvsn_intrst_due_bal_a_rub,
            d_agr_cred_old_fin_dt.prvsn_intrst_ovr_bal_a_rub,
            d_agr_cred_old_fin_dt.prvsn_unused_limit_a_rub,
            d_agr_cred_old_fin_dt.prvsn_grntee_a_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_int_due_a_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_int_ovr_a_rub,
            d_agr_cred_old_fin_dt.prvsn_int_sbsdy_due_a_rub,
            d_agr_cred_old_fin_dt.prvsn_int_sbsdy_ovr_a_rub,
            d_agr_cred_old_fin_dt.prvsn_val_adj_a_rub,
            d_agr_cred_old_fin_dt.prvsn_discount_of_acqstn_claims_due_a_rub,
            d_agr_cred_old_fin_dt.prvsn_discount_of_acqstn_claims_ovr_a_rub,
            d_agr_cred_old_fin_dt.prvsn_premium_of_acqstn_claims_a_rub,
            d_agr_cred_old_fin_dt.prvsn_unused_limit_gen_agr_guar_a_rub,
            d_agr_cred_old_fin_dt.prvsn_debt_due_l_rub,
            d_agr_cred_old_fin_dt.prvsn_debt_ovr_l_rub,
            d_agr_cred_old_fin_dt.prvsn_intrst_due_bal_l_rub,
            d_agr_cred_old_fin_dt.prvsn_intrst_ovr_bal_l_rub,
            d_agr_cred_old_fin_dt.prvsn_unused_limit_l_rub,
            d_agr_cred_old_fin_dt.prvsn_grntee_l_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_int_due_l_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_int_ovr_l_rub,
            d_agr_cred_old_fin_dt.prvsn_int_sbsdy_due_l_rub,
            d_agr_cred_old_fin_dt.prvsn_int_sbsdy_ovr_l_rub,
            d_agr_cred_old_fin_dt.prvsn_val_adj_l_rub,
            d_agr_cred_old_fin_dt.prvsn_discount_of_acqstn_claims_due_l_rub,
            d_agr_cred_old_fin_dt.prvsn_discount_of_acqstn_claims_ovr_l_rub,
            d_agr_cred_old_fin_dt.prvsn_premium_of_acqstn_claims_l_rub,
            d_agr_cred_old_fin_dt.prvsn_unused_limit_gen_agr_guar_l_rub,
            d_agr_cred_old_fin_dt.comiss_ovr_rub,
            d_agr_cred_old_fin_dt.comiss_due_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_ovr_rub,
            d_agr_cred_old_fin_dt.prvsn_comiss_due_rub,
            d_agr_cred_old_fin_dt.info_system_id,
            d_agr_cred_old_fin_dt.bal_crncy_id,
            d_agr_cred_old_fin_dt.off_crncy_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_old_fin_dt
        ), t2 AS (
         SELECT dp.agr_cred_id,
            dp.debt_ovr_dt,
            dp.intrst_ovr_dt,
            dp.grntee_comiss_ovr_dt,
            dp.agr_comiss_ovr_dt,
            dp.ovr_dt,
            dp.first_lim_rub,
            dp.first_lim_amt,
            dacos.issued_amt,
            dacos.issued_issue_amt,
                CASE
                    WHEN (dacos.start_dt > dp.start_dt) THEN dacos.start_dt
                    ELSE dp.start_dt
                END AS gen_start_dt,
                CASE
                    WHEN (dacos.end_dt < dp.end_dt) THEN dacos.end_dt
                    ELSE dp.end_dt
                END AS gen_end_dt
           FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp dp
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_prt_dacos dacos ON ((dacos.agr_cred_id = dp.agr_cred_id)))
          WHERE ((dp.agr_cred_id IN ( SELECT d_agr_cred.agr_cred_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred)) AND (
                CASE
                    WHEN (dacos.start_dt > dp.start_dt) THEN dacos.start_dt
                    ELSE dp.start_dt
                END <=
                CASE
                    WHEN (dacos.end_dt < dp.end_dt) THEN dacos.end_dt
                    ELSE dp.end_dt
                END))
        )
 SELECT a.agr_cred_id,
    t2.gen_start_dt,
    t2.gen_end_dt,
        CASE
            WHEN (t2.gen_start_dt > dt.start_dt) THEN t2.gen_start_dt
            ELSE dt.start_dt
        END AS gen_start_dt_sec,
        CASE
            WHEN (t2.gen_end_dt < dt.end_dt) THEN t2.gen_end_dt
            ELSE dt.end_dt
        END AS gen_end_dt_sec,
    dt.debt_due_rub,
    dt.debt_ovr_rub,
    dt.intrst_due_bal_rub,
    dt.intrst_due_off_rub,
    dt.intrst_ovr_off_rub,
    dt.intrst_ovr_bal_rub,
    dt.unused_limit_rub,
    dt.comiss_rub,
    dt.comiss_other_rub,
    dt.grntee_rub,
    dt.debt_prvsn_write_off_rub,
    dt.comiss_opn_lim_due_rub,
    dt.comiss_int_due_rub,
    dt.comiss_int_ovr_rub,
    dt.comiss_opn_due_rub,
    dt.comiss_opn_ovr_rub,
    dt.int_sbsdy_due_rub,
    dt.int_sbsdy_ovr_rub,
    dt.txn_costs_rub,
    dt.val_adj_incr_rub,
    dt.comiss_opn_lim_due_liab_rub,
    dt.comiss_int_due_liab_rub,
    dt.comiss_opn_due_liab_rub,
    dt.int_sbsdy_due_liab_rub,
    dt.txn_costs_liab_rub,
    dt.val_adj_decr_rub,
    dt.prepaid_intrst_rub,
    dt.positive_reval_to_fv_pl_rub,
    dt.negative_reval_to_fv_pl_rub,
    dt.positive_reval_to_fv_oci_rub,
    dt.negative_reval_to_fv_oci_rub,
    dt.discount_of_acqstn_claims_due_rub,
    dt.discount_of_acqstn_claims_ovr_rub,
    dt.premium_of_acqstn_claims_rub,
    dt.unused_limit_gen_agr_guar_rub,
    dt.let_of_cred_cover_rub,
    dt.let_of_cred_cond_req_rub,
    dt.prvsn_debt_due_rub,
    dt.prvsn_debt_ovr_rub,
    dt.prvsn_intrst_due_bal_rub,
    dt.prvsn_intrst_ovr_bal_rub,
    dt.prvsn_unused_limit_rub,
    dt.prvsn_comiss_rub,
    dt.prvsn_grntee_rub,
    dt.prvsn_comiss_opn_lim_due_rub,
    dt.prvsn_comiss_int_due_rub,
    dt.prvsn_comiss_int_ovr_rub,
    dt.prvsn_comiss_opn_due_rub,
    dt.prvsn_comiss_opn_ovr_rub,
    dt.prvsn_int_sbsdy_due_rub,
    dt.prvsn_int_sbsdy_ovr_rub,
    dt.prvsn_discount_of_acqstn_claims_due_rub,
    dt.prvsn_discount_of_acqstn_claims_ovr_rub,
    dt.prvsn_unused_limit_gen_agr_guar_rub,
    dt.prvsn_debt_due_a_rub,
    dt.prvsn_debt_ovr_a_rub,
    dt.prvsn_intrst_due_bal_a_rub,
    dt.prvsn_intrst_ovr_bal_a_rub,
    dt.prvsn_unused_limit_a_rub,
    dt.prvsn_grntee_a_rub,
    dt.prvsn_comiss_int_due_a_rub,
    dt.prvsn_comiss_int_ovr_a_rub,
    dt.prvsn_int_sbsdy_due_a_rub,
    dt.prvsn_int_sbsdy_ovr_a_rub,
    dt.prvsn_val_adj_a_rub,
    dt.prvsn_discount_of_acqstn_claims_due_a_rub,
    dt.prvsn_discount_of_acqstn_claims_ovr_a_rub,
    dt.prvsn_premium_of_acqstn_claims_a_rub,
    dt.prvsn_unused_limit_gen_agr_guar_a_rub,
    dt.prvsn_debt_due_l_rub,
    dt.prvsn_debt_ovr_l_rub,
    dt.prvsn_intrst_due_bal_l_rub,
    dt.prvsn_intrst_ovr_bal_l_rub,
    dt.prvsn_unused_limit_l_rub,
    dt.prvsn_grntee_l_rub,
    dt.prvsn_comiss_int_due_l_rub,
    dt.prvsn_comiss_int_ovr_l_rub,
    dt.prvsn_int_sbsdy_due_l_rub,
    dt.prvsn_int_sbsdy_ovr_l_rub,
    dt.prvsn_val_adj_l_rub,
    dt.prvsn_discount_of_acqstn_claims_due_l_rub,
    dt.prvsn_discount_of_acqstn_claims_ovr_l_rub,
    dt.prvsn_premium_of_acqstn_claims_l_rub,
    dt.prvsn_unused_limit_gen_agr_guar_l_rub,
    dt.comiss_ovr_rub,
    dt.comiss_due_rub,
    dt.prvsn_comiss_ovr_rub,
    dt.prvsn_comiss_due_rub,
    t2.debt_ovr_dt,
    t2.intrst_ovr_dt,
    t2.grntee_comiss_ovr_dt,
    t2.agr_comiss_ovr_dt,
    t2.ovr_dt,
    t2.first_lim_rub,
    t2.first_lim_amt,
    t2.issued_amt,
    t2.issued_issue_amt,
    a.crncy_id,
    a.issue_crncy_id,
    a.info_system_id,
    dt.bal_crncy_id,
    dt.off_crncy_id,
    a.agr_cred_type_cd
   FROM ((t1 dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred a ON ((a.agr_cred_id = dt.agr_cred_id)))
     JOIN t2 ON ((t2.agr_cred_id = a.agr_cred_id)))
  WHERE ((1 = 1) AND (
        CASE
            WHEN (t2.gen_start_dt > dt.start_dt) THEN t2.gen_start_dt
            ELSE dt.start_dt
        END <=
        CASE
            WHEN (t2.gen_end_dt < dt.end_dt) THEN t2.gen_end_dt
            ELSE dt.end_dt
        END));"
d_agr_cred_fin_dt," SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.debt_due_rub,
    t.debt_ovr_rub,
    t.intrst_due_bal_rub,
    t.intrst_due_off_rub,
    t.intrst_ovr_bal_rub,
    t.intrst_ovr_off_rub,
    t.unused_limit_rub,
    t.comiss_rub,
    t.comiss_other_rub,
    t.grntee_rub,
    t.debt_prvsn_write_off_rub,
    t.comiss_opn_lim_due_rub,
    t.comiss_int_due_rub,
    t.comiss_int_ovr_rub,
    t.comiss_opn_due_rub,
    t.comiss_opn_ovr_rub,
    t.int_sbsdy_due_rub,
    t.int_sbsdy_ovr_rub,
    t.txn_costs_rub,
    t.val_adj_incr_rub,
    t.comiss_opn_lim_due_liab_rub,
    t.comiss_int_due_liab_rub,
    t.comiss_opn_due_liab_rub,
    t.int_sbsdy_due_liab_rub,
    t.txn_costs_liab_rub,
    t.val_adj_decr_rub,
    t.prepaid_intrst_rub,
    t.positive_reval_to_fv_pl_rub,
    t.negative_reval_to_fv_pl_rub,
    t.positive_reval_to_fv_oci_rub,
    t.negative_reval_to_fv_oci_rub,
    t.discount_of_acqstn_claims_due_rub,
    t.discount_of_acqstn_claims_ovr_rub,
    t.premium_of_acqstn_claims_rub,
    t.unused_limit_gen_agr_guar_rub,
    t.let_of_cred_cover_rub,
    t.let_of_cred_cond_req_rub,
    t.prvsn_debt_due_rub,
    t.prvsn_debt_ovr_rub,
    t.prvsn_intrst_due_bal_rub,
    t.prvsn_intrst_ovr_bal_rub,
    t.prvsn_unused_limit_rub,
    t.prvsn_comiss_rub,
    t.prvsn_grntee_rub,
    t.prvsn_comiss_opn_lim_due_rub,
    t.prvsn_comiss_int_due_rub,
    t.prvsn_comiss_int_ovr_rub,
    t.prvsn_comiss_opn_due_rub,
    t.prvsn_comiss_opn_ovr_rub,
    t.prvsn_int_sbsdy_due_rub,
    t.prvsn_int_sbsdy_ovr_rub,
    t.prvsn_discount_of_acqstn_claims_due_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_rub,
    t.prvsn_unused_limit_gen_agr_guar_rub,
    t.prvsn_debt_due_a_rub,
    t.prvsn_debt_ovr_a_rub,
    t.prvsn_intrst_due_bal_a_rub,
    t.prvsn_intrst_ovr_bal_a_rub,
    t.prvsn_unused_limit_a_rub,
    t.prvsn_grntee_a_rub,
    t.prvsn_comiss_int_due_a_rub,
    t.prvsn_comiss_int_ovr_a_rub,
    t.prvsn_int_sbsdy_due_a_rub,
    t.prvsn_int_sbsdy_ovr_a_rub,
    t.prvsn_val_adj_a_rub,
    t.prvsn_discount_of_acqstn_claims_due_a_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_a_rub,
    t.prvsn_premium_of_acqstn_claims_a_rub,
    t.prvsn_unused_limit_gen_agr_guar_a_rub,
    t.prvsn_debt_due_l_rub,
    t.prvsn_debt_ovr_l_rub,
    t.prvsn_intrst_due_bal_l_rub,
    t.prvsn_intrst_ovr_bal_l_rub,
    t.prvsn_unused_limit_l_rub,
    t.prvsn_grntee_l_rub,
    t.prvsn_comiss_int_due_l_rub,
    t.prvsn_comiss_int_ovr_l_rub,
    t.prvsn_int_sbsdy_due_l_rub,
    t.prvsn_int_sbsdy_ovr_l_rub,
    t.prvsn_val_adj_l_rub,
    t.prvsn_discount_of_acqstn_claims_due_l_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_l_rub,
    t.prvsn_premium_of_acqstn_claims_l_rub,
    t.prvsn_unused_limit_gen_agr_guar_l_rub,
    t.comiss_ovr_rub,
    t.comiss_due_rub,
    t.prvsn_comiss_ovr_rub,
    (t.prvsn_comiss_rub - t.prvsn_comiss_ovr_rub) AS prvsn_comiss_due_rub,
    t.info_system_id,
    t.bal_crncy_id,
    t.off_crncy_id
   FROM ( SELECT t_1.agr_cred_id,
            t_1.start_dt,
            t_1.end_dt,
            t_1.debt_due_rub,
            t_1.debt_ovr_rub,
            t_1.intrst_due_bal_rub,
            t_1.intrst_due_off_rub,
            t_1.intrst_ovr_bal_rub,
            t_1.intrst_ovr_off_rub,
            t_1.unused_limit_rub,
            t_1.comiss_rub,
            t_1.comiss_other_rub,
            t_1.grntee_rub,
            t_1.debt_prvsn_write_off_rub,
            t_1.comiss_opn_lim_due_rub,
            t_1.comiss_int_due_rub,
            t_1.comiss_int_ovr_rub,
            t_1.comiss_opn_due_rub,
            t_1.comiss_opn_ovr_rub,
            t_1.int_sbsdy_due_rub,
            t_1.int_sbsdy_ovr_rub,
            t_1.txn_costs_rub,
            t_1.val_adj_incr_rub,
            t_1.comiss_opn_lim_due_liab_rub,
            t_1.comiss_int_due_liab_rub,
            t_1.comiss_opn_due_liab_rub,
            t_1.int_sbsdy_due_liab_rub,
            t_1.txn_costs_liab_rub,
            t_1.val_adj_decr_rub,
            t_1.prepaid_intrst_rub,
            t_1.positive_reval_to_fv_pl_rub,
            t_1.negative_reval_to_fv_pl_rub,
            t_1.positive_reval_to_fv_oci_rub,
            t_1.negative_reval_to_fv_oci_rub,
            t_1.discount_of_acqstn_claims_due_rub,
            t_1.discount_of_acqstn_claims_ovr_rub,
            t_1.premium_of_acqstn_claims_rub,
            t_1.unused_limit_gen_agr_guar_rub,
            t_1.let_of_cred_cover_rub,
            t_1.let_of_cred_cond_req_rub,
            t_1.prvsn_debt_due_rub,
            t_1.prvsn_debt_ovr_rub,
            t_1.prvsn_intrst_due_bal_rub,
            t_1.prvsn_intrst_ovr_bal_rub,
            t_1.prvsn_unused_limit_rub,
            t_1.prvsn_comiss_rub,
            t_1.prvsn_grntee_rub,
            t_1.prvsn_comiss_opn_lim_due_rub,
            t_1.prvsn_comiss_int_due_rub,
            t_1.prvsn_comiss_int_ovr_rub,
            t_1.prvsn_comiss_opn_due_rub,
            t_1.prvsn_comiss_opn_ovr_rub,
            t_1.prvsn_int_sbsdy_due_rub,
            t_1.prvsn_int_sbsdy_ovr_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_rub,
            t_1.prvsn_debt_due_a_rub,
            t_1.prvsn_debt_ovr_a_rub,
            t_1.prvsn_intrst_due_bal_a_rub,
            t_1.prvsn_intrst_ovr_bal_a_rub,
            t_1.prvsn_unused_limit_a_rub,
            t_1.prvsn_grntee_a_rub,
            t_1.prvsn_comiss_int_due_a_rub,
            t_1.prvsn_comiss_int_ovr_a_rub,
            t_1.prvsn_int_sbsdy_due_a_rub,
            t_1.prvsn_int_sbsdy_ovr_a_rub,
            t_1.prvsn_val_adj_a_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_a_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_a_rub,
            t_1.prvsn_premium_of_acqstn_claims_a_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_a_rub,
            t_1.prvsn_debt_due_l_rub,
            t_1.prvsn_debt_ovr_l_rub,
            t_1.prvsn_intrst_due_bal_l_rub,
            t_1.prvsn_intrst_ovr_bal_l_rub,
            t_1.prvsn_unused_limit_l_rub,
            t_1.prvsn_grntee_l_rub,
            t_1.prvsn_comiss_int_due_l_rub,
            t_1.prvsn_comiss_int_ovr_l_rub,
            t_1.prvsn_int_sbsdy_due_l_rub,
            t_1.prvsn_int_sbsdy_ovr_l_rub,
            t_1.prvsn_val_adj_l_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_l_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_l_rub,
            t_1.prvsn_premium_of_acqstn_claims_l_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_l_rub,
            t_1.comiss_ovr_rub,
            t_1.comiss_due_rub,
            (t_1.prvsn_comiss_rub * (t_1.comiss_ovr_rub / NULLIF((t_1.comiss_ovr_rub + t_1.comiss_due_rub), (0)::numeric))) AS prvsn_comiss_ovr_rub,
            t_1.info_system_id,
            t_1.bal_crncy_id,
            t_1.off_crncy_id
           FROM ( SELECT t_2.agr_cred_id,
                    t_2.start_dt,
                    t_2.end_dt,
                    t_2.debt_due_rub,
                    t_2.debt_ovr_rub,
                    t_2.intrst_due_bal_rub,
                    t_2.intrst_due_off_rub,
                    t_2.intrst_ovr_bal_rub,
                    t_2.intrst_ovr_off_rub,
                    t_2.unused_limit_rub,
                    t_2.comiss_rub,
                    t_2.comiss_other_rub,
                    t_2.grntee_rub,
                    t_2.debt_prvsn_write_off_rub,
                    t_2.comiss_opn_lim_due_rub,
                    t_2.comiss_int_due_rub,
                    t_2.comiss_int_ovr_rub,
                    t_2.comiss_opn_due_rub,
                    t_2.comiss_opn_ovr_rub,
                    t_2.int_sbsdy_due_rub,
                    t_2.int_sbsdy_ovr_rub,
                    t_2.txn_costs_rub,
                    t_2.val_adj_incr_rub,
                    t_2.comiss_opn_lim_due_liab_rub,
                    t_2.comiss_int_due_liab_rub,
                    t_2.comiss_opn_due_liab_rub,
                    t_2.int_sbsdy_due_liab_rub,
                    t_2.txn_costs_liab_rub,
                    t_2.val_adj_decr_rub,
                    t_2.prepaid_intrst_rub,
                    t_2.positive_reval_to_fv_pl_rub,
                    t_2.negative_reval_to_fv_pl_rub,
                    t_2.positive_reval_to_fv_oci_rub,
                    t_2.negative_reval_to_fv_oci_rub,
                    t_2.discount_of_acqstn_claims_due_rub,
                    t_2.discount_of_acqstn_claims_ovr_rub,
                    t_2.premium_of_acqstn_claims_rub,
                    t_2.unused_limit_gen_agr_guar_rub,
                    t_2.let_of_cred_cover_rub,
                    t_2.let_of_cred_cond_req_rub,
                    t_2.prvsn_debt_due_rub,
                    t_2.prvsn_debt_ovr_rub,
                    t_2.prvsn_intrst_due_bal_rub,
                    t_2.prvsn_intrst_ovr_bal_rub,
                    t_2.prvsn_unused_limit_rub,
                    t_2.prvsn_comiss_rub,
                    t_2.prvsn_grntee_rub,
                    t_2.prvsn_comiss_opn_lim_due_rub,
                    t_2.prvsn_comiss_int_due_rub,
                    t_2.prvsn_comiss_int_ovr_rub,
                    t_2.prvsn_comiss_opn_due_rub,
                    t_2.prvsn_comiss_opn_ovr_rub,
                    t_2.prvsn_int_sbsdy_due_rub,
                    t_2.prvsn_int_sbsdy_ovr_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_rub,
                    t_2.prvsn_debt_due_a_rub,
                    t_2.prvsn_debt_ovr_a_rub,
                    t_2.prvsn_intrst_due_bal_a_rub,
                    t_2.prvsn_intrst_ovr_bal_a_rub,
                    t_2.prvsn_unused_limit_a_rub,
                    t_2.prvsn_grntee_a_rub,
                    t_2.prvsn_comiss_int_due_a_rub,
                    t_2.prvsn_comiss_int_ovr_a_rub,
                    t_2.prvsn_int_sbsdy_due_a_rub,
                    t_2.prvsn_int_sbsdy_ovr_a_rub,
                    t_2.prvsn_val_adj_a_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_a_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_a_rub,
                    t_2.prvsn_premium_of_acqstn_claims_a_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_a_rub,
                    t_2.prvsn_debt_due_l_rub,
                    t_2.prvsn_debt_ovr_l_rub,
                    t_2.prvsn_intrst_due_bal_l_rub,
                    t_2.prvsn_intrst_ovr_bal_l_rub,
                    t_2.prvsn_unused_limit_l_rub,
                    t_2.prvsn_grntee_l_rub,
                    t_2.prvsn_comiss_int_due_l_rub,
                    t_2.prvsn_comiss_int_ovr_l_rub,
                    t_2.prvsn_int_sbsdy_due_l_rub,
                    t_2.prvsn_int_sbsdy_ovr_l_rub,
                    t_2.prvsn_val_adj_l_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_l_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_l_rub,
                    t_2.prvsn_premium_of_acqstn_claims_l_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_l_rub,
                    t_2.comiss_ovr_rub,
                    (t_2.comiss_rub - t_2.comiss_ovr_rub) AS comiss_due_rub,
                    t_2.info_system_id,
                    t_2.bal_crncy_id,
                    t_2.off_crncy_id
                   FROM ( SELECT t_3.agr_cred_id,
                            t_3.start_dt,
                            t_3.end_dt,
                            t_3.debt_due_rub,
                            t_3.debt_ovr_rub,
                            t_3.intrst_due_bal_rub,
                            t_3.intrst_due_off_rub,
                            t_3.intrst_ovr_bal_rub,
                            t_3.intrst_ovr_off_rub,
                            t_3.unused_limit_rub,
                            t_3.comiss_rub,
                            t_3.comiss_other_rub,
                            t_3.grntee_rub,
                            t_3.debt_prvsn_write_off_rub,
                            t_3.comiss_opn_lim_due_rub,
                            t_3.comiss_int_due_rub,
                            t_3.comiss_int_ovr_rub,
                            t_3.comiss_opn_due_rub,
                            t_3.comiss_opn_ovr_rub,
                            t_3.int_sbsdy_due_rub,
                            t_3.int_sbsdy_ovr_rub,
                            t_3.txn_costs_rub,
                            t_3.val_adj_incr_rub,
                            t_3.comiss_opn_lim_due_liab_rub,
                            t_3.comiss_int_due_liab_rub,
                            t_3.comiss_opn_due_liab_rub,
                            t_3.int_sbsdy_due_liab_rub,
                            t_3.txn_costs_liab_rub,
                            t_3.val_adj_decr_rub,
                            t_3.prepaid_intrst_rub,
                            t_3.positive_reval_to_fv_pl_rub,
                            t_3.negative_reval_to_fv_pl_rub,
                            t_3.positive_reval_to_fv_oci_rub,
                            t_3.negative_reval_to_fv_oci_rub,
                            t_3.discount_of_acqstn_claims_due_rub,
                            t_3.discount_of_acqstn_claims_ovr_rub,
                            t_3.premium_of_acqstn_claims_rub,
                            t_3.unused_limit_gen_agr_guar_rub,
                            t_3.let_of_cred_cover_rub,
                            t_3.let_of_cred_cond_req_rub,
                            t_3.prvsn_debt_due_rub,
                            t_3.prvsn_debt_ovr_rub,
                            t_3.prvsn_intrst_due_bal_rub,
                            t_3.prvsn_intrst_ovr_bal_rub,
                            t_3.prvsn_unused_limit_rub,
                            t_3.prvsn_comiss_rub,
                            t_3.prvsn_grntee_rub,
                            t_3.prvsn_comiss_opn_lim_due_rub,
                            t_3.prvsn_comiss_int_due_rub,
                            t_3.prvsn_comiss_int_ovr_rub,
                            t_3.prvsn_comiss_opn_due_rub,
                            t_3.prvsn_comiss_opn_ovr_rub,
                            t_3.prvsn_int_sbsdy_due_rub,
                            t_3.prvsn_int_sbsdy_ovr_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_rub,
                            t_3.prvsn_debt_due_a_rub,
                            t_3.prvsn_debt_ovr_a_rub,
                            t_3.prvsn_intrst_due_bal_a_rub,
                            t_3.prvsn_intrst_ovr_bal_a_rub,
                            t_3.prvsn_unused_limit_a_rub,
                            t_3.prvsn_grntee_a_rub,
                            t_3.prvsn_comiss_int_due_a_rub,
                            t_3.prvsn_comiss_int_ovr_a_rub,
                            t_3.prvsn_int_sbsdy_due_a_rub,
                            t_3.prvsn_int_sbsdy_ovr_a_rub,
                            t_3.prvsn_val_adj_a_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_a_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_a_rub,
                            t_3.prvsn_premium_of_acqstn_claims_a_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_a_rub,
                            t_3.prvsn_debt_due_l_rub,
                            t_3.prvsn_debt_ovr_l_rub,
                            t_3.prvsn_intrst_due_bal_l_rub,
                            t_3.prvsn_intrst_ovr_bal_l_rub,
                            t_3.prvsn_unused_limit_l_rub,
                            t_3.prvsn_grntee_l_rub,
                            t_3.prvsn_comiss_int_due_l_rub,
                            t_3.prvsn_comiss_int_ovr_l_rub,
                            t_3.prvsn_int_sbsdy_due_l_rub,
                            t_3.prvsn_int_sbsdy_ovr_l_rub,
                            t_3.prvsn_val_adj_l_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_l_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_l_rub,
                            t_3.prvsn_premium_of_acqstn_claims_l_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_l_rub,
                                CASE
                                    WHEN (GREATEST(COALESCE(t_3.optn_sum_rub, (0)::numeric), (0)::numeric) < COALESCE(t_3.comiss_rub, (0)::numeric)) THEN GREATEST(COALESCE(t_3.optn_sum_rub, (0)::numeric), (0)::numeric)
                                    ELSE t_3.comiss_rub
                                END AS comiss_ovr_rub,
                            t_3.info_system_id,
                            t_3.bal_crncy_id,
                            t_3.off_crncy_id
                           FROM ( SELECT dt.id AS agr_cred_id,
                                    dt.start_dt,
                                    max(dt.end_dt) AS end_dt,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_due_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L004'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_due_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_ovr_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L006'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_ovr_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_L007'::text, 'AGRA_L051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS unused_limit_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L008'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L018'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_other_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS grntee_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L020'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_prvsn_write_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L021'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_lim_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L024'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L025'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L028'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS txn_costs_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS val_adj_incr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L031'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_lim_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L032'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L034'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L036'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L038'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS txn_costs_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L039'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS val_adj_decr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L040'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prepaid_intrst_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L041'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS positive_reval_to_fv_pl_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L042'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS negative_reval_to_fv_pl_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L043'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS positive_reval_to_fv_oci_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L044'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS negative_reval_to_fv_oci_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS discount_of_acqstn_claims_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS discount_of_acqstn_claims_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS premium_of_acqstn_claims_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS unused_limit_gen_agr_guar_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L049'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS let_of_cred_cover_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L050'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS let_of_cred_cond_req_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_P007'::text, 'AGRA_P051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P008'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P021'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_lim_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P024'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P025'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_J007'::text, 'AGRA_J051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_val_adj_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_premium_of_acqstn_claims_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_N007'::text, 'AGRA_N051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_val_adj_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_premium_of_acqstn_claims_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_l_rub,
                                    max(dt.info_system_id) AS info_system_id,
                                    max(
CASE
 WHEN ((coa.meas_cd = ANY (ARRAY['AGRA_L001'::text, 'AGRA_L002'::text])) AND (coa.meas_rub > (0)::numeric)) THEN coa.crncy_id
 ELSE NULL::bigint
END) AS bal_crncy_id,
                                    max(
CASE
 WHEN ((coa.meas_cd = ANY (ARRAY['AGRA_L007'::text, 'AGRA_L009'::text, 'AGRA_L048'::text])) AND (coa.meas_rub > (0)::numeric)) THEN coa.crncy_id
 ELSE NULL::bigint
END) AS off_crncy_id,
                                    sum(com.optn_sum_rub) AS optn_sum_rub
                                   FROM ((( SELECT ""Window"".id,
    ""Window"".start_dt,
    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    ""Window"".info_system_id
   FROM ( SELECT dt_1.id,
      dt_1.start_dt,
      max(dt_1.info_system_id) AS info_system_id
     FROM ( SELECT coa_1.agr_cred_id AS id,
      CASE
       WHEN (m.i = 1) THEN coa_1.start_dt
       WHEN (m.i = 2) THEN (coa_1.end_dt + 1)
       ELSE NULL::date
      END AS start_dt,
        coa_1.info_system_id
       FROM (( SELECT t1.agr_cred_id,
          t1.start_dt,
          t1.end_dt,
          t1.info_system_id
         FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa t1
      UNION ALL
       SELECT d_agr_cred_coa_uvdo.agr_cred_id,
          d_agr_cred_coa_uvdo.start_dt,
          d_agr_cred_coa_uvdo.end_dt,
          d_agr_cred_coa_uvdo.info_system_id
         FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_uvdo
      UNION ALL
       SELECT d_coa_cred_coa.agr_cred_id,
          d_coa_cred_coa.start_dt,
          d_coa_cred_coa.end_dt,
          d_coa_cred_coa.info_system_id
         FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_coa) coa_1
         JOIN ( SELECT a.i
         FROM ( SELECT 1 AS i) a
      UNION ALL
       SELECT a.i
         FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (coa_1.end_dt <> '9999-12-31'::date)))))
    UNION ALL
     SELECT d_agr_cred_fin_dt_com_tmp.agr_cred_id AS id,
        d_agr_cred_fin_dt_com_tmp.start_dt,
        d_agr_cred_fin_dt_com_tmp.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp
    UNION ALL
     SELECT d_agr_cred_fin_dt_com_tmp.agr_cred_id AS id,
        (d_agr_cred_fin_dt_com_tmp.end_dt + 1) AS start_dt,
        d_agr_cred_fin_dt_com_tmp.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp
      WHERE (d_agr_cred_fin_dt_com_tmp.end_dt <> '9999-12-31'::date)) dt_1
    GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
                                     JOIN ( SELECT d_agr_cred_coa.agr_cred_id,
    d_agr_cred_coa.start_dt,
    d_agr_cred_coa.end_dt,
    d_agr_cred_coa.meas_cd,
    d_agr_cred_coa.meas_rub,
    d_agr_cred_coa.coa_id,
    d_agr_cred_coa.crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa
UNION ALL
 SELECT d_agr_cred_coa_uvdo.agr_cred_id,
    d_agr_cred_coa_uvdo.start_dt,
    d_agr_cred_coa_uvdo.end_dt,
    d_agr_cred_coa_uvdo.meas_cd,
    d_agr_cred_coa_uvdo.meas_rub,
    d_agr_cred_coa_uvdo.coa_id,
    d_agr_cred_coa_uvdo.crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_uvdo
UNION ALL
 SELECT d_coa_cred_coa.agr_cred_id,
    d_coa_cred_coa.start_dt,
    d_coa_cred_coa.end_dt,
    d_coa_cred_coa.meas_cd,
    d_coa_cred_coa.meas_rub,
    d_coa_cred_coa.coa_id,
    d_coa_cred_coa.crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_coa) coa ON ((((coa.agr_cred_id = dt.id) AND (dt.start_dt >= coa.start_dt)) AND (dt.start_dt <= coa.end_dt))))
                                     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp com ON ((((dt.id = com.agr_cred_id) AND (dt.start_dt >= com.start_dt)) AND (dt.start_dt <= com.end_dt))))
                                  GROUP BY dt.id, dt.start_dt) t_3) t_2) t_1) t;"
d_agr_cred_coa_amt_cor," SELECT t.meas_src_cd,
    t.agr_cred_id,
    t.coa_id,
    t.agr_coa_role_id,
    t.coa_to_agrmnt_role_cd,
    t.coa_n_id,
    ((substr(COALESCE(t.meas_cd, t.meas_src_cd), 1, 5) || t.adj_type) || substr(COALESCE(t.meas_cd, t.meas_src_cd), 7, 3)) AS meas_cd,
    t.start_dt,
    t.end_dt,
    t.crncy_id,
    t.coa_num,
    t.bal_amt,
    t.bal_rub,
    ((t.sum_agra_l1 * t.sum_meas_amt) / t.sum_agra_l0) AS meas_amt,
    ((t.sum_r_agra_l1 * t.sum_rub_amt) / t.sum_r_agra_l0) AS meas_rub,
    0 AS delta_amt,
    0 AS delta_rub,
    t.prvsn_port_flag,
    t.eks_port_flag,
    t.info_system_id
   FROM ( SELECT dt.id AS agr_cred_id,
            c1.meas_src_cd,
            c1.coa_id,
            c1.agr_coa_role_id,
            c1.coa_to_agrmnt_role_cd,
            c1.coa_n_id,
            c1.crncy_id,
            c1.coa_num,
            c1.bal_amt,
            c1.bal_rub,
            c1.prvsn_port_flag,
            c1.eks_port_flag,
            c1.info_system_id,
            dt.start_dt,
            dt.end_dt,
            c1.adj_type,
            max(COALESCE(c1.meas_amt, (0)::numeric)) OVER (PARTITION BY dt.id, c1.coa_id, dt.start_dt, c1.adj_type) AS sum_agra_l1,
            max(COALESCE(c1.meas_rub, (0)::numeric)) OVER (PARTITION BY dt.id, c1.coa_id, dt.start_dt, c1.adj_type) AS sum_r_agra_l1,
            c2.meas_cd,
            COALESCE(NULLIF(sum(COALESCE(c2.meas_amt, (0)::numeric)) OVER (PARTITION BY dt.id, c1.coa_id, dt.start_dt, c1.adj_type), (0)::numeric), (1)::numeric) AS sum_agra_l0,
            COALESCE(NULLIF(sum(COALESCE(c2.meas_rub, (0)::numeric)) OVER (PARTITION BY dt.id, c1.coa_id, dt.start_dt, c1.adj_type), (0)::numeric), (1)::numeric) AS sum_r_agra_l0,
            COALESCE(NULLIF(sum(COALESCE(c2.meas_amt, (0)::numeric)) OVER (PARTITION BY dt.id, c1.coa_id, dt.start_dt, c2.meas_cd, c1.adj_type), (0)::numeric), (1)::numeric) AS sum_meas_amt,
            COALESCE(NULLIF(sum(COALESCE(c2.meas_rub, (0)::numeric)) OVER (PARTITION BY dt.id, c1.coa_id, dt.start_dt, c2.meas_cd, c1.adj_type), (0)::numeric), (1)::numeric) AS sum_rub_amt
           FROM ((( SELECT ""Window"".id,
                    ""Window"".start_dt,
                    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    ""Window"".info_system_id
                   FROM ( SELECT dt_1.id,
                            dt_1.start_dt,
                            max(dt_1.info_system_id) AS info_system_id
                           FROM ( SELECT coa.agr_cred_id AS id,
                                    coa.start_dt,
                                    coa.info_system_id
                                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa coa
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_meas_adj m ON ((m.meas_cd = coa.meas_cd)))
                                  WHERE ((coa.start_dt <> '1900-01-01'::date) AND (EXISTS ( SELECT 1
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa c
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_meas_adj m_1 ON (((m_1.meas_cd = c.meas_cd) AND (m_1.meas_adj_type = '1'::text))))
  WHERE ((c.agr_cred_id = coa.agr_cred_id) AND (COALESCE(c.meas_amt, (0)::numeric) <> (0)::numeric)))))
                                UNION ALL
                                 SELECT coa.agr_cred_id AS id,
                                    (coa.end_dt + 1),
                                    coa.info_system_id
                                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa coa
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_meas_adj m ON ((m.meas_cd = coa.meas_cd)))
                                  WHERE ((coa.end_dt <> '9999-12-31'::date) AND (EXISTS ( SELECT 1
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa c
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_meas_adj m_1 ON (((m_1.meas_cd = c.meas_cd) AND (m_1.meas_adj_type = '1'::text))))
  WHERE ((c.agr_cred_id = coa.agr_cred_id) AND (COALESCE(c.meas_amt, (0)::numeric) <> (0)::numeric)))))) dt_1
                          GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
             JOIN ( SELECT c1_1.meas_amt,
                    c1_1.meas_rub,
                    c1_1.meas_cd AS meas_src_cd,
                    c1_1.coa_id,
                    c1_1.agr_coa_role_id,
                    c1_1.coa_to_agrmnt_role_cd,
                    c1_1.coa_n_id,
                    c1_1.crncy_id,
                    c1_1.coa_num,
                    c1_1.bal_amt,
                    c1_1.bal_rub,
                    c1_1.prvsn_port_flag,
                    c1_1.eks_port_flag,
                    c1_1.info_system_id,
                    c1_1.agr_cred_id,
                    c1_1.start_dt,
                    c1_1.end_dt,
                    m1.adj_type
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa c1_1
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_meas_adj m1 ON (((m1.meas_cd = c1_1.meas_cd) AND (m1.meas_adj_type = '1'::text))))
                  WHERE (c1_1.meas_amt <> (0)::numeric)) c1 ON ((((c1.agr_cred_id = dt.id) AND (dt.start_dt >= c1.start_dt)) AND (dt.start_dt <= c1.end_dt))))
             LEFT JOIN ( SELECT c2_1.meas_cd,
                    c2_1.meas_amt,
                    c2_1.meas_rub,
                    c2_1.agr_cred_id,
                    c2_1.start_dt,
                    c2_1.end_dt
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa c2_1
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_meas_adj m2 ON (((m2.meas_cd = c2_1.meas_cd) AND (m2.meas_adj_type = '2'::text))))
                  WHERE (c2_1.meas_amt <> (0)::numeric)) c2 ON ((((c2.agr_cred_id = dt.id) AND (dt.start_dt >= c2.start_dt)) AND (dt.start_dt <= c2.end_dt))))) t
  GROUP BY t.meas_src_cd, t.agr_cred_id, t.coa_id, t.agr_coa_role_id, t.coa_to_agrmnt_role_cd, t.coa_n_id, ((substr(COALESCE(t.meas_cd, t.meas_src_cd), 1, 5) || t.adj_type) || substr(COALESCE(t.meas_cd, t.meas_src_cd), 7, 3)), t.start_dt, t.end_dt, t.crncy_id, t.coa_num, t.bal_amt, t.bal_rub, ((t.sum_agra_l1 * t.sum_meas_amt) / t.sum_agra_l0), ((t.sum_r_agra_l1 * t.sum_rub_amt) / t.sum_r_agra_l0), 0::integer, t.prvsn_port_flag, t.eks_port_flag, t.info_system_id;"
d_agr_cred_rate," SELECT 1 AS a
   FROM (((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp t1
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t2)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa t3)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_old t4)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_tmp t5)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_arc t6);"
d_agr_cred_arc_fin_dt," SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.debt_due_rub,
    t.debt_ovr_rub,
    t.intrst_due_bal_rub,
    t.intrst_due_off_rub,
    t.intrst_ovr_bal_rub,
    t.intrst_ovr_off_rub,
    t.unused_limit_rub,
    t.comiss_rub,
    t.comiss_other_rub,
    t.grntee_rub,
    t.debt_prvsn_write_off_rub,
    t.comiss_opn_lim_due_rub,
    t.comiss_int_due_rub,
    t.comiss_int_ovr_rub,
    t.comiss_opn_due_rub,
    t.comiss_opn_ovr_rub,
    t.int_sbsdy_due_rub,
    t.int_sbsdy_ovr_rub,
    t.txn_costs_rub,
    t.val_adj_incr_rub,
    t.comiss_opn_lim_due_liab_rub,
    t.comiss_int_due_liab_rub,
    t.comiss_opn_due_liab_rub,
    t.int_sbsdy_due_liab_rub,
    t.txn_costs_liab_rub,
    t.val_adj_decr_rub,
    t.prepaid_intrst_rub,
    t.positive_reval_to_fv_pl_rub,
    t.negative_reval_to_fv_pl_rub,
    t.positive_reval_to_fv_oci_rub,
    t.negative_reval_to_fv_oci_rub,
    t.discount_of_acqstn_claims_due_rub,
    t.discount_of_acqstn_claims_ovr_rub,
    t.premium_of_acqstn_claims_rub,
    t.unused_limit_gen_agr_guar_rub,
    t.let_of_cred_cover_rub,
    t.let_of_cred_cond_req_rub,
    t.prvsn_debt_due_rub,
    t.prvsn_debt_ovr_rub,
    t.prvsn_intrst_due_bal_rub,
    t.prvsn_intrst_ovr_bal_rub,
    t.prvsn_unused_limit_rub,
    t.prvsn_comiss_rub,
    t.prvsn_grntee_rub,
    t.prvsn_comiss_opn_lim_due_rub,
    t.prvsn_comiss_int_due_rub,
    t.prvsn_comiss_int_ovr_rub,
    t.prvsn_comiss_opn_due_rub,
    t.prvsn_comiss_opn_ovr_rub,
    t.prvsn_int_sbsdy_due_rub,
    t.prvsn_int_sbsdy_ovr_rub,
    t.prvsn_discount_of_acqstn_claims_due_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_rub,
    t.prvsn_unused_limit_gen_agr_guar_rub,
    t.prvsn_debt_due_a_rub,
    t.prvsn_debt_ovr_a_rub,
    t.prvsn_intrst_due_bal_a_rub,
    t.prvsn_intrst_ovr_bal_a_rub,
    t.prvsn_unused_limit_a_rub,
    t.prvsn_grntee_a_rub,
    t.prvsn_comiss_int_due_a_rub,
    t.prvsn_comiss_int_ovr_a_rub,
    t.prvsn_int_sbsdy_due_a_rub,
    t.prvsn_int_sbsdy_ovr_a_rub,
    t.prvsn_val_adj_a_rub,
    t.prvsn_discount_of_acqstn_claims_due_a_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_a_rub,
    t.prvsn_premium_of_acqstn_claims_a_rub,
    t.prvsn_unused_limit_gen_agr_guar_a_rub,
    t.prvsn_debt_due_l_rub,
    t.prvsn_debt_ovr_l_rub,
    t.prvsn_intrst_due_bal_l_rub,
    t.prvsn_intrst_ovr_bal_l_rub,
    t.prvsn_unused_limit_l_rub,
    t.prvsn_grntee_l_rub,
    t.prvsn_comiss_int_due_l_rub,
    t.prvsn_comiss_int_ovr_l_rub,
    t.prvsn_int_sbsdy_due_l_rub,
    t.prvsn_int_sbsdy_ovr_l_rub,
    t.prvsn_val_adj_l_rub,
    t.prvsn_discount_of_acqstn_claims_due_l_rub,
    t.prvsn_discount_of_acqstn_claims_ovr_l_rub,
    t.prvsn_premium_of_acqstn_claims_l_rub,
    t.prvsn_unused_limit_gen_agr_guar_l_rub,
    t.comiss_ovr_rub,
    t.comiss_due_rub,
    t.prvsn_comiss_ovr_rub,
    (t.prvsn_comiss_rub - t.prvsn_comiss_ovr_rub) AS prvsn_comiss_due_rub,
    t.info_system_id,
    t.bal_crncy_id,
    t.off_crncy_id
   FROM ( SELECT t_1.agr_cred_id,
            t_1.start_dt,
            t_1.end_dt,
            t_1.debt_due_rub,
            t_1.debt_ovr_rub,
            t_1.intrst_due_bal_rub,
            t_1.intrst_due_off_rub,
            t_1.intrst_ovr_bal_rub,
            t_1.intrst_ovr_off_rub,
            t_1.unused_limit_rub,
            t_1.comiss_rub,
            t_1.comiss_other_rub,
            t_1.grntee_rub,
            t_1.debt_prvsn_write_off_rub,
            t_1.comiss_opn_lim_due_rub,
            t_1.comiss_int_due_rub,
            t_1.comiss_int_ovr_rub,
            t_1.comiss_opn_due_rub,
            t_1.comiss_opn_ovr_rub,
            t_1.int_sbsdy_due_rub,
            t_1.int_sbsdy_ovr_rub,
            t_1.txn_costs_rub,
            t_1.val_adj_incr_rub,
            t_1.comiss_opn_lim_due_liab_rub,
            t_1.comiss_int_due_liab_rub,
            t_1.comiss_opn_due_liab_rub,
            t_1.int_sbsdy_due_liab_rub,
            t_1.txn_costs_liab_rub,
            t_1.val_adj_decr_rub,
            t_1.prepaid_intrst_rub,
            t_1.positive_reval_to_fv_pl_rub,
            t_1.negative_reval_to_fv_pl_rub,
            t_1.positive_reval_to_fv_oci_rub,
            t_1.negative_reval_to_fv_oci_rub,
            t_1.discount_of_acqstn_claims_due_rub,
            t_1.discount_of_acqstn_claims_ovr_rub,
            t_1.premium_of_acqstn_claims_rub,
            t_1.unused_limit_gen_agr_guar_rub,
            t_1.let_of_cred_cover_rub,
            t_1.let_of_cred_cond_req_rub,
            t_1.prvsn_debt_due_rub,
            t_1.prvsn_debt_ovr_rub,
            t_1.prvsn_intrst_due_bal_rub,
            t_1.prvsn_intrst_ovr_bal_rub,
            t_1.prvsn_unused_limit_rub,
            t_1.prvsn_comiss_rub,
            t_1.prvsn_grntee_rub,
            t_1.prvsn_comiss_opn_lim_due_rub,
            t_1.prvsn_comiss_int_due_rub,
            t_1.prvsn_comiss_int_ovr_rub,
            t_1.prvsn_comiss_opn_due_rub,
            t_1.prvsn_comiss_opn_ovr_rub,
            t_1.prvsn_int_sbsdy_due_rub,
            t_1.prvsn_int_sbsdy_ovr_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_rub,
            t_1.prvsn_debt_due_a_rub,
            t_1.prvsn_debt_ovr_a_rub,
            t_1.prvsn_intrst_due_bal_a_rub,
            t_1.prvsn_intrst_ovr_bal_a_rub,
            t_1.prvsn_unused_limit_a_rub,
            t_1.prvsn_grntee_a_rub,
            t_1.prvsn_comiss_int_due_a_rub,
            t_1.prvsn_comiss_int_ovr_a_rub,
            t_1.prvsn_int_sbsdy_due_a_rub,
            t_1.prvsn_int_sbsdy_ovr_a_rub,
            t_1.prvsn_val_adj_a_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_a_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_a_rub,
            t_1.prvsn_premium_of_acqstn_claims_a_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_a_rub,
            t_1.prvsn_debt_due_l_rub,
            t_1.prvsn_debt_ovr_l_rub,
            t_1.prvsn_intrst_due_bal_l_rub,
            t_1.prvsn_intrst_ovr_bal_l_rub,
            t_1.prvsn_unused_limit_l_rub,
            t_1.prvsn_grntee_l_rub,
            t_1.prvsn_comiss_int_due_l_rub,
            t_1.prvsn_comiss_int_ovr_l_rub,
            t_1.prvsn_int_sbsdy_due_l_rub,
            t_1.prvsn_int_sbsdy_ovr_l_rub,
            t_1.prvsn_val_adj_l_rub,
            t_1.prvsn_discount_of_acqstn_claims_due_l_rub,
            t_1.prvsn_discount_of_acqstn_claims_ovr_l_rub,
            t_1.prvsn_premium_of_acqstn_claims_l_rub,
            t_1.prvsn_unused_limit_gen_agr_guar_l_rub,
            t_1.comiss_ovr_rub,
            t_1.comiss_due_rub,
            (t_1.prvsn_comiss_rub * (t_1.comiss_ovr_rub / NULLIF((t_1.comiss_ovr_rub + t_1.comiss_due_rub), (0)::numeric))) AS prvsn_comiss_ovr_rub,
            t_1.info_system_id,
            t_1.bal_crncy_id,
            t_1.off_crncy_id
           FROM ( SELECT t_2.agr_cred_id,
                    t_2.start_dt,
                    t_2.end_dt,
                    t_2.debt_due_rub,
                    t_2.debt_ovr_rub,
                    t_2.intrst_due_bal_rub,
                    t_2.intrst_due_off_rub,
                    t_2.intrst_ovr_bal_rub,
                    t_2.intrst_ovr_off_rub,
                    t_2.unused_limit_rub,
                    t_2.comiss_rub,
                    t_2.comiss_other_rub,
                    t_2.grntee_rub,
                    t_2.debt_prvsn_write_off_rub,
                    t_2.comiss_opn_lim_due_rub,
                    t_2.comiss_int_due_rub,
                    t_2.comiss_int_ovr_rub,
                    t_2.comiss_opn_due_rub,
                    t_2.comiss_opn_ovr_rub,
                    t_2.int_sbsdy_due_rub,
                    t_2.int_sbsdy_ovr_rub,
                    t_2.txn_costs_rub,
                    t_2.val_adj_incr_rub,
                    t_2.comiss_opn_lim_due_liab_rub,
                    t_2.comiss_int_due_liab_rub,
                    t_2.comiss_opn_due_liab_rub,
                    t_2.int_sbsdy_due_liab_rub,
                    t_2.txn_costs_liab_rub,
                    t_2.val_adj_decr_rub,
                    t_2.prepaid_intrst_rub,
                    t_2.positive_reval_to_fv_pl_rub,
                    t_2.negative_reval_to_fv_pl_rub,
                    t_2.positive_reval_to_fv_oci_rub,
                    t_2.negative_reval_to_fv_oci_rub,
                    t_2.discount_of_acqstn_claims_due_rub,
                    t_2.discount_of_acqstn_claims_ovr_rub,
                    t_2.premium_of_acqstn_claims_rub,
                    t_2.unused_limit_gen_agr_guar_rub,
                    t_2.let_of_cred_cover_rub,
                    t_2.let_of_cred_cond_req_rub,
                    t_2.prvsn_debt_due_rub,
                    t_2.prvsn_debt_ovr_rub,
                    t_2.prvsn_intrst_due_bal_rub,
                    t_2.prvsn_intrst_ovr_bal_rub,
                    t_2.prvsn_unused_limit_rub,
                    t_2.prvsn_comiss_rub,
                    t_2.prvsn_grntee_rub,
                    t_2.prvsn_comiss_opn_lim_due_rub,
                    t_2.prvsn_comiss_int_due_rub,
                    t_2.prvsn_comiss_int_ovr_rub,
                    t_2.prvsn_comiss_opn_due_rub,
                    t_2.prvsn_comiss_opn_ovr_rub,
                    t_2.prvsn_int_sbsdy_due_rub,
                    t_2.prvsn_int_sbsdy_ovr_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_rub,
                    t_2.prvsn_debt_due_a_rub,
                    t_2.prvsn_debt_ovr_a_rub,
                    t_2.prvsn_intrst_due_bal_a_rub,
                    t_2.prvsn_intrst_ovr_bal_a_rub,
                    t_2.prvsn_unused_limit_a_rub,
                    t_2.prvsn_grntee_a_rub,
                    t_2.prvsn_comiss_int_due_a_rub,
                    t_2.prvsn_comiss_int_ovr_a_rub,
                    t_2.prvsn_int_sbsdy_due_a_rub,
                    t_2.prvsn_int_sbsdy_ovr_a_rub,
                    t_2.prvsn_val_adj_a_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_a_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_a_rub,
                    t_2.prvsn_premium_of_acqstn_claims_a_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_a_rub,
                    t_2.prvsn_debt_due_l_rub,
                    t_2.prvsn_debt_ovr_l_rub,
                    t_2.prvsn_intrst_due_bal_l_rub,
                    t_2.prvsn_intrst_ovr_bal_l_rub,
                    t_2.prvsn_unused_limit_l_rub,
                    t_2.prvsn_grntee_l_rub,
                    t_2.prvsn_comiss_int_due_l_rub,
                    t_2.prvsn_comiss_int_ovr_l_rub,
                    t_2.prvsn_int_sbsdy_due_l_rub,
                    t_2.prvsn_int_sbsdy_ovr_l_rub,
                    t_2.prvsn_val_adj_l_rub,
                    t_2.prvsn_discount_of_acqstn_claims_due_l_rub,
                    t_2.prvsn_discount_of_acqstn_claims_ovr_l_rub,
                    t_2.prvsn_premium_of_acqstn_claims_l_rub,
                    t_2.prvsn_unused_limit_gen_agr_guar_l_rub,
                    t_2.comiss_ovr_rub,
                    (t_2.comiss_rub - t_2.comiss_ovr_rub) AS comiss_due_rub,
                    t_2.info_system_id,
                    t_2.bal_crncy_id,
                    t_2.off_crncy_id
                   FROM ( SELECT t_3.agr_cred_id,
                            t_3.start_dt,
                            t_3.end_dt,
                            t_3.debt_due_rub,
                            t_3.debt_ovr_rub,
                            t_3.intrst_due_bal_rub,
                            t_3.intrst_due_off_rub,
                            t_3.intrst_ovr_bal_rub,
                            t_3.intrst_ovr_off_rub,
                            t_3.unused_limit_rub,
                            t_3.comiss_rub,
                            t_3.comiss_other_rub,
                            t_3.grntee_rub,
                            t_3.debt_prvsn_write_off_rub,
                            t_3.comiss_opn_lim_due_rub,
                            t_3.comiss_int_due_rub,
                            t_3.comiss_int_ovr_rub,
                            t_3.comiss_opn_due_rub,
                            t_3.comiss_opn_ovr_rub,
                            t_3.int_sbsdy_due_rub,
                            t_3.int_sbsdy_ovr_rub,
                            t_3.txn_costs_rub,
                            t_3.val_adj_incr_rub,
                            t_3.comiss_opn_lim_due_liab_rub,
                            t_3.comiss_int_due_liab_rub,
                            t_3.comiss_opn_due_liab_rub,
                            t_3.int_sbsdy_due_liab_rub,
                            t_3.txn_costs_liab_rub,
                            t_3.val_adj_decr_rub,
                            t_3.prepaid_intrst_rub,
                            t_3.positive_reval_to_fv_pl_rub,
                            t_3.negative_reval_to_fv_pl_rub,
                            t_3.positive_reval_to_fv_oci_rub,
                            t_3.negative_reval_to_fv_oci_rub,
                            t_3.discount_of_acqstn_claims_due_rub,
                            t_3.discount_of_acqstn_claims_ovr_rub,
                            t_3.premium_of_acqstn_claims_rub,
                            t_3.unused_limit_gen_agr_guar_rub,
                            t_3.let_of_cred_cover_rub,
                            t_3.let_of_cred_cond_req_rub,
                            t_3.prvsn_debt_due_rub,
                            t_3.prvsn_debt_ovr_rub,
                            t_3.prvsn_intrst_due_bal_rub,
                            t_3.prvsn_intrst_ovr_bal_rub,
                            t_3.prvsn_unused_limit_rub,
                            t_3.prvsn_comiss_rub,
                            t_3.prvsn_grntee_rub,
                            t_3.prvsn_comiss_opn_lim_due_rub,
                            t_3.prvsn_comiss_int_due_rub,
                            t_3.prvsn_comiss_int_ovr_rub,
                            t_3.prvsn_comiss_opn_due_rub,
                            t_3.prvsn_comiss_opn_ovr_rub,
                            t_3.prvsn_int_sbsdy_due_rub,
                            t_3.prvsn_int_sbsdy_ovr_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_rub,
                            t_3.prvsn_debt_due_a_rub,
                            t_3.prvsn_debt_ovr_a_rub,
                            t_3.prvsn_intrst_due_bal_a_rub,
                            t_3.prvsn_intrst_ovr_bal_a_rub,
                            t_3.prvsn_unused_limit_a_rub,
                            t_3.prvsn_grntee_a_rub,
                            t_3.prvsn_comiss_int_due_a_rub,
                            t_3.prvsn_comiss_int_ovr_a_rub,
                            t_3.prvsn_int_sbsdy_due_a_rub,
                            t_3.prvsn_int_sbsdy_ovr_a_rub,
                            t_3.prvsn_val_adj_a_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_a_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_a_rub,
                            t_3.prvsn_premium_of_acqstn_claims_a_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_a_rub,
                            t_3.prvsn_debt_due_l_rub,
                            t_3.prvsn_debt_ovr_l_rub,
                            t_3.prvsn_intrst_due_bal_l_rub,
                            t_3.prvsn_intrst_ovr_bal_l_rub,
                            t_3.prvsn_unused_limit_l_rub,
                            t_3.prvsn_grntee_l_rub,
                            t_3.prvsn_comiss_int_due_l_rub,
                            t_3.prvsn_comiss_int_ovr_l_rub,
                            t_3.prvsn_int_sbsdy_due_l_rub,
                            t_3.prvsn_int_sbsdy_ovr_l_rub,
                            t_3.prvsn_val_adj_l_rub,
                            t_3.prvsn_discount_of_acqstn_claims_due_l_rub,
                            t_3.prvsn_discount_of_acqstn_claims_ovr_l_rub,
                            t_3.prvsn_premium_of_acqstn_claims_l_rub,
                            t_3.prvsn_unused_limit_gen_agr_guar_l_rub,
                            LEAST(GREATEST(COALESCE(t_3.optn_sum_rub, (0)::numeric), (0)::numeric), t_3.comiss_rub) AS comiss_ovr_rub,
                            t_3.info_system_id,
                            t_3.bal_crncy_id,
                            t_3.off_crncy_id
                           FROM ( SELECT dt.id AS agr_cred_id,
                                    dt.start_dt,
                                    max(dt.end_dt) AS end_dt,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_due_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L004'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_due_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_ovr_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L006'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS intrst_ovr_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_L007'::text, 'AGRA_L051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS unused_limit_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L008'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L018'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_other_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS grntee_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L020'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS debt_prvsn_write_off_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L021'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_lim_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L024'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L025'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L028'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS txn_costs_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS val_adj_incr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L031'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_lim_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L032'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_int_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L034'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS comiss_opn_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L036'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS int_sbsdy_due_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L038'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS txn_costs_liab_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L039'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS val_adj_decr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L040'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prepaid_intrst_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L041'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS positive_reval_to_fv_pl_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L042'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS negative_reval_to_fv_pl_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L043'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS positive_reval_to_fv_oci_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L044'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS negative_reval_to_fv_oci_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS discount_of_acqstn_claims_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS discount_of_acqstn_claims_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS premium_of_acqstn_claims_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS unused_limit_gen_agr_guar_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L049'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS let_of_cred_cover_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_L050'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS let_of_cred_cond_req_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_P007'::text, 'AGRA_P051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P008'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P021'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_lim_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P024'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P025'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_opn_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_P048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_J007'::text, 'AGRA_J051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_val_adj_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_premium_of_acqstn_claims_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_J048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_a_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N001'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N002'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_debt_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N003'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_due_bal_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N005'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_intrst_ovr_bal_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = ANY (ARRAY['AGRA_N007'::text, 'AGRA_N051'::text])) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N009'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_grntee_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N022'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N023'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_comiss_int_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N026'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N027'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_int_sbsdy_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N029'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_val_adj_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N045'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_due_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N046'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_discount_of_acqstn_claims_ovr_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N047'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_premium_of_acqstn_claims_l_rub,
                                    sum(
CASE
 WHEN (coa.meas_cd = 'AGRA_N048'::text) THEN coa.meas_rub
 ELSE NULL::numeric
END) AS prvsn_unused_limit_gen_agr_guar_l_rub,
                                    max(dt.info_system_id) AS info_system_id,
                                    max(
CASE
 WHEN ((coa.meas_cd = ANY (ARRAY['AGRA_L001'::text, 'AGRA_L002'::text])) AND (coa.meas_rub > (0)::numeric)) THEN coa.crncy_id
 ELSE NULL::bigint
END) AS bal_crncy_id,
                                    max(
CASE
 WHEN ((coa.meas_cd = ANY (ARRAY['AGRA_L007'::text, 'AGRA_L009'::text, 'AGRA_L048'::text])) AND (coa.meas_rub > (0)::numeric)) THEN coa.crncy_id
 ELSE NULL::bigint
END) AS off_crncy_id,
                                    sum(com.optn_sum_rub) AS optn_sum_rub
                                   FROM ((( SELECT ""Window"".id,
    ""Window"".start_dt,
    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    ""Window"".info_system_id
   FROM ( SELECT dt_1.id,
      dt_1.start_dt,
      max(dt_1.info_system_id) AS info_system_id
     FROM ( SELECT t1.agr_cred_id AS id,
        t1.start_dt,
        t1.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_arc t1
    UNION ALL
     SELECT t1.agr_cred_id,
        (t1.end_dt + 1) AS start_dt,
        t1.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_arc t1
      WHERE (t1.end_dt <> '9999-12-31'::date)
    UNION ALL
     SELECT d_agr_cred_fin_dt_com_tmp.agr_cred_id,
        d_agr_cred_fin_dt_com_tmp.start_dt,
        d_agr_cred_fin_dt_com_tmp.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp
    UNION ALL
     SELECT d_agr_cred_fin_dt_com_tmp.agr_cred_id,
        (d_agr_cred_fin_dt_com_tmp.end_dt + 1) AS start_dt,
        d_agr_cred_fin_dt_com_tmp.info_system_id
       FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp
      WHERE (d_agr_cred_fin_dt_com_tmp.end_dt <> '9999-12-31'::date)) dt_1
    GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
                                     JOIN ( SELECT d_agr_cred_coa_arc.agr_cred_id,
    d_agr_cred_coa_arc.start_dt,
    d_agr_cred_coa_arc.end_dt,
    d_agr_cred_coa_arc.meas_cd,
    d_agr_cred_coa_arc.meas_rub,
    d_agr_cred_coa_arc.coa_id,
    d_agr_cred_coa_arc.crncy_id,
    d_agr_cred_coa_arc.info_system_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_arc) coa ON (((((coa.agr_cred_id = dt.id) AND (coa.info_system_id = dt.info_system_id)) AND (dt.start_dt >= coa.start_dt)) AND (dt.start_dt <= coa.end_dt))))
                                     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_com_tmp com ON (((((dt.id = com.agr_cred_id) AND (dt.info_system_id = com.info_system_id)) AND (dt.start_dt >= com.start_dt)) AND (dt.start_dt <= com.end_dt))))
                                  GROUP BY dt.id, dt.start_dt) t_3) t_2) t_1) t;"
d_agr_cred_calc_prvsn," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    (((((COALESCE(agr_cred_fin_dt_mat.debt_due_rub, (0)::numeric) + COALESCE(agr_cred_fin_dt_mat.debt_ovr_rub, (0)::numeric)) + COALESCE(agr_cred_fin_dt_mat.intrst_ovr_bal_rub, (0)::numeric)) + COALESCE(agr_cred_fin_dt_mat.intrst_due_bal_rub, (0)::numeric)) - ((((COALESCE(agr_cred_fin_dt_mat.prvsn_debt_due_rub, (0)::numeric) + COALESCE(agr_cred_fin_dt_mat.prvsn_debt_ovr_rub, (0)::numeric)) + COALESCE(agr_cred_fin_dt_mat.prvsn_intrst_due_bal_rub, (0)::numeric)) + COALESCE(agr_cred_fin_dt_mat.prvsn_intrst_ovr_bal_rub, (0)::numeric)) / NULLIF((agr_cred_prvsn.prvsn_rate / (100)::numeric), (0)::numeric))))::numeric(38,8) AS agr_collat_prvsn_amt,
    dt.info_system_id
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT mat.agr_cred_id AS id,
                            mat.start_dt,
                            mat.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat mat
                        UNION ALL
                         SELECT mat.agr_cred_id AS id,
                            (mat.end_dt + 1) AS start_dt,
                            mat.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat mat
                          WHERE (mat.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_agr_cred_prvsn.agr_cred_id AS id,
                            d_agr_cred_prvsn.start_dt,
                            d_agr_cred_prvsn.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prvsn
                        UNION ALL
                         SELECT d_agr_cred_prvsn.agr_cred_id AS id,
                            (d_agr_cred_prvsn.end_dt + 1) AS start_dt,
                            d_agr_cred_prvsn.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prvsn
                          WHERE (d_agr_cred_prvsn.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat agr_cred_fin_dt_mat ON ((((agr_cred_fin_dt_mat.agr_cred_id = dt.id) AND (dt.start_dt >= agr_cred_fin_dt_mat.start_dt)) AND (dt.start_dt <= agr_cred_fin_dt_mat.end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prvsn agr_cred_prvsn ON ((((agr_cred_prvsn.agr_cred_id = dt.id) AND (dt.start_dt >= agr_cred_prvsn.start_dt)) AND (dt.start_dt <= agr_cred_prvsn.end_dt))));"
d_letter_of_cred_cover_amt," SELECT t.letter_cred_id,
    t.agr_cred_id,
    t.agr_cred_issue_id,
    t.agr_cred_debt_rub,
    t.cred_issued_amt,
    t.let_of_cred_start_amt,
    t.start_dt,
    t.end_dt,
    t.let_of_cred_total_amt,
    t.let_cnt,
    (t.issued_amt * COALESCE((t.let_of_cred_start_amt / NULLIF(t.let_of_cred_total_amt, (0)::numeric)), ((1)::numeric / NULLIF(t.let_of_cred_total_amt, (0)::numeric)), (1)::numeric)) AS issued_amt_by_letter_of_cred,
    t.info_system_id
   FROM ( SELECT t2.let_of_cred_id AS letter_cred_id,
            t1.agr_cred_id,
            t2.agr_cred_issue_id,
            (COALESCE(t1.debt_due_rub, (0)::numeric) + COALESCE(t1.debt_ovr_rub, (0)::numeric)) AS agr_cred_debt_rub,
            t1.issued_amt AS cred_issued_amt,
            t2.agr_cred_start_amt AS let_of_cred_start_amt,
            t1.start_dt,
            t1.end_dt,
            sum(t2.agr_cred_start_amt) OVER (PARTITION BY t1.agr_cred_id, t1.start_dt) AS let_of_cred_total_amt,
            count(*) OVER (PARTITION BY t1.agr_cred_id, t1.start_dt) AS let_cnt,
            t2.info_system_id,
            t1.issued_amt
           FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat t1
             JOIN ( SELECT t1_1.agr_cred_id,
                    t2_1.let_of_cred_id,
                    t2_1.agr_cred_start_amt,
                    t1_1.issue_crncy_id AS agr_cred_issue_id,
                    t2_1.info_system_id
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred t1_1
                     JOIN ( SELECT d_agr_cred.agr_cred_id AS let_of_cred_id,
                            (d_agr_cred.host_let_of_cred_cover_id)::text AS host_agr_cred_id,
                            d_agr_cred.agr_cred_start_amt,
                            d_agr_cred.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred
                          WHERE ((d_agr_cred.agr_cred_type_id = '-1033'::integer) AND (COALESCE(d_agr_cred.host_let_of_cred_cover_id, ('-1'::integer)::bigint) <> '-1'::integer))) t2_1 ON ((t1_1.host_agr_cred_id = t2_1.host_agr_cred_id)))) t2 ON ((t1.agr_cred_id = t2.agr_cred_id)))) t;"
d_$$res_st_dokd," SELECT t.eks_agr_cred_id,
    t.c_d_date,
    t.c_n_dokd_kk1_d,
    t.c_n_dokd_kk1_p,
    t.c_n_dokd_kk2_d,
    t.c_n_dokd_kk2_p,
    t.info_system_id
   FROM ( SELECT r.eks_agrmnt_id AS eks_agr_cred_id,
            r.c_d_date,
            r.c_n_dokd_kk1_d,
            r.c_n_dokd_kk1_p,
            r.c_n_dokd_kk2_d,
            r.c_n_dokd_kk2_p,
            r.info_system_id,
            row_number() OVER (PARTITION BY r.eks_agrmnt_id, r.c_d_date ORDER BY r.c_n_dokd_kk1_d, r.c_n_dokd_kk1_p, r.c_n_dokd_kk2_d, r.c_n_dokd_kk2_p) AS rn
           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_$$res_st_dokd"" r) t
  WHERE (t.rn = 1);"
d_agr_cred_coa_tmp_protf," SELECT a.agr_cred_id,
    a.coa_id,
    a.agr_coa_role_id,
    a.gen_start_dt AS start_dt,
    LEAST(COALESCE((max(a.gen_start_dt) OVER (PARTITION BY a.agr_cred_id, a.coa_id, a.agr_coa_role_id, a.eks_port_flag ORDER BY a.gen_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date), a.end_dt) AS end_dt,
    a.prnt_agr_cred_id,
    a.eks_port_flag,
    a.info_system_id,
    a.eks_agr_cred_type_id,
    a.close_dt
   FROM ( SELECT a_1.agr_cred_id,
            a_1.coa_id,
            a_1.agr_coa_role_id,
            a_1.gen_start_dt,
            a_1.end_dt,
            a_1.prnt_agr_cred_id,
            a_1.eks_port_flag,
            a_1.info_system_id,
            a_1.eks_agr_cred_type_id,
            a_1.close_dt
           FROM ( SELECT a_2.agr_cred_id,
                    a_2.coa_id,
                    a_2.agr_coa_role_id,
                    a_2.gen_start_dt,
                    a_2.gen_end_dt,
                    a_2.prnt_agr_cred_id,
                    a_2.eks_port_flag,
                    a_2.info_system_id,
                    a_2.eks_agr_cred_type_id,
                    a_2.close_dt,
                    a_2.rn,
                    a_2.max_gen_end_dt,
                    a_2.new_part,
                    max(a_2.gen_end_dt) OVER (PARTITION BY a_2.agr_cred_id, a_2.coa_id, a_2.agr_coa_role_id, a_2.eks_port_flag, a_2.new_part ORDER BY NULL::text) AS end_dt,
                        CASE
                            WHEN ((a_2.gen_start_dt - 1) > a_2.max_gen_end_dt) THEN (1)::bigint
                            ELSE row_number() OVER (PARTITION BY a_2.agr_cred_id, a_2.coa_id, a_2.agr_coa_role_id, a_2.eks_port_flag ORDER BY a_2.gen_start_dt)
                        END AS rn1
                   FROM ( SELECT a_3.agr_cred_id,
                            a_3.coa_id,
                            a_3.agr_coa_role_id,
                            a_3.gen_start_dt,
                            a_3.gen_end_dt,
                            a_3.prnt_agr_cred_id,
                            a_3.eks_port_flag,
                            a_3.info_system_id,
                            a_3.eks_agr_cred_type_id,
                            a_3.close_dt,
                            a_3.rn,
                            a_3.max_gen_end_dt,
                            sum(
                                CASE
                                    WHEN ((a_3.gen_start_dt - 1) > a_3.max_gen_end_dt) THEN 1
                                    ELSE 0
                                END) OVER (PARTITION BY a_3.agr_cred_id, a_3.coa_id, a_3.agr_coa_role_id, a_3.eks_port_flag ORDER BY a_3.gen_start_dt) AS new_part
                           FROM ( SELECT a_4.agr_cred_id,
                                    a_4.coa_id,
                                    a_4.agr_coa_role_id,
                                    a_4.gen_start_dt,
                                    a_4.gen_end_dt,
                                    a_4.prnt_agr_cred_id,
                                    a_4.eks_port_flag,
                                    a_4.info_system_id,
                                    a_4.eks_agr_cred_type_id,
                                    a_4.close_dt,
                                    a_4.rn,
                                    max(a_4.gen_end_dt) OVER (PARTITION BY a_4.agr_cred_id, a_4.coa_id, a_4.agr_coa_role_id, a_4.eks_port_flag ORDER BY a_4.gen_start_dt ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING) AS max_gen_end_dt
                                   FROM ( SELECT a_5.agr_cred_id,
    a_5.coa_id,
    a_5.agr_coa_role_id,
    a_5.gen_start_dt,
    a_5.gen_end_dt,
    a_5.prnt_agr_cred_id,
    a_5.eks_port_flag,
    a_5.info_system_id,
    a_5.eks_agr_cred_type_id,
    a_5.close_dt,
    a_5.rn
   FROM ( SELECT a_6.agr_cred_id,
      a_6.coa_id,
      a_6.agr_coa_role_id,
      a_6.gen_start_dt,
      a_6.gen_end_dt,
      a_6.prnt_agr_cred_id,
      a_6.eks_port_flag,
      a_6.info_system_id,
      a_6.eks_agr_cred_type_id,
      a_6.close_dt,
      row_number() OVER (PARTITION BY a_6.agr_cred_id, a_6.coa_id, a_6.agr_coa_role_id, a_6.eks_port_flag, a_6.gen_start_dt ORDER BY a_6.gen_end_dt DESC) AS rn
     FROM ( SELECT agr.agr_cred_id,
        p2c.coa_id,
        p2c.coa_to_agrmnt_role_id AS agr_coa_role_id,
      CASE
       WHEN (p2a.start_dt > p2c.start_dt) THEN p2a.start_dt
       ELSE p2c.start_dt
      END AS gen_start_dt,
      CASE
       WHEN (p2a.end_dt < p2c.end_dt) THEN p2a.end_dt
       ELSE p2c.end_dt
      END AS gen_end_dt,
        agr.prnt_agr_cred_id,
        'Y'::text AS eks_port_flag,
        agr.info_system_id,
        agr.eks_agr_cred_type_id,
        agr.close_dt
       FROM ((( SELECT dt.acct_grp_id,
          dt.coa_to_agrmnt_role_id,
          dt.start_dt,
          dt.end_dt,
          a_aset.coa_id
         FROM (( SELECT ""Window"".acct_grp_id,
            ""Window"".coa_to_agrmnt_role_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".acct_grp_id, ""Window"".coa_to_agrmnt_role_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.acct_grp_id,
              dt_1.coa_to_agrmnt_role_id,
              dt_1.start_dt
             FROM ( SELECT d_acct_grp_coa.acct_grp_id,
                d_acct_grp_coa.coa_to_agrmnt_role_id,
                d_acct_grp_coa.start_dt
               FROM s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa
              WHERE (d_acct_grp_coa.end_dt >= '2019-01-01'::date)
            UNION ALL
             SELECT d_acct_grp_coa.acct_grp_id,
                d_acct_grp_coa.coa_to_agrmnt_role_id,
                (d_acct_grp_coa.end_dt + 1) AS start_dt
               FROM s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa
              WHERE ((d_acct_grp_coa.end_dt <> '9999-12-31'::date) AND (d_acct_grp_coa.end_dt >= '2019-01-01'::date))) dt_1
            GROUP BY dt_1.acct_grp_id, dt_1.coa_to_agrmnt_role_id, dt_1.start_dt) ""Window""(acct_grp_id, coa_to_agrmnt_role_id, start_dt)) dt
           LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa a_aset ON ((((a_aset.acct_grp_id = dt.acct_grp_id) AND ((dt.start_dt >= a_aset.start_dt) AND (dt.start_dt <= a_aset.end_dt))) AND (a_aset.coa_to_agrmnt_role_id = dt.coa_to_agrmnt_role_id))))) p2c
         JOIN ( SELECT p2a_1.agrmnt_id,
          p2a_1.start_dt,
          p2a_1.end_dt,
          p2a_1.acct_grp_id
         FROM ( SELECT p2a_2.agrmnt_id,
            p2a_2.start_dt,
            max(p2a_2.end_dt) OVER (PARTITION BY p2a_2.agrmnt_id, p2a_2.new_part ORDER BY NULL::text) AS end_dt,
            p2a_2.acct_grp_id,
            p2a_2.grp_rn
           FROM ( SELECT aag.agrmnt_id,
              aag.start_dt,
              sum(
            CASE
             WHEN (aag.grp_rn = 1) THEN 1
             ELSE 0
            END) OVER (PARTITION BY aag.agrmnt_id ORDER BY aag.start_dt) AS new_part,
              aag.acct_grp_id,
              aag.grp_rn,
              aag.end_dt
             FROM ( SELECT aag_1.agrmnt_id,
                aag_1.acct_grp_id,
                aag_1.start_dt,
                aag_1.end_dt,
              CASE
               WHEN ((aag_1.start_dt - 1) > max(aag_1.end_dt) OVER (PARTITION BY aag_1.agrmnt_id, aag_1.acct_grp_id ORDER BY aag_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
               ELSE row_number() OVER (PARTITION BY aag_1.agrmnt_id, aag_1.acct_grp_id ORDER BY aag_1.start_dt)
              END AS grp_rn
               FROM ( SELECT t.agrmnt_id,
                  t.acct_grp_id,
                  t.start_dt,
                  t.end_dt
                 FROM ( SELECT dt.id AS agrmnt_id,
                    aag_2.acct_grp_id,
                    dt.start_dt,
                    dt.end_dt,
                    row_number() OVER (PARTITION BY dt.id, dt.start_dt ORDER BY aag_2.acct_assoc_start_dt DESC, aag_2.acct_grp_id DESC) AS rn
                   FROM (( SELECT ""Window"".id,
                      ""Window"".start_dt,
                      COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                     FROM ( SELECT dt_1.id,
                        dt_1.start_dt
                       FROM ( SELECT agr_1.agrmnt_id AS id,
                          agr_1.acct_assoc_start_dt AS start_dt
                         FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp agr_1
                        WHERE (agr_1.acct_assoc_end_dt >= '2019-01-01'::date)
                      UNION ALL
                       SELECT agr_1.agrmnt_id AS id,
                          agr_1.acct_assoc_end_dt AS start_dt
                         FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp agr_1
                        WHERE ((agr_1.acct_assoc_end_dt <> '9999-12-31'::date) AND (agr_1.acct_assoc_end_dt >= '2019-01-01'::date))) dt_1
                      GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp aag_2 ON (((dt.id = aag_2.agrmnt_id) AND ((dt.start_dt >= aag_2.acct_assoc_start_dt) AND (dt.start_dt <=
                  CASE
                   WHEN (aag_2.acct_assoc_end_dt = '9999-12-31'::date) THEN aag_2.acct_assoc_end_dt
                   ELSE (aag_2.acct_assoc_end_dt - 1)
                  END)))))) t
                WHERE (t.rn = 1)) aag_1) aag) p2a_2) p2a_1
        WHERE (1 = p2a_1.grp_rn)) p2a ON ((p2a.acct_grp_id = p2c.acct_grp_id)))
         JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr ON (((agr.prnt_agr_cred_id = p2a.agrmnt_id) AND (agr.eks_agr_cred_type_id <> ALL (ARRAY[('-1007'::integer)::bigint, ('-1024'::integer)::bigint])))))
      WHERE (agr.info_system_id = ANY (ARRAY[1108, 1173, 1197]))) a_6
    WHERE (a_6.gen_start_dt <= a_6.gen_end_dt)) a_5
  WHERE (a_5.rn = 1)) a_4) a_3) a_2) a_1
          WHERE (a_1.rn1 = 1)) a;"
d_restruct_calc," SELECT ""Window"".agr_cred_id,
    ""Window"".start_dt,
    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    sum(1) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS restruct_cnt,
    ""Window"".start_dt AS last_restruct_dt,
    ""Window"".info_system_id
   FROM ( SELECT v_acct_renewal_hist.agrmnt_id AS agr_cred_id,
            v_acct_renewal_hist.contract_start_dt AS start_dt,
            v_acct_renewal_hist.info_system_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist
          WHERE (((1 = 1) AND (v_acct_renewal_hist.acct_renewal_categ_id = '-1003'::integer)) AND (v_acct_renewal_hist.agrmnt_id IN ( SELECT d_agr_cred.agr_cred_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred)))
          GROUP BY v_acct_renewal_hist.agrmnt_id, v_acct_renewal_hist.contract_start_dt, v_acct_renewal_hist.info_system_id) ""Window""(agr_cred_id, start_dt, info_system_id);"
d_agr_cred_grntee_form," SELECT v_agmt_agmt_class_assoc.agrmnt_id AS agr_cred_id,
    v_agmt_agmt_class_assoc.agrmnt_class_val_id AS grntee_form_id,
    v_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt,
    v_agmt_agmt_class_assoc.agrmnt_class_end_dt AS end_dt,
    v_agmt_agmt_class_assoc.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
  WHERE (v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1060'::integer);"
d_agrmnt_clsfctn_val," SELECT dt.id AS agrmnt_id,
    dt.start_dt,
    dt.end_dt,
    aa1.agrmnt_clsfctn_val_cd,
    dt.info_system_id
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT aa.agrmnt_id AS id,
                            aa.agrmnt_class_start_dt AS start_dt,
                            aa.info_system_id
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
                          WHERE (((1 = 1) AND (aa.agrmnt_class_start_dt <> '1900-01-01'::date)) AND (aa.agrmnt_clsfctn_id = '-1039'::integer))
                        UNION ALL
                         SELECT aa.agrmnt_id AS id,
                            (aa.agrmnt_class_end_dt + 1) AS end_dt,
                            aa.info_system_id
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
                          WHERE (((1 = 1) AND (aa.agrmnt_class_end_dt <> '9999-12-31'::date)) AND (aa.agrmnt_clsfctn_id = '-1039'::integer))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((dt.id = agr.agr_cred_id)))
     LEFT JOIN ( SELECT aa.agrmnt_id,
            aa.agrmnt_class_start_dt AS start_dt,
            aa.agrmnt_class_end_dt AS end_dt,
            ac.agrmnt_clsfctn_val_cd,
            aa.info_system_id
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
          WHERE ((1 = 1) AND (aa.agrmnt_clsfctn_id = '-1039'::integer))) aa1 ON (((aa1.agrmnt_id = dt.id) AND ((dt.start_dt >= aa1.start_dt) AND (dt.start_dt <= aa1.end_dt)))));"
d_agr_cred_limit," SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.amt_start_dt,
        CASE
            WHEN (t.amt_end_dt > t.new_amt_end_dt) THEN t.new_amt_end_dt
            ELSE (t.amt_end_dt)::timestamp without time zone
        END AS amt_end_dt,
    t.limit_amt,
    t.limit_crncy_id,
    t.info_system_id
   FROM ( SELECT l.agrmnt_id AS agr_cred_id,
            l.acct_schdl_start_dt AS start_dt,
            l.acct_schdl_end_dt AS end_dt,
            l.acct_schdl_amt_start_dt AS amt_start_dt,
            l.acct_schdl_amt_end_dt AS amt_end_dt,
            l.acct_schdl_amt AS limit_amt,
            l.acct_schdl_amt_crncy_id AS limit_crncy_id,
            l.info_system_id,
            COALESCE((min(l.acct_schdl_amt_start_dt) OVER (PARTITION BY l.agrmnt_id, l.acct_schdl_start_dt ORDER BY l.acct_schdl_amt_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - '1 day'::interval day), ('9999-12-31'::date)::timestamp without time zone) AS new_amt_end_dt
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_schdl_hist l
          WHERE (l.acct_schdl_type_id = '-1001'::integer)) t;"
d_rdm_cust_eks2crm_mast," SELECT 1 AS a
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt agr
  WHERE (1 = 0);"
d_agr_cred_stts," WITH agr_cred_fin_dt_mat AS (
         SELECT agr_cred_fin_dt_mat_1.agr_cred_id,
            agr_cred_fin_dt_mat_1.start_dt,
            agr_cred_fin_dt_mat_1.end_dt,
            (((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((abs(COALESCE(agr_cred_fin_dt_mat_1.debt_due_rub, (0)::numeric)) + abs(COALESCE(agr_cred_fin_dt_mat_1.debt_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.intrst_due_bal_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.intrst_due_off_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.intrst_ovr_bal_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.intrst_ovr_off_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.unused_limit_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.grntee_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_other_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_opn_lim_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_int_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_int_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_opn_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.int_sbsdy_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.val_adj_incr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_opn_lim_due_liab_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_int_due_liab_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_opn_due_liab_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.int_sbsdy_due_liab_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.val_adj_decr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.positive_reval_to_fv_pl_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.negative_reval_to_fv_pl_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.positive_reval_to_fv_oci_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.negative_reval_to_fv_oci_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.discount_of_acqstn_claims_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.discount_of_acqstn_claims_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.discount_of_acqstn_claims_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_debt_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_debt_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_intrst_due_bal_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_intrst_ovr_bal_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_unused_limit_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_grntee_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_opn_lim_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_int_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_int_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_opn_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_opn_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_int_sbsdy_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_int_sbsdy_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_discount_of_acqstn_claims_due_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_discount_of_acqstn_claims_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_int_due_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_int_ovr_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_int_sbsdy_due_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_int_sbsdy_ovr_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_val_adj_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_discount_of_acqstn_claims_due_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_discount_of_acqstn_claims_ovr_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_premium_of_acqstn_claims_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_int_due_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_comiss_int_ovr_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_int_sbsdy_due_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_int_sbsdy_ovr_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_val_adj_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_discount_of_acqstn_claims_due_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_discount_of_acqstn_claims_ovr_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_premium_of_acqstn_claims_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.unused_limit_gen_agr_guar_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.let_of_cred_cover_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.comiss_opn_ovr_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_unused_limit_gen_agr_guar_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_unused_limit_gen_agr_guar_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_unused_limit_a_rub, (0)::numeric))) AS sum_no1034,
            (((((((((abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_debt_due_a_rub, (0)::numeric)) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_debt_ovr_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_intrst_due_bal_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_intrst_ovr_bal_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_grntee_a_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_debt_due_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_debt_ovr_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_intrst_due_bal_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_intrst_ovr_bal_l_rub, (0)::numeric))) + abs(COALESCE(agr_cred_fin_dt_mat_1.prvsn_grntee_l_rub, (0)::numeric))) AS sum_1035
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat agr_cred_fin_dt_mat_1
          WHERE (1 = 1)
        )
 SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    agr_cred_stts.agr_cred_stts_type_id,
    agr_cred_stts.agr_cred_stts_type_cd,
    agr_cred_stts.agr_cred_stts_type_name,
    agr_cred.info_system_id,
        CASE
            WHEN ((agr_cred.agr_cred_type_id <> '-1034'::integer) AND (((agr_cred_fin_dt_mat.sum_no1034 > (0)::numeric) OR ((agr_cred.agr_cred_type_id = '-1035'::integer) AND (agr_cred_fin_dt_mat.sum_1035 > (0)::numeric))) OR (((agr_cred_int_org.srv_int_org_id <> ALL (ARRAY[('-999'::integer)::bigint, ('-1'::integer)::bigint])) AND ((((agr_cred_stts.agr_cred_stts_type_cd = ANY (ARRAY['TO_CLOSE'::text, 'WORK'::text, 'IN_SUPPORT'::text, 'TO_BUH_CONTROL'::text])) AND (
            CASE
                WHEN (dt.start_dt = '9999-12-31'::date) THEN dt.start_dt
                ELSE (dt.start_dt + 1)
            END > agr_cred.signed_dt)) OR (((agr_cred_stts.agr_cred_stts_type_cd = 'CLOSE'::text) AND (
            CASE
                WHEN (dt.start_dt = '9999-12-31'::date) THEN dt.start_dt
                ELSE (dt.start_dt + 1)
            END >=
            CASE
                WHEN (agr_cred.signed_dt = '9999-12-31'::date) THEN agr_cred.signed_dt
                ELSE (agr_cred.signed_dt + 1)
            END)) AND (
            CASE
                WHEN (dt.start_dt = '9999-12-31'::date) THEN dt.start_dt
                ELSE (dt.start_dt + 1)
            END <= agr_cred.close_dt))) OR (((agr_cred_stts.agr_cred_stts_type_cd IS NULL) AND (agr_cred.signed_dt <= dt.start_dt)) AND (dt.start_dt < COALESCE(agr_cred.close_dt, '9999-12-31'::date))))) AND ((COALESCE(agr_cred_prod.grntee_prod_id, ('-1'::integer)::bigint) <> '-1'::integer) OR (agr_cred.eks_agr_cred_type_id = ANY (ARRAY[('-1007'::integer)::bigint, ('-1024'::integer)::bigint, ('-1025'::integer)::bigint])))))) THEN 'Y'::text
            WHEN ((agr_cred.agr_cred_type_id = '-1034'::integer) AND (((
            CASE
                WHEN (dt.start_dt = '9999-12-31'::date) THEN dt.start_dt
                ELSE (dt.start_dt + 1)
            END >=
            CASE
                WHEN (agr_cred.signed_dt = '9999-12-31'::date) THEN agr_cred.signed_dt
                ELSE (agr_cred.signed_dt + 1)
            END) AND (
            CASE
                WHEN (dt.start_dt = '9999-12-31'::date) THEN dt.start_dt
                ELSE (dt.start_dt + 1)
            END <= agr_cred.close_dt)) OR (agr_cred.close_dt IS NULL))) THEN 'Y'::text
            ELSE 'N'::text
        END AS active_flag
   FROM (((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT agr_cred_1.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr_cred_1
                        UNION ALL
                         SELECT agr_cred_1.agr_cred_id AS id,
                            COALESCE(agr_cred_1.signed_dt, '1900-01-01'::date) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr_cred_1
                        UNION ALL
                         SELECT agr_cred_1.agr_cred_id AS id,
                            COALESCE(agr_cred_1.close_dt, '1900-01-01'::date) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr_cred_1
                        UNION ALL
                         SELECT ash.agrmnt_id AS id,
                            ash.acct_stts_start_dt AS start_dt
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_stts_hist ash
                             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_stts_type ast ON (((ash.acct_stts_type_id = ast.acct_stts_type_id) AND (ast.acct_stts_role_id = 1))))
                          WHERE (ash.acct_stts_role_id = 1)
                        UNION ALL
                         SELECT ash.agrmnt_id AS id,
                            (ash.acct_stts_end_dt + 1) AS start_dt
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_stts_hist ash
                             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_stts_type ast ON (((ash.acct_stts_type_id = ast.acct_stts_type_id) AND (ast.acct_stts_role_id = 1))))
                          WHERE ((ash.acct_stts_role_id = 1) AND (ash.acct_stts_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT org.agr_cred_id AS id,
                            org.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org org
                        UNION ALL
                         SELECT org.agr_cred_id AS id,
                            (org.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org org
                          WHERE (org.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT mat.agr_cred_id AS id,
                            mat.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat mat
                        UNION ALL
                         SELECT mat.agr_cred_id AS id,
                            (mat.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt_mat mat
                          WHERE (mat.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT prod.agr_cred_id AS id,
                            prod.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod prod
                        UNION ALL
                         SELECT prod.agr_cred_id AS id,
                            (prod.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod prod
                          WHERE (prod.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr_cred ON ((agr_cred.agr_cred_id = dt.id)))
     LEFT JOIN ( SELECT ash.agrmnt_id AS id,
            ash.acct_stts_start_dt AS start_dt,
            ash.acct_stts_end_dt AS end_dt,
            ast.acct_stts_type_id AS agr_cred_stts_type_id,
            ast.acct_stts_type_cd AS agr_cred_stts_type_cd,
            ast.acct_stts_type_desc AS agr_cred_stts_type_name
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_stts_hist ash
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_stts_type ast ON (((ash.acct_stts_type_id = ast.acct_stts_type_id) AND (ast.acct_stts_role_id = 1))))
          WHERE (ash.acct_stts_role_id = 1)) agr_cred_stts ON ((((agr_cred_stts.id = dt.id) AND (dt.start_dt >= agr_cred_stts.start_dt)) AND (dt.start_dt <= agr_cred_stts.end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org agr_cred_int_org ON ((((dt.id = agr_cred_int_org.agr_cred_id) AND (dt.start_dt >= agr_cred_int_org.start_dt)) AND (dt.start_dt <= agr_cred_int_org.end_dt))))
     LEFT JOIN agr_cred_fin_dt_mat agr_cred_fin_dt_mat ON ((((dt.id = agr_cred_fin_dt_mat.agr_cred_id) AND (dt.start_dt >= agr_cred_fin_dt_mat.start_dt)) AND (dt.start_dt <= agr_cred_fin_dt_mat.end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod agr_cred_prod ON ((((dt.id = agr_cred_prod.agr_cred_id) AND (dt.start_dt >= agr_cred_prod.start_dt)) AND (dt.start_dt <= agr_cred_prod.end_dt))));"
d_agr_cred_addendum," SELECT arh.agr_cred_id,
    arh.restruct_flag,
    arh.signed_dt,
    arh.prolong_flag,
    COALESCE(amh.acct_bal_metric_dt, amh_max.acct_bal_metric_dt) AS expiration_dt,
    arh.restruct_default_flag,
    arh.restruct_default_dt,
    arh.modify_ifrs9_type_id,
    arh.info_system_id
   FROM ((( SELECT arh_1.agrmnt_id AS agr_cred_id,
                CASE arh_1.restruct_ind
                    WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
                    WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
                    ELSE NULL::text
                END AS restruct_flag,
            arh_1.contract_start_dt AS signed_dt,
                CASE arh_1.prolong_ind
                    WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
                    WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
                    ELSE NULL::text
                END AS prolong_flag,
                CASE arh_1.restruct_default_ind
                    WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
                    WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
                    ELSE NULL::text
                END AS restruct_default_flag,
            arh_1.restruct_default_dt,
            (max(arh_1.contract_start_dt) OVER (PARTITION BY arh_1.agrmnt_id ORDER BY arh_1.contract_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1) AS expiration_join_dt,
            arh_1.info_system_id,
            arh_1.eks_modify_msfo9_type_id AS modify_ifrs9_type_id
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist arh_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = arh_1.agrmnt_id)))
          WHERE ((NOT ((arh_1.contract_start_dt = '9999-12-31'::date) AND (arh_1.contract_end_dt = '9999-12-31'::date))) AND (arh_1.acct_renewal_categ_id = '-1001'::integer))) arh
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amh ON (((((arh.agr_cred_id = amh.agrmnt_id) AND ((arh.expiration_join_dt >= amh.acct_bal_metric_start_dt) AND (arh.expiration_join_dt <= amh.acct_bal_metric_end_dt))) AND (amh.bal_cat_type_id = '-1'::integer)) AND (amh.acct_metric_type_id = '-1046'::integer))))
     LEFT JOIN ( SELECT t.agrmnt_id,
            t.acct_bal_metric_dt
           FROM ( SELECT amh_1.agrmnt_id,
                    amh_1.acct_bal_metric_dt,
                    row_number() OVER (PARTITION BY amh_1.agrmnt_id ORDER BY amh_1.acct_bal_metric_end_dt DESC) AS rn
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amh_1
                  WHERE ((amh_1.bal_cat_type_id = '-1'::integer) AND (amh_1.acct_metric_type_id = '-1046'::integer))) t
          WHERE (t.rn = 1)) amh_max ON ((arh.agr_cred_id = amh_max.agrmnt_id)));"
d_agr_cred_ifrs9_gca," SELECT dt.agr_cred_id,
    dt.issue_crncy_id,
    dt.start_dt,
    max(dt.end_dt) AS end_dt,
    sum(b.acct_bal_metric_amt) AS eks_gross_carrying_amt,
    max(b.info_system_id) AS info_system_id
   FROM (( SELECT ""Window"".agr_cred_id,
            ""Window"".issue_crncy_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_cred_id, ""Window"".issue_crncy_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.agr_cred_id,
                    dt_1.issue_crncy_id,
                    dt_1.start_dt
                   FROM ( SELECT b_1.agr_cred_id,
                            b_1.issue_crncy_id,
                                CASE
                                    WHEN (m.i = 1) THEN b_1.start_dt
                                    WHEN ((m.i = 2) AND (b_1.end_dt = '9999-12-31'::date)) THEN b_1.end_dt
                                    ELSE (b_1.end_dt + 1)
                                END AS start_dt
                           FROM (( SELECT
CASE
 WHEN (multiplier.a = 1) THEN agr.agr_cred_id
 WHEN (multiplier.a = 2) THEN agr.prnt_agr_cred_id
 ELSE NULL::bigint
END AS agr_cred_id,
                                    agr.issue_crncy_id,
                                    amv.acct_bal_metric_start_dt AS start_dt,
                                    amv.acct_bal_metric_end_dt AS end_dt,
                                    amv.acct_bal_metric_amt
                                   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr
                                     JOIN ( SELECT a.a
   FROM ( SELECT 1 AS a) a
UNION ALL
 SELECT a.a
   FROM ( SELECT 2 AS a) a) multiplier ON (((multiplier.a = 1) OR ((multiplier.a = 2) AND (agr.prnt_agr_cred_id <> agr.agr_cred_id)))))
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amv ON (((agr.agr_cred_id = amv.agrmnt_id) AND (amv.acct_metric_type_id = '-1055'::integer))))) b_1
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (b_1.end_dt <> '9999-12-31'::date)))))) dt_1
                  GROUP BY dt_1.agr_cred_id, dt_1.issue_crncy_id, dt_1.start_dt) ""Window""(agr_cred_id, issue_crncy_id, start_dt)) dt
     JOIN ( SELECT
                CASE
                    WHEN (multiplier.a = 1) THEN agr.agr_cred_id
                    WHEN (multiplier.a = 2) THEN agr.prnt_agr_cred_id
                    ELSE NULL::bigint
                END AS agr_cred_id,
            agr.issue_crncy_id,
            amv.acct_bal_metric_start_dt AS start_dt,
            amv.acct_bal_metric_end_dt AS end_dt,
            amv.acct_bal_metric_amt,
            agr.info_system_id
           FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr
             JOIN ( SELECT a.a
                   FROM ( SELECT 1 AS a) a
                UNION ALL
                 SELECT a.a
                   FROM ( SELECT 2 AS a) a) multiplier ON (((multiplier.a = 1) OR ((multiplier.a = 2) AND (agr.prnt_agr_cred_id <> agr.agr_cred_id)))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amv ON (((agr.agr_cred_id = amv.agrmnt_id) AND (amv.acct_metric_type_id = '-1055'::integer))))) b ON ((((dt.agr_cred_id = b.agr_cred_id) AND (dt.issue_crncy_id = b.issue_crncy_id)) AND ((dt.start_dt >= b.start_dt) AND (dt.start_dt <= b.end_dt)))))
  GROUP BY dt.agr_cred_id, dt.issue_crncy_id, dt.start_dt;"
d_agr_cred_clsfctn_purpose," SELECT agr.agr_cred_id,
    min(src.agrmnt_multi_assoc_start_dt) AS start_dt,
    '9999-12-31'::date AS end_dt,
    src.agrmnt_multi_val_id AS agr_cred_purpose_id,
    max(agr.info_system_id) AS info_system_id
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc src ON ((agr.agr_cred_id = src.agrmnt_id)))
  WHERE (src.agrmnt_multi_scheme_id = '-1001'::integer)
  GROUP BY agr.agr_cred_id, src.agrmnt_multi_val_id;"
d_agr_cred_fin_f303_cond," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    ama.agrmnt_multi_val_id AS f303_cond_type_id,
    agr.info_system_id
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT ama_1.agrmnt_id AS id,
                            ama_1.agrmnt_multi_assoc_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama_1
                          WHERE (ama_1.agrmnt_multi_scheme_id = '-1004'::integer)
                        UNION ALL
                         SELECT ama_1.agrmnt_id AS id,
                            (ama_1.agrmnt_multi_assoc_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama_1
                          WHERE ((ama_1.agrmnt_multi_scheme_id = '-1004'::integer) AND (ama_1.agrmnt_multi_assoc_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((dt.id = agr.agr_cred_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama ON ((((dt.id = ama.agrmnt_id) AND (ama.agrmnt_multi_scheme_id = '-1004'::integer)) AND ((dt.start_dt >= ama.agrmnt_multi_assoc_start_dt) AND (dt.start_dt <= ama.agrmnt_multi_assoc_end_dt)))));"
d_agr_cred_fin_f303_ins," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    ama.agrmnt_multi_val_id AS f303_ins_type_id,
    agr.info_system_id
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT ama_1.agrmnt_id AS id,
                            ama_1.agrmnt_multi_assoc_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama_1
                          WHERE (ama_1.agrmnt_multi_scheme_id = '-1002'::integer)
                        UNION ALL
                         SELECT ama_1.agrmnt_id AS id,
                            (ama_1.agrmnt_multi_assoc_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama_1
                          WHERE ((ama_1.agrmnt_multi_scheme_id = '-1002'::integer) AND (ama_1.agrmnt_multi_assoc_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((dt.id = agr.agr_cred_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_multi_assoc ama ON ((((dt.id = ama.agrmnt_id) AND (ama.agrmnt_multi_scheme_id = '-1002'::integer)) AND ((dt.start_dt >= ama.agrmnt_multi_assoc_start_dt) AND (dt.start_dt <= ama.agrmnt_multi_assoc_end_dt)))));"
d_agr_cred_restruct," SELECT ""Window"".agr_cred_id,
    ""Window"".start_dt,
    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    ""Window"".addendum_flag,
    ""Window"".f303_flag,
    ""Window"".f26_flag,
    ""Window"".covid_flag,
    ""Window"".modify_ifrs9_type_id,
    ""Window"".f303_restruct_types_id,
    ""Window"".covid_restruct_type_id,
    ""Window"".total_covid_restruct_flag,
    ""Window"".covid_recovery_dt,
    ""Window"".covid_holidays_flag,
    ""Window"".covid_subsidy_flag,
    ""Window"".info_system_id
   FROM ( SELECT t.agr_cred_id,
            t.start_dt,
            max(t.addendum_flag) AS addendum_flag,
            max(t.f303_flag) AS f303_flag,
            max(t.f26_flag) AS f26_flag,
            max(t.covid_flag) AS covid_flag,
            max(t.modify_ifrs9_type_id) AS modify_ifrs9_type_id,
            max(t.f303_restruct_types_id) AS f303_restruct_types_id,
            max(t.covid_restruct_type_id) AS covid_restruct_type_id,
            max(t.total_covid_restruct_flag) AS total_covid_restruct_flag,
            min(t.covid_recovery_dt) AS covid_recovery_dt,
            max(t.covid_holidays_flag) AS covid_holidays_flag,
            max(t.covid_subsidy_flag) AS covid_subsidy_flag,
            max(t.info_system_id) AS info_system_id
           FROM ( SELECT v_acct_renewal_hist.agrmnt_id AS agr_cred_id,
                    v_acct_renewal_hist.contract_start_dt AS start_dt,
                        CASE
                            WHEN ((v_acct_renewal_hist.acct_renewal_categ_id = '-1001'::integer) AND (v_acct_renewal_hist.restruct_ind = 'YES'::text)) THEN 'Y'::text
                            ELSE NULL::text
                        END AS addendum_flag,
                        CASE
                            WHEN (v_acct_renewal_hist.acct_renewal_categ_id = '-1003'::integer) THEN 'Y'::text
                            ELSE NULL::text
                        END AS f303_flag,
                    NULL::text AS f26_flag,
                        CASE
                            WHEN (v_acct_renewal_hist.acct_renewal_categ_id = '-1004'::integer) THEN 'Y'::text
                            ELSE NULL::text
                        END AS covid_flag,
                        CASE
                            WHEN ((v_acct_renewal_hist.acct_renewal_categ_id = '-1001'::integer) AND (v_acct_renewal_hist.restruct_ind = 'YES'::text)) THEN v_acct_renewal_hist.eks_modify_msfo9_type_id
                            ELSE NULL::integer
                        END AS modify_ifrs9_type_id,
                        CASE
                            WHEN (v_acct_renewal_hist.acct_renewal_categ_id = '-1003'::integer) THEN v_acct_renewal_hist.acct_renewal_id
                            ELSE NULL::bigint
                        END AS f303_restruct_types_id,
                        CASE
                            WHEN (v_acct_renewal_hist.acct_renewal_categ_id = '-1004'::integer) THEN v_acct_renewal_hist.acct_renewal_type_id
                            ELSE NULL::bigint
                        END AS covid_restruct_type_id,
                    NULL::text AS total_covid_restruct_flag,
                    NULL::date AS covid_recovery_dt,
                        CASE
                            WHEN (v_acct_renewal_hist.acct_renewal_categ_id = '-1005'::integer) THEN 'Y'::text
                            ELSE NULL::text
                        END AS covid_holidays_flag,
                    NULL::text AS covid_subsidy_flag,
                    v_acct_renewal_hist.info_system_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist
                  WHERE (((v_acct_renewal_hist.acct_renewal_categ_id = '-1001'::integer) AND (v_acct_renewal_hist.restruct_ind = 'YES'::text)) OR (v_acct_renewal_hist.acct_renewal_categ_id = ANY (ARRAY[('-1003'::integer)::bigint, ('-1004'::integer)::bigint, ('-1005'::integer)::bigint])))
                UNION ALL
                 SELECT v_agrmnt_metric_hist.agrmnt_id AS agr_cred_id,
                    v_agrmnt_metric_hist.acct_bal_metric_start_dt AS start_dt,
                    NULL::text AS addendum_flag,
                    NULL::text AS f303_flag,
                    'Y'::text AS f26_flag,
                    NULL::text AS covid_flag,
                    NULL::integer AS modify_ifrs9_type_id,
                    NULL::bigint AS f303_restruct_types_id,
                    NULL::bigint AS covid_restruct_type_id,
                    NULL::text AS total_covid_restruct_flag,
                    NULL::date AS covid_recovery_dt,
                    NULL::text AS covid_holidays_flag,
                    NULL::text AS covid_subsidy_flag,
                    v_agrmnt_metric_hist.info_system_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist
                  WHERE (((v_agrmnt_metric_hist.acct_metric_type_id = '-1004'::integer) AND (v_agrmnt_metric_hist.acct_bal_metric_start_dt <> '1900-01-01'::date)) AND (v_agrmnt_metric_hist.acct_bal_metric_cnt > 0))
                UNION ALL
                 SELECT d_agr_cred_recovery_dt.agr_cred_id,
                    d_agr_cred_recovery_dt.start_dt,
                    NULL::text AS addendum_flag,
                    NULL::text AS f303_flag,
                    NULL::text AS f26_flag,
                    NULL::text AS covid_flag,
                    NULL::integer AS modify_ifrs9_type_id,
                    NULL::bigint AS f303_restruct_types_id,
                    NULL::bigint AS covid_restruct_type_id,
                    'Y'::text AS total_covid_restruct_flag,
                    d_agr_cred_recovery_dt.recovery_dt AS covid_recovery_dt,
                    NULL::text AS covid_holidays_flag,
                    NULL::text AS covid_subsidy_flag,
                    d_agr_cred_recovery_dt.info_system_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_recovery_dt
                UNION ALL
                 SELECT v_agrmnt_subsidy_hist.agrmnt_id AS agr_cred_id,
                    v_agrmnt_subsidy_hist.start_dt,
                    NULL::text AS addendum_flag,
                    NULL::text AS f303_flag,
                    NULL::text AS f26_flag,
                    NULL::text AS covid_flag,
                    NULL::integer AS modify_ifrs9_type_id,
                    NULL::bigint AS f303_restruct_types_id,
                    NULL::bigint AS covid_restruct_type_id,
                    NULL::text AS total_covid_restruct_flag,
                    NULL::date AS covid_recovery_dt,
                    NULL::text AS covid_holidays_flag,
                    'Y'::text AS covid_subsidy_flag,
                    v_agrmnt_subsidy_hist.info_system_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_subsidy_hist
                  WHERE (v_agrmnt_subsidy_hist.agrmnt_subsidy_type_id = '-1003'::integer)) t
          GROUP BY t.agr_cred_id, t.start_dt) ""Window""(agr_cred_id, start_dt, addendum_flag, f303_flag, f26_flag, covid_flag, modify_ifrs9_type_id, f303_restruct_types_id, covid_restruct_type_id, total_covid_restruct_flag, covid_recovery_dt, covid_holidays_flag, covid_subsidy_flag, info_system_id);"
d_agr_collat_cust," SELECT vap.agrmnt_id AS agr_collat_id,
    vap.agrmnt_pty_start_dt AS start_dt,
    vap.agrmnt_pty_end_dt AS end_dt,
    vap.pty_id AS cust_id,
    vap.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty vap
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat ac ON ((vap.agrmnt_id = ac.agr_collat_id)))
  WHERE (vap.agrmnt_pty_role_id = 1);"
d_grntee_pty," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    p1009.pty_id AS grntee_chief_bank_cust_id,
    p1010.pty_id AS grntee_guided_bank_cust_id,
    dt.info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_agrmnt_pty.agrmnt_id AS id,
                            v_agrmnt_pty.agrmnt_pty_start_dt AS start_dt,
                            v_agrmnt_pty.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE (v_agrmnt_pty.agrmnt_pty_role_id = ANY (ARRAY['-1009'::integer, '-1010'::integer]))
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            (v_agrmnt_pty.agrmnt_pty_end_dt + 1),
                            v_agrmnt_pty.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE ((v_agrmnt_pty.agrmnt_pty_role_id = ANY (ARRAY['-1009'::integer, '-1010'::integer])) AND (v_agrmnt_pty.agrmnt_pty_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr ON ((dt.id = agr.agr_cred_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty p1009 ON ((((p1009.agrmnt_pty_role_id = '-1009'::integer) AND (p1009.agrmnt_id = dt.id)) AND ((dt.start_dt >= p1009.agrmnt_pty_start_dt) AND (dt.start_dt <= p1009.agrmnt_pty_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty p1010 ON ((((p1010.agrmnt_pty_role_id = '-1010'::integer) AND (p1010.agrmnt_id = dt.id)) AND ((dt.start_dt >= p1010.agrmnt_pty_start_dt) AND (dt.start_dt <= p1010.agrmnt_pty_end_dt)))));"
d_agr_cred_core," SELECT agr.agrmnt_id AS agr_cred_id,
    max(agr.info_system_id) AS info_system_id
   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt agr
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_info_system i ON ((i.info_system_id = agr.info_system_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fag ON ((fag.agrmnt_id = agr.agrmnt_id)))
  WHERE (((((i.info_system_type_cd = '010'::text) AND (i.info_system_inst_cd = '910002'::text)) AND (agr.agrmnt_categ_id = 1)) AND (fag.fin_agrmnt_type_id = ANY (ARRAY[('-1006'::integer)::bigint, ('-1007'::integer)::bigint, ('-1008'::integer)::bigint, ('-1009'::integer)::bigint, ('-1010'::integer)::bigint, ('-1024'::integer)::bigint, ('-1025'::integer)::bigint, ('-1028'::integer)::bigint, ('-1031'::integer)::bigint]))) AND ((agr.acct_signed_dt <> '9999-12-31'::date) OR (fag.fin_agrmnt_type_id = '-1028'::integer)))
  GROUP BY agr.agrmnt_id;"
d_agr_cession," SELECT fa.agrmnt_id AS agr_cession_id,
    a.agrmnt_num AS agr_num,
    ac.agrmnt_class_val_id AS cession_sell_type_id,
    ccy.acct_crncy_id AS crncy_id,
    a.acct_signed_dt AS signed_dt,
    a.info_system_id
   FROM ((((s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fa
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt a ON ((fa.agrmnt_id = a.agrmnt_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_info_system i ON ((((i.info_system_id = a.info_system_id) AND (i.info_system_type_cd = '010'::text)) AND (i.info_system_inst_cd = '910002'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc ac ON ((((fa.agrmnt_id = ac.agrmnt_id) AND (ac.agrmnt_clsfctn_id = '-1032'::integer)) AND ((('now'::text)::date >= ac.agrmnt_class_start_dt) AND (('now'::text)::date <= ac.agrmnt_class_end_dt)))))
     LEFT JOIN ( SELECT t.agrmnt_id,
            t.acct_crncy_id
           FROM ( SELECT v_acct_crncy.agrmnt_id,
                    v_acct_crncy.acct_crncy_id,
                    row_number() OVER (PARTITION BY v_acct_crncy.agrmnt_id ORDER BY v_acct_crncy.acct_crncy_start_dt DESC) AS rn
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_crncy
                  WHERE (v_acct_crncy.crncy_use_id = 4)) t
          WHERE (t.rn = 1)) ccy ON ((fa.agrmnt_id = ccy.agrmnt_id)))
  WHERE (fa.fin_agrmnt_type_id = '-1020'::integer);"
d_agr_cred_prnt_tmp," SELECT agr.agr_cred_id,
    COALESCE(a2a.agrmnt_id, agr.agr_cred_id) AS prnt_agr_cred_id,
    agr.info_system_id
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr
     LEFT JOIN ( SELECT t.related_agrmnt_id,
            t.agrmnt_id
           FROM ( SELECT rel.related_agrmnt_id,
                    rel.agrmnt_id,
                    row_number() OVER (PARTITION BY rel.related_agrmnt_id ORDER BY rel.agrmnt_related_start_dt, rel.agrmnt_id DESC) AS rn
                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related rel
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((rel.agrmnt_id = cor.agr_cred_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fag ON ((fag.agrmnt_id = rel.agrmnt_id)))
                  WHERE ((rel.agrmnt_related_type_id = '-1004'::integer) AND (fag.fin_agrmnt_type_id <> '-1007'::integer))) t
          WHERE (t.rn = 1)) a2a ON ((a2a.related_agrmnt_id = agr.agr_cred_id)));"
d_gl_main_acct," SELECT v_gl_main_acct.gl_main_acct_id,
    v_gl_main_acct.gl_main_acct_start_dt,
    v_gl_main_acct.gl_main_acct_end_dt,
    v_gl_main_acct.gl_main_acct_num,
    v_gl_main_acct.asset_liab_cd,
    v_gl_main_acct.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct;"
d_agr_cred_plan_param," SELECT a.agrmnt_id AS agr_cred_id,
    a.optn_type_id,
    a.start_dt,
    COALESCE((max(a.start_dt) OVER (PARTITION BY a.agrmnt_id, a.optn_type_id ORDER BY a.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    a.outer_optn_type_cd AS host_optn_type_cd,
    ass.agrmnt_class_val_id AS time_period_type_id,
    a.info_system_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr
     JOIN ( SELECT t.agrmnt_id,
                CASE mult.i
                    WHEN 1 THEN t.agrmnt_class_start_dt
                    WHEN 2 THEN (t.agrmnt_class_end_dt + 1)
                    ELSE NULL::date
                END AS start_dt,
                CASE t.agrmnt_clsfctn_id
                    WHEN 2 THEN '_'::text
                    WHEN 10 THEN '_'::text
                    ELSE NULL::text
                END AS outer_optn_type_cd,
            max(ot.fin_evt_type_id) AS optn_type_id,
            max(t.info_system_id) AS info_system_id
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc t
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type ot ON (((ot.fin_evt_host_type_cd =
                CASE t.agrmnt_clsfctn_id
                    WHEN 2 THEN '_'::text
                    WHEN 10 THEN '_'::text
                    ELSE NULL::text
                END) AND (ot.fin_evt_host_type_cd = ANY (ARRAY['_'::text, '_'::text])))))
             CROSS JOIN ( SELECT a_1.i
                   FROM ( SELECT 1 AS i) a_1
                UNION ALL
                 SELECT a_1.i
                   FROM ( SELECT 2 AS i) a_1) mult)
          WHERE ((t.agrmnt_clsfctn_id = ANY (ARRAY[2, 10])) AND ((mult.i = 1) OR (t.agrmnt_class_end_dt <> '9999-12-31'::date)))
          GROUP BY t.agrmnt_id,
                CASE mult.i
                    WHEN 1 THEN t.agrmnt_class_start_dt
                    WHEN 2 THEN (t.agrmnt_class_end_dt + 1)
                    ELSE NULL::date
                END,
                CASE t.agrmnt_clsfctn_id
                    WHEN 2 THEN '_'::text
                    WHEN 10 THEN '_'::text
                    ELSE NULL::text
                END) a ON ((a.agrmnt_id = agr.agr_cred_id)))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc ass
     JOIN ( SELECT
                CASE v_fin_evt_type.fin_evt_host_type_cd
                    WHEN '_'::text THEN (2)::bigint
                    WHEN '_'::text THEN (10)::bigint
                    ELSE NULL::bigint
                END AS agrmnt_clsfctn_id,
            max(v_fin_evt_type.fin_evt_type_id) AS optn_type_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type
          WHERE (v_fin_evt_type.fin_evt_host_type_cd = ANY (ARRAY['_'::text, '_'::text]))
          GROUP BY
                CASE v_fin_evt_type.fin_evt_host_type_cd
                    WHEN '_'::text THEN (2)::bigint
                    WHEN '_'::text THEN (10)::bigint
                    ELSE NULL::bigint
                END) m ON (((ass.agrmnt_clsfctn_id = ANY (ARRAY[2, 10])) AND (ass.agrmnt_clsfctn_id = m.agrmnt_clsfctn_id)))) ON ((((ass.agrmnt_id = a.agrmnt_id) AND (a.optn_type_id = m.optn_type_id)) AND ((a.start_dt >= ass.agrmnt_class_start_dt) AND (a.start_dt <= ass.agrmnt_class_end_dt)))));"
d_agr_cred_int_org_tmp," SELECT agr.agr_cred_id,
    src.agrmnt_pty_start_dt AS start_dt,
    src.agrmnt_pty_end_dt AS end_dt,
    src.pty_id AS srv_int_org_id,
    trans.tgt109_id AS bal_int_org_id,
    agr.info_system_id,
        CASE
            WHEN (substr(fio.org_num, 1, 4) = ANY (ARRAY['9049'::text, '9042'::text])) THEN 'Y'::text
            ELSE 'N'::text
        END AS kf_flag
   FROM (((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty src ON (((agr.agr_cred_id = src.agrmnt_id) AND (src.agrmnt_pty_role_id = 2))))
     JOIN ( SELECT nk47.tgt_id AS tgt47_id,
            max(nk109.tgt_id) AS tgt109_id
           FROM (s_grnplm_as_t_didsd_010_db_tmd.k_pty_nk47 nk47
             JOIN s_grnplm_as_t_didsd_010_db_tmd.k_pty_nk109 nk109 ON (((((nk47.nk47_depart_id = nk109.nk109_depart_id) AND (nk47.info_system_inst_cd = nk109.info_system_inst_cd)) AND (nk47.info_system_type_cd = nk109.info_system_type_cd)) AND (nk109.nk109_depart_id IS NOT NULL))))
          GROUP BY nk47.tgt_id) trans ON ((trans.tgt47_id = src.pty_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_inst_int_org fio ON ((fio.int_org_pty_id = src.pty_id)));"
d_agr_cred_fin_dp," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    debt_ovr.start_dt AS debt_ovr_dt,
    intrst_ovr.start_dt AS intrst_ovr_dt,
    grntee_comiss_ovr.start_dt AS grntee_comiss_ovr_dt,
    agr_comiss_ovr.start_dt AS agr_comiss_ovr_dt,
    ovr.start_dt AS ovr_dt,
    lm.start_dt AS lim_dt,
    COALESCE(aco_rl.first_lim_rub, (0)::numeric) AS first_lim_rub,
    COALESCE(aco_rl.first_lim_amt, (0)::numeric) AS first_lim_amt,
    COALESCE(lm.eks_agr_cred_amt, (0)::numeric) AS eks_agr_cred_amt,
    dt.info_system_id
   FROM (((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT d_agr_cred_optn_sum.agr_cred_id AS id,
                            d_agr_cred_optn_sum.start_dt,
                            d_agr_cred_optn_sum.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum
                          WHERE (d_agr_cred_optn_sum.meas_cd = ANY (ARRAY['AGRA_L001'::text, 'AGRA_L002'::text, 'AGRA_L005'::text, 'AGRA_L006'::text, 'AGRA_L023'::text, 'AGRA_L025'::text]))
                        UNION ALL
                         SELECT t.id,
                            t.start_dt,
                            t.info_system_id
                           FROM ( SELECT aco_rl_1.agr_cred_id AS id,
                                    aco_rl_1.optn_dt AS start_dt,
                                    aco_rl_1.info_system_id,
                                    row_number() OVER (PARTITION BY aco_rl_1.agr_cred_id ORDER BY aco_rl_1.optn_dt) AS rn
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn aco_rl_1
                                  WHERE (((aco_rl_1.rise_limit_flag = 'Y'::text) AND (aco_rl_1.inc_flag = 'Y'::text)) AND (aco_rl_1.optn_rub <> (0)::numeric))) t
                          WHERE (1 = t.rn)
                        UNION ALL
                         SELECT t.agr_cred_id,
                            t.start_dt,
                            t.info_system_id
                           FROM ( SELECT aco_fst_iss.agr_cred_id,
                                    aco_fst_iss.optn_dt AS start_dt,
                                    aco_fst_iss.info_system_id,
                                    row_number() OVER (PARTITION BY aco_fst_iss.agr_cred_id ORDER BY aco_fst_iss.optn_dt) AS rn
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn aco_fst_iss
                                  WHERE (((aco_fst_iss.issue_flag = 'Y'::text) OR (aco_fst_iss.move_flag = 'Y'::text)) AND (aco_fst_iss.optn_rub <> (0)::numeric))) t
                          WHERE (1 = t.rn)
                        UNION ALL
                         SELECT a2l.agrmnt_id AS id,
                                CASE m.i
                                    WHEN 1 THEN lmh.limit_metric_start_dt
                                    WHEN 2 THEN
                                    CASE
WHEN (lmh.limit_metric_end_dt = '9999-12-31'::date) THEN lmh.limit_metric_end_dt
ELSE (lmh.limit_metric_end_dt + 1)
                                    END
                                    ELSE NULL::date
                                END AS start_dt,
                            a2l.info_system_id
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_limit a2l
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_limit_metric_hist lmh ON ((lmh.limit_id = a2l.limit_id)))
                             CROSS JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m)
                          WHERE ((a2l.agrmnt_limit_role_id = ANY (ARRAY['-1001'::integer, '-1002'::integer])) AND (lmh.limit_metric_type_id = '-1005'::integer))
                        UNION ALL
                         SELECT d_agr_cred_optn_sum.agr_cred_id AS id,
                            d_agr_cred_optn_sum.start_dt,
                            d_agr_cred_optn_sum.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum
                          WHERE (d_agr_cred_optn_sum.grntee_comiss_flag = 'Y'::text)
                        UNION ALL
                         SELECT cor.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt,
                            cor.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     LEFT JOIN ( SELECT a.agr_cred_id,
            a.start_dt,
            a.end_dt
           FROM ( SELECT a_1.agr_cred_id,
                    a_1.start_dt,
                    COALESCE((max(a_1.start_dt) OVER (PARTITION BY a_1.agr_cred_id ORDER BY a_1.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    a_1.has_flag
                   FROM ( SELECT t.agr_cred_id,
                            t.start_dt,
                            t.has_flag
                           FROM ( SELECT t_1.agr_cred_id,
                                    t_1.start_dt,
                                    t_1.has_flag,
CASE
 WHEN (t_1.has_flag <> max(t_1.has_flag) OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
 ELSE row_number() OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt)
END AS rn
                                   FROM ( SELECT dt_1.agr_cred_id,
    dt_1.start_dt,
  CASE
   WHEN (COALESCE(sum(
   CASE
    WHEN (sm.meas_cd = 'AGRA_L002'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001) THEN 'N'::text
   ELSE 'Y'::text
  END AS has_flag
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum sm
     JOIN ( SELECT dt_2.agr_cred_id,
      dt_2.start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum dt_2
    WHERE (dt_2.meas_cd = 'AGRA_L002'::text)
    GROUP BY dt_2.agr_cred_id, dt_2.start_dt) dt_1 ON ((((sm.agr_cred_id = dt_1.agr_cred_id) AND (dt_1.start_dt >= sm.start_dt)) AND (dt_1.start_dt <= sm.end_dt))))
  WHERE (sm.meas_cd = 'AGRA_L002'::text)
  GROUP BY dt_1.agr_cred_id, dt_1.start_dt) t_1) t
                          WHERE (t.rn = 1)) a_1) a
          WHERE (a.has_flag = 'Y'::text)) debt_ovr ON ((((dt.id = debt_ovr.agr_cred_id) AND (dt.start_dt >= debt_ovr.start_dt)) AND (dt.start_dt <= debt_ovr.end_dt))))
     LEFT JOIN ( SELECT a.agr_cred_id,
            a.start_dt,
            a.end_dt
           FROM ( SELECT a_1.agr_cred_id,
                    a_1.start_dt,
                    COALESCE((max(a_1.start_dt) OVER (PARTITION BY a_1.agr_cred_id ORDER BY a_1.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    a_1.has_flag
                   FROM ( SELECT t.agr_cred_id,
                            t.start_dt,
                            t.has_flag
                           FROM ( SELECT t_1.agr_cred_id,
                                    t_1.start_dt,
                                    t_1.has_flag,
CASE
 WHEN (t_1.has_flag <> max(t_1.has_flag) OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
 ELSE row_number() OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt)
END AS rn
                                   FROM ( SELECT dt_1.agr_cred_id,
    dt_1.start_dt,
  CASE
   WHEN ((COALESCE(sum(
   CASE
    WHEN (sm.meas_cd = 'AGRA_L005'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001) AND (COALESCE(sum(
   CASE
    WHEN (sm.meas_cd = 'AGRA_L006'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) THEN 'N'::text
   ELSE 'Y'::text
  END AS has_flag
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum sm
     JOIN ( SELECT dt_2.agr_cred_id,
      dt_2.start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum dt_2
    WHERE (dt_2.meas_cd = ANY (ARRAY['AGRA_L005'::text, 'AGRA_L006'::text]))
    GROUP BY dt_2.agr_cred_id, dt_2.start_dt) dt_1 ON ((((sm.agr_cred_id = dt_1.agr_cred_id) AND (dt_1.start_dt >= sm.start_dt)) AND (dt_1.start_dt <= sm.end_dt))))
  WHERE (sm.meas_cd = ANY (ARRAY['AGRA_L005'::text, 'AGRA_L006'::text]))
  GROUP BY dt_1.agr_cred_id, dt_1.start_dt) t_1) t
                          WHERE (t.rn = 1)) a_1) a
          WHERE (a.has_flag = 'Y'::text)) intrst_ovr ON ((((dt.id = intrst_ovr.agr_cred_id) AND (dt.start_dt >= intrst_ovr.start_dt)) AND (dt.start_dt <= intrst_ovr.end_dt))))
     LEFT JOIN ( SELECT a.agr_cred_id,
            a.start_dt,
            a.end_dt
           FROM ( SELECT a_1.agr_cred_id,
                    a_1.start_dt,
                    COALESCE((max(a_1.start_dt) OVER (PARTITION BY a_1.agr_cred_id ORDER BY a_1.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    a_1.has_flag
                   FROM ( SELECT t.agr_cred_id,
                            t.start_dt,
                            t.has_flag
                           FROM ( SELECT t_1.agr_cred_id,
                                    t_1.start_dt,
                                    t_1.has_flag,
CASE
 WHEN (t_1.has_flag <> max(t_1.has_flag) OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
 ELSE row_number() OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt)
END AS rn
                                   FROM ( SELECT dt_1.agr_cred_id,
    dt_1.start_dt,
  CASE
   WHEN ((((((COALESCE(sum(
   CASE
    WHEN (sm.meas_cd = 'AGRA_L002'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001) AND (COALESCE(sum(
   CASE
    WHEN (sm.meas_cd = 'AGRA_L005'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) AND (COALESCE(sum(
   CASE
    WHEN (sm.meas_cd = 'AGRA_L006'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) AND (COALESCE(sum(
   CASE
    WHEN (sm.grntee_comiss_flag = 'Y'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) AND (COALESCE(sum(
   CASE
    WHEN ((sm.grntee_comiss_flag = 'N'::text) AND (sm.meas_cd = 'AGRA_L023'::text)) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) AND (COALESCE(sum(
   CASE
    WHEN ((sm.grntee_comiss_flag = 'N'::text) AND (sm.meas_cd = 'AGRA_L025'::text)) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) THEN 'N'::text
   ELSE 'Y'::text
  END AS has_flag
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum sm
     JOIN ( SELECT dt_2.agr_cred_id,
      dt_2.start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum dt_2
    WHERE (((dt_2.meas_cd = ANY (ARRAY['AGRA_L002'::text, 'AGRA_L005'::text, 'AGRA_L006'::text])) OR (dt_2.grntee_comiss_flag = 'Y'::text)) OR ((dt_2.meas_cd = ANY (ARRAY['AGRA_L023'::text, 'AGRA_L025'::text])) AND (dt_2.grntee_comiss_flag = 'N'::text)))
    GROUP BY dt_2.agr_cred_id, dt_2.start_dt) dt_1 ON ((((sm.agr_cred_id = dt_1.agr_cred_id) AND (dt_1.start_dt >= sm.start_dt)) AND (dt_1.start_dt <= sm.end_dt))))
  WHERE (((sm.meas_cd = ANY (ARRAY['AGRA_L002'::text, 'AGRA_L005'::text, 'AGRA_L006'::text])) OR (sm.grntee_comiss_flag = 'Y'::text)) OR ((sm.meas_cd = ANY (ARRAY['AGRA_L023'::text, 'AGRA_L025'::text])) AND (sm.grntee_comiss_flag = 'N'::text)))
  GROUP BY dt_1.agr_cred_id, dt_1.start_dt) t_1) t
                          WHERE (t.rn = 1)) a_1) a
          WHERE (a.has_flag = 'Y'::text)) ovr ON ((((dt.id = ovr.agr_cred_id) AND (dt.start_dt >= ovr.start_dt)) AND (dt.start_dt <= ovr.end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id,
            t.first_lim_rub,
            t.first_lim_amt
           FROM ( SELECT aco_rl_1.agr_cred_id,
                    aco_rl_1.optn_rub AS first_lim_rub,
                    aco_rl_1.optn_agr_cred_crncy_amt AS first_lim_amt,
                    row_number() OVER (PARTITION BY aco_rl_1.agr_cred_id ORDER BY aco_rl_1.optn_dt, aco_rl_1.optn_rub DESC) AS rn
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn aco_rl_1
                  WHERE (((aco_rl_1.rise_limit_flag = 'Y'::text) AND (aco_rl_1.inc_flag = 'Y'::text)) AND (aco_rl_1.optn_rub <> (0)::numeric))) t
          WHERE (t.rn = 1)) aco_rl ON ((dt.id = aco_rl.agr_cred_id)))
     LEFT JOIN ( SELECT al.agrmnt_id AS agr_cred_id,
            met.limit_metric_amt AS eks_agr_cred_amt,
            met.limit_metric_start_dt AS start_dt,
            met.limit_metric_end_dt AS end_dt
           FROM (( SELECT t.agrmnt_id,
                    t.limit_id,
                    t.lim_start_dt,
                    t.lim_end_dt
                   FROM ( SELECT v_agrmnt_limit.agrmnt_id,
                            v_agrmnt_limit.limit_id,
                            v_agrmnt_limit.agrmnt_limit_start_dt AS lim_start_dt,
                            v_agrmnt_limit.agrmnt_limit_end_dt AS lim_end_dt,
                            row_number() OVER (PARTITION BY v_agrmnt_limit.agrmnt_id ORDER BY abs(v_agrmnt_limit.agrmnt_limit_role_id) DESC) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_limit) t
                  WHERE (t.rn = 1)) al
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_limit_metric_hist met ON (((((met.limit_id = al.limit_id) AND (met.limit_metric_type_id = '-1005'::integer)) AND (met.limit_metric_start_dt <= al.lim_end_dt)) AND (met.limit_metric_end_dt >= al.lim_start_dt))))) lm ON ((((lm.agr_cred_id = dt.id) AND (dt.start_dt >= lm.start_dt)) AND (dt.start_dt <= lm.end_dt))))
     LEFT JOIN ( SELECT a.agr_cred_id,
            a.start_dt,
            a.end_dt
           FROM ( SELECT a_1.agr_cred_id,
                    a_1.start_dt,
                    COALESCE((max(a_1.start_dt) OVER (PARTITION BY a_1.agr_cred_id ORDER BY a_1.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    a_1.has_flag
                   FROM ( SELECT t.agr_cred_id,
                            t.start_dt,
                            t.has_flag
                           FROM ( SELECT t_1.agr_cred_id,
                                    t_1.start_dt,
                                    t_1.has_flag,
CASE
 WHEN (t_1.has_flag <> max(t_1.has_flag) OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
 ELSE row_number() OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt)
END AS rn
                                   FROM ( SELECT dt_1.agr_cred_id,
    dt_1.start_dt,
  CASE
   WHEN (COALESCE(sum(
   CASE
    WHEN (sm.grntee_comiss_flag = 'Y'::text) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001) THEN 'N'::text
   ELSE 'Y'::text
  END AS has_flag
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum sm
     JOIN ( SELECT dt_2.agr_cred_id,
      dt_2.start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum dt_2
    WHERE (dt_2.grntee_comiss_flag = 'Y'::text)
    GROUP BY dt_2.agr_cred_id, dt_2.start_dt) dt_1 ON ((((sm.agr_cred_id = dt_1.agr_cred_id) AND (dt_1.start_dt >= sm.start_dt)) AND (dt_1.start_dt <= sm.end_dt))))
  WHERE (sm.grntee_comiss_flag = 'Y'::text)
  GROUP BY dt_1.agr_cred_id, dt_1.start_dt) t_1) t
                          WHERE (t.rn = 1)) a_1) a
          WHERE (a.has_flag = 'Y'::text)) grntee_comiss_ovr ON ((((dt.id = grntee_comiss_ovr.agr_cred_id) AND (dt.start_dt >= grntee_comiss_ovr.start_dt)) AND (dt.start_dt <= grntee_comiss_ovr.end_dt))))
     LEFT JOIN ( SELECT a.agr_cred_id,
            a.start_dt,
            a.end_dt
           FROM ( SELECT a_1.agr_cred_id,
                    a_1.start_dt,
                    COALESCE((max(a_1.start_dt) OVER (PARTITION BY a_1.agr_cred_id ORDER BY a_1.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
                    a_1.has_flag
                   FROM ( SELECT t.agr_cred_id,
                            t.start_dt,
                            t.has_flag
                           FROM ( SELECT t_1.agr_cred_id,
                                    t_1.start_dt,
                                    t_1.has_flag,
CASE
 WHEN (t_1.has_flag <> max(t_1.has_flag) OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) THEN (1)::bigint
 ELSE row_number() OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.start_dt)
END AS rn
                                   FROM ( SELECT dt_1.agr_cred_id,
    dt_1.start_dt,
  CASE
   WHEN ((COALESCE(sum(
   CASE
    WHEN ((sm.meas_cd = 'AGRA_L023'::text) AND (sm.grntee_comiss_flag = 'N'::text)) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001) AND (COALESCE(sum(
   CASE
    WHEN ((sm.meas_cd = 'AGRA_L025'::text) AND (sm.grntee_comiss_flag = 'N'::text)) THEN sm.calc_amt
    ELSE NULL::numeric
   END), (0)::numeric) <= 0.001)) THEN 'N'::text
   ELSE 'Y'::text
  END AS has_flag
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum sm
     JOIN ( SELECT dt_2.agr_cred_id,
      dt_2.start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum dt_2
    WHERE ((dt_2.meas_cd = ANY (ARRAY['AGRA_L023'::text, 'AGRA_L025'::text])) AND (dt_2.grntee_comiss_flag = 'N'::text))
    GROUP BY dt_2.agr_cred_id, dt_2.start_dt) dt_1 ON ((((sm.agr_cred_id = dt_1.agr_cred_id) AND (dt_1.start_dt >= sm.start_dt)) AND (dt_1.start_dt <= sm.end_dt))))
  WHERE ((sm.meas_cd = ANY (ARRAY['AGRA_L023'::text, 'AGRA_L025'::text])) AND (sm.grntee_comiss_flag = 'N'::text))
  GROUP BY dt_1.agr_cred_id, dt_1.start_dt) t_1) t
                          WHERE (t.rn = 1)) a_1) a
          WHERE (a.has_flag = 'Y'::text)) agr_comiss_ovr ON ((((dt.id = agr_comiss_ovr.agr_cred_id) AND (dt.start_dt >= agr_comiss_ovr.start_dt)) AND (dt.start_dt <= agr_comiss_ovr.end_dt))))
UNION ALL
 SELECT dt.agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    dp.debt_ovr_dt,
    dp.intrst_ovr_dt,
    NULL::date AS grntee_comiss_ovr_dt,
    NULL::date AS agr_comiss_ovr_dt,
    dp.ovr_dt,
    NULL::date AS lim_dt,
    NULL::numeric(26,4) AS first_lim_rub,
    NULL::numeric(26,4) AS first_lim_amt,
    NULL::numeric(26,4) AS eks_agr_cred_amt,
    dt.info_system_id
   FROM (( SELECT ""Window"".agr_cred_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT t.agr_cred_id,
                    t.start_dt,
                    max(t.info_system_id) AS info_system_id
                   FROM ( SELECT d_coa_cred_fin_dp.agr_cred_id,
                            d_coa_cred_fin_dp.start_dt,
                            d_coa_cred_fin_dp.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_fin_dp
                        UNION ALL
                         SELECT d_coa_cred_fin_dp.agr_cred_id,
                            (d_coa_cred_fin_dp.end_dt + 1) AS start_dt,
                            d_coa_cred_fin_dp.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_fin_dp
                          WHERE (d_coa_cred_fin_dp.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_coa_cred_core.agr_cred_id,
                            '1900-01-01'::date AS start_dt,
                            d_coa_cred_core.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core
                        UNION ALL
                         SELECT d_agr_cred_core_uvdo.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt,
                            d_agr_cred_core_uvdo.info_system_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo) t
                  GROUP BY t.agr_cred_id, t.start_dt) ""Window""(agr_cred_id, start_dt, info_system_id)) dt
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_fin_dp dp ON ((((dt.agr_cred_id = dp.agr_cred_id) AND (dt.start_dt >= dp.start_dt)) AND (dt.start_dt <= dp.end_dt))));"
d_mkt_idx_quote," SELECT dt.id AS mkt_idx_id,
    mi.info_system_id,
    dt.start_dt,
    dt.end_dt,
    miq.mkt_idx_rate
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT mi_1.mkt_idx_id AS id,
                            '1900-01-01'::date AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_mkt_idx mi_1
                        UNION ALL
                         SELECT miq_1.mkt_idx_id AS id,
                            miq_1.start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_quote miq_1
                        UNION ALL
                         SELECT miq_1.mkt_idx_id AS id,
                            (miq_1.end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_quote miq_1
                          WHERE (miq_1.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_mkt_idx mi ON ((dt.id = mi.mkt_idx_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_quote miq ON (((dt.id = miq.mkt_idx_id) AND ((dt.start_dt >= miq.start_dt) AND (dt.start_dt <= miq.end_dt)))));"
d_mkt_idx," SELECT mi.mkt_idx_id,
    max(mi.info_system_id) AS info_system_id,
    max(mi.host_mkt_idx_id) AS mkt_idx_cd,
    max(mit.mkt_idx_type_cd) AS mkt_idx_type_cd,
    max(mit.crncy_id) AS crncy_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mi
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mit ON ((mi.mkt_idx_type_id = mit.mkt_idx_type_id)))
  GROUP BY mi.mkt_idx_id;"
d_agr_cession_cust," SELECT dt.id AS agr_cession_id,
    dt.start_dt,
    dt.end_dt,
    ap.pty_id AS cust_id,
    a.info_system_id
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT ap_1.agrmnt_id AS id,
                            ap_1.agrmnt_pty_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty ap_1
                          WHERE (ap_1.agrmnt_pty_role_id = 1)
                        UNION ALL
                         SELECT ap_1.agrmnt_id AS id,
                            (ap_1.agrmnt_pty_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty ap_1
                          WHERE ((ap_1.agrmnt_pty_role_id = 1) AND (ap_1.agrmnt_pty_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cession a ON ((dt.id = a.agr_cession_id)))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty ap
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty cus ON (((ap.pty_id = cus.pty_id) AND (ap.agrmnt_pty_role_id = 1)))) ON (((dt.id = ap.agrmnt_id) AND ((dt.start_dt >= ap.agrmnt_pty_start_dt) AND (dt.start_dt <= ap.agrmnt_pty_end_dt)))));"
d_agr_grntee," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    p1009.pty_id AS grntee_chief_bank_cust_id,
    p1010.pty_id AS grntee_guided_bank_cust_id,
    clc1059.agrmnt_class_val_id AS grntee_spec_id,
    clc1060.agrmnt_class_val_id AS grntee_form_id,
        CASE
            WHEN (aa1.agrmnt_clsfctn_val_cd = 'GUAR_PREF_024'::text) THEN 'Y'::text
            ELSE 'N'::text
        END AS grntee_express_flag,
    aa2.pty_id AS grntee_beneficiary_cust_id,
    aa1.agrmnt_class_val_id,
    dt.info_system_id
   FROM (((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_agrmnt_pty.agrmnt_id AS id,
                            v_agrmnt_pty.agrmnt_pty_start_dt AS start_dt,
                            v_agrmnt_pty.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE (v_agrmnt_pty.agrmnt_pty_role_id = ANY (ARRAY['-1009'::integer, '-1010'::integer]))
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            (v_agrmnt_pty.agrmnt_pty_end_dt + 1) AS start_dt,
                            v_agrmnt_pty.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE ((v_agrmnt_pty.agrmnt_pty_role_id = ANY (ARRAY['-1009'::integer, '-1010'::integer])) AND (v_agrmnt_pty.agrmnt_pty_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT aaca.agrmnt_id AS id,
                            aaca.agrmnt_class_start_dt AS start_dt,
                            aaca.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca
                          WHERE (aaca.agrmnt_clsfctn_id = ANY (ARRAY['-1059'::integer, '-1060'::integer]))
                        UNION ALL
                         SELECT aaca.agrmnt_id AS id,
                            (aaca.agrmnt_class_end_dt + 1) AS start_dt,
                            aaca.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca
                          WHERE ((aaca.agrmnt_clsfctn_id = ANY (ARRAY['-1059'::integer, '-1060'::integer])) AND (aaca.agrmnt_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT aa.agrmnt_id AS id,
                            aa.agrmnt_class_start_dt AS start_dt,
                            aa.info_system_id
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
                          WHERE (((1 = 1) AND (aa.agrmnt_class_start_dt <> '1900-01-01'::date)) AND (aa.agrmnt_clsfctn_id = '-1039'::integer))
                        UNION ALL
                         SELECT aa.agrmnt_id AS id,
                            (aa.agrmnt_class_end_dt + 1) AS start_dt,
                            aa.info_system_id
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
                          WHERE (((1 = 1) AND (aa.agrmnt_class_end_dt <> '9999-12-31'::date)) AND (aa.agrmnt_clsfctn_id = '-1039'::integer))
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            v_agrmnt_pty.agrmnt_pty_start_dt AS start_dt,
                            v_agrmnt_pty.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE ((v_agrmnt_pty.agrmnt_pty_role_id = '-1001'::integer) AND (v_agrmnt_pty.pty_id <> '-1'::integer))
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            (v_agrmnt_pty.agrmnt_pty_end_dt + 1) AS start_dt,
                            v_agrmnt_pty.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE (((v_agrmnt_pty.agrmnt_pty_role_id = '-1001'::integer) AND (v_agrmnt_pty.agrmnt_pty_end_dt <> '9999-12-31'::date)) AND (v_agrmnt_pty.pty_id <> '-1'::integer))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr ON ((dt.id = agr.agr_cred_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty p1009 ON ((((p1009.agrmnt_pty_role_id = '-1009'::integer) AND (p1009.agrmnt_id = dt.id)) AND ((dt.start_dt >= p1009.agrmnt_pty_start_dt) AND (dt.start_dt <= p1009.agrmnt_pty_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty p1010 ON ((((p1010.agrmnt_pty_role_id = '-1010'::integer) AND (p1010.agrmnt_id = dt.id)) AND ((dt.start_dt >= p1010.agrmnt_pty_start_dt) AND (dt.start_dt <= p1010.agrmnt_pty_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc clc1059 ON ((((clc1059.agrmnt_id = dt.id) AND ((dt.start_dt >= clc1059.agrmnt_class_start_dt) AND (dt.start_dt <= clc1059.agrmnt_class_end_dt))) AND (clc1059.agrmnt_clsfctn_id = '-1059'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc clc1060 ON ((((clc1060.agrmnt_id = dt.id) AND ((dt.start_dt >= clc1060.agrmnt_class_start_dt) AND (dt.start_dt <= clc1060.agrmnt_class_end_dt))) AND (clc1060.agrmnt_clsfctn_id = '-1060'::integer))))
     LEFT JOIN ( SELECT aa.agrmnt_id,
            aa.agrmnt_class_val_id,
            aa.agrmnt_class_start_dt AS start_dt,
            aa.agrmnt_class_end_dt AS end_dt,
            ac.agrmnt_clsfctn_val_cd,
            aa.info_system_id
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
          WHERE ((1 = 1) AND (aa.agrmnt_clsfctn_id = '-1039'::integer))) aa1 ON (((aa1.agrmnt_id = dt.id) AND ((dt.start_dt >= aa1.start_dt) AND (dt.start_dt <= aa1.end_dt)))))
     LEFT JOIN ( SELECT ap.pty_id,
            ap.agrmnt_id,
            ap.agrmnt_pty_start_dt,
            ap.agrmnt_pty_end_dt
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty ap
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty cus ON ((((ap.pty_id = cus.pty_id) AND (ap.agrmnt_pty_role_id = '-1001'::integer)) AND (ap.pty_id <> '-1'::integer))))) aa2 ON (((dt.id = aa2.agrmnt_id) AND ((dt.start_dt >= aa2.agrmnt_pty_start_dt) AND (dt.start_dt <= aa2.agrmnt_pty_end_dt)))));"
d_agr_cred_cust," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    a2p.pty_id AS cust_id,
        CASE cus.org_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS org_flag,
        CASE cus.ind_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS ind_flag,
    agr.info_system_id,
        CASE
            WHEN (b.bus_cat_id = '-1001'::integer) THEN 'Y'::text
            ELSE 'N'::text
        END AS bank_flag,
    aa.pty_id AS beneficiary_id,
    th.agrmnt_txt AS fnl_rsk_brr_cust_cd
   FROM (((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT v_agrmnt_pty.agrmnt_id AS id,
                            v_agrmnt_pty.agrmnt_pty_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE (v_agrmnt_pty.agrmnt_pty_role_id = 1)
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            (v_agrmnt_pty.agrmnt_pty_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE ((v_agrmnt_pty.agrmnt_pty_role_id = 1) AND (v_agrmnt_pty.agrmnt_pty_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            v_agrmnt_pty.agrmnt_pty_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE ((v_agrmnt_pty.agrmnt_pty_role_id = '-1001'::integer) AND (v_agrmnt_pty.pty_id <> '-1'::integer))
                        UNION ALL
                         SELECT v_agrmnt_pty.agrmnt_id AS id,
                            (v_agrmnt_pty.agrmnt_pty_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty
                          WHERE (((v_agrmnt_pty.agrmnt_pty_role_id = '-1001'::integer) AND (v_agrmnt_pty.agrmnt_pty_end_dt <> '9999-12-31'::date)) AND (v_agrmnt_pty.pty_id <> '-1'::integer))
                        UNION ALL
                         SELECT v_agrmnt_text_hist.agrmnt_id AS id,
                            v_agrmnt_text_hist.agrmnt_text_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_text_hist
                          WHERE (v_agrmnt_text_hist.agrmnt_text_type_id = '-1014'::integer)
                        UNION ALL
                         SELECT v_agrmnt_text_hist.agrmnt_id AS id,
                            (v_agrmnt_text_hist.agrmnt_text_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_text_hist
                          WHERE ((v_agrmnt_text_hist.agrmnt_text_type_id = '-1014'::integer) AND (v_agrmnt_text_hist.agrmnt_text_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((dt.id = agr.agr_cred_id)))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty a2p
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty cus ON (((a2p.pty_id = cus.pty_id) AND (a2p.agrmnt_pty_role_id = 1)))) ON (((dt.id = a2p.agrmnt_id) AND ((dt.start_dt >= a2p.agrmnt_pty_start_dt) AND (dt.start_dt <= a2p.agrmnt_pty_end_dt)))))
     LEFT JOIN ( SELECT ap.pty_id,
            ap.agrmnt_id,
            ap.agrmnt_pty_start_dt,
            ap.agrmnt_pty_end_dt
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty ap
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty cus_1 ON ((((ap.pty_id = cus_1.pty_id) AND (ap.agrmnt_pty_role_id = '-1001'::integer)) AND (ap.pty_id <> '-1'::integer))))) aa ON (((dt.id = aa.agrmnt_id) AND ((dt.start_dt >= aa.agrmnt_pty_start_dt) AND (dt.start_dt <= aa.agrmnt_pty_end_dt)))))
     LEFT JOIN ( SELECT ath.agrmnt_id,
            ath.agrmnt_txt,
            ath.agrmnt_text_start_dt,
            ath.agrmnt_text_end_dt
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_text_hist ath
          WHERE (ath.agrmnt_text_type_id = '-1014'::integer)) th ON (((dt.id = th.agrmnt_id) AND ((dt.start_dt >= th.agrmnt_text_start_dt) AND (dt.start_dt <= th.agrmnt_text_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_bus b ON ((a2p.pty_id = b.ext_org_pty_id)))
UNION ALL
 SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(h_1003.pty_id, h_1001.pty_id) AS cust_id,
    NULL::text AS org_flag,
    NULL::text AS ind_flag,
    dt.info_system_id,
    NULL::text AS bank_flag,
    NULL::bigint AS beneficiary_id,
    NULL::text AS fnl_rsk_brr_cust_cd
   FROM ((( SELECT ""Window"".agr_cred_id,
            ""Window"".id,
            ""Window"".info_system_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.agr_cred_id,
                    dt_1.id,
                    dt_1.info_system_id,
                    dt_1.start_dt
                   FROM ( SELECT t.agr_cred_id,
                            h.coa_id AS id,
                            h.info_system_id,
                            h.coa_pty_start_dt AS start_dt
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_coa_pty_hist h
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core t ON ((h.coa_id = t.coa_id)))
                          WHERE (h.coa_pty_role_id = ANY (ARRAY['-1001'::integer, '-1003'::integer]))
                        UNION ALL
                         SELECT t.agr_cred_id,
                            h.coa_id AS id,
                            h.info_system_id,
                            (h.coa_pty_end_dt + 1) AS start_dt
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_coa_pty_hist h
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core t ON ((h.coa_id = t.coa_id)))
                          WHERE ((h.coa_pty_role_id = ANY (ARRAY['-1001'::integer, '-1003'::integer])) AND (h.coa_pty_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.agr_cred_id, dt_1.id, dt_1.info_system_id, dt_1.start_dt) ""Window""(agr_cred_id, id, info_system_id, start_dt)) dt
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa_pty_hist h_1001 ON ((((dt.id = h_1001.coa_id) AND ((dt.start_dt >= h_1001.coa_pty_start_dt) AND (dt.start_dt <= h_1001.coa_pty_end_dt))) AND (h_1001.coa_pty_role_id = '-1001'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa_pty_hist h_1003 ON ((((dt.id = h_1003.coa_id) AND ((dt.start_dt >= h_1003.coa_pty_start_dt) AND (dt.start_dt <= h_1003.coa_pty_end_dt))) AND (h_1003.coa_pty_role_id = '-1003'::integer))));"
d_int_org," SELECT dt.id AS int_org_id,
    dt.start_dt,
    dt.end_dt,
    bcf.pty_metric_flag AS int_org_reg_bank_collat_flag
   FROM (( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT COALESCE(i.issue_int_org_id, b.srv_int_org_id) AS id,
                            '1900-01-01'::date AS start_dt
                           FROM (( SELECT d_agr_cred.issue_int_org_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred
                                  GROUP BY d_agr_cred.issue_int_org_id) i
                             FULL JOIN ( SELECT d_agr_cred_int_org.srv_int_org_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org
                                  GROUP BY d_agr_cred_int_org.srv_int_org_id
                                UNION
                                 SELECT d_agr_cred_int_org.bal_int_org_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org
                                  GROUP BY d_agr_cred_int_org.bal_int_org_id) b ON ((i.issue_int_org_id = b.srv_int_org_id)))
                        UNION ALL
                         SELECT bcf_1.pty_id AS id,
                            bcf_1.pty_metric_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_metric_hist bcf_1
                          WHERE (bcf_1.pty_metric_type_id = '-1021'::integer)
                        UNION ALL
                         SELECT bcf_1.pty_id AS id,
                            (bcf_1.pty_metric_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_metric_hist bcf_1
                          WHERE ((bcf_1.pty_metric_type_id = '-1021'::integer) AND (bcf_1.pty_metric_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_metric_hist bcf ON ((((dt.id = bcf.pty_id) AND ((dt.start_dt >= bcf.pty_metric_start_dt) AND (dt.start_dt <= bcf.pty_metric_end_dt))) AND (bcf.pty_metric_type_id = '-1021'::integer))));"
d_cust_org_fin," SELECT dt.id AS cust_id,
    dt.start_dt,
    dt.end_dt,
    ass_wrth.risk_grade_id AS cust_rating_type_id,
    ass_fp.pty_class_val_id AS cust_fin_pos_type_id,
    dt.info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_pty_pty_class_assoc.pty_id AS id,
                            v_pty_pty_class_assoc.pty_class_start_dt AS start_dt,
                            v_pty_pty_class_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc
                          WHERE (v_pty_pty_class_assoc.pty_clsfctn_id = ANY (ARRAY[4, 5]))
                        UNION ALL
                         SELECT v_pty_pty_class_assoc.pty_id AS id,
                            (v_pty_pty_class_assoc.pty_class_end_dt + 1) AS start_dt,
                            v_pty_pty_class_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc
                          WHERE ((v_pty_pty_class_assoc.pty_clsfctn_id = ANY (ARRAY[4, 5])) AND (v_pty_pty_class_assoc.pty_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_pty_risk_grade.pty_id,
                            v_pty_risk_grade.pty_risk_grade_start_dt AS start_dt,
                            v_pty_risk_grade.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_risk_grade
                          WHERE (v_pty_risk_grade.risk_grade_scheme_id = '-1001'::integer)
                        UNION ALL
                         SELECT v_pty_risk_grade.pty_id,
                            (v_pty_risk_grade.pty_risk_grade_end_dt + 1) AS start_dt,
                            v_pty_risk_grade.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_risk_grade
                          WHERE ((v_pty_risk_grade.risk_grade_scheme_id = '-1001'::integer) AND (v_pty_risk_grade.pty_risk_grade_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((dt.id = cor.cust_id) AND (cor.crm_flag = 'N'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_risk_grade ass_wrth ON ((((ass_wrth.pty_id = dt.id) AND ((dt.start_dt >= ass_wrth.pty_risk_grade_start_dt) AND (dt.start_dt <= ass_wrth.pty_risk_grade_end_dt))) AND (ass_wrth.risk_grade_scheme_id = '-1001'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc ass_fp ON ((((ass_fp.pty_id = dt.id) AND ((dt.start_dt >= ass_fp.pty_class_start_dt) AND (dt.start_dt <= ass_fp.pty_class_end_dt))) AND (ass_fp.pty_clsfctn_id = 5))));"
d_agr_collat," SELECT agr.agrmnt_id AS agr_collat_id,
    agr.info_system_id,
    agr.agrmnt_num,
    vac.acct_crncy_id AS agr_collat_crncy_id,
    agr.acct_open_dt AS open_dt,
    agr.contract_expiration_dt AS expiration_dt,
        CASE
            WHEN (aca51.agrmnt_class_val_id = '-1001'::integer) THEN 'Y'::text
            WHEN (aca51.agrmnt_class_val_id = '-1002'::integer) THEN 'N'::text
            ELSE NULL::text
        END AS revocable_flag,
        CASE
            WHEN (aca52.agrmnt_class_val_id = '-1001'::integer) THEN 'Y'::text
            WHEN (aca52.agrmnt_class_val_id = '-1002'::integer) THEN 'N'::text
            ELSE NULL::text
        END AS unilaterally_modfn_flag,
    agr.host_agrmnt_cd AS host_agr_collat_id,
    ca.agr_collat_type_id AS asset_pledge_type_id
   FROM (((((((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt agr
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_info_system i ON ((((i.info_system_id = agr.info_system_id) AND (i.info_system_type_cd = '010'::text)) AND (i.info_system_inst_cd = '910002'::text))))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fag ON (((((fag.agrmnt_id = agr.agrmnt_id) AND (fag.fin_agrmnt_type_id = '-1011'::integer)) AND (fag.risk_expsr_mitigant_type_id = 2)) AND (fag.fin_agrmnt_categ_id = '-1'::integer))))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_risk_mitigant_agrmnt rma ON (((rma.risk_mitigant_agrmnt_id = agr.agrmnt_id) AND (rma.risk_mitigant_agrmnt_type_id = '-1001'::integer))))
     LEFT JOIN ( SELECT t.agrmnt_id,
            t.acct_crncy_id
           FROM ( SELECT v_acct_crncy.agrmnt_id,
                    v_acct_crncy.acct_crncy_id,
                    row_number() OVER (PARTITION BY v_acct_crncy.agrmnt_id ORDER BY v_acct_crncy.acct_crncy_start_dt DESC) AS rn
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_crncy
                  WHERE (v_acct_crncy.crncy_use_id = 4)) t
          WHERE (t.rn = 1)) vac ON ((vac.agrmnt_id = agr.agrmnt_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aca51 ON (((aca51.agrmnt_id = agr.agrmnt_id) AND (aca51.agrmnt_clsfctn_id = '-1035'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aca52 ON (((aca52.agrmnt_id = agr.agrmnt_id) AND (aca52.agrmnt_clsfctn_id = '-1034'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_collat_agrmnt ca ON ((agr.agrmnt_id = ca.risk_mitigant_agrmnt_id)))
  WHERE (agr.agrmnt_categ_id = 1);"
d_agr_cred_subsidy," SELECT ash.agrmnt_id AS agr_cred_id,
    ash.start_dt,
    ash.end_dt,
    spg.eks_subsidy_program_src_val AS subsidy_src_cd,
    ash.subsidy_program_type_id AS subsidy_id
   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_subsidy_hist ash
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core acc ON ((ash.agrmnt_id = acc.agr_cred_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_subsidy_program_type spg ON ((ash.subsidy_program_type_id = spg.subsidy_program_type_id)))
  WHERE (((spg.eks_subsidy_program_src_val = 'PROP_GRP'::text) AND (spg.subsidy_program_type_cd = ANY (ARRAY['CRED_APK'::text, 'MSP65_MER85'::text, 'MSP65_MER2018'::text, 'MSP65_MER2017'::text, 'MPT_SUB2018'::text, 'MER995'::text, 'MER_1_3'::text, 'MSP6_5'::text, 'FOND_RAZV_DVBR'::text, ''::text, 'PROGRAM_MB'::text, 'MER_582'::text, 'MER_0'::text, 'MER_2'::text]))) OR ((spg.eks_subsidy_program_src_val = 'M9_SUBS'::text) AND (spg.subsidy_program_type_cd <> ALL (ARRAY['CRED_APK'::text, 'MSP65_MER85'::text, 'MSP65_MER2018'::text, 'MSP65_MER2017'::text, 'MPT_SUB2018'::text, 'MER995'::text, 'MER_1_3'::text, 'MSP6_5'::text, 'FOND_RAZV_DVBR'::text, ''::text, 'PROGRAM_MB'::text, 'MER_582'::text, 'MER_0'::text, 'MER_2'::text]))));"
d_time_period_type," SELECT mod((1 + (da.agr_cred_id / 100)), (31537)::bigint) AS time_period_type_id,
    '?' AS time_period_type_cd,
    ' ' AS time_period_type_desc,
    0 AS unit_of_time_id,
    '-1'::integer AS unit_of_time_qty,
    0 AS month_qty,
    '1' AS rep_time_period_cd
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core da
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_time_period_type tpt ON (((
        CASE
            WHEN (mod((1 + (da.agr_cred_id / 100)), (9)::bigint) = 7) THEN (11)::bigint
            ELSE mod((1 + (da.agr_cred_id / 100)), (9)::bigint)
        END = tpt.time_period_id) AND (tpt.time_period_id = ANY (ARRAY[1, 2, 3, 4, 5, 6, 11])))))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_unit_of_time uot ON ((tpt.time_period_id = uot.unit_of_time_id)));"
d_unit_of_time," SELECT pt.period_inst_id AS unit_of_time_id,
    pt.period_inst_cd AS unit_of_time_cd,
    pt.period_inst_desc AS unit_of_time_desc
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_period_inst pt
  WHERE (pt.period_inst_type_id = '-1002'::integer)
UNION ALL
 SELECT tpt.time_period_id AS unit_of_time_id,
        CASE
            WHEN (tpt.time_period_id = '-1'::integer) THEN '?'::text
            WHEN (tpt.time_period_id = 1) THEN 'D'::text
            WHEN (tpt.time_period_id = 2) THEN 'W'::text
            WHEN (tpt.time_period_id = 3) THEN 'C'::text
            WHEN (tpt.time_period_id = 4) THEN 'M'::text
            WHEN (tpt.time_period_id = 5) THEN 'Q'::text
            WHEN (tpt.time_period_id = 6) THEN 'Y'::text
            WHEN (tpt.time_period_id = 11) THEN 'H'::text
            ELSE '!'::text
        END AS unit_of_time_cd,
    tpt.time_period_desc AS unit_of_time_desc
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_time_period_type tpt
  WHERE (((tpt.time_period_id >= '-1'::integer) AND (tpt.time_period_id <= 6)) OR (tpt.time_period_id = 11));"
d_$$cx_monitoring," SELECT t.cust_id,
    t.start_dt,
    t.end_dt,
    t.crm_mntrng_id,
    t.crm_host_mntrng_id
   FROM ( SELECT dt.id AS cust_id,
            dt.start_dt,
            dt.end_dt,
            mh.crm_mntrng_id,
            m.crm_host_mntrng_id,
            row_number() OVER (PARTITION BY dt.id, dt.start_dt ORDER BY m.crm_host_mntrng_id DESC) AS rn
           FROM (((( SELECT ""Window"".id,
                    ""Window"".start_dt,
                    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                   FROM ( SELECT dt_1.id,
                            dt_1.start_dt
                           FROM ( SELECT mh_1.cust_id AS id,
                                    mh_1.start_dt
                                   FROM s_grnplm_as_t_didsd_039_vd_dwh.""v_$crm_mntrng_hist"" mh_1
                                  WHERE (mh_1.crm_active_flag = 'Y'::text)
                                UNION ALL
                                 SELECT mh_1.cust_id AS id,
                                    (mh_1.end_dt + 1) AS start_dt
                                   FROM s_grnplm_as_t_didsd_039_vd_dwh.""v_$crm_mntrng_hist"" mh_1
                                  WHERE ((mh_1.crm_active_flag = 'Y'::text) AND (mh_1.end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT c_1.cust_id AS id,
                                    c_1.start_dt
                                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_cust_org_fin c_1
                                UNION ALL
                                 SELECT c_1.cust_id AS id,
                                    (c_1.end_dt + 1) AS start_dt
                                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_cust_org_fin c_1
                                  WHERE (c_1.end_dt <> '9999-12-31'::date)) dt_1
                          GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
             JOIN s_grnplm_as_t_didsd_039_vd_dwh.""v_$crm_mntrng_hist"" mh ON ((((mh.cust_id = dt.id) AND ((dt.start_dt >= mh.start_dt) AND (dt.start_dt <= mh.end_dt))) AND (mh.crm_active_flag = 'Y'::text))))
             JOIN s_grnplm_as_t_didsd_039_vd_dwh.""v_$crm_mntrng"" m ON ((mh.crm_mntrng_id = m.crm_mntrng_id)))
             JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_cust_org_fin c ON ((((c.cust_id = dt.id) AND ((dt.start_dt >= c.start_dt) AND (dt.start_dt <= c.end_dt))) AND (c.cust_org_prblm_grp_type_id = mh.crm_apprv_prblm_grp_type_id))))) t
  WHERE (t.rn = 1);"
d_$$s_postn," SELECT dt.start_dt,
    dt.end_dt,
    h.int_org_pty_id AS row_idid,
    p.src_pty_cd AS row_id,
    o.org_name AS name,
    prnt.relates_pty_id AS par_row_idid,
    mc.relates_pty_id AS pr_emp_idid,
    op.pty_id AS ou_ids_org_extid
   FROM ((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT o_1.org_pty_id AS id,
                            o_1.org_name_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist o_1
                          WHERE (o_1.name_type_id = 1)
                        UNION ALL
                         SELECT o_1.org_pty_id AS id,
                            (o_1.org_name_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist o_1
                          WHERE ((o_1.name_type_id = 1) AND (o_1.org_name_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT prnt_1.related_pty_id AS id,
                            prnt_1.pty_rel_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prnt_1
                          WHERE (((prnt_1.pty_rel_role_id = ANY (ARRAY['-1001'::integer, 1])) AND (prnt_1.pty_struct_type_id = '-1'::integer)) OR ((prnt_1.pty_rel_role_id = '-1017'::integer) AND (prnt_1.pty_struct_type_id = '-1007'::integer)))
                        UNION ALL
                         SELECT prnt_1.related_pty_id AS id,
                            (prnt_1.pty_rel_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prnt_1
                          WHERE ((((prnt_1.pty_rel_role_id = ANY (ARRAY['-1001'::integer, 1])) AND (prnt_1.pty_struct_type_id = '-1'::integer)) OR ((prnt_1.pty_rel_role_id = '-1017'::integer) AND (prnt_1.pty_struct_type_id = '-1007'::integer))) AND (prnt_1.pty_rel_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT org_1.related_pty_id AS id,
                                CASE m.i
                                    WHEN 1 THEN nm.org_name_start_dt
                                    WHEN 2 THEN
                                    CASE
WHEN (nm.org_name_end_dt = '9999-12-31'::date) THEN nm.org_name_end_dt
ELSE (nm.org_name_end_dt + 1)
                                    END
                                    ELSE NULL::date
                                END AS start_dt
                           FROM ((s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related org_1
                             JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist nm ON ((nm.org_pty_id = org_1.relates_pty_id)))
                             CROSS JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m)
                          WHERE ((((org_1.pty_rel_role_id = 1) AND (org_1.pty_struct_type_id = '-1'::integer)) AND (nm.name_type_id = 1)) AND ((m.i = 1) OR ((m.i = 2) AND (nm.org_name_end_dt <> '9999-12-31'::date))))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_hr_int_org h ON ((h.int_org_pty_id = dt.id)))
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty p ON ((p.pty_id = h.int_org_pty_id)))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist o ON ((((o.org_pty_id = dt.id) AND (o.name_type_id = 1)) AND ((dt.start_dt >= o.org_name_start_dt) AND (dt.start_dt <= o.org_name_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prnt ON (((((prnt.related_pty_id = dt.id) AND (prnt.pty_rel_role_id = '-1001'::integer)) AND (prnt.pty_struct_type_id = '-1'::integer)) AND ((dt.start_dt >= prnt.pty_rel_start_dt) AND (dt.start_dt <= prnt.pty_rel_end_dt)))))
     LEFT JOIN (s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related org
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty op ON ((op.pty_id = org.relates_pty_id))) ON (((((org.related_pty_id = dt.id) AND (org.pty_rel_role_id = 1)) AND (org.pty_struct_type_id = '-1'::integer)) AND ((dt.start_dt >= org.pty_rel_start_dt) AND (dt.start_dt <= org.pty_rel_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related mc ON (((((mc.related_pty_id = dt.id) AND (mc.pty_rel_role_id = '-1017'::integer)) AND (mc.pty_struct_type_id = '-1007'::integer)) AND ((dt.start_dt >= mc.pty_rel_start_dt) AND (dt.start_dt <= mc.pty_rel_end_dt)))))
  WHERE (h.hr_int_org_type_id = '-1001'::integer);"
d_cust_stts," SELECT pst.pty_id AS cust_id,
    pst.pty_stts_start_dt AS start_dt,
    pst.pty_stts_end_dt AS end_dt,
    pst.pty_stts_id AS cust_stts_type_id,
    pst.info_system_id
   FROM (s_grnplm_as_t_didsd_039_vd_dwh.v_pty_stts pst
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((pst.pty_id = cor.cust_id) AND (cor.crm_flag = 'Y'::text))))
  WHERE (pst.pty_stts_role_id = '-1002'::integer);"
d_agr_cred_int_org_uvdo," SELECT org.agr_cred_id,
    org.int_org_id,
    org.start_dt,
    org.end_dt,
    org.info_system_id
   FROM s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_int_org org
  WHERE ((1 = 1) AND (org.agr_cred_int_org_type_id = '-1005'::integer));"
d_cust_core_epk," SELECT c.cust_id,
    dc.crm_flag,
    c.host_epk_cust_id,
    c.info_system_id
   FROM ((s_grnplm_as_t_didsd_200_vd_dwh.v_cust c
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty p ON ((p.host_epk_pty_id = c.host_epk_cust_id)))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core dc ON ((p.pty_id = dc.cust_id)))
  WHERE (c.info_system_inst_cd = '000002'::text)
UNION
 SELECT c.cust_id,
    'N'::text AS crm_flag,
    c.host_epk_cust_id,
    c.info_system_id
   FROM (s_grnplm_as_t_didsd_200_vd_dwh.v_cust c
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_org_idfn_uvdo dcu ON ((dcu.host_epk_id = c.host_epk_cust_id)))
  WHERE (c.info_system_inst_cd = '000002'::text);"
d_agr_cred_mt_hst_uvdo," SELECT prd.id AS agr_cred_id,
    prd.start_dt,
    prd.end_dt,
    (h_1006.agr_cred_metric_txt)::bigint AS let_of_cred_cover_type_id,
    h_1005.agr_cred_metric_dt AS max_delay_dt,
    h_1004.agr_cred_metric_dt AS delay_dt,
    prd.info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".info_system_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt.id,
                    dt.info_system_id,
                    dt.start_dt
                   FROM ( SELECT ""v_agr_cred_metric_hist$$$"".agr_cred_id AS id,
                            ""v_agr_cred_metric_hist$$$"".info_system_id,
                            ""v_agr_cred_metric_hist$$$"".start_dt
                           FROM s_grnplm_as_t_didsd_029_vd_dwh.""v_agr_cred_metric_hist$$$""
                          WHERE (""v_agr_cred_metric_hist$$$"".agr_cred_metric_type_id = ANY (ARRAY[('-1004'::integer)::bigint, ('-1005'::integer)::bigint, ('-1006'::integer)::bigint]))
                        UNION ALL
                         SELECT ""v_agr_cred_metric_hist$$$"".agr_cred_id AS id,
                            ""v_agr_cred_metric_hist$$$"".info_system_id,
                            (""v_agr_cred_metric_hist$$$"".end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_029_vd_dwh.""v_agr_cred_metric_hist$$$""
                          WHERE ((""v_agr_cred_metric_hist$$$"".agr_cred_metric_type_id = ANY (ARRAY[('-1004'::integer)::bigint, ('-1005'::integer)::bigint, ('-1006'::integer)::bigint])) AND (""v_agr_cred_metric_hist$$$"".end_dt <> '9999-12-31'::date))) dt
                  GROUP BY dt.id, dt.info_system_id, dt.start_dt) ""Window""(id, info_system_id, start_dt)) prd
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.""v_agr_cred_metric_hist$$$"" h_1006 ON ((((h_1006.agr_cred_id = prd.id) AND ((prd.start_dt >= h_1006.start_dt) AND (prd.start_dt <= h_1006.end_dt))) AND (h_1006.agr_cred_metric_type_id = '-1006'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.""v_agr_cred_metric_hist$$$"" h_1005 ON ((((h_1005.agr_cred_id = prd.id) AND ((prd.start_dt >= h_1005.start_dt) AND (prd.start_dt <= h_1005.end_dt))) AND (h_1005.agr_cred_metric_type_id = '-1005'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.""v_agr_cred_metric_hist$$$"" h_1004 ON ((((h_1004.agr_cred_id = prd.id) AND ((prd.start_dt >= h_1004.start_dt) AND (prd.start_dt <= h_1004.end_dt))) AND (h_1004.agr_cred_metric_type_id = '-1004'::integer))));"
d_agr_cred_core_uvdo," SELECT t.agr_cred_id,
    t.info_system_id,
    t.agr_cred_type_id,
    t.host_agr_cred_id
   FROM ( SELECT t_1.agr_cred_id,
            t_1.info_system_id,
            t_1.agr_cred_type_id,
            t_1.host_agr_cred_id,
            row_number() OVER (PARTITION BY t_1.agr_cred_id ORDER BY t_1.agr_cred_type_id) AS rn
           FROM ( SELECT agr_cred.agr_cred_id,
                    agr_cred.info_system_id,
                    '-1033'::integer AS agr_cred_type_id,
                    (agr_cred.host_agr_cred_id)::text AS host_agr_cred_id
                   FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred
                     JOIN ( SELECT d_agr_cred_coa_uvdo.agr_cred_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_uvdo
                          GROUP BY d_agr_cred_coa_uvdo.agr_cred_id) flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
                UNION ALL
                 SELECT agr.agr_cred_id,
                    agr.info_system_id,
                    '-1034'::integer AS agr_cred_type_id,
                    (agr.host_agr_cred_id)::text AS host_agr_cred_id
                   FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr
                     JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type t_2 ON ((t_2.agr_cred_type_id = agr.agr_cred_type_id)))
                  WHERE (t_2.host_agr_cred_type_id = (12)::numeric)) t_1) t
  WHERE (t.rn = 1);"
d_cust_org_grp," SELECT v.related_pty_id AS cust_id,
    v.pty_rel_start_dt AS start_dt,
    v.pty_rel_end_dt AS end_dt,
    v.relates_pty_id AS crm_prnt_cust_id,
    v.info_system_id
   FROM (s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related v
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((v.related_pty_id = cor.cust_id) AND (cor.crm_flag = 'Y'::text))))
  WHERE ((v.pty_struct_type_id = '-1002'::integer) AND (v.pty_rel_role_id = 1))
UNION ALL
 SELECT ch.cust_id,
    ch.start_dt,
    ch.end_dt,
    ch.holding_cust_id AS crm_prnt_cust_id,
    ch.info_system_id
   FROM (s_grnplm_as_t_didsd_200_vd_dwh.v_cust_hier ch
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_epk cce ON ((cce.cust_id = ch.cust_id)))
  WHERE (ch.info_system_inst_cd = '000002'::text);"
d_cust_core_uvdo," SELECT cst.cust_id,
    'N' AS crm_flag,
    max(cst.info_system_id) AS info_system_id
   FROM (( SELECT cst_1.cust_id,
            cst_1.info_system_id
           FROM s_grnplm_as_t_didsd_029_vd_dwh.v_cust cst_1
        UNION ALL
         SELECT v_int_org.int_org_id AS cust_id,
            v_int_org.info_system_id
           FROM s_grnplm_as_t_didsd_029_vd_dwh.v_int_org) cst
     JOIN ( SELECT agr_cred.payer_cust_id AS cust_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
        UNION ALL
         SELECT agr_cred.bnfc_cust_id AS cust_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
        UNION ALL
         SELECT agr_cred.uvdo_benefitiary_id AS cust_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
        UNION ALL
         SELECT agr_cred.uvdo_applicant_id AS cust_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
        UNION ALL
         SELECT t1.cust_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_cust t1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo t2 ON ((t1.agr_cred_id = t2.agr_cred_id)))
          WHERE (t1.agr_cred_cust_type_id = ANY (ARRAY['-1001'::integer, '-1002'::integer, '-1003'::integer]))
        UNION ALL
         SELECT agr_cred.int_org_id AS cust_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_int_org agr_cred
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
          WHERE (agr_cred.agr_cred_int_org_type_id = ANY (ARRAY['-1002'::integer, '-1006'::integer]))) u_cc ON ((cst.cust_id = u_cc.cust_id)))
  GROUP BY cst.cust_id;"
d_cust_org_idfn_uvdo," SELECT dt.id AS cust_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(idfn.full_name, int_org.int_org_full_name) AS full_name,
    COALESCE(iforg.short_name, idfn.short_name) AS short_name,
    COALESCE(idfn.inn_num, int_org.inn_num) AS inn_num,
    idfn.kpp_num,
        CASE
            WHEN (int_org.int_org_id IS NOT NULL) THEN 'Y'::text
            ELSE COALESCE(iforg.rsd_rus_flag, idfn.rsd_rus_flag)
        END AS rsd_rus_flag,
    iforg.swift_num AS swift_cd,
    idfn.bic_num AS rcbic_cd,
    idfn.host_epk_cust_id AS host_epk_id,
    dt.info_system_id
   FROM ((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_cust_idfn.cust_id AS id,
                            v_cust_idfn.start_dt,
                            v_cust_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_029_vd_dwh.v_cust_idfn
                        UNION ALL
                         SELECT v_cust_idfn.cust_id AS id,
                            (v_cust_idfn.end_dt + 1) AS start_dt,
                            v_cust_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_029_vd_dwh.v_cust_idfn
                          WHERE (v_cust_idfn.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT v_cust_org_idfn.cust_id AS id,
                            '1900-01-01'::date AS start_dt,
                            v_cust_org_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_029_vd_dwh.v_cust_org_idfn
                        UNION ALL
                         SELECT v_int_org.int_org_id AS id,
                            '1900-01-01'::date AS start_dt,
                            v_int_org.info_system_id
                           FROM s_grnplm_as_t_didsd_029_vd_dwh.v_int_org) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_uvdo cor ON ((dt.id = cor.cust_id)))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_cust_idfn idfn ON (((idfn.cust_id = dt.id) AND ((dt.start_dt >= idfn.start_dt) AND (dt.start_dt <= idfn.end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_cust_org_idfn iforg ON ((iforg.cust_id = dt.id)))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_int_org int_org ON ((int_org.int_org_id = dt.id)));"
d_letter_of_cred_cust," SELECT prd.id AS agr_cred_id,
    prd.start_dt,
    prd.end_dt,
    t1.bnfc_cust_id,
    t1.uvdo_benefitiary_id,
    t1.payer_cust_id,
    t1.uvdo_applicant_id,
    COALESCE(t_1002.cust_id, int_org_1.int_org_id) AS beneficiary_bank_id,
    COALESCE(t_1001.cust_id, int_org.int_org_id) AS issuing_bank_id,
    t_1003.cust_id AS reimbursing_bank_id,
        CASE
            WHEN ((((atp.agr_cred_type_name = ''::text) AND (prd.optn_dt <> '9999-12-31'::date)) AND (COALESCE(prd.agr_cred_pay_role_type_id, (0)::bigint) = '-1001'::integer)) AND (prd.optn_dt <= prd.start_dt)) THEN t1.bnfc_cust_id
            WHEN ((atp.agr_cred_type_name = ''::text) AND (((prd.optn_dt = '9999-12-31'::date) OR (prd.optn_dt > prd.start_dt)) OR (COALESCE(prd.agr_cred_pay_role_type_id, (0)::bigint) <> '-1001'::integer))) THEN COALESCE(t_1001.cust_id, int_org.int_org_id)
            WHEN (atp.agr_cred_type_name <> ''::text) THEN t1.payer_cust_id
            ELSE NULL::bigint
        END AS export_spec_counterparty_id,
    t1.info_system_id
   FROM (((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".optn_dt,
            ""Window"".agr_cred_pay_role_type_id
           FROM ( SELECT dt.id,
                    dt.start_dt,
                    min(dt.optn_dt) AS optn_dt,
                    min(dt.agr_cred_pay_role_type_id) AS agr_cred_pay_role_type_id
                   FROM ( SELECT d_agr_cred_core_uvdo.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt,
                            '9999-12-31'::date AS optn_dt,
                            NULL::bigint AS agr_cred_pay_role_type_id
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo
                        UNION ALL
                         SELECT t1_1.agr_cred_id AS id,
                            t1_1.start_dt,
                            '9999-12-31'::date AS optn_dt,
                            NULL::bigint AS agr_cred_pay_role_type_id
                           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_cust t1_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo t2 ON ((t1_1.agr_cred_id = t2.agr_cred_id)))
                          WHERE (t1_1.agr_cred_cust_type_id = ANY (ARRAY['-1001'::integer, '-1002'::integer, '-1003'::integer]))
                        UNION ALL
                         SELECT t1_1.agr_cred_id AS id,
                            (t1_1.end_dt + 1) AS start_dt,
                            '9999-12-31'::date AS optn_dt,
                            NULL::bigint AS agr_cred_pay_role_type_id
                           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_cust t1_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo t2 ON ((t1_1.agr_cred_id = t2.agr_cred_id)))
                          WHERE ((t1_1.agr_cred_cust_type_id = ANY (ARRAY['-1001'::integer, '-1002'::integer, '-1003'::integer])) AND (t1_1.end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT a.agr_cred_id AS id,
                            min(o.optn_dt) AS start_dt,
                            min(o.optn_dt) AS optn_dt,
                            min(o.agr_cred_pay_role_type_id) AS agr_cred_pay_role_type_id
                           FROM ((((s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred a
                             JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type atp_1 ON (((atp_1.agr_cred_type_id = a.agr_cred_type_id) AND (atp_1.agr_cred_type_name = ''::text))))
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo t2 ON ((a.agr_cred_id = t2.agr_cred_id)))
                             JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_optn o ON ((o.agr_cred_id = a.agr_cred_id)))
                             JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_optn_type ot ON (((o.optn_type_id = ot.optn_type_id) AND (lower(ot.optn_type_cd) = 'prepayfee'::text))))
                          GROUP BY a.agr_cred_id
                        UNION ALL
                         SELECT t1_1.agr_cred_id AS id,
                            t1_1.start_dt,
                            '9999-12-31'::date AS optn_dt,
                            NULL::bigint AS agr_cred_pay_role_type_id
                           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_int_org t1_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo t2 ON ((t1_1.agr_cred_id = t2.agr_cred_id)))
                          WHERE (t1_1.agr_cred_int_org_type_id = ANY (ARRAY['-1002'::integer, '-1006'::integer]))) dt
                  GROUP BY dt.id, dt.start_dt) ""Window""(id, start_dt, optn_dt, agr_cred_pay_role_type_id)) prd
     JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred t1 ON ((prd.id = t1.agr_cred_id)))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_cust t_1001 ON (((((prd.id = t_1001.agr_cred_id) AND (prd.start_dt >= t_1001.start_dt)) AND (prd.start_dt <= t_1001.end_dt)) AND (t_1001.agr_cred_cust_type_id = '-1001'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_cust t_1002 ON (((((prd.id = t_1002.agr_cred_id) AND (prd.start_dt >= t_1002.start_dt)) AND (prd.start_dt <= t_1002.end_dt)) AND (t_1002.agr_cred_cust_type_id = '-1002'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_cust t_1003 ON (((((prd.id = t_1003.agr_cred_id) AND (prd.start_dt >= t_1003.start_dt)) AND (prd.start_dt <= t_1003.end_dt)) AND (t_1003.agr_cred_cust_type_id = '-1003'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type atp ON ((atp.agr_cred_type_id = t1.agr_cred_type_id)))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_int_org int_org ON (((((prd.id = int_org.agr_cred_id) AND (prd.start_dt >= int_org.start_dt)) AND (prd.start_dt <= int_org.end_dt)) AND (int_org.agr_cred_int_org_type_id = '-1002'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_int_org int_org_1 ON (((((prd.id = int_org_1.agr_cred_id) AND (prd.start_dt >= int_org_1.start_dt)) AND (prd.start_dt <= int_org_1.end_dt)) AND (int_org_1.agr_cred_int_org_type_id = '-1006'::integer))));"
d_int_org_mat," SELECT t.int_org_id,
    t.start_dt,
    t.end_dt,
    t.int_org_reg_bank_collat_flag,
    t.int_org_mk,
    t.int_org_bank_mk,
    t.int_org_reg_bank_mk,
    t.int_org_sbranch_mk,
    t.int_org_branch_mk,
    t.int_org_division_mk,
    t.int_org_bank_name,
    t.int_org_reg_bank_name,
    t.int_org_sbranch_name,
    t.int_org_branch_name,
    t.int_org_division_name,
    t.int_org_bank_cd,
    t.int_org_reg_bank_cd,
    t.int_org_sbranch_cd,
    t.int_org_branch_cd,
    t.int_org_division_cd,
    t.okato_cd
   FROM ( SELECT a.int_org_id,
            a.gen_start_dt AS start_dt,
            a.gen_end_dt AS end_dt,
            a.int_org_reg_bank_collat_flag,
            a.int_org_mk,
            a.int_org_bank_mk,
            a.int_org_reg_bank_mk,
            a.int_org_sbranch_mk,
            a.int_org_branch_mk,
            a.int_org_division_mk,
            a.int_org_bank_name,
            a.int_org_reg_bank_name,
            a.int_org_sbranch_name,
            a.int_org_branch_name,
            a.int_org_division_name,
            a.int_org_bank_cd,
            a.int_org_reg_bank_cd,
            a.int_org_sbranch_cd,
            a.int_org_branch_cd,
            a.int_org_division_cd,
            a.okato_cd,
            row_number() OVER (PARTITION BY a.int_org_id, a.gen_start_dt ORDER BY a.gen_end_dt DESC) AS rn
           FROM ( SELECT ioi.int_org_id,
                    ioi.int_org_reg_bank_collat_flag,
                        CASE
                            WHEN (mk.start_dt > ioi.start_dt) THEN mk.start_dt
                            ELSE (ioi.start_dt)::timestamp without time zone
                        END AS gen_start_dt,
                        CASE
                            WHEN (mk.end_dt < ioi.end_dt) THEN mk.end_dt
                            ELSE ioi.end_dt
                        END AS gen_end_dt,
                    mk.int_org_mk,
                    mk.int_org_bank_mk,
                    mk.int_org_reg_bank_mk,
                    mk.int_org_sbranch_mk,
                    mk.int_org_branch_mk,
                    mk.int_org_division_mk,
                    mk.int_org_bank_name,
                    mk.int_org_reg_bank_name,
                    mk.int_org_sbranch_name,
                    mk.int_org_branch_name,
                    mk.int_org_division_name,
                    mk.int_org_bank_cd,
                    mk.int_org_reg_bank_cd,
                    mk.int_org_sbranch_cd,
                    mk.int_org_branch_cd,
                    mk.int_org_division_cd,
                    mk.okato_cd
                   FROM (( SELECT dt.id AS int_org_id,
                            dt.start_dt,
                            dt.end_dt,
                            iog.int_org_reg_bank_collat_flag
                           FROM (( SELECT ""Window"".id,
                                    ""Window"".start_dt,
                                    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                                   FROM ( SELECT dt_1.id,
    dt_1.start_dt
   FROM ( SELECT iog_1.int_org_id AS id,
      iog_1.start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_int_org iog_1
  UNION ALL
   SELECT iog_1.int_org_id AS id,
      (iog_1.end_dt + 1) AS start_dt
     FROM s_grnplm_vd_t_bvd_db_dmslcl.d_int_org iog_1
    WHERE (iog_1.end_dt <> '9999-12-31'::date)) dt_1
  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
                             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_int_org iog ON (((dt.id = iog.int_org_id) AND ((dt.start_dt >= iog.start_dt) AND (dt.start_dt <= iog.end_dt)))))) ioi
                     LEFT JOIN ( SELECT dt.mk AS int_org_mk,
                            dt.start_dt,
                            dt.end_dt,
                            x.tgt_id AS int_org_id,
                            m.mk_10_bank AS int_org_bank_mk,
                            m.mk_20_reg_bank AS int_org_reg_bank_mk,
                            m.mk_30_sbranch AS int_org_sbranch_mk,
                            m.mk_40_branch AS int_org_branch_mk,
                            m.mk_50_division AS int_org_division_mk,
                            m.nm_10_bank AS int_org_bank_name,
                            m.nm_20_reg_bank AS int_org_reg_bank_name,
                            m.nm_30_sbranch AS int_org_sbranch_name,
                            m.nm_40_branch AS int_org_branch_name,
                            m.nm_50_division AS int_org_division_name,
                            m.code_10_bank AS int_org_bank_cd,
                            m.code_20_reg_bank AS int_org_reg_bank_cd,
                            m.code_30_sbranch AS int_org_sbranch_cd,
                            m.code_40_branch AS int_org_branch_cd,
                            m.code_50_division AS int_org_division_cd,
                            m._okato_50_division AS okato_cd
                           FROM ((( SELECT ""Window"".mk,
                                    ""Window"".start_dt,
                                    COALESCE(((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".mk ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING))::date - 1), '9999-12-31'::date) AS end_dt
                                   FROM ( SELECT dt_1.mk,
    dt_1.start_dt
   FROM ( SELECT x_1.mk,
      x_1.start_dt
     FROM s_grnplm_as_t_didsd_vd_rdm.int_org_xref_v x_1
  UNION ALL
   SELECT x_1.mk,
      (x_1.end_dt + '1 day'::interval) AS start_dt
     FROM s_grnplm_as_t_didsd_vd_rdm.int_org_xref_v x_1
    WHERE (x_1.end_dt <> '9999-12-31'::date)
  UNION ALL
   SELECT m_1.mk_link AS mk,
      m_1.start_dt
     FROM s_grnplm_as_t_didsd_vd_rdm.int_org_mat_v m_1
    WHERE (m_1.hscn_id = 1)
  UNION ALL
   SELECT m_1.mk_link AS mk,
      (m_1.end_dt + '1 day'::interval) AS start_dt
     FROM s_grnplm_as_t_didsd_vd_rdm.int_org_mat_v m_1
    WHERE ((m_1.end_dt <> '9999-12-31'::date) AND (m_1.hscn_id = 1))) dt_1
  GROUP BY dt_1.mk, dt_1.start_dt) ""Window""(mk, start_dt)) dt
                             LEFT JOIN s_grnplm_as_t_didsd_vd_rdm.int_org_xref_v x ON (((dt.mk = x.mk) AND ((dt.start_dt >= x.start_dt) AND (dt.start_dt <= x.end_dt)))))
                             LEFT JOIN s_grnplm_as_t_didsd_vd_rdm.int_org_mat_v m ON ((((dt.mk = m.mk_link) AND (m.hscn_id = 1)) AND ((dt.start_dt >= m.start_dt) AND (dt.start_dt <= m.end_dt)))))) mk ON ((ioi.int_org_id = mk.int_org_id)))) a) t
  WHERE (t.rn = 1);"
d_cust_used," SELECT cor.cust_id,
        CASE cus.org_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS org_flag,
        CASE cus.ind_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS ind_flag,
    cus.src_pty_cd AS host_cust_id,
    hci.src_pty_cd AS host_crm_id,
    e2c.code AS crm_cust_id,
    cor.crm_flag,
        CASE
            WHEN (b.bus_cat_id = '-1001'::integer) THEN 'Y'::text
            ELSE 'N'::text
        END AS bank_flag,
    ind.birth_dt,
    cor.info_system_id,
    cus.host_epk_pty_id AS host_epk_id
   FROM (((((s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty cus ON ((cor.cust_id = cus.pty_id)))
     LEFT JOIN ( SELECT t.related_pty_id,
            t.src_pty_cd
           FROM ( SELECT pr.related_pty_id,
                    p.src_pty_cd,
                    row_number() OVER (PARTITION BY pr.related_pty_id ORDER BY pr.pty_rel_start_dt DESC, p.src_pty_cd) AS rn
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_pty_related pr
                     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty p ON ((p.pty_id = pr.relates_pty_id)))
                  WHERE (pr.pty_rel_role_id = '-1026'::integer)) t
          WHERE (t.rn = 1)) hci ON ((cor.cust_id = hci.related_pty_id)))
     LEFT JOIN s_grnplm_as_t_didsd_vd_rdm.rdm_cust_eks2crm_mast_v e2c ON (((e2c.eks_pty_id = cus.pty_id) AND ((('now'::text)::date >= e2c.start_dt) AND (('now'::text)::date <= e2c.end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_bus b ON ((cor.cust_id = b.ext_org_pty_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_individ ind ON ((cor.cust_id = ind.individ_pty_id)))
  WHERE (cor.crm_flag = 'N'::text)
UNION ALL
 SELECT pty.pty_id AS cust_id,
        CASE pty.org_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS org_flag,
        CASE pty.ind_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS ind_flag,
    pty.src_pty_cd AS host_cust_id,
    NULL::text AS host_crm_id,
    NULL::text AS crm_cust_id,
    'N'::text AS crm_flag,
    NULL::text AS bank_flag,
    NULL::date AS birth_dt,
    pty.info_system_id,
    pty.host_epk_pty_id AS host_epk_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty pty
  WHERE ((pty.info_system_id = 0) AND (pty.pty_id = '-1'::integer))
UNION ALL
 SELECT pty.pty_id AS cust_id,
        CASE pty.org_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS org_flag,
        CASE pty.ind_ind
            WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
            ELSE NULL::text
        END AS ind_flag,
    pty.src_pty_cd AS host_cust_id,
    NULL::text AS host_crm_id,
    NULL::text AS crm_cust_id,
    'Y'::text AS crm_flag,
    NULL::text AS bank_flag,
    NULL::date AS birth_dt,
    pty.info_system_id,
    NULL::text AS host_epk_id
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty ON ((cor.cust_id = pty.pty_id)))
  WHERE ((pty.org_ind = 'YES'::text) AND (cor.crm_flag = 'Y'::text))
UNION ALL
 SELECT cst.cust_id,
    'Y'::text AS org_flag,
    NULL::text AS ind_flag,
    (cst.host_cust_id)::text AS host_cust_id,
    cst.host_crm_cust_id AS host_crm_id,
    NULL::text AS crm_cust_id,
    NULL::text AS crm_flag,
    NULL::text AS bank_flag,
    NULL::date AS birth_dt,
    cst.info_system_id,
    cst_idfn.host_epk_cust_id AS host_epk_id
   FROM ((s_grnplm_as_t_didsd_029_vd_dwh.v_cust cst
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_uvdo u_cc ON ((cst.cust_id = u_cc.cust_id)))
     LEFT JOIN ( SELECT v_cust_idfn.cust_id,
            v_cust_idfn.host_epk_cust_id
           FROM ( SELECT v_cust_idfn_1.cust_id,
                    v_cust_idfn_1.host_epk_cust_id,
                    row_number() OVER (PARTITION BY v_cust_idfn_1.cust_id ORDER BY v_cust_idfn_1.start_dt DESC) AS rn
                   FROM s_grnplm_as_t_didsd_029_vd_dwh.v_cust_idfn v_cust_idfn_1) v_cust_idfn
          WHERE (v_cust_idfn.rn = 1)) cst_idfn ON ((cst_idfn.cust_id = cst.cust_id)))
UNION ALL
 SELECT cst.int_org_id AS cust_id,
    'Y'::text AS org_flag,
    NULL::text AS ind_flag,
    NULL::text AS host_cust_id,
    NULL::text AS host_crm_id,
    NULL::text AS crm_cust_id,
    NULL::text AS crm_flag,
    'Y'::text AS bank_flag,
    NULL::date AS birth_dt,
    cst.info_system_id,
    NULL::text AS host_epk_id
   FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_int_org cst
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_uvdo u_cc ON ((cst.int_org_id = u_cc.cust_id)))
UNION ALL
 SELECT cor.cust_id,
    c.org_flag,
    c.ind_flag,
    c.host_epk_cust_id AS host_cust_id,
    css.host_cust_cd AS host_crm_id,
    NULL::text AS crm_cust_id,
    NULL::text AS crm_flag,
    c.fin_inst_flag AS bank_flag,
    c.birth_dt,
    cor.info_system_id,
    cor.host_epk_cust_id AS host_epk_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_epk cor
     JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cust c ON (((c.cust_id = cor.cust_id) AND (c.info_system_inst_cd = '000002'::text))))
     LEFT JOIN ( SELECT t.cust_id,
            t.host_cust_cd
           FROM ( SELECT css_1.cust_id,
                    css_1.host_cust_cd,
                    css_1.start_dt,
                    row_number() OVER (PARTITION BY css_1.cust_id ORDER BY css_1.start_dt DESC) AS rn
                   FROM ( SELECT css_2.cust_id,
                            css_2.host_cust_cd,
                            css_2.start_dt
                           FROM (s_grnplm_as_t_didsd_200_vd_dwh.v_cust_src_system_type css_2
                             JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_src_system_type sst ON (((sst.src_system_type_id = css_2.src_system_type_id) AND (sst.info_system_inst_cd = '000002'::text))))
                          WHERE (((1 = 1) AND (css_2.info_system_inst_cd = '000002'::text)) AND (sst.src_system_type_name = 'CRM '::text))) css_1) t
          WHERE (t.rn = 1)) css ON ((cor.cust_id = css.cust_id)));"
d_cust_ind_idfn," SELECT idfn.pty_id AS cust_id,
    idfn.pty_idfn_start_dt AS start_dt,
    idfn.pty_idfn_end_dt AS end_dt,
    idfn.pty_idfn_val AS doc_num,
    idfn.pty_id_receipt_dt AS doc_issue_dt,
    idfn.pty_idfn_type_id AS cust_ind_doc_type_id,
    idfn.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn idfn
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((idfn.pty_id = cor.cust_id) AND (cor.crm_flag = 'N'::text))))
  WHERE ((idfn.pty_id_categ_id = 1) AND (mod(idfn.pty_idfn_type_id, 100) = 12));"
d_$vd_grntee," SELECT rpt.stf_val_dt AS report_dt,
    val.stf_cell_no_val AS cell_a,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK56'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_str_val
            ELSE NULL::text
        END) AS host_agr_cred_id,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK03'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_value_name
            ELSE NULL::text
        END) AS prod_name,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK09'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_str_val
            ELSE NULL::text
        END) AS principal_name,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK10'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_str_val
            ELSE NULL::text
        END) AS inn_num,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK052'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_attr0_val
            ELSE NULL::text
        END) AS oksm_num,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK45_1'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_value_name
            ELSE NULL::text
        END) AS principal_fin_pos,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK45_2'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_value_name
            ELSE NULL::text
        END) AS principal_cred_class,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK07'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_str_val
            ELSE NULL::text
        END) AS beneficiary_name,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK17'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_str_val
            ELSE NULL::text
        END) AS agr_cred_num,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK18'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_dt
            ELSE NULL::date
        END) AS open_dt,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK22'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_dt
            ELSE NULL::date
        END) AS close_dt,
    (max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK16_1'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_num_val
            ELSE NULL::numeric
        END))::numeric(38,12) AS grntee_amt,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK25'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_code_name
            ELSE NULL::text
        END) AS issue_crncy_cd,
    (max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK27'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_num_val
            ELSE NULL::numeric
        END))::numeric(38,12) AS grntee_rub,
    (max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK47'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_num_val
            ELSE NULL::numeric
        END))::numeric(38,12) AS prvsn_grntee_rub,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK049'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_code_name
            ELSE NULL::text
        END) AS agr_qlty_cat_type_cd,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK53'::text) AND (cell.stf_cell_type_cd = 'DICT'::text)) THEN dval.stf_value_name
            ELSE NULL::text
        END) AS prvsn_port_flag,
    max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK54'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_str_val
            ELSE NULL::text
        END) AS coa_num,
    (max(
        CASE
            WHEN ((val.stf_cell_ext_id_cd = 'DB1_POK55'::text) AND (cell.stf_cell_type_cd = 'INPUT'::text)) THEN val.stf_cell_num_val
            ELSE NULL::numeric
        END))::numeric(38,12) AS cor_prvsn_grntee_rub,
    f.info_system_id
   FROM ((((s_grnplm_as_t_didsd_068_vd_dwh.""v_$stf_forms"" f
     JOIN s_grnplm_as_t_didsd_068_vd_dwh.""v_$stf_rpt_insts"" rpt ON ((f.stf_form_id = rpt.stf_form_id)))
     JOIN s_grnplm_as_t_didsd_068_vd_dwh.""v_$stf_form_cells"" cell ON (((f.stf_form_id = cell.stf_form_id) AND (rpt.stf_ver_val = cell.stf_ver_val))))
     JOIN s_grnplm_as_t_didsd_068_vd_dwh.""v_$stf_rpt_cells"" val ON (((rpt.stf_rpt_insts_id = val.stf_rpt_insts_id) AND (cell.stf_ext_id_cd = val.stf_cell_ext_id_cd))))
     LEFT JOIN s_grnplm_as_t_didsd_068_vd_dwh.""v_$stf_dict_vals"" dval ON (((val.stf_cell_num_val = (dval.stf_val_id)::numeric) AND (cell.stf_dict_names_id = dval.stf_dict_names_id))))
  WHERE ((((1 = 1) AND (rpt.stf_ready_to_use_flag = 'Y'::text)) AND (f.stf_ext_id_cd = 'F2_1'::text)) AND (rpt.stf_int_org_id = ( SELECT org.int_org_id
           FROM s_grnplm_as_t_didsd_068_vd_dwh.v_int_org org
          WHERE (org.int_org_num = '0999100'::text))))
  GROUP BY rpt.stf_val_dt, val.stf_cell_no_val, f.info_system_id;"
d_agr_cred_coa_tmp_stg," SELECT 1 AS a
   FROM ((((((((((((((s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg_prep stg
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp act)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr_cor)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_coa set_coa_in)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_stg acopt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port acport)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa ac_grp_coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp_coa p2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp p2a)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa"" ae2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_coa a2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct glm)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa_3"" ae3c)
  WHERE ((1 = 0) AND (a2c.agrmnt_gl_acct_start_dt > ('now'::text)::date));"
d_agr_cred_prod," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    type1.agrmnt_class_val_id AS eks_a_f26_prod_id,
    type2.agrmnt_class_val_id AS eks_b_f26_prod_id,
    ect.agrmnt_class_val_id AS eks_a_f26_agr_cred_type_id,
    aph.prod_id AS grntee_prod_id,
    ap.prod_id AS crm_prod_id,
    a269.appl_num,
        CASE
            WHEN (atp2.agrmnt_id IS NOT NULL) THEN 'Y'::text
            ELSE 'N'::text
        END AS sbol_flag,
    cor.info_system_id
   FROM ((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT v_agmt_agmt_class_assoc.agrmnt_id AS id,
                            v_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
                          WHERE (v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY['-1024'::integer, '-1025'::integer, '-1022'::integer]))
                        UNION ALL
                         SELECT v_agmt_agmt_class_assoc.agrmnt_id,
                            (v_agmt_agmt_class_assoc.agrmnt_class_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
                          WHERE ((v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY['-1024'::integer, '-1025'::integer, '-1022'::integer])) AND (v_agmt_agmt_class_assoc.agrmnt_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_acct_prod_hist.agrmnt_id,
                            '1900-01-01'::date AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_prod_hist
                          WHERE (v_acct_prod_hist.agrmnt_prod_role_id = '-1001'::integer)
                        UNION ALL
                         SELECT dt_2.agrmnt_id,
                                CASE
                                    WHEN (m.i = 1) THEN dt_2.gen_start_dt
                                    WHEN ((m.i = 2) AND (dt_2.gen_end_dt = '9999-12-31'::date)) THEN dt_2.gen_end_dt
                                    ELSE (dt_2.gen_end_dt + 1)
                                END AS start_dt
                           FROM (( SELECT aa_1.agrmnt_id,
CASE
 WHEN (aa_1.agmt_to_appl_start_dt > ap_1.appl_prod_start_dt) THEN aa_1.agmt_to_appl_start_dt
 ELSE ap_1.appl_prod_start_dt
END AS gen_start_dt,
CASE
 WHEN (aa_1.agmt_to_appl_end_dt < ap_1.appl_prod_end_dt) THEN aa_1.agmt_to_appl_end_dt
 ELSE ap_1.appl_prod_end_dt
END AS gen_end_dt
                                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl aa_1
                                     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_appl_prod ap_1 ON ((((ap_1.appl_id = aa_1.appl_id) AND (ap_1.appl_prod_role_id = '-1002'::integer)) AND (aa_1.agrmnt_appl_role_id = '-1004'::integer))))
                                  WHERE (
CASE
 WHEN (aa_1.agmt_to_appl_start_dt > ap_1.appl_prod_start_dt) THEN aa_1.agmt_to_appl_start_dt
 ELSE ap_1.appl_prod_start_dt
END <=
CASE
 WHEN (aa_1.agmt_to_appl_end_dt < ap_1.appl_prod_end_dt) THEN aa_1.agmt_to_appl_end_dt
 ELSE ap_1.appl_prod_end_dt
END)
                                UNION
                                 SELECT atp2_1.agrmnt_id,
                                    atp2_1.agmt_to_appl_start_dt,
                                    atp2_1.agmt_to_appl_end_dt
                                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl atp2_1
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_appl ap2 ON ((((ap2.appl_id = atp2_1.appl_id) AND (ap2.chnl_type_id = 1121)) AND (atp2_1.agrmnt_id <> '-1'::integer))))) dt_2
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (dt_2.gen_end_dt <> '9999-12-31'::date)))))
                        UNION ALL
                         SELECT a.agrmnt_id,
                            '1900-01-01'::date AS start_dt
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl a
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_appl v ON ((a.appl_id = v.appl_id)))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt g ON (((a.agrmnt_id = g.agrmnt_id) AND (g.fin_agrmnt_type_id <> '-1006'::integer))))
                          WHERE ((((a.agrmnt_appl_role_id = '-1001'::integer) AND (a.agmt_to_appl_end_dt = '9999-12-31'::date)) AND (a.appl_id <> '-1'::integer)) AND (v.appl_num IS NOT NULL))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = dt.id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc type1 ON (((((type1.agrmnt_id = dt.id) AND (dt.start_dt >= type1.agrmnt_class_start_dt)) AND (dt.start_dt <= type1.agrmnt_class_end_dt)) AND (type1.agrmnt_clsfctn_id = '-1024'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc type2 ON (((((type2.agrmnt_id = dt.id) AND (dt.start_dt >= type2.agrmnt_class_start_dt)) AND (dt.start_dt <= type2.agrmnt_class_end_dt)) AND (type2.agrmnt_clsfctn_id = '-1025'::integer))))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc ect
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ect_vl ON ((((ect.agrmnt_class_val_id = ect_vl.agrmnt_class_val_id) AND (ect.agrmnt_clsfctn_id = '-1022'::integer)) AND (ect_vl.agrmnt_clsfctn_id = '-1022'::integer)))) ON ((((ect.agrmnt_id = dt.id) AND (dt.start_dt >= ect.agrmnt_class_start_dt)) AND (dt.start_dt <= ect.agrmnt_class_end_dt))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_prod_hist aph ON (((aph.agrmnt_id = dt.id) AND (aph.agrmnt_prod_role_id = '-1001'::integer))))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl aa
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_appl_prod ap ON ((((ap.appl_id = aa.appl_id) AND (ap.appl_prod_role_id = '-1002'::integer)) AND (aa.agrmnt_appl_role_id = '-1004'::integer)))) ON ((((((aa.agrmnt_id = dt.id) AND (dt.start_dt >= aa.agmt_to_appl_start_dt)) AND (dt.start_dt <= aa.agmt_to_appl_end_dt)) AND (dt.start_dt >= ap.appl_prod_start_dt)) AND (dt.start_dt <= ap.appl_prod_end_dt))))
     LEFT JOIN ( SELECT a.agrmnt_id,
            v.appl_num
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl a
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_appl v ON ((a.appl_id = v.appl_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt g ON (((a.agrmnt_id = g.agrmnt_id) AND (g.fin_agrmnt_type_id <> '-1006'::integer))))
          WHERE ((((a.agrmnt_appl_role_id = '-1001'::integer) AND (a.agmt_to_appl_end_dt = '9999-12-31'::date)) AND (a.appl_id <> '-1'::integer)) AND (v.appl_num IS NOT NULL))) a269 ON ((a269.agrmnt_id = dt.id)))
     LEFT JOIN ( SELECT atp2_1.agrmnt_id,
            atp2_1.agmt_to_appl_start_dt,
            atp2_1.agmt_to_appl_end_dt
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl atp2_1
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_appl ap2 ON ((((ap2.appl_id = atp2_1.appl_id) AND (ap2.chnl_type_id = 1121)) AND (atp2_1.agrmnt_id <> '-1'::integer))))) atp2 ON ((((atp2.agrmnt_id = dt.id) AND (dt.start_dt >= atp2.agmt_to_appl_start_dt)) AND (dt.start_dt <= atp2.agmt_to_appl_end_dt))));"
d_grntee_pl_pm_cond_per," SELECT ap.agrmnt_id AS agr_cred_id,
    ap.acct_pymnt_option_start_dt AS start_dt,
    '9999-12-31'::date AS end_dt,
    ap.acct_pymnt_option_amt_start_dt AS plan_pymnt_cond_start_dt,
    ap.acct_pymnt_option_amt_end_dt AS plan_pymnt_cond_end_dt,
    ap.acct_pymnt_due_day_num AS due_day_num,
    ap.acct_pymnt_calc_type_id AS plan_pymnt_type_id,
        CASE
            WHEN (ap.acct_pymnt_calc_type_id <> '-1001'::integer) THEN (ap.acct_pymnt_time_period_cd)::integer
            ELSE '-1'::integer
        END AS periodic_pymnt_unit_of_time_id,
    ap.pymnt_day_working_flag AS last_day_working_flag,
    ap.acct_pymnt_option_rate AS plan_pymnt_rate,
    ap.acct_pymnt_option_amt AS plan_pymnt_crncy_amt,
    ap.acct_pymnt_option_amt_crncy_id AS crncy_id,
    ap.pymnt_cat_id AS plan_pymnt_optn_type_id,
        CASE
            WHEN (ap.eks_acct_pymnt_kind_id <> '-1'::integer) THEN 'Y'::text
            ELSE 'N'::text
        END AS intrst_pymnt_flag,
        CASE
            WHEN (ap.eks_acct_pymnt_kind_id = '-1004'::integer) THEN 'Y'::text
            ELSE 'N'::text
        END AS annual_intrst_pymnt_flag,
    ap.pymnt_delay_time_period_qty AS delay_days_cnt,
    ap.pymnt_delay_day_working_flag AS delay_working_flag,
    ap.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option ap
  WHERE (ap.pymnt_option_id = '-1005'::integer)
UNION ALL
 SELECT cur_rate.agrmnt_id AS agr_cred_id,
    '1900-01-01'::date AS start_dt,
    '9999-12-31'::date AS end_dt,
    cur_rate.acct_rate_start_dt AS plan_pymnt_cond_start_dt,
    cur_rate.acct_rate_end_dt AS plan_pymnt_cond_end_dt,
    NULL::integer AS due_day_num,
    NULL::bigint AS plan_pymnt_type_id,
    NULL::integer AS periodic_pymnt_unit_of_time_id,
    NULL::text AS last_day_working_flag,
    cur_rate.acct_rate AS plan_pymnt_rate,
    NULL::numeric(28,6) AS plan_pymnt_crncy_amt,
    NULL::bigint AS crncy_id,
    cur_rate.fin_meas_id AS plan_pymnt_optn_type_id,
    'Y'::text AS intrst_pymnt_flag,
    'Y'::text AS annual_intrst_pymnt_flag,
    NULL::numeric AS delay_days_cnt,
    NULL::text AS delay_working_flag,
    cur_rate.info_system_id
   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate.fin_meas_id) AND (lower(meas_cur_rate.fin_meas_name) = lower('    '::text)))))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_info_system i ON ((((i.info_system_id = cur_rate.info_system_id) AND (i.info_system_type_cd = '010'::text)) AND (i.info_system_inst_cd = '910002'::text))))
  WHERE ((((((cur_rate.bal_cat_type_id = '-1'::integer) AND (cur_rate.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate.intrst_rate_type_id = '-1'::integer)) AND (cur_rate.term_compliance_type_id = '-1'::integer)) AND (cur_rate.intrst_calc_type_id = '-1'::integer)) AND (cur_rate.acct_rate_time_period_id = '-1'::integer));"
d_early_plan_pymnt_cond," SELECT v_acct_pymnt_option.agrmnt_id AS agr_cred_id,
    v_acct_pymnt_option.acct_pymnt_option_amt_start_dt AS plan_pymnt_cond_start_dt,
    v_acct_pymnt_option.acct_pymnt_option_rate AS plan_pymnt_rate,
    v_acct_pymnt_option.acct_pymnt_option_min_amt AS fine_min_rub,
    v_acct_pymnt_option.acct_pymnt_option_max_amt AS fine_max_rub,
    v_acct_pymnt_option.pymnt_delay_time_period_qty AS delay_days_cnt,
    v_acct_pymnt_option.pymnt_day_working_flag AS delay_working_flag,
    v_acct_pymnt_option.eks_acct_pymnt_kind_id AS fraction_cond_type_id,
    v_acct_pymnt_option.acct_pymnt_calc_type_id AS plan_pymnt_type_id,
    v_acct_pymnt_option.acct_pymnt_option_start_dt AS start_dt,
    v_acct_pymnt_option.acct_pymnt_option_end_dt AS end_dt,
    v_acct_pymnt_option.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option
  WHERE ((v_acct_pymnt_option.pymnt_cat_id = '-1006'::integer) AND (v_acct_pymnt_option.agrmnt_id IN ( SELECT d_agr_cred_core.agr_cred_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core)));"
d_agr_cred_coa_tmp," SELECT 1 AS a
   FROM (((((((((((((((s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg stg
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp act)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr_cor)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_coa set_coa_in)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg set_coa_a2c_stg)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn acopt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port acport)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa ac_grp_coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp_coa p2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp p2a)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa"" ae2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_coa a2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct glm)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa_3"" ae3c)
  WHERE ((1 = 0) AND (a2c.agrmnt_gl_acct_start_dt > ('now'::text)::date));"
d_agr_collat_coa," SELECT dt.id AS agr_collat_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(a2c_corr.coa_id, eatc.coa_id) AS coa_id,
    coa.crncy_id,
    coa.coa_num,
    agr.info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT eatc_1.agrmnt_id AS id,
                            eatc_1.agrmnt_gl_acct_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa"" eatc_1
                          WHERE (eatc_1.coa_to_agrmnt_role_id = '-1019'::integer)
                        UNION ALL
                         SELECT eatc_1.agrmnt_id AS id,
                            (eatc_1.agrmnt_gl_acct_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa"" eatc_1
                          WHERE ((eatc_1.coa_to_agrmnt_role_id = '-1019'::integer) AND (eatc_1.agrmnt_gl_acct_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat agr ON ((dt.id = agr.agr_collat_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg a2c_corr ON ((((a2c_corr.host_agr_cred_id = agr.host_agr_collat_id) AND (dt.start_dt >= a2c_corr.start_dt)) AND (dt.start_dt <= a2c_corr.end_dt))))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa"" eatc
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa ON (((coa.coa_id = eatc.coa_id) AND (eatc.coa_to_agrmnt_role_id = '-1019'::integer)))) ON ((((dt.id = eatc.agrmnt_id) AND (dt.start_dt >= eatc.agrmnt_gl_acct_start_dt)) AND (dt.start_dt <= eatc.agrmnt_gl_acct_end_dt))));"
d_agr_cred_plan_optn_param," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    tpt.time_period_type_id AS debt_time_period_type_id,
    tpt2.time_period_type_id AS intrst_time_period_type_id,
    dt.info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT apo_1.agrmnt_id AS id,
                                CASE
                                    WHEN (m.i = 1) THEN apo_1.acct_pymnt_option_start_dt
                                    WHEN (m.i = 2) THEN (apo_1.acct_pymnt_option_end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt,
                            apo_1.info_system_id
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option apo_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_time_period_type tpt_1 ON (((apo_1.acct_pymnt_time_period_cd = tpt_1.unit_of_time_id) AND (apo_1.acct_pymnt_time_period_qty = (tpt_1.unit_of_time_qty)::numeric))))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (apo_1.acct_pymnt_option_end_dt <> '9999-12-31'::date)))))
                          WHERE (((apo_1.pymnt_cat_id = ANY (ARRAY[('-1002'::integer)::bigint, ('-1004'::integer)::bigint])) AND (apo_1.pymnt_option_id = 1)) AND (apo_1.acct_pymnt_option_id = '-1'::integer))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((dt.id = cor.agr_cred_id)))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option apo
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_time_period_type tpt ON ((((((apo.acct_pymnt_time_period_cd = tpt.unit_of_time_id) AND (apo.acct_pymnt_time_period_qty = (tpt.unit_of_time_qty)::numeric)) AND (apo.pymnt_cat_id = '-1002'::integer)) AND (apo.pymnt_option_id = 1)) AND (apo.acct_pymnt_option_id = '-1'::integer)))) ON ((((dt.id = apo.agrmnt_id) AND (dt.start_dt >= apo.acct_pymnt_option_start_dt)) AND (dt.start_dt <= apo.acct_pymnt_option_end_dt))))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option apo2
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_time_period_type tpt2 ON ((((((apo2.acct_pymnt_time_period_cd = tpt2.unit_of_time_id) AND (apo2.acct_pymnt_time_period_qty = (tpt2.unit_of_time_qty)::numeric)) AND (apo2.pymnt_cat_id = '-1004'::integer)) AND (apo2.pymnt_option_id = 1)) AND (apo2.acct_pymnt_option_id = '-1'::integer)))) ON ((((dt.id = apo2.agrmnt_id) AND (dt.start_dt >= apo2.acct_pymnt_option_start_dt)) AND (dt.start_dt <= apo2.acct_pymnt_option_end_dt))));"
d_agr_cred_coa," SELECT 1 AS a
   FROM ((((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum a2c
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp prnt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_tmp coa_tmp)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port acp)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prvsn acpr)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c2ar)
  WHERE (1 = 0);"
d_plan_pymnt_cond," SELECT v_acct_pymnt_option.agrmnt_id AS agr_cred_id,
    v_acct_pymnt_option.acct_pymnt_option_amt_start_dt AS plan_pymnt_cond_start_dt,
    v_acct_pymnt_option.acct_pymnt_option_amt_end_dt AS plan_pymnt_cond_end_dt,
    v_acct_pymnt_option.acct_pymnt_due_dt AS plan_pymnt_dt,
    v_acct_pymnt_option.acct_pymnt_option_amt AS plan_pymnt_crncy_amt,
    v_acct_pymnt_option.acct_pymnt_option_amt_crncy_id AS crncy_id,
    v_acct_pymnt_option.eks_acct_pymnt_num_val AS plan_pymnt_num_val,
    v_acct_pymnt_option.eks_acct_pymnt_den_val AS plan_pymnt_den_val,
    v_acct_pymnt_option.acct_pymnt_time_period_qty AS period_unit_of_time_qty,
    v_acct_pymnt_option.acct_pymnt_time_period_cd AS period_unit_of_time_id,
    v_acct_pymnt_option.pymnt_cat_id AS plan_pymnt_optn_type_id,
    v_acct_pymnt_option.pymnt_option_id AS plan_pymnt_cond_type_id,
    v_acct_pymnt_option.eks_acct_pymnt_kind_id AS fraction_cond_type_id,
    v_acct_pymnt_option.acct_pymnt_calc_type_id AS plan_pymnt_type_id,
    v_acct_pymnt_option.acct_pymnt_option_start_dt AS start_dt,
    v_acct_pymnt_option.acct_pymnt_option_end_dt AS end_dt,
    v_acct_pymnt_option.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option
  WHERE (((v_acct_pymnt_option.pymnt_option_id = '-1001'::integer) AND (v_acct_pymnt_option.pymnt_cat_id = '-1002'::integer)) AND (v_acct_pymnt_option.agrmnt_id IN ( SELECT d_agr_cred_core.agr_cred_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core)))
UNION ALL
 SELECT apo.agrmnt_id AS agr_cred_id,
    apo.acct_pymnt_option_amt_start_dt AS plan_pymnt_cond_start_dt,
    apo.acct_pymnt_option_amt_end_dt AS plan_pymnt_cond_end_dt,
    apo.acct_pymnt_due_dt AS plan_pymnt_dt,
    apo.acct_pymnt_option_amt AS plan_pymnt_crncy_amt,
    apo.acct_pymnt_option_amt_crncy_id AS crncy_id,
    apo.eks_acct_pymnt_num_val AS plan_pymnt_num_val,
    apo.eks_acct_pymnt_den_val AS plan_pymnt_den_val,
    apo.acct_pymnt_time_period_qty AS period_unit_of_time_qty,
    apo.acct_pymnt_time_period_cd AS period_unit_of_time_id,
    apo.pymnt_cat_id AS plan_pymnt_optn_type_id,
    apo.pymnt_option_id AS plan_pymnt_cond_type_id,
    apo.eks_acct_pymnt_kind_id AS fraction_cond_type_id,
    apo.acct_pymnt_calc_type_id AS plan_pymnt_type_id,
    apo.acct_pymnt_option_start_dt AS start_dt,
    apo.acct_pymnt_option_end_dt AS end_dt,
    apo.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option apo
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pymnt_cat pc ON ((apo.pymnt_cat_id = pc.pymnt_cat_id)))
  WHERE ((((1 = 1) AND (apo.pymnt_option_id = '-1004'::integer)) AND (upper(pc.pymnt_cat_desc) = ' '::text)) AND (apo.agrmnt_id IN ( SELECT d_agr_cred_core.agr_cred_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core)));"
d_agr_cred_int_org," SELECT d_agr_cred_int_org_tmp.agr_cred_id,
    d_agr_cred_int_org_tmp.start_dt,
    d_agr_cred_int_org_tmp.end_dt,
    d_agr_cred_int_org_tmp.srv_int_org_id,
    d_agr_cred_int_org_tmp.bal_int_org_id,
    d_agr_cred_int_org_tmp.info_system_id,
    d_agr_cred_int_org_tmp.kf_flag,
    d_agr_cred_int_org_tmp.mmb_flag
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org_tmp
UNION ALL
 SELECT t2.agr_cred_id,
    t1.coa_int_org_start_dt AS start_dt,
    t1.coa_int_org_end_dt AS end_dt,
    t1.coa_int_org_pty_id AS srv_int_org_id,
    t3.gl_int_org_pty_id AS bal_int_org_id,
    t2.info_system_id,
    NULL::text AS kf_flag,
    NULL::text AS mmb_flag
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core t2
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref t1 ON ((t1.coa_id = t2.coa_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa t3 ON ((t2.coa_id = t3.coa_id)))
  WHERE (t1.coa_int_org_type_id = '-1001'::integer);"
d_agr_cred_coa_stg," SELECT 1 AS a
   FROM ((((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum_stg a2c
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp prnt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_tmp_stg coa_tmp)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port acp)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prvsn acpr)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c2ar)
  WHERE (1 = 0);"
d_coa," SELECT c.gl_main_acct_id AS coa_n_id
   FROM (( SELECT d_agr_cred_coa_old.coa_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_old
          GROUP BY d_agr_cred_coa_old.coa_id
        UNION ALL
         SELECT d_agr_cred_coa_arc.coa_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_arc
          GROUP BY d_agr_cred_coa_arc.coa_id
        UNION ALL
         SELECT d_agr_cred_coa.coa_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa
          GROUP BY d_agr_cred_coa.coa_id
        UNION ALL
         SELECT d_coa_cred_coa.coa_id AS coa_n_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_coa
          GROUP BY d_coa_cred_coa.coa_id
        UNION ALL
         SELECT d_agr_cred_coa_uvdo.coa_id AS coa_n_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_uvdo
          GROUP BY d_agr_cred_coa_uvdo.coa_id) ac
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c ON ((c.coa_id = ac.coa_id)))
  GROUP BY c.gl_main_acct_id;"
d_plan_pymnt_optn_type_s," SELECT pc.pymnt_cat_id AS plan_pymnt_optn_type_id,
    pc.pymnt_cat_cd AS plan_pymnt_optn_type_cd,
    pc.pymnt_cat_desc AS plan_pymnt_optn_type_name,
    pc.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pymnt_cat pc
  WHERE ((pc.pymnt_cat_id = '-1002'::integer) OR (pc.pymnt_cat_desc = ' '::text))
UNION ALL
 SELECT pc.pymnt_cat_id AS plan_pymnt_optn_type_id,
    pc.pymnt_cat_cd AS plan_pymnt_optn_type_cd,
    pc.pymnt_cat_desc AS plan_pymnt_optn_type_name,
    pc.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_pymnt_cat pc
     JOIN ( SELECT v_acct_pymnt_option.pymnt_cat_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option
          WHERE (v_acct_pymnt_option.pymnt_option_id = ANY (ARRAY['-1002'::integer, '-1003'::integer, '-1005'::integer]))
          GROUP BY v_acct_pymnt_option.pymnt_cat_id) po ON ((pc.pymnt_cat_id = po.pymnt_cat_id)))
UNION ALL
 SELECT fm.fin_meas_id AS plan_pymnt_optn_type_id,
    fm.fin_meas_cd AS plan_pymnt_optn_type_cd,
    fm.fin_meas_name AS plan_pymnt_optn_type_name,
    fm.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas fm
     JOIN ( SELECT v_tariff_agrmnt.fin_meas_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_tariff_agrmnt
          GROUP BY v_tariff_agrmnt.fin_meas_id) t ON ((t.fin_meas_id = fm.fin_meas_id)))
UNION ALL
 SELECT fm.fin_meas_id AS plan_pymnt_optn_type_id,
    fm.fin_meas_cd AS plan_pymnt_optn_type_cd,
    fm.fin_meas_name AS plan_pymnt_optn_type_name,
    fm.info_system_id
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas fm
  WHERE (fm.fin_meas_cd = '__'::text);"
d_agr_cred_rate_tmp," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(cur_rate.acct_rate, cur_rate_prnt.acct_rate) AS acct_rate,
        CASE
            WHEN (cur_rate.acct_rate IS NULL) THEN 'Y'::text
            ELSE 'N'::text
        END AS prnt_current_rate_flag,
        CASE
            WHEN ((comp_rate1.acct_rate IS NULL) AND (comp_rate2.acct_rate IS NULL)) THEN
            CASE
                WHEN ((prnt_comp_rate1.acct_rate IS NULL) AND (prnt_comp_rate2.acct_rate IS NULL)) THEN NULL::numeric(15,12)
                ELSE (COALESCE(prnt_comp_rate1.acct_rate, (0)::numeric) + COALESCE(prnt_comp_rate2.acct_rate, (0)::numeric))
            END
            ELSE (COALESCE(comp_rate1.acct_rate, (0)::numeric) + COALESCE(comp_rate2.acct_rate, (0)::numeric))
        END AS agr_cred_compens_rate,
        CASE
            WHEN ((defer_rate1.acct_rate IS NULL) AND (defer_rate2.acct_rate IS NULL)) THEN
            CASE
                WHEN ((prnt_defer_rate1.acct_rate IS NULL) AND (prnt_defer_rate2.acct_rate IS NULL)) THEN NULL::numeric(15,12)
                ELSE (COALESCE(prnt_defer_rate1.acct_rate, (0)::numeric) + COALESCE(prnt_defer_rate2.acct_rate, (0)::numeric))
            END
            ELSE (COALESCE(defer_rate1.acct_rate, (0)::numeric) + COALESCE(defer_rate2.acct_rate, (0)::numeric))
        END AS agr_cred_deferral_rate,
    comp_rate1.acct_rate AS comp_rate1,
    comp_rate2.acct_rate AS comp_rate2,
    prnt_comp_rate1.acct_rate AS prnt_comp_rate1,
    prnt_comp_rate2.acct_rate AS prnt_comp_rate2,
    defer_rate1.acct_rate AS defer_rate1,
    defer_rate2.acct_rate AS defer_rate2,
    prnt_defer_rate1.acct_rate AS prnt_defer_rate1,
    prnt_defer_rate2.acct_rate AS prnt_defer_rate2,
    cur_rate_prnt.acct_rate AS prnt_cur_rate,
    cur_rate.acct_rate AS cur_rate
   FROM ((((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT rat.agrmnt_id AS id,
                            rat.acct_rate_start_dt AS start_dt
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate rat
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas ON ((meas.fin_meas_id = rat.fin_meas_id)))
                          WHERE (((((((rat.bal_cat_type_id = '-1'::integer) AND (rat.intrst_calc_rule_type_id = '-1'::integer)) AND (rat.intrst_rate_type_id = '-1'::integer)) AND (rat.term_compliance_type_id = '-1'::integer)) AND (rat.intrst_calc_type_id = '-1'::integer)) AND (rat.acct_rate_time_period_id = '-1'::integer)) AND (meas.fin_meas_cd = ANY (ARRAY['__'::text, '___'::text, '_'::text, '__N'::text, '__'::text])))
                        UNION ALL
                         SELECT rat.agrmnt_id AS id,
                            (rat.acct_rate_end_dt + 1) AS start_dt
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate rat
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas ON ((meas.fin_meas_id = rat.fin_meas_id)))
                          WHERE ((((((((rat.bal_cat_type_id = '-1'::integer) AND (rat.intrst_calc_rule_type_id = '-1'::integer)) AND (rat.intrst_rate_type_id = '-1'::integer)) AND (rat.term_compliance_type_id = '-1'::integer)) AND (rat.intrst_calc_type_id = '-1'::integer)) AND (rat.acct_rate_time_period_id = '-1'::integer)) AND (meas.fin_meas_cd = ANY (ARRAY['__'::text, '___'::text, '_'::text, '__N'::text, '__'::text]))) AND (rat.acct_rate_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT t.agr_cred_id AS id,
                            rat.acct_rate_start_dt AS start_dt
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate rat
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((rat.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas ON ((meas.fin_meas_id = rat.fin_meas_id)))
                          WHERE (((((((rat.bal_cat_type_id = '-1'::integer) AND (rat.intrst_calc_rule_type_id = '-1'::integer)) AND (rat.intrst_rate_type_id = '-1'::integer)) AND (rat.term_compliance_type_id = '-1'::integer)) AND (rat.intrst_calc_type_id = '-1'::integer)) AND (rat.acct_rate_time_period_id = '-1'::integer)) AND (meas.fin_meas_cd = ANY (ARRAY['__'::text, '___'::text, '_'::text, '__N'::text, '__'::text])))
                        UNION ALL
                         SELECT t.agr_cred_id AS id,
                            (rat.acct_rate_end_dt + 1) AS start_dt
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate rat
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((rat.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas ON ((meas.fin_meas_id = rat.fin_meas_id)))
                          WHERE ((((((((rat.bal_cat_type_id = '-1'::integer) AND (rat.intrst_calc_rule_type_id = '-1'::integer)) AND (rat.intrst_rate_type_id = '-1'::integer)) AND (rat.term_compliance_type_id = '-1'::integer)) AND (rat.intrst_calc_type_id = '-1'::integer)) AND (rat.acct_rate_time_period_id = '-1'::integer)) AND (meas.fin_meas_cd = ANY (ARRAY['__'::text, '___'::text, '_'::text, '__N'::text, '__'::text]))) AND (rat.acct_rate_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     LEFT JOIN ( SELECT cur_rate_1.agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '_'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) cur_rate ON ((((dt.id = cur_rate.agrmnt_id) AND (dt.start_dt >= cur_rate.acct_rate_start_dt)) AND (dt.start_dt <= cur_rate.acct_rate_end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id AS agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((cur_rate_1.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '_'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) cur_rate_prnt ON ((((dt.id = cur_rate_prnt.agrmnt_id) AND (dt.start_dt >= cur_rate_prnt.acct_rate_start_dt)) AND (dt.start_dt <= cur_rate_prnt.acct_rate_end_dt))))
     LEFT JOIN ( SELECT cur_rate_1.agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '__'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) defer_rate1 ON ((((dt.id = defer_rate1.agrmnt_id) AND (dt.start_dt >= defer_rate1.acct_rate_start_dt)) AND (dt.start_dt <= defer_rate1.acct_rate_end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id AS agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((cur_rate_1.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '__'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) prnt_defer_rate1 ON ((((dt.id = prnt_defer_rate1.agrmnt_id) AND (dt.start_dt >= prnt_defer_rate1.acct_rate_start_dt)) AND (dt.start_dt <= prnt_defer_rate1.acct_rate_end_dt))))
     LEFT JOIN ( SELECT cur_rate_1.agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '__N'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) defer_rate2 ON ((((dt.id = defer_rate2.agrmnt_id) AND (dt.start_dt >= defer_rate2.acct_rate_start_dt)) AND (dt.start_dt <= defer_rate2.acct_rate_end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id AS agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((cur_rate_1.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '__N'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) prnt_defer_rate2 ON ((((dt.id = prnt_defer_rate2.agrmnt_id) AND (dt.start_dt >= prnt_defer_rate2.acct_rate_start_dt)) AND (dt.start_dt <= prnt_defer_rate2.acct_rate_end_dt))))
     LEFT JOIN ( SELECT cur_rate_1.agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '___'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) comp_rate1 ON ((((dt.id = comp_rate1.agrmnt_id) AND (dt.start_dt >= comp_rate1.acct_rate_start_dt)) AND (dt.start_dt <= comp_rate1.acct_rate_end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id AS agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((cur_rate_1.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '___'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) prnt_comp_rate1 ON ((((dt.id = prnt_comp_rate1.agrmnt_id) AND (dt.start_dt >= prnt_comp_rate1.acct_rate_start_dt)) AND (dt.start_dt <= prnt_comp_rate1.acct_rate_end_dt))))
     LEFT JOIN ( SELECT cur_rate_1.agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '__'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) comp_rate2 ON ((((dt.id = comp_rate2.agrmnt_id) AND (dt.start_dt >= comp_rate2.acct_rate_start_dt)) AND (dt.start_dt <= comp_rate2.acct_rate_end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id AS agrmnt_id,
            cur_rate_1.acct_rate_start_dt,
            cur_rate_1.acct_rate_end_dt,
            cur_rate_1.acct_rate
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate cur_rate_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp t ON (((cur_rate_1.agrmnt_id = t.prnt_agr_cred_id) AND (t.prnt_agr_cred_id <> t.agr_cred_id))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas meas_cur_rate ON (((meas_cur_rate.fin_meas_id = cur_rate_1.fin_meas_id) AND (meas_cur_rate.fin_meas_cd = '__'::text))))
          WHERE ((((((cur_rate_1.bal_cat_type_id = '-1'::integer) AND (cur_rate_1.intrst_calc_rule_type_id = '-1'::integer)) AND (cur_rate_1.intrst_rate_type_id = '-1'::integer)) AND (cur_rate_1.term_compliance_type_id = '-1'::integer)) AND (cur_rate_1.intrst_calc_type_id = '-1'::integer)) AND (cur_rate_1.acct_rate_time_period_id = '-1'::integer))) prnt_comp_rate2 ON ((((dt.id = prnt_comp_rate2.agrmnt_id) AND (dt.start_dt >= prnt_comp_rate2.acct_rate_start_dt)) AND (dt.start_dt <= prnt_comp_rate2.acct_rate_end_dt))));"
d_coa_cred_coa," SELECT 1 AS a
   FROM ((((s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg stg
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c2ar)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct glm)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa_3"" ae3c)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa ac_grp_coa)
  WHERE (1 = 0);"
d_agr_cred_coa_cess," SELECT t.agr_cred_id,
    min(
        CASE
            WHEN (t.agr_coa_start_dt >= t.coa_start_dt) THEN t.agr_coa_start_dt
            ELSE t.coa_start_dt
        END) AS start_dt,
    max(
        CASE
            WHEN (t.agr_coa_end_dt >= t.coa_end_dt) THEN (t.coa_end_dt)::timestamp without time zone
            ELSE t.agr_coa_end_dt
        END) AS end_dt,
    t.info_system_id
   FROM ( SELECT c.agr_cred_id,
                CASE
                    WHEN (c.start_dt <= '2019-01-01'::date) THEN '2019-01-01'::date
                    ELSE c.start_dt
                END AS agr_coa_start_dt,
            c.end_dt AS agr_coa_end_dt,
            c.info_system_id,
            ac.coa_start_dt,
            ac.coa_end_dt
           FROM (( SELECT d_agr_cred_coa.agr_cred_id,
                    d_agr_cred_coa.coa_id,
                        CASE
                            WHEN (d_agr_cred_coa.start_dt <= t2.arc_date) THEN t2.arc_date
                            ELSE d_agr_cred_coa.start_dt
                        END AS start_dt,
                    d_agr_cred_coa.end_dt,
                    d_agr_cred_coa.info_system_id
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa
                     CROSS JOIN ( SELECT (meta_dm_param.param_val)::date AS arc_date
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
                          WHERE (meta_dm_param.param_cd = 'D_AGR_CRED_COA_ARC_DATE'::text)) t2)
                  WHERE ((d_agr_cred_coa.end_dt >= t2.arc_date) AND (substr(d_agr_cred_coa.meas_cd, 1, 6) = 'AGRA_L'::text))
                UNION ALL
                 SELECT d_agr_cred_coa_arc.agr_cred_id,
                    d_agr_cred_coa_arc.coa_id,
                        CASE
                            WHEN (d_agr_cred_coa_arc.start_dt <= '2019-01-01'::date) THEN '2019-01-01'::date
                            ELSE d_agr_cred_coa_arc.start_dt
                        END AS start_dt,
                        CASE
                            WHEN (d_agr_cred_coa_arc.end_dt > t2.arc_date) THEN (t2.arc_date - '1 day'::interval day)
                            ELSE (d_agr_cred_coa_arc.end_dt)::timestamp without time zone
                        END AS end_dt,
                    d_agr_cred_coa_arc.info_system_id
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_arc
                     CROSS JOIN ( SELECT (meta_dm_param.param_val)::date AS arc_date
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.meta_dm_param
                          WHERE (meta_dm_param.param_cd = 'D_AGR_CRED_COA_ARC_DATE'::text)) t2)
                  WHERE (((d_agr_cred_coa_arc.end_dt >= '2019-01-01'::date) AND (d_agr_cred_coa_arc.start_dt < t2.arc_date)) AND (substr(d_agr_cred_coa_arc.meas_cd, 1, 6) = 'AGRA_L'::text))
                UNION ALL
                 SELECT d_agr_cred_coa_old.agr_cred_id,
                    d_agr_cred_coa_old.coa_id,
                    d_agr_cred_coa_old.start_dt,
                        CASE
                            WHEN (d_agr_cred_coa_old.end_dt < '2019-01-01'::date) THEN d_agr_cred_coa_old.end_dt
                            ELSE ('2019-01-01'::date - 1)
                        END AS end_dt,
                    d_agr_cred_coa_old.info_system_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_old
                  WHERE ((d_agr_cred_coa_old.start_dt < '2019-01-01'::date) AND (substr(d_agr_cred_coa_old.meas_cd, 1, 6) = 'AGRA_L'::text))) c
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa ac ON ((c.coa_id = ac.coa_id)))
          WHERE (((1 = 1) AND ((ac.coa_num ~~ '478%'::text) OR (substr(ac.coa_num, 1, 5) = ANY (ARRAY['44111'::text, '44211'::text, '44311'::text, '44411'::text, '44511'::text, '44611'::text, '44711'::text, '44811'::text, '44911'::text, '45011'::text, '45111'::text, '45211'::text, '45311'::text, '45411'::text, '45611'::text])))) AND (c.start_dt <= c.end_dt))) t
  GROUP BY t.agr_cred_id, t.info_system_id;"
d_agr_cred_coa_old," SELECT 1 AS a
   FROM ((((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_sum a2c
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp prnt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_coa_old_tmp coa_tmp)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port acp)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prvsn acpr)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c2ar)
  WHERE (1 = 0);"
d_agr_cred_coa_old_tmp," SELECT 1 AS a
   FROM (((((((((((((((s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg stg
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp act)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr_cor)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_coa_old set_coa_in)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_a2c_stg set_coa_a2c_stg)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn acopt)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port acport)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_acct_grp_coa ac_grp_coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp_coa p2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp p2a)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa"" ae2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_coa a2c)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct glm)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa_3"" ae3c)
  WHERE ((1 = 0) AND (a2c.agrmnt_gl_acct_start_dt > ('now'::text)::date));"
d_agr_cred_coa_uvdo," SELECT 1 AS a
   FROM (((((s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred a
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct t)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_coa_uvdo st)
     CROSS JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_coa c1)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa_bal_trnovr gl)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c2)
  WHERE (1 = 0);"
d_agr_cred_covid_recovery_dt," SELECT 1 AS a
   FROM ((((((((((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist t1
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp_int t2)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist t3)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp_int t4)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_evt t5)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt t6)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_evt t7)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type_fin_meas t8)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type t9)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pymnt_cat t10)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_pymnt_option t11)
  WHERE (1 = 0);"
d_coa_cred_core," SELECT t.agr_cred_id,
    t.coa_id,
    t.info_system_id,
        CASE
            WHEN (org.org_num ~~ '0000-84-18-02%'::text) THEN '-1035'::integer
            ELSE
            CASE
                WHEN (t.uvdo_flag = 1) THEN '-1037'::integer
                ELSE '-1036'::integer
            END
        END AS agr_cred_type_id,
    t.subject_area_type_id
   FROM ((( SELECT d_coa_cred_coa.agr_cred_id,
            d_coa_cred_coa.coa_id,
            d_coa_cred_coa.info_system_id,
            d_coa_cred_coa.subject_area_type_id,
            min(d_coa_cred_coa.uvdo_flag) AS uvdo_flag
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_coa
          GROUP BY d_coa_cred_coa.agr_cred_id, d_coa_cred_coa.coa_id, d_coa_cred_coa.info_system_id, d_coa_cred_coa.subject_area_type_id) t
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa ON ((t.coa_id = coa.coa_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_inst_int_org org ON ((coa.gl_int_org_pty_id = org.int_org_pty_id)));"
d_agr_cred_optn_je_tmp," SELECT aco.evt_id AS agr_cred_optn_id,
    jeh.je_header_id AS eks_je_header_id,
    jeh.je_header_val_dt AS optn_bal_dt,
    jeh.dbt_coa_num AS debt_coa_num,
    jeh.crd_coa_num AS cred_coa_num,
    jeh.dbt_je_line_coa_id AS debt_coa_id,
    jeh.crd_je_line_coa_id AS cred_coa_id,
    jeh.optn_bal_rub
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_evt aco
     LEFT JOIN ( SELECT e2j.evt_id,
            max(e2j.je_header_id) AS je_header_id,
            max(jeh_1.je_header_val_dt) AS je_header_val_dt,
            max(
                CASE
                    WHEN (jel.je_line_cred_ind = 'NO'::text) THEN jel.je_line_coa_id
                    ELSE NULL::bigint
                END) AS dbt_je_line_coa_id,
            max(
                CASE
                    WHEN (jel.je_line_cred_ind = 'YES'::text) THEN jel.je_line_coa_id
                    ELSE NULL::bigint
                END) AS crd_je_line_coa_id,
            max(
                CASE
                    WHEN (jel.je_line_cred_ind = 'NO'::text) THEN coa.coa_num
                    ELSE NULL::text
                END) AS dbt_coa_num,
            max(
                CASE
                    WHEN (jel.je_line_cred_ind = 'YES'::text) THEN coa.coa_num
                    ELSE NULL::text
                END) AS crd_coa_num,
            max(jel.je_line_local_amt) AS optn_bal_rub
           FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_je_header e2j
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_je_header jeh_1 ON ((jeh_1.je_header_id = e2j.je_header_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_je_line jel ON ((jel.je_header_id = e2j.je_header_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa ON ((coa.coa_id = jel.je_line_coa_id)))
          WHERE ((e2j.fin_evt_je_hdr_role_type_id = '-1001'::integer) AND (e2j.je_header_id <> '-1'::integer))
          GROUP BY e2j.evt_id) jeh ON ((aco.evt_id = jeh.evt_id)));"
d_acct_grp_coa," SELECT 1 AS a
   FROM (((((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp p
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp_hist t)
     CROSS JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_coa st)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct gl)
     CROSS JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp_coa grp_coa)
  WHERE (1 = 0);"
d_$crm_gsz," SELECT pty.pty_id AS crm_gsz_id,
    dt.start_dt,
    COALESCE((max(dt.start_dt) OVER (PARTITION BY prd.related_pty_id ORDER BY dt.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    pty.src_pty_cd AS crm_host_gsz_id,
    h.org_name AS crm_gsz_name,
    ps.pty_stts_id AS crm_gsz_stts_type_id,
    COALESCE(prdp.relates_pty_id, ('-1'::integer)::bigint) AS crm_prnt_gsz_id,
    '-1'::integer AS crm_high_gsz_id,
    0 AS crm_gsz_hlvl_id,
    pty.info_system_id
   FROM (((((((( SELECT dt_1.id,
            dt_1.start_dt
           FROM ( SELECT prd_1.related_pty_id AS id,
                    prd_1.pty_rel_start_dt AS start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prd_1
                  WHERE ((prd_1.pty_rel_role_id = '-1004'::integer) AND (prd_1.pty_struct_type_id = '-1003'::integer))
                UNION ALL
                 SELECT prd_1.related_pty_id,
                    (prd_1.pty_rel_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prd_1
                  WHERE (((prd_1.pty_rel_end_dt <> '9999-12-31'::date) AND (prd_1.pty_rel_role_id = '-1004'::integer)) AND (prd_1.pty_struct_type_id = '-1003'::integer))
                UNION ALL
                 SELECT prd_1.related_pty_id AS id,
                    prd_1.pty_rel_start_dt AS start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prd_1
                  WHERE ((prd_1.pty_rel_role_id = 1) AND (prd_1.pty_struct_type_id = '-1003'::integer))
                UNION ALL
                 SELECT prd_1.related_pty_id,
                    (prd_1.pty_rel_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prd_1
                  WHERE (((prd_1.pty_rel_end_dt <> '9999-12-31'::date) AND (prd_1.pty_rel_role_id = 1)) AND (prd_1.pty_struct_type_id = '-1003'::integer))
                UNION ALL
                 SELECT h_1.org_pty_id,
                    h_1.org_name_start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist h_1
                  WHERE (h_1.name_type_id = 1)
                UNION ALL
                 SELECT h_1.org_pty_id,
                    (h_1.org_name_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist h_1
                  WHERE ((h_1.org_name_end_dt <> '9999-12-31'::date) AND (h_1.name_type_id = 1))
                UNION ALL
                 SELECT ps_1.pty_id,
                    ps_1.pty_stts_start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_stts ps_1
                  WHERE (ps_1.pty_stts_role_id = '-1001'::integer)
                UNION ALL
                 SELECT ps_1.pty_id,
                    (ps_1.pty_stts_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_stts ps_1
                  WHERE ((ps_1.pty_stts_end_dt <> '9999-12-31'::date) AND (ps_1.pty_stts_role_id = '-1001'::integer))) dt_1
          GROUP BY dt_1.id, dt_1.start_dt) dt
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_assoc a ON ((a.assoc_pty_id = dt.id)))
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty ON ((pty.pty_id = a.assoc_pty_id)))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_info_systems_crm sys ON ((sys.info_system_id = pty.info_system_id)))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prd ON ((((((dt.start_dt >= prd.pty_rel_start_dt) AND (dt.start_dt <= prd.pty_rel_end_dt)) AND (prd.related_pty_id = dt.id)) AND (prd.pty_rel_role_id = '-1004'::integer)) AND (prd.pty_struct_type_id = '-1003'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related prdp ON (((((prdp.related_pty_id = prd.related_pty_id) AND ((dt.start_dt >= prdp.pty_rel_start_dt) AND (dt.start_dt <= prdp.pty_rel_end_dt))) AND (prdp.pty_rel_role_id = 1)) AND (prdp.pty_struct_type_id = '-1003'::integer))))
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist h ON ((((h.org_pty_id = dt.id) AND ((dt.start_dt >= h.org_name_start_dt) AND (dt.start_dt <= h.org_name_end_dt))) AND (h.name_type_id = 1))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_stts ps ON ((((ps.pty_id = dt.id) AND ((dt.start_dt >= ps.pty_stts_start_dt) AND (dt.start_dt <= ps.pty_stts_end_dt))) AND (ps.pty_stts_role_id = '-1001'::integer))))
  WHERE (a.assoc_type_id = '-1001'::integer);"
d_cust_core," SELECT cust.cust_id,
    max(cust.crm_flag) AS crm_flag,
    max(cust.info_system_id) AS info_system_id
   FROM ( SELECT a2p.pty_id AS cust_id,
            'N'::text AS crm_flag,
            max(p.info_system_id) AS info_system_id
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_pty p
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_info_system sys ON ((((sys.info_system_id = p.info_system_id) AND (sys.info_system_type_cd = '010'::text)) AND (sys.info_system_inst_cd = ANY (ARRAY['910001'::text, '910002'::text])))))
             JOIN ( SELECT a2p_1.pty_id
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_pty a2p_1
                     JOIN ( SELECT cor_1.agr_cred_id
                           FROM ( SELECT d_agr_cred_core.agr_cred_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core
                                UNION ALL
                                 SELECT d_agr_cession.agr_cession_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cession
                                UNION ALL
                                 SELECT d_agr_collat.agr_collat_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat) cor_1
                          GROUP BY cor_1.agr_cred_id) cor ON ((a2p_1.agrmnt_id = cor.agr_cred_id)))
                  WHERE (a2p_1.agrmnt_pty_role_id = ANY (ARRAY[1, '-1009'::integer, '-1010'::integer, '-1001'::integer]))) a2p ON ((a2p.pty_id = p.pty_id)))
          GROUP BY a2p.pty_id
        UNION ALL
         SELECT pty.pty_id AS ""pty_id$cust_id"",
            'Y'::text AS crm_flag,
            pty.info_system_id
           FROM (((s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty
             JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_ext_org eorg ON (((eorg.ext_org_pty_id = pty.pty_id) AND (eorg.ext_org_type_id IS NULL))))
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_info_systems_crm sys ON ((sys.info_system_id = pty.info_system_id)))
             LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related ptr ON (((ptr.relates_pty_id = pty.pty_id) AND (ptr.pty_rel_role_id = '-1007'::integer))))
          WHERE ((pty.org_ind = 'YES'::text) AND (ptr.relates_pty_id IS NULL))
        UNION ALL
         SELECT h.pty_id AS id,
            'N'::text AS crm_flag,
            max(h.info_system_id) AS info_system_id
           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_coa_pty_hist h
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core t ON ((h.coa_id = t.coa_id)))
          WHERE (h.coa_pty_role_id = ANY (ARRAY['-1001'::integer, '-1003'::integer]))
          GROUP BY h.pty_id, 'N'::text) cust
  GROUP BY cust.cust_id;"
d_cust_grp_clsfctn," SELECT a.assoc_pty_id AS cust_grp_id,
    dt.start_dt,
    dt.end_dt,
    ot.pty_class_val_id AS crm_cust_grp_sctr_type_id,
    o.pty_class_val_id AS crm_cust_risk_sgmnt_type_id,
    h.pty_metric_dt AS crm_risk_sgmnt_dt,
    a.info_system_id
   FROM (((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT pca.pty_id AS id,
                            pca.pty_class_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc pca
                          WHERE (pca.pty_clsfctn_id = ANY (ARRAY[8, '-1032'::integer]))
                        UNION ALL
                         SELECT pca.pty_id,
                            (pca.pty_class_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc pca
                          WHERE ((pca.pty_class_end_dt <> '9999-12-31'::date) AND (pca.pty_clsfctn_id = ANY (ARRAY[8, '-1032'::integer])))
                        UNION ALL
                         SELECT h_1.pty_id,
                            h_1.pty_metric_start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_metric_hist h_1
                          WHERE (h_1.pty_metric_type_id = '-1020'::integer)
                        UNION ALL
                         SELECT h_1.pty_id,
                            (h_1.pty_metric_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_metric_hist h_1
                          WHERE ((h_1.pty_metric_end_dt <> '9999-12-31'::date) AND (h_1.pty_metric_type_id = '-1020'::integer))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_assoc a ON ((a.assoc_pty_id = dt.id)))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_info_systems_crm sys ON ((sys.info_system_id = a.info_system_id)))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ot ON ((((ot.pty_id = dt.id) AND ((dt.start_dt >= ot.pty_class_start_dt) AND (dt.start_dt <= ot.pty_class_end_dt))) AND (ot.pty_clsfctn_id = 8))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc o ON ((((o.pty_id = dt.id) AND ((dt.start_dt >= o.pty_class_start_dt) AND (dt.start_dt <= o.pty_class_end_dt))) AND (o.pty_clsfctn_id = '-1032'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_metric_hist h ON ((((h.pty_id = dt.id) AND ((dt.start_dt >= h.pty_metric_start_dt) AND (dt.start_dt <= h.pty_metric_end_dt))) AND (h.pty_metric_type_id = '-1020'::integer))))
  WHERE (a.assoc_type_id = '-1002'::integer);"
d_cust_org_clsfctn," SELECT dt.id AS cust_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(sme_s.sme_type_id, ('-1'::integer)::bigint) AS sme_type_id,
    src.pty_multi_val_id AS prim_okved_id,
    ('-1'::integer)::bigint AS cust_org_sgmnt_type_id,
    NULL::bigint AS crm_cust_org_accsr_type_id,
    NULL::bigint AS crm_cust_prb_zone_type_id,
    NULL::bigint AS crm_cust_risk_sgmnt_type_id,
    NULL::bigint AS crm_cust_coop_type_id,
    NULL::text AS crm_cust_coop_flag,
    NULL::date AS crm_card_create_dt,
    NULL::date AS crm_risk_sgmnt_dt,
    NULL::bigint AS crm_cust_org_sctr_type_id,
    NULL::bigint AS crm_cust_org_subs_type_id,
    dt.info_system_id,
    (COALESCE(NULL::integer, '-1'::integer))::bigint AS crm_gsz_id,
    (COALESCE(NULL::integer, '-1'::integer))::bigint AS crm_high_gsz_id,
    (COALESCE(NULL::integer, '-1'::integer))::bigint AS cust_org_bus_type_id,
    (COALESCE(NULL::integer, '-1'::integer))::bigint AS cust_org_sctr_type_id
   FROM (((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_pty_pty_class_assoc.pty_id AS id,
                            v_pty_pty_class_assoc.pty_class_start_dt AS start_dt,
                            v_pty_pty_class_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc
                          WHERE (v_pty_pty_class_assoc.pty_clsfctn_id = 6)
                        UNION ALL
                         SELECT v_pty_pty_class_assoc.pty_id AS id,
                            (v_pty_pty_class_assoc.pty_class_end_dt + 1) AS start_dt,
                            v_pty_pty_class_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc
                          WHERE ((v_pty_pty_class_assoc.pty_clsfctn_id = 6) AND (v_pty_pty_class_assoc.pty_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_pty_multi_assoc.pty_id,
                            v_pty_multi_assoc.pty_multi_assoc_start_dt AS start_dt,
                            v_pty_multi_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_multi_assoc
                          WHERE (v_pty_multi_assoc.pty_multi_scheme_id = '-1001'::integer)
                        UNION ALL
                         SELECT v_pty_multi_assoc.pty_id,
                            (v_pty_multi_assoc.pty_multi_assoc_end_dt + 1) AS start_dt,
                            v_pty_multi_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_multi_assoc
                          WHERE ((v_pty_multi_assoc.pty_multi_scheme_id = '-1001'::integer) AND (v_pty_multi_assoc.pty_multi_assoc_end_dt <> '9999-12-31'::date))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((dt.id = cor.cust_id) AND (cor.crm_flag = 'N'::text))))
     LEFT JOIN ( SELECT a.pty_id,
            a.pty_class_val_id,
            a.pty_class_start_dt,
            LEAST(a.pty_class_end_dt, COALESCE((max(a.pty_class_start_dt) OVER (PARTITION BY a.pty_id ORDER BY a.pty_class_end_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), a.pty_class_end_dt)) AS pty_class_end_dt
           FROM ( SELECT a_1.pty_id,
                    a_1.pty_class_val_id,
                    a_1.pty_class_start_dt,
                    a_1.pty_class_end_dt,
                    a_1.rn,
                    COALESCE(max(a_1.pty_class_end_dt) OVER (PARTITION BY a_1.pty_id ORDER BY a_1.pty_class_start_dt ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING), '1900-01-01'::date) AS pty_class_end_dt_max
                   FROM ( SELECT p.pty_id,
                            p.pty_class_val_id,
                            p.pty_class_start_dt,
                            p.pty_class_end_dt,
                            row_number() OVER (PARTITION BY p.pty_id, p.pty_class_start_dt ORDER BY p.pty_class_end_dt DESC) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc p
                          WHERE (p.pty_clsfctn_id = 6)) a_1
                  WHERE (a_1.rn = 1)) a
          WHERE (a.pty_class_end_dt > a.pty_class_end_dt_max)) sme_ass ON (((sme_ass.pty_id = dt.id) AND ((dt.start_dt >= sme_ass.pty_class_start_dt) AND (dt.start_dt <= sme_ass.pty_class_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_class_val sme_val ON (((sme_val.pty_clsfctn_id = 6) AND (sme_val.pty_class_val_id = sme_ass.pty_class_val_id))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_sme_type_s sme_s ON ((sme_s.f26_sme_type_cd = substr(sme_val.pty_class_val_cd, 1, 1))))
     LEFT JOIN ( SELECT t.id,
            t.start_dt,
            t.end_dt,
            t.pty_multi_val_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    dt_1.end_dt,
                    d.pty_multi_val_id,
                    row_number() OVER (PARTITION BY dt_1.id, dt_1.start_dt ORDER BY
                        CASE
                            WHEN (d.pty_multi_primary_ind = 'YES'::text) THEN 0
                            ELSE 1
                        END, d.pty_multi_val_id DESC) AS rn
                   FROM (( SELECT ""Window"".id,
                            ""Window"".start_dt,
                            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                           FROM ( SELECT dt_2.id,
                                    dt_2.start_dt
                                   FROM ( SELECT v_pty_multi_assoc.pty_id AS id,
    v_pty_multi_assoc.pty_multi_assoc_start_dt AS start_dt
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_multi_assoc
  WHERE (v_pty_multi_assoc.pty_multi_scheme_id = '-1001'::integer)
UNION ALL
 SELECT v_pty_multi_assoc.pty_id,
    (v_pty_multi_assoc.pty_multi_assoc_end_dt + 1) AS start_dt
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_multi_assoc
  WHERE ((v_pty_multi_assoc.pty_multi_scheme_id = '-1001'::integer) AND (v_pty_multi_assoc.pty_multi_assoc_end_dt <> '9999-12-31'::date))) dt_2
                                  GROUP BY dt_2.id, dt_2.start_dt) ""Window""(id, start_dt)) dt_1
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_multi_assoc d ON (((d.pty_id = dt_1.id) AND ((dt_1.start_dt >= d.pty_multi_assoc_start_dt) AND (dt_1.start_dt <= d.pty_multi_assoc_end_dt)))))
                  WHERE (d.pty_multi_scheme_id = '-1001'::integer)) t
          WHERE (t.rn = 1)) src ON (((dt.id = src.id) AND ((dt.start_dt >= src.start_dt) AND (dt.start_dt <= src.end_dt)))))
UNION ALL
 SELECT pty.pty_id AS cust_id,
    dt.start_dt,
    dt.end_dt,
    NULL::integer AS sme_type_id,
    '-1'::integer AS prim_okved_id,
    COALESCE(ppca.pty_class_val_id, ('-1'::integer)::bigint) AS cust_org_sgmnt_type_id,
    ppca3.pty_class_val_id AS crm_cust_org_accsr_type_id,
    ass_a100.pty_class_val_id AS crm_cust_prb_zone_type_id,
    ass_a101.pty_class_val_id AS crm_cust_risk_sgmnt_type_id,
    ass_a102.pty_class_val_id AS crm_cust_coop_type_id,
        CASE pcv_a102.pty_class_val_desc
            WHEN IS NOT DISTINCT FROM ''::text THEN 'Y'::text
            WHEN IS NOT DISTINCT FROM ' '::text THEN 'N'::text
            ELSE NULL::text
        END AS crm_cust_coop_flag,
    pty.created_dt AS crm_card_create_dt,
    pmh.pty_metric_dt AS crm_risk_sgmnt_dt,
    ass_dep.pty_class_val_id AS crm_cust_org_sctr_type_id,
    pseg.pty_class_val_id AS crm_cust_org_subs_type_id,
    pty.info_system_id,
    COALESCE(ptr.relates_pty_id, ('-1'::integer)::bigint) AS crm_gsz_id,
    COALESCE(gsz.crm_high_gsz_id, ('-1'::integer)::bigint) AS crm_high_gsz_id,
    COALESCE(cobt.pty_class_val_id, ('-1'::integer)::bigint) AS cust_org_bus_type_id,
    COALESCE(cost.pty_class_val_id, ('-1'::integer)::bigint) AS cust_org_sctr_type_id
   FROM (((((((((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT pty_1.pty_id AS id,
                            '1900-01-01'::date AS start_dt
                           FROM ((s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty_1
                             JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_ext_org eorg_1 ON (((eorg_1.ext_org_pty_id = pty_1.pty_id) AND (eorg_1.ext_org_type_id IS NULL))))
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_info_systems_crm sys ON ((sys.info_system_id = pty_1.info_system_id)))
                          WHERE (pty_1.org_ind = 'YES'::text)
                        UNION ALL
                         SELECT ppca_1.pty_id,
                            ppca_1.pty_class_start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca_1
                          WHERE (ppca_1.pty_clsfctn_id = ANY (ARRAY[2, '-1004'::integer, '-1003'::integer, '-1032'::integer, '-1030'::integer, 8, '-1006'::integer]))
                        UNION ALL
                         SELECT ppca_1.pty_id,
                            (ppca_1.pty_class_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca_1
                          WHERE ((ppca_1.pty_class_end_dt <> '9999-12-31'::date) AND (ppca_1.pty_clsfctn_id = ANY (ARRAY[2, '-1004'::integer, '-1003'::integer, '-1032'::integer, '-1030'::integer, 8, '-1006'::integer])))
                        UNION ALL
                         SELECT pmh_1.pty_id,
                            pmh_1.pty_metric_start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_metric_hist pmh_1
                          WHERE (pmh_1.pty_metric_type_id = '-1020'::integer)
                        UNION ALL
                         SELECT pmh_1.pty_id,
                            (pmh_1.pty_metric_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_metric_hist pmh_1
                          WHERE ((pmh_1.pty_metric_end_dt <> '9999-12-31'::date) AND (pmh_1.pty_metric_type_id = '-1020'::integer))
                        UNION ALL
                         SELECT dt_2.pty_id,
                                CASE
                                    WHEN (m.i = 1) THEN dt_2.gen_start_dt
                                    WHEN ((m.i = 2) AND (dt_2.gen_end_dt = '9999-12-31'::date)) THEN dt_2.gen_end_dt
                                    ELSE (dt_2.gen_end_dt + 1)
                                END AS start_dt
                           FROM (( SELECT ptr_1.related_pty_id AS pty_id,
CASE
 WHEN (ptr_1.pty_rel_start_dt > gsz_1.start_dt) THEN ptr_1.pty_rel_start_dt
 ELSE gsz_1.start_dt
END AS gen_start_dt,
CASE
 WHEN (ptr_1.pty_rel_end_dt < gsz_1.end_dt) THEN ptr_1.pty_rel_end_dt
 ELSE gsz_1.end_dt
END AS gen_end_dt
                                   FROM ((s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related ptr_1
                                     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_assoc ast ON (((ast.assoc_pty_id = ptr_1.relates_pty_id) AND (ast.assoc_type_id = '-1001'::integer))))
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.""d_$crm_gsz"" gsz_1 ON ((gsz_1.crm_gsz_id = ptr_1.relates_pty_id)))
                                  WHERE (((
CASE
 WHEN (ptr_1.pty_rel_start_dt > gsz_1.start_dt) THEN ptr_1.pty_rel_start_dt
 ELSE gsz_1.start_dt
END <=
CASE
 WHEN (ptr_1.pty_rel_end_dt < gsz_1.end_dt) THEN ptr_1.pty_rel_end_dt
 ELSE gsz_1.end_dt
END) AND (ptr_1.pty_rel_role_id = 1)) AND (ptr_1.pty_struct_type_id = '-1003'::integer))) dt_2
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (dt_2.gen_end_dt <> '9999-12-31'::date)))))
                        UNION ALL
                         SELECT cobt_1.pty_id,
                            cobt_1.pty_class_start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc cobt_1
                          WHERE (cobt_1.pty_clsfctn_id = '-1033'::integer)
                        UNION ALL
                         SELECT cobt_1.pty_id,
                            (cobt_1.pty_class_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc cobt_1
                          WHERE ((cobt_1.pty_class_end_dt <> '9999-12-31'::date) AND (cobt_1.pty_clsfctn_id = '-1033'::integer))
                        UNION ALL
                         SELECT cost_1.pty_id,
                            cost_1.pty_class_start_dt
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc cost_1
                          WHERE (cost_1.pty_clsfctn_id = '-1035'::integer)
                        UNION ALL
                         SELECT cost_1.pty_id,
                            (cost_1.pty_class_end_dt + 1)
                           FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc cost_1
                          WHERE ((cost_1.pty_class_end_dt <> '9999-12-31'::date) AND (cost_1.pty_clsfctn_id = '-1035'::integer))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((dt.id = cor.cust_id) AND (cor.crm_flag = 'Y'::text))))
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty ON (((pty.org_ind = 'YES'::text) AND (dt.id = pty.pty_id))))
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_ext_org eorg ON (((eorg.ext_org_pty_id = pty.pty_id) AND (eorg.ext_org_type_id IS NULL))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca ON ((((ppca.pty_id = pty.pty_id) AND ((dt.start_dt >= ppca.pty_class_start_dt) AND (dt.start_dt <= ppca.pty_class_end_dt))) AND (ppca.pty_clsfctn_id = 2))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca3 ON ((((ppca3.pty_id = pty.pty_id) AND ((dt.start_dt >= ppca3.pty_class_start_dt) AND (dt.start_dt <= ppca3.pty_class_end_dt))) AND (ppca3.pty_clsfctn_id = '-1004'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ass_a100 ON ((((ass_a100.pty_id = dt.id) AND ((dt.start_dt >= ass_a100.pty_class_start_dt) AND (dt.start_dt <= ass_a100.pty_class_end_dt))) AND (ass_a100.pty_clsfctn_id = '-1003'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ass_a101 ON ((((ass_a101.pty_id = dt.id) AND ((dt.start_dt >= ass_a101.pty_class_start_dt) AND (dt.start_dt <= ass_a101.pty_class_end_dt))) AND (ass_a101.pty_clsfctn_id = '-1032'::integer))))
     LEFT JOIN (s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ass_a102
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_class_val pcv_a102 ON ((pcv_a102.pty_class_val_id = ass_a102.pty_class_val_id))) ON ((((((ass_a102.pty_id = pty.pty_id) AND ((dt.start_dt >= ass_a102.pty_class_start_dt) AND (dt.start_dt <= ass_a102.pty_class_end_dt))) AND (pcv_a102.pty_clsfctn_id = '-1030'::integer)) AND ((dt.start_dt >= pcv_a102.pty_class_val_start_dt) AND (dt.start_dt <= pcv_a102.pty_class_val_end_dt))) AND (ass_a102.pty_clsfctn_id = '-1030'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_metric_hist pmh ON ((((pmh.pty_id = dt.id) AND ((dt.start_dt >= pmh.pty_metric_start_dt) AND (dt.start_dt <= pmh.pty_metric_end_dt))) AND (pmh.pty_metric_type_id = '-1020'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ass_dep ON ((((ass_dep.pty_id = dt.id) AND (ass_dep.pty_clsfctn_id = 8)) AND ((dt.start_dt >= ass_dep.pty_class_start_dt) AND (dt.start_dt <= ass_dep.pty_class_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc pseg ON ((((pseg.pty_id = dt.id) AND (pseg.pty_clsfctn_id = '-1006'::integer)) AND ((dt.start_dt >= pseg.pty_class_start_dt) AND (dt.start_dt <= pseg.pty_class_end_dt)))))
     LEFT JOIN ( SELECT t.related_pty_id,
            t.start_dt,
            t.end_dt,
            t.relates_pty_id
           FROM ( SELECT ptr_1.related_pty_id,
                    dt_1.start_dt,
                    dt_1.end_dt,
                    ptr_1.relates_pty_id,
                    row_number() OVER (PARTITION BY ptr_1.related_pty_id, dt_1.start_dt ORDER BY ptr_1.relates_pty_id DESC) AS rn
                   FROM ((( SELECT ""Window"".id,
                            ""Window"".start_dt,
                            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                           FROM ( SELECT dt_2.id,
                                    dt_2.start_dt
                                   FROM ( SELECT ptr_2.related_pty_id AS id,
  CASE
   WHEN (m.i = 1) THEN ptr_2.pty_rel_start_dt
   WHEN (m.i = 2) THEN (ptr_2.pty_rel_end_dt + 1)
   ELSE NULL::date
  END AS start_dt
   FROM ((s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related ptr_2
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_assoc ast_1 ON (((((ast_1.assoc_pty_id = ptr_2.relates_pty_id) AND (ptr_2.pty_rel_role_id = 1)) AND (ptr_2.pty_struct_type_id = '-1003'::integer)) AND (ast_1.assoc_type_id = '-1001'::integer))))
     JOIN ( SELECT a.i
     FROM ( SELECT 1 AS i) a
  UNION ALL
   SELECT a.i
     FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (ptr_2.pty_rel_end_dt <> '9999-12-31'::date)))))
UNION ALL
 SELECT ptr_2.related_pty_id,
    (ptr_2.pty_rel_end_dt + 1)
   FROM (s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related ptr_2
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_assoc ast_1 ON (((((ast_1.assoc_pty_id = ptr_2.relates_pty_id) AND (ptr_2.pty_rel_role_id = 1)) AND (ptr_2.pty_struct_type_id = '-1003'::integer)) AND (ast_1.assoc_type_id = '-1001'::integer))))
  WHERE (ptr_2.pty_rel_end_dt <> '9999-12-31'::date)) dt_2
                                  GROUP BY dt_2.id, dt_2.start_dt) ""Window""(id, start_dt)) dt_1
                     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_related ptr_1 ON (((ptr_1.related_pty_id = dt_1.id) AND ((dt_1.start_dt >= ptr_1.pty_rel_start_dt) AND (dt_1.start_dt <= ptr_1.pty_rel_end_dt)))))
                     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_assoc ast ON (((((ast.assoc_pty_id = ptr_1.relates_pty_id) AND (ptr_1.pty_rel_role_id = 1)) AND (ptr_1.pty_struct_type_id = '-1003'::integer)) AND (ast.assoc_type_id = '-1001'::integer))))) t
          WHERE (t.rn = 1)) ptr ON (((ptr.related_pty_id = pty.pty_id) AND ((dt.start_dt >= ptr.start_dt) AND (dt.start_dt <= ptr.end_dt)))))
     LEFT JOIN ( SELECT gsz_1.crm_gsz_id,
            gsz_1.crm_high_gsz_id,
            gsz_1.start_dt,
            gsz_1.end_dt
           FROM s_grnplm_vd_t_bvd_db_dmslcl.""d_$crm_gsz"" gsz_1) gsz ON (((gsz.crm_gsz_id = ptr.relates_pty_id) AND ((dt.start_dt >= gsz.start_dt) AND (dt.start_dt <= gsz.end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc cobt ON ((((cobt.pty_id = dt.id) AND (cobt.pty_clsfctn_id = '-1033'::integer)) AND ((dt.start_dt >= cobt.pty_class_start_dt) AND (dt.start_dt <= cobt.pty_class_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc cost ON ((((cost.pty_id = dt.id) AND (cost.pty_clsfctn_id = '-1035'::integer)) AND ((dt.start_dt >= cost.pty_class_start_dt) AND (dt.start_dt <= cost.pty_class_end_dt)))))
UNION ALL
 SELECT cce.cust_id,
    dt.start_dt,
    dt.end_dt,
    NULL::bigint AS sme_type_id,
    okv.okved_id AS prim_okved_id,
    coc.cust_org_sgmnt_type_id,
    coap.cust_org_acssr_type_id AS crm_cust_org_accsr_type_id,
    NULL::bigint AS crm_cust_prb_zone_type_id,
    NULL::bigint AS crm_cust_risk_sgmnt_type_id,
    coc.lylty_cust_org_clsfctn_val_id AS crm_cust_coop_type_id,
        CASE
            WHEN (cocv.cust_org_clsfctn_val_cd = '3'::text) THEN 'N'::text
            ELSE 'Y'::text
        END AS crm_cust_coop_flag,
    NULL::date AS crm_card_create_dt,
    NULL::date AS crm_risk_sgmnt_dt,
    coc.cust_org_indry_type_id AS crm_cust_org_sctr_type_id,
    coc.cust_org_subsgmnt_type_id AS crm_cust_org_subs_type_id,
    dt.info_system_id,
    (COALESCE(NULL::integer, '-1'::integer))::bigint AS crm_gsz_id,
    (COALESCE(NULL::integer, '-1'::integer))::bigint AS crm_high_gsz_id,
        CASE
            WHEN (k.okk_level_num = '3'::text) THEN k.okk_id
            ELSE NULL::bigint
        END AS cust_org_bus_type_id,
        CASE
            WHEN (k.okk_level_num = '4'::text) THEN k.okk_id
            ELSE NULL::bigint
        END AS cust_org_sctr_type_id
   FROM ((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_cust_org_clsfctn.cust_id AS id,
                            v_cust_org_clsfctn.start_dt,
                            v_cust_org_clsfctn.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_clsfctn
                          WHERE (v_cust_org_clsfctn.info_system_inst_cd = '000002'::text)
                        UNION ALL
                         SELECT org.cust_id,
                            (org.end_dt + 1) AS start_dt,
                            org.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_clsfctn org
                          WHERE ((org.end_dt <> '9999-12-31'::date) AND (org.info_system_inst_cd = '000002'::text))
                        UNION ALL
                         SELECT v_cust_org_acssr_pos_acs.cust_id AS id,
                            v_cust_org_acssr_pos_acs.start_dt,
                            v_cust_org_acssr_pos_acs.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_acssr_pos_acs
                          WHERE (v_cust_org_acssr_pos_acs.info_system_inst_cd = '000002'::text)
                        UNION ALL
                         SELECT org.cust_id,
                            (org.end_dt + 1) AS start_dt,
                            org.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_acssr_pos_acs org
                          WHERE ((org.end_dt <> '9999-12-31'::date) AND (org.info_system_inst_cd = '000002'::text))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_epk cce ON ((cce.cust_id = dt.id)))
     LEFT JOIN s_grnplm_as_t_didsd_200_db_dwh.t_cust_org_clsfctn coc ON (((((coc.cust_id = dt.id) AND ((dt.start_dt >= coc.start_dt) AND (dt.start_dt <= coc.end_dt))) AND (coc.deleted_flag = 'N'::text)) AND (coc.info_system_inst_cd = '000002'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_acssr_pos_acs coap ON ((((coap.cust_id = dt.id) AND ((dt.start_dt >= coap.start_dt) AND (dt.start_dt <= coap.end_dt))) AND (coap.info_system_inst_cd = '000002'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_okk k ON (((k.okk_id = coc.code_okk_id) AND (k.info_system_inst_cd = '000002'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_clsfctn_okved okv ON (((((okv.cust_id = dt.id) AND ((dt.start_dt >= okv.start_dt) AND (dt.start_dt <= okv.end_dt))) AND (okv.info_system_inst_cd = '000002'::text)) AND (okv.prim_flag = 'Y'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_clsfctn_val cocv ON (((cocv.cust_org_clsfctn_val_id = coc.lylty_cust_org_clsfctn_val_id) AND (cocv.info_system_inst_cd = '000002'::text))));"
d_agr_cred_optn_uvdo," SELECT d.agr_cred_id,
    optn.agr_cred_optn_id,
    optn.optn_dt,
    optn.crncy_id,
    agr_crncy.crncy_cd,
    agr_crncy.iso_crncy_cd,
    optn.optn_type_id,
    optn.completed_flag AS uvdo_completed_flag,
    optn.host_tlcesse_nid_id AS uvdo_host_tlcesse_nid_id,
    d.info_system_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo d
     JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_optn optn ON ((optn.agr_cred_id = d.agr_cred_id)))
     LEFT JOIN ( SELECT curu.crncy_id,
            max(cure.crncy_id) AS crncy_id_eks,
            max(COALESCE(cure.crncy_cd, '-1'::text)) AS crncy_cd,
            max(COALESCE(cure.crncy_name, ''::text)) AS crncy_name,
            max(curu.iso_crncy_cd) AS iso_crncy_cd,
            max(curu.info_system_id) AS info_system_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_crncy curu
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy cure ON ((cure.iso_crncy_cd = curu.iso_crncy_cd)))
          GROUP BY curu.crncy_id) agr_crncy ON ((agr_crncy.crncy_id = optn.crncy_id)));"
d_agr_cred_port," SELECT dat.agr_cred_id,
    dat.start_dt,
    COALESCE((max(dat.start_dt) OVER (PARTITION BY dat.agr_cred_id ORDER BY dat.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    dat.acct_grp_id AS prvsn_port_id,
    COALESCE(port26curr.rdm_port_f26_mk, port26init.rdm_port_f26_mk) AS f26_prvsn_port_id,
    port_init.issue_prvsn_port_id,
    dat.info_system_id
   FROM ((((((( SELECT t.agr_cred_id,
            t.start_dt,
            t.acct_grp_id,
            t.info_system_id
           FROM ( SELECT dat_1.agr_cred_id,
                    dat_1.start_dt,
                    dat_1.acct_grp_id,
                    dat_1.info_system_id,
                        CASE
                            WHEN (((dat_1.acct_grp_id <> max(dat_1.acct_grp_id) OVER (PARTITION BY dat_1.agr_cred_id ORDER BY dat_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING)) OR ((dat_1.acct_grp_id IS NULL) AND (max(dat_1.acct_grp_id) OVER (PARTITION BY dat_1.agr_cred_id ORDER BY dat_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING) IS NOT NULL))) OR ((dat_1.acct_grp_id IS NOT NULL) AND (max(dat_1.acct_grp_id) OVER (PARTITION BY dat_1.agr_cred_id ORDER BY dat_1.start_dt ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING) IS NULL))) THEN (1)::bigint
                            ELSE row_number() OVER (PARTITION BY dat_1.agr_cred_id ORDER BY dat_1.start_dt)
                        END AS rn
                   FROM ( SELECT dt.agr_cred_id,
                            dt.start_dt,
                            max(dat_2.acct_grp_id) AS acct_grp_id,
                            max(dt.info_system_id) AS info_system_id
                           FROM (( SELECT agr.agr_cred_id,
                                    dt_1.start_dt,
                                    max(dt_1.info_system_id) AS info_system_id
                                   FROM (( SELECT aag.agrmnt_id AS id,
    aag.acct_assoc_start_dt AS start_dt,
    aag.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp aag
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp acg ON ((acg.acct_grp_id = aag.acct_grp_id)))
  WHERE (acg.acct_grp_reason_type_id = '-1002'::integer)
UNION ALL
 SELECT aag.agrmnt_id AS id,
    aag.acct_assoc_end_dt AS start_dt,
    aag.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp aag
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp acg ON ((acg.acct_grp_id = aag.acct_grp_id)))
  WHERE ((acg.acct_grp_reason_type_id = '-1002'::integer) AND (aag.acct_assoc_end_dt <> '9999-12-31'::date))) dt_1
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr ON ((dt_1.id = agr.prnt_agr_cred_id)))
                                  GROUP BY agr.agr_cred_id, dt_1.start_dt) dt
                             LEFT JOIN ( SELECT agr.agr_cred_id,
                                    aag.acct_assoc_start_dt,
                                    (aag.acct_assoc_end_dt - 1) AS acct_assoc_end_dt,
                                    acg.acct_grp_id,
                                    aag.info_system_id
                                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp aag
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr ON ((aag.agrmnt_id = agr.prnt_agr_cred_id)))
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp acg ON ((acg.acct_grp_id = aag.acct_grp_id)))
                                  WHERE (acg.acct_grp_reason_type_id = '-1002'::integer)) dat_2 ON (((dt.agr_cred_id = dat_2.agr_cred_id) AND ((dt.start_dt >= dat_2.acct_assoc_start_dt) AND (dt.start_dt <= dat_2.acct_assoc_end_dt)))))
                          GROUP BY dt.agr_cred_id, dt.start_dt) dat_1) t
          WHERE (t.rn = 1)) dat
     LEFT JOIN ( SELECT a2f.agrmnt_id,
            max(COALESCE(ife_1.feature_ind, 'NO'::text)) AS overdraft_prvsn_flag
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_feature a2f
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_feature fea ON ((((fea.feature_id = a2f.feature_id) AND (fea.feature_type_id = 4)) AND (fea.feature_clsfctn_id = '-1014'::integer))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_ind_feature ife_1 ON ((ife_1.feature_id = fea.feature_id)))
          WHERE (a2f.acct_feature_role_id = 1)
          GROUP BY a2f.agrmnt_id) ife ON ((ife.agrmnt_id = dat.agr_cred_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_prvsn_port_s prt ON ((prt.prvsn_port_id = dat.acct_grp_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_rdm_port_f26_map_mast port26curr ON ((((port26curr.code = prt.prvsn_port_kind_cd) AND (port26curr.is_overd =
        CASE
            WHEN (ife.overdraft_prvsn_flag = 'YES'::text) THEN 1
            ELSE 0
        END)) AND (port26curr.is_initial = 0))))
     LEFT JOIN ( SELECT aag.agrmnt_id,
            max(acg.acct_grp_id) AS issue_prvsn_port_id
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_acct_grp aag
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt a ON ((a.agrmnt_id = aag.agrmnt_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_grp acg ON ((acg.acct_grp_id = aag.acct_grp_id)))
          WHERE ((acg.acct_grp_reason_type_id = '-1002'::integer) AND ((a.acct_signed_dt >= aag.acct_assoc_start_dt) AND (a.acct_signed_dt <= aag.acct_assoc_end_dt)))
          GROUP BY aag.agrmnt_id) port_init ON ((port_init.agrmnt_id = dat.agr_cred_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_prvsn_port_s port2 ON ((port2.prvsn_port_id = port_init.issue_prvsn_port_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_rdm_port_f26_map_mast port26init ON ((((port26init.code = port2.prvsn_port_kind_cd) AND (port26init.is_overd =
        CASE
            WHEN (ife.overdraft_prvsn_flag = 'YES'::text) THEN 1
            ELSE 0
        END)) AND (port26init.is_initial = 1))));"
d_crncy_trans_rate," SELECT t.crncy_id,
    t.gregor_dt AS gregor_dt_,
    r.tgt_crncy_amt,
    r.src_crncy_amt
   FROM (( SELECT a.crncy_id,
            a.crncy_cd,
            a.gregor_dt
           FROM ( SELECT a_1.crncy_id,
                    a_1.crncy_cd,
                    a_1.gregor_dt,
                    row_number() OVER (PARTITION BY a_1.crncy_id, a_1.gregor_dt ORDER BY NULL::text) AS rn
                   FROM ( SELECT c.crncy_id,
                            c.crncy_cd,
                            ggt.gregor_dt
                           FROM ((( SELECT a_3.crncy_id
                                   FROM ( SELECT d_agr_cred.crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred
UNION ALL
 SELECT d_agr_cred.issue_crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred
UNION ALL
 SELECT d_agr_cred.cess_crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred
UNION ALL
 SELECT d_agr_cred_optn.crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn
UNION ALL
 SELECT d_agr_collat_mkt.mkt_crncy_id
   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt
UNION ALL
 SELECT c_1.crncy_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp a_4
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_coa a2c ON ((a2c.agrmnt_id = a_4.agr_cred_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c_1 ON ((c_1.coa_id = a2c.coa_id)))) a_3
                                  WHERE (a_3.crncy_id <> '-1'::integer)
                                  GROUP BY a_3.crncy_id) a_2
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy c ON ((c.crncy_id = a_2.crncy_id)))
                             CROSS JOIN ( SELECT (t_1.date_)::date AS gregor_dt
                                   FROM generate_series(('1950-01-01'::date)::timestamp with time zone, ((('now'::text)::date + 1))::timestamp with time zone, '1 day'::interval) t_1(date_)) ggt)) a_1) a
          WHERE (a.rn = 1)) t
     LEFT JOIN ( SELECT v_crncy_trans_rate_hist.tgt_crncy_cd,
            v_crncy_trans_rate_hist.crncy_trans_start_dt,
            v_crncy_trans_rate_hist.crncy_trans_end_dt,
            v_crncy_trans_rate_hist.tgt_crncy_amt,
            v_crncy_trans_rate_hist.src_crncy_amt
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_crncy_trans_rate_hist
          WHERE ((v_crncy_trans_rate_hist.src_crncy_cd = '810'::text) AND (v_crncy_trans_rate_hist.crncy_trans_rate_type_id = 1))) r ON ((((r.tgt_crncy_cd = t.crncy_cd) AND (t.gregor_dt >= r.crncy_trans_start_dt)) AND (t.gregor_dt <= r.crncy_trans_end_dt))));"
d_agr_cred_optn," SELECT t.agr_cred_id,
    t.agr_cred_optn_id,
    t.optn_dt,
    t.optn_crncy_amt,
    t.optn_rub,
    t.crncy_id,
    t.optn_type_id,
    t.host_optn_id,
    t.meas_cd,
    t.own_flag,
    t.inc_flag,
    (
        CASE
            WHEN ((t.crncy_cd = ANY (ARRAY['810'::text, '643'::text])) OR (t.issue_crncy_id = '-1'::integer)) THEN (1)::numeric
            ELSE (t.tgt_crncy_amt / NULLIF(t.src_crncy_amt, (0)::numeric))
        END * t.optn_rub) AS optn_agr_cred_crncy_amt,
    (
        CASE
            WHEN ((t.crncy_cd = ANY (ARRAY['810'::text, '643'::text])) OR (t.issue_crncy_id = '-1'::integer)) THEN (1)::numeric
            ELSE (t.tgt_crncy_amt / NULLIF(t.src_crncy_amt, (0)::numeric))
        END * t.optn_rub) AS optn_issue_crncy_amt,
    t.issue_flag,
    t.move_flag,
    t.rise_limit_flag,
    t.repymnt_flag,
    t.redemptn_on_prvsn_flag,
    t.eks_je_header_id,
    t.optn_bal_dt,
    t.debt_coa_num,
    t.cred_coa_num,
    t.debt_coa_id,
    t.cred_coa_id,
    t.optn_bal_rub,
    t.info_system_id
   FROM ( SELECT
                CASE
                    WHEN (multiplier.a = 1) THEN agr.agr_cred_id
                    WHEN (multiplier.a = 2) THEN agr.prnt_agr_cred_id
                    ELSE NULL::bigint
                END AS agr_cred_id,
            aev.evt_id AS agr_cred_optn_id,
            evt.evt_start_dt AS optn_dt,
            fev.evt_amt AS optn_crncy_amt,
            (
                CASE
                    WHEN ((ccy.crncy_cd = ANY (ARRAY['810'::text, '643'::text])) OR (ccy.crncy_id = '-1'::integer)) THEN (1)::numeric
                    ELSE (rat.tgt_crncy_amt / NULLIF(rat.src_crncy_amt, (0)::numeric))
                END * fev.evt_amt) AS optn_rub,
                CASE
                    WHEN ((fev.evt_crncy_id IS NOT NULL) AND (fev.evt_crncy_id <> '-1'::integer)) THEN fev.evt_crncy_id
                    ELSE ccy_rur.crncy_id
                END AS crncy_id,
            fev.fin_evt_type_id AS optn_type_id,
            evt.src_txn_cd AS host_optn_id,
            t2m.meas_cd,
                CASE
                    WHEN (multiplier.a = 1) THEN 'Y'::text
                    WHEN (multiplier.a = 2) THEN 'N'::text
                    ELSE NULL::text
                END AS own_flag,
            t2m.inc_flag,
                CASE
                    WHEN (iss_flg.fin_evt_type_id IS NOT NULL) THEN 'Y'::text
                    ELSE 'N'::text
                END AS issue_flag,
                CASE
                    WHEN (mv_flg.fin_evt_type_id IS NOT NULL) THEN 'Y'::text
                    ELSE 'N'::text
                END AS move_flag,
                CASE
                    WHEN (rl_flg.fin_evt_type_id IS NOT NULL) THEN 'Y'::text
                    ELSE 'N'::text
                END AS rise_limit_flag,
                CASE
                    WHEN (rp_flg.fin_evt_type_id IS NOT NULL) THEN 'Y'::text
                    ELSE 'N'::text
                END AS repymnt_flag,
                CASE
                    WHEN (rprvsn_flg.fin_evt_type_id IS NOT NULL) THEN 'Y'::text
                    ELSE 'N'::text
                END AS redemptn_on_prvsn_flag,
            jeh.eks_je_header_id,
            jeh.optn_bal_dt,
            jeh.debt_coa_num,
            jeh.cred_coa_num,
            jeh.debt_coa_id,
            jeh.cred_coa_id,
            jeh.optn_bal_rub,
            aev.info_system_id,
            agr_ccy.crncy_cd,
            agr.issue_crncy_id,
            agr_rat.tgt_crncy_amt,
            agr_rat.src_crncy_amt
           FROM ((((((((((((((((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_evt aev
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr ON ((aev.agrmnt_id = agr.agr_cred_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt fev ON ((fev.evt_id = aev.evt_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_evt evt ON ((evt.evt_id = aev.evt_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy ccy ON ((ccy.crncy_id = fev.evt_crncy_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy_trans_rate_hist rat ON ((((((rat.tgt_crncy_cd = '810'::text) AND (rat.src_crncy_cd = ccy.crncy_cd)) AND (rat.crncy_trans_rate_type_id = 1)) AND (evt.evt_start_dt >= rat.crncy_trans_start_dt)) AND (evt.evt_start_dt <= rat.crncy_trans_end_dt))))
             LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_crncy agr_ccy
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy_trans_rate_hist agr_rat ON ((((agr_rat.tgt_crncy_cd = agr_ccy.crncy_cd) AND (agr_rat.src_crncy_cd = '810'::text)) AND (agr_rat.crncy_trans_rate_type_id = 1)))) ON ((((agr_ccy.crncy_id = agr.issue_crncy_id) AND (evt.evt_start_dt >= agr_rat.crncy_trans_start_dt)) AND (evt.evt_start_dt <= agr_rat.crncy_trans_end_dt))))
             LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_crncy iss_ccy
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy_trans_rate_hist iss_rat ON ((((iss_rat.tgt_crncy_cd = iss_ccy.crncy_cd) AND (iss_rat.src_crncy_cd = '810'::text)) AND (iss_rat.crncy_trans_rate_type_id = 1)))) ON ((((iss_ccy.crncy_id = agr.issue_crncy_id) AND (evt.evt_start_dt >= iss_rat.crncy_trans_start_dt)) AND (evt.evt_start_dt <= iss_rat.crncy_trans_end_dt))))
             LEFT JOIN ( SELECT t2m_1.fin_evt_type_id,
                        CASE
                            WHEN (t2m_1.dbt_flag = 'Y'::text) THEN 'N'::text
                            ELSE 'Y'::text
                        END AS inc_flag,
                    s.meas_cd
                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type_fin_meas t2m_1
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas m ON ((m.fin_meas_id = t2m_1.fin_meas_id)))
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set s ON ((s.fin_meas_cd = m.fin_meas_cd)))
                  GROUP BY t2m_1.fin_evt_type_id,
                        CASE
                            WHEN (t2m_1.dbt_flag = 'Y'::text) THEN 'N'::text
                            ELSE 'Y'::text
                        END, s.meas_cd) t2m ON ((t2m.fin_evt_type_id = fev.fin_evt_type_id)))
             CROSS JOIN ( SELECT max(v_crncy.crncy_id) AS crncy_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_crncy
                  WHERE ((v_crncy.info_system_id IN ( SELECT v_info_system.info_system_id
                           FROM s_grnplm_as_t_didsd_vd_dwh.v_info_system
                          WHERE (((v_info_system.info_system_type_cd || '_'::text) || v_info_system.info_system_inst_cd) = '010_930002'::text))) AND (v_crncy.crncy_cd = '810'::text))) ccy_rur)
             LEFT JOIN ( SELECT v_fin_evt_type.fin_evt_type_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type
                  WHERE (v_fin_evt_type.fin_evt_host_type_cd = ANY (ARRAY['_'::text, '___'::text, '__'::text]))
                  GROUP BY v_fin_evt_type.fin_evt_type_id) iss_flg ON ((fev.fin_evt_type_id = iss_flg.fin_evt_type_id)))
             LEFT JOIN ( SELECT v_fin_evt_type.fin_evt_type_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type
                  WHERE (v_fin_evt_type.fin_evt_host_type_cd = ANY (ARRAY['__'::text, '___'::text]))
                  GROUP BY v_fin_evt_type.fin_evt_type_id) mv_flg ON ((fev.fin_evt_type_id = mv_flg.fin_evt_type_id)))
             LEFT JOIN ( SELECT v_fin_evt_type.fin_evt_type_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type
                  WHERE (v_fin_evt_type.fin_evt_host_type_cd = ANY (ARRAY['_'::text, 'OPEN_LINE'::text, '_'::text, '_'::text]))
                  GROUP BY v_fin_evt_type.fin_evt_type_id) rl_flg ON ((fev.fin_evt_type_id = rl_flg.fin_evt_type_id)))
             LEFT JOIN ( SELECT t_1.fin_evt_type_id
                   FROM ( SELECT v_fin_evt_type.fin_evt_type_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type
                          WHERE (v_fin_evt_type.fin_evt_host_type_cd = ANY (ARRAY['_'::text, '_'::text, 'IMP__'::text, '__'::text, '__'::text, '___'::text, '_'::text, '__'::text, '__'::text, '_'::text, '___'::text, '___'::text, '___'::text, '___'::text]))
                        UNION ALL
                         SELECT fet.fin_evt_type_id
                           FROM (((((s_grnplm_vd_t_bvd_db_dmslcl.d_set_303_comiss_optn_type t_2
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_303_optn_type ot ON ((ot.optn_type_id = t_2.optn_type_id)))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type fet ON ((fet.fin_evt_host_type_cd = ot.optn_type_cd)))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type_fin_meas fetfm ON ((fetfm.fin_evt_type_id = fet.fin_evt_type_id)))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas fm ON ((fm.fin_meas_id = fetfm.fin_meas_id)))
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_303_optn_type_fin_meas otfm ON ((otfm.optn_type_id = ot.optn_type_id)))
                          WHERE (otfm.dbt_flag = 'Y'::text)) t_1
                  GROUP BY t_1.fin_evt_type_id) rp_flg ON ((fev.fin_evt_type_id = rp_flg.fin_evt_type_id)))
             LEFT JOIN ( SELECT fet.fin_evt_type_id
                   FROM (((((s_grnplm_vd_t_bvd_db_dmslcl.d_set_303_comiss_optn_type t_1
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_303_optn_type ot ON ((ot.optn_type_id = t_1.optn_type_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type fet ON ((fet.fin_evt_host_type_cd = ot.optn_type_cd)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type_fin_meas fetfm ON ((fetfm.fin_evt_type_id = fet.fin_evt_type_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas fm ON ((fm.fin_meas_id = fetfm.fin_meas_id)))
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_set_303_optn_type_fin_meas otfm ON ((otfm.optn_type_id = ot.optn_type_id)))
                  WHERE ((otfm.dbt_flag = 'Y'::text) AND (fm.fin_meas_cd = ANY (ARRAY['__'::text, '_'::text, '____'::text])))
                  GROUP BY fet.fin_evt_type_id) rprvsn_flg ON ((fev.fin_evt_type_id = rprvsn_flg.fin_evt_type_id)))
             JOIN ( SELECT a.a
                   FROM ( SELECT 1 AS a) a
                UNION ALL
                 SELECT a.a
                   FROM ( SELECT 2 AS a) a) multiplier ON (((multiplier.a = 1) OR ((multiplier.a = 2) AND (agr.prnt_agr_cred_id <> agr.agr_cred_id)))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn_je_tmp jeh ON ((jeh.agr_cred_optn_id = aev.evt_id)))) t;"
d_agr_cred_fin_dt_com_tmp," WITH list_agr AS (
         SELECT a.agr_cred_id,
            a.link_agr_cred_id,
            a.info_system_id,
            aev.evt_id
           FROM (( SELECT agr.agr_cred_id,
                    agr.agr_cred_id AS link_agr_cred_id,
                    agr.info_system_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr
                UNION
                 SELECT agr.agr_cred_id,
                    ar.related_agrmnt_id AS link_agr_cred_id,
                    agr.info_system_id
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related ar ON (((agr.agr_cred_id = ar.agrmnt_id) AND (ar.agrmnt_related_type_id = '-1004'::integer))))) a
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_acct_evt aev ON ((a.link_agr_cred_id = aev.agrmnt_id)))
        )
 SELECT ""Window"".agr_cred_id,
    ""Window"".start_dt,
    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    sum(""Window"".att_3) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS UNBOUNDED PRECEDING) AS optn_sum_rub,
    ""Window"".info_system_id
   FROM ( SELECT a.agr_cred_id,
            evt.evt_start_dt AS start_dt,
            sum((((
                CASE
                    WHEN (em.dbt_flag = 'Y'::text) THEN '-1'::integer
                    ELSE 1
                END)::numeric *
                CASE
                    WHEN ((ccy.crncy_cd = ANY (ARRAY['810'::text, '643'::text])) OR (ccy.crncy_id = '-1'::integer)) THEN (1)::numeric
                    ELSE (rat.src_crncy_amt / NULLIF(rat.tgt_crncy_amt, (0)::numeric))
                END) * fev.evt_amt)) AS att_3,
            max(a.info_system_id) AS info_system_id
           FROM (((((((list_agr a
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt fev ON ((fev.evt_id = a.evt_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_evt evt ON (((evt.evt_start_dt <= ('now'::text)::date) AND (evt.evt_id = a.evt_id))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy ccy ON ((fev.evt_crncy_id = ccy.crncy_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy_trans_rate_hist rat ON ((((((ccy.crncy_cd = rat.tgt_crncy_cd) AND (rat.src_crncy_cd = '810'::text)) AND (rat.crncy_trans_rate_type_id = 1)) AND (evt.evt_start_dt >= rat.crncy_trans_start_dt)) AND (evt.evt_start_dt <= rat.crncy_trans_end_dt))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type fet ON ((fev.fin_evt_type_id = fet.fin_evt_type_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_evt_type_fin_meas em ON ((fet.fin_evt_type_id = em.fin_evt_type_id)))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas m ON (((em.fin_meas_id = m.fin_meas_id) AND (m.fin_meas_id IN ( SELECT h.fin_meas_id
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas_hier h
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas mh ON ((h.prnt_fin_meas_id = mh.fin_meas_id)))
                  WHERE (mh.fin_meas_cd = '__'::text))))))
          GROUP BY a.agr_cred_id, evt.evt_start_dt) ""Window""(agr_cred_id, start_dt, att_3, info_system_id);"
d_agr_cred_clsfctn," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    agra_a114.agr_cred_purpose_cd AS agr_cred_purpose_txt,
    val.agrmnt_clsfctn_val_cd AS eks_p_agr_cred_f26_type_cd,
    f.cust_fin_pos_type_id,
        CASE
            WHEN (conf.appl_class_val_id = '-1001'::integer) THEN 'Y'::text
            WHEN (conf.appl_class_val_id = '-1002'::integer) THEN 'N'::text
            ELSE NULL::text
        END AS confid_flag,
    aac.agrmnt_class_val_id AS crm_cred_type_id,
    appl.appl_num AS crm_host_appl_id,
    appl.appl_num AS crm_revn_id,
    appl2.appl_num AS crm_opty_id,
    ag.host_agrmnt_cd AS crm_host_agr_id
   FROM ((((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT ass_1.agrmnt_id AS id,
                                CASE
                                    WHEN (m.i = 1) THEN ass_1.agrmnt_class_start_dt
                                    WHEN ((m.i = 2) AND (ass_1.agrmnt_class_end_dt <> '9999-12-31'::date)) THEN (ass_1.agrmnt_class_end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc ass_1
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val val_1 ON ((((ass_1.agrmnt_class_val_id = val_1.agrmnt_class_val_id) AND (val_1.agrmnt_clsfctn_id = '-1022'::integer)) AND (ass_1.agrmnt_clsfctn_id = '-1022'::integer))))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (ass_1.agrmnt_class_end_dt <> '9999-12-31'::date)))))
                        UNION ALL
                         SELECT c_1.agr_cred_id,
                                CASE
                                    WHEN (m.i = 1) THEN c_1.start_dt
                                    WHEN ((m.i = 2) AND (c_1.end_dt <> '9999-12-31'::date)) THEN (c_1.end_dt + 1)
                                    WHEN (m.i = 3) THEN f_1.start_dt
                                    WHEN ((m.i = 4) AND (f_1.end_dt <> '9999-12-31'::date)) THEN (f_1.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust c_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_org_fin f_1 ON (((f_1.cust_id = c_1.cust_id) AND (((f_1.start_dt >= c_1.start_dt) AND (f_1.start_dt <= c_1.end_dt)) OR ((c_1.start_dt >= f_1.start_dt) AND (c_1.start_dt <= f_1.end_dt))))))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 3 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 4 AS i) a) m ON ((((m.i = ANY (ARRAY[1, 3])) OR ((m.i = 2) AND (c_1.end_dt <> '9999-12-31'::date))) OR ((m.i = 4) AND (f_1.end_dt <> '9999-12-31'::date)))))
                        UNION ALL
                         SELECT d.agr_cred_id AS id,
                                CASE
                                    WHEN (m.i = 1) THEN d.start_dt
                                    WHEN ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)) THEN (d.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_clsfctn_purpose d
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_purpose_s s ON ((d.agr_cred_purpose_id = s.agr_cred_purpose_id)))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)))))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = dt.id)))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc ass
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val val ON ((((ass.agrmnt_class_val_id = val.agrmnt_class_val_id) AND (val.agrmnt_clsfctn_id = '-1022'::integer)) AND (ass.agrmnt_clsfctn_id = '-1022'::integer)))) ON (((ass.agrmnt_id = dt.id) AND ((dt.start_dt >= ass.agrmnt_class_start_dt) AND (dt.start_dt <= ass.agrmnt_class_end_dt)))))
     LEFT JOIN (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust c
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_org_fin f ON ((f.cust_id = c.cust_id))) ON ((((c.agr_cred_id = dt.id) AND ((dt.start_dt >= c.start_dt) AND (dt.start_dt <= c.end_dt))) AND ((dt.start_dt >= f.start_dt) AND (dt.start_dt <= f.end_dt)))))
     LEFT JOIN ( SELECT t.agr_cred_id,
            t.start_dt,
            t.end_dt,
            t.agr_cred_purpose_cd
           FROM ( SELECT d.agr_cred_id,
                    d.start_dt,
                    d.end_dt,
                    s.agr_cred_purpose_cd,
                    row_number() OVER (PARTITION BY d.agr_cred_id ORDER BY s.agr_cred_purpose_cd, d.start_dt) AS r_nbr
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_clsfctn_purpose d
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_purpose_s s ON ((d.agr_cred_purpose_id = s.agr_cred_purpose_id)))) t
          WHERE (t.r_nbr = 1)) agra_a114 ON (((dt.id = agra_a114.agr_cred_id) AND ((dt.start_dt >= agra_a114.start_dt) AND (dt.start_dt <= agra_a114.end_dt)))))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl aa ON ((((aa.agrmnt_id = dt.id) AND (aa.agrmnt_appl_role_id = '-1004'::integer)) AND ((dt.start_dt >= aa.agmt_to_appl_start_dt) AND (dt.start_dt <= aa.agmt_to_appl_end_dt)))))
     LEFT JOIN (s_grnplm_as_t_didsd_039_vd_dwh.v_appl_related ar
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_appl_appl_class_assoc conf ON (((conf.appl_id = ar.relates_appl_id) AND (conf.appl_clsfctn_id = '-1006'::integer)))) ON (((((ar.related_appl_id = aa.appl_id) AND (ar.appl_rel_type_id = '-1001'::integer)) AND ((dt.start_dt >= conf.appl_class_start_dt) AND (dt.start_dt <= conf.appl_class_end_dt))) AND ((dt.start_dt >= ar.appl_rel_start_dt) AND (dt.start_dt <= ar.appl_rel_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_appl appl ON (((appl.appl_id = aa.appl_id) AND (appl.appl_type_id = '-1002'::integer))))
     LEFT JOIN (s_grnplm_as_t_didsd_039_vd_dwh.v_appl_related ar2
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_appl appl2 ON (((appl2.appl_id = ar2.relates_appl_id) AND (appl2.appl_type_id = '-1001'::integer)))) ON ((((ar2.related_appl_id = appl.appl_id) AND (ar2.appl_rel_type_id = '-1001'::integer)) AND ((dt.start_dt >= ar2.appl_rel_start_dt) AND (dt.start_dt <= ar2.appl_rel_end_dt)))))
     LEFT JOIN (s_grnplm_as_t_didsd_039_vd_dwh.v_agrmnt_to_appl atp
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_agrmnt ag ON (((ag.agrmnt_id = atp.agrmnt_id) AND (ag.agrmnt_categ_id = 1)))) ON ((((atp.appl_id = aa.appl_id) AND (atp.agrmnt_appl_role_id = '-1003'::integer)) AND ((dt.start_dt >= atp.agmt_to_appl_start_dt) AND (dt.start_dt <= atp.agmt_to_appl_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_agmt_agmt_class_assoc aac ON ((((aac.agrmnt_id = atp.agrmnt_id) AND (aac.agrmnt_clsfctn_id = 4)) AND ((dt.start_dt >= aac.agrmnt_class_start_dt) AND (dt.start_dt <= aac.agrmnt_class_end_dt)))));"
d_agr_cred_f303_collat_tmp," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    sum(
        CASE
            WHEN (act.asset_collat_type_qlty_cat_cd = '1'::text) THEN a2a.alloc_prvsn_mkt_rub
            ELSE NULL::numeric
        END) AS f303_agr_collat_prvsn_1_amt,
    sum(
        CASE
            WHEN (act.asset_collat_type_qlty_cat_cd = '2'::text) THEN a2a.alloc_prvsn_mkt_rub
            ELSE NULL::numeric
        END) AS f303_agr_collat_prvsn_2_amt,
    max(acol.info_system_id) AS info_system_id
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT collat.agr_cred_id AS id,
                                CASE mult.i
                                    WHEN 1 THEN collat.start_dt
                                    WHEN 2 THEN (collat.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM (( SELECT a2a_1.agr_cred_id,
                                    GREATEST(a2a_1.start_dt, COALESCE(acol_1.acct_open_dt, '1900-01-01'::date)) AS start_dt,
                                    LEAST(a2a_1.end_dt, COALESCE(acol_1.acct_close_dt, '9999-12-31'::date)) AS end_dt
                                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_agr_collat a2a_1
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt acol_1 ON ((((a2a_1.agr_collat_id = acol_1.agrmnt_id) AND ((a2a_1.start_dt <= COALESCE(acol_1.acct_close_dt, '9999-12-31'::date)) AND (a2a_1.end_dt >= COALESCE(acol_1.acct_open_dt, '1900-01-01'::date)))) AND (acol_1.agrmnt_categ_id = 1))))
                                  GROUP BY a2a_1.agr_cred_id, GREATEST(a2a_1.start_dt, COALESCE(acol_1.acct_open_dt, '1900-01-01'::date)), LEAST(a2a_1.end_dt, COALESCE(acol_1.acct_close_dt, '9999-12-31'::date))) collat
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) mult ON (((mult.i = 1) OR (collat.end_dt <> '9999-12-31'::date))))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_agr_collat a2a ON (((dt.id = a2a.agr_cred_id) AND ((dt.start_dt >= a2a.start_dt) AND (dt.start_dt <= a2a.end_dt)))))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt acol ON ((((a2a.agr_collat_id = acol.agrmnt_id) AND ((dt.start_dt >= COALESCE(acol.acct_open_dt, '1900-01-01'::date)) AND (dt.start_dt <= COALESCE(acol.acct_close_dt, '9999-12-31'::date)))) AND (acol.agrmnt_categ_id = 1))))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_asset_collat_type_s act ON ((a2a.asset_collat_type_id = act.asset_collat_type_id)))
  GROUP BY dt.id, dt.start_dt, dt.end_dt;"
d_agr_cred_agr_collat," SELECT a2a.related_agrmnt_id AS agr_cred_id,
    a2a.agrmnt_id AS agr_collat_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(
        CASE
            WHEN (mkt.mkt_price_rub <> (0)::numeric) THEN mkt.mkt_price_rub
            ELSE coll.agr_collat_rub
        END, (0)::numeric) AS alloc_rub,
        CASE
            WHEN (((act.asset_collat_type_qlty_cat_cd = ANY (ARRAY['1'::text, '2'::text])) AND (cport.prvsn_port_id IS NULL)) AND (COALESCE(
            CASE
                WHEN (amtsrc.agrmnt_class_val_id = '-1001'::integer) THEN coll.agr_collat_rub
                ELSE mkt.mkt_price_rub
            END, (0)::numeric) > (0)::numeric)) THEN
            CASE
                WHEN ((a2a.eks_part_prc_ind = 'YES'::text) AND (a2a.eks_part_amt < (101)::numeric)) THEN (COALESCE(
                CASE
                    WHEN (amtsrc.agrmnt_class_val_id = '-1001'::integer) THEN coll.agr_collat_rub
                    ELSE mkt.mkt_price_rub
                END, (0)::numeric) * (a2a.eks_part_amt / (100)::numeric))
                ELSE a2a.eks_part_amt
            END
            ELSE NULL::numeric
        END AS alloc_prvsn_mkt_rub,
        CASE
            WHEN ((cport.prvsn_port_id IS NULL) AND (mkt.mkt_price_rub > (0)::numeric)) THEN
            CASE
                WHEN ((a2a.eks_part_prc_ind = 'YES'::text) AND (a2a.eks_part_amt < (101)::numeric)) THEN (mkt.mkt_price_rub * (a2a.eks_part_amt / (100)::numeric))
                ELSE a2a.eks_part_amt
            END
            ELSE NULL::numeric
        END AS alloc_car_mkt_rub,
        CASE
            WHEN ((cport.prvsn_port_id IS NULL) AND (coll.agr_collat_rub > (0)::numeric)) THEN
            CASE
                WHEN ((a2a.eks_part_prc_ind = 'YES'::text) AND (a2a.eks_part_amt < (101)::numeric)) THEN (coll.agr_collat_rub * (a2a.eks_part_amt / (100)::numeric))
                ELSE a2a.eks_part_amt
            END
            ELSE NULL::numeric
        END AS alloc_car_bal_rub,
    coll.asset_collat_type_id,
    a2a.info_system_id
   FROM (((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT a2a_1.agrmnt_id AS id,
                            a2a_1.agrmnt_related_start_dt AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related a2a_1
                          WHERE (a2a_1.agrmnt_related_type_id = '-1003'::integer)
                        UNION ALL
                         SELECT a2a_1.agrmnt_id AS id,
                            (a2a_1.agrmnt_related_end_dt + 1) AS start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related a2a_1
                          WHERE ((a2a_1.agrmnt_related_end_dt <> '9999-12-31'::date) AND (a2a_1.agrmnt_related_type_id = '-1003'::integer))
                        UNION ALL
                         SELECT coll_1.agr_collat_id AS id,
                            coll_1.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_fin coll_1
                        UNION ALL
                         SELECT coll_1.agr_collat_id AS id,
                            (coll_1.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_fin coll_1
                          WHERE (coll_1.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT mkt_1.agr_collat_id AS id,
                            mkt_1.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt mkt_1
                        UNION ALL
                         SELECT mkt_1.agr_collat_id AS id,
                            (mkt_1.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt mkt_1
                          WHERE (mkt_1.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT a2a_1.agr_collat_id AS id,
                            cfin_1.start_dt
                           FROM (( SELECT v_agrmnt_related.agrmnt_id AS agr_collat_id,
                                    v_agrmnt_related.related_agrmnt_id AS agr_cred_id
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related
                                  WHERE (v_agrmnt_related.agrmnt_related_type_id = '-1003'::integer)
                                  GROUP BY v_agrmnt_related.agrmnt_id, v_agrmnt_related.related_agrmnt_id) a2a_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt cfin_1 ON ((a2a_1.agr_cred_id = cfin_1.agr_cred_id)))
                        UNION ALL
                         SELECT a2a_1.agr_collat_id AS id,
                            (cfin_1.end_dt + 1) AS start_dt
                           FROM (( SELECT v_agrmnt_related.agrmnt_id AS agr_collat_id,
                                    v_agrmnt_related.related_agrmnt_id AS agr_cred_id
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related
                                  WHERE (v_agrmnt_related.agrmnt_related_type_id = '-1003'::integer)
                                  GROUP BY v_agrmnt_related.agrmnt_id, v_agrmnt_related.related_agrmnt_id) a2a_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt cfin_1 ON (((a2a_1.agr_cred_id = cfin_1.agr_cred_id) AND (cfin_1.end_dt <> '9999-12-31'::date))))
                        UNION ALL
                         SELECT a2a_1.agr_collat_id AS id,
                            cport_1.start_dt
                           FROM (( SELECT v_agrmnt_related.agrmnt_id AS agr_collat_id,
                                    v_agrmnt_related.related_agrmnt_id AS agr_cred_id
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related
                                  WHERE (v_agrmnt_related.agrmnt_related_type_id = '-1003'::integer)
                                  GROUP BY v_agrmnt_related.agrmnt_id, v_agrmnt_related.related_agrmnt_id) a2a_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port cport_1 ON ((a2a_1.agr_cred_id = cport_1.agr_cred_id)))
                        UNION ALL
                         SELECT a2a_1.agr_collat_id AS id,
                            (cport_1.end_dt + 1) AS start_dt
                           FROM (( SELECT v_agrmnt_related.agrmnt_id AS agr_collat_id,
                                    v_agrmnt_related.related_agrmnt_id AS agr_cred_id
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related
                                  WHERE (v_agrmnt_related.agrmnt_related_type_id = '-1003'::integer)
                                  GROUP BY v_agrmnt_related.agrmnt_id, v_agrmnt_related.related_agrmnt_id) a2a_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port cport_1 ON (((a2a_1.agr_cred_id = cport_1.agr_cred_id) AND (cport_1.end_dt <> '9999-12-31'::date))))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat ac ON ((dt.id = ac.agr_collat_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related a2a ON ((((dt.id = a2a.agrmnt_id) AND ((dt.start_dt >= a2a.agrmnt_related_start_dt) AND (dt.start_dt <= a2a.agrmnt_related_end_dt))) AND (a2a.agrmnt_related_type_id = '-1003'::integer))))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((a2a.related_agrmnt_id = agr.agr_cred_id)))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_fin coll ON (((dt.id = coll.agr_collat_id) AND ((dt.start_dt >= coll.start_dt) AND (dt.start_dt <= coll.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_asset_collat_type_s act ON ((coll.asset_collat_type_id = act.asset_collat_type_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_collat_mkt mkt ON (((dt.id = mkt.agr_collat_id) AND ((dt.start_dt >= mkt.start_dt) AND (dt.start_dt <= mkt.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dt cfin ON (((a2a.related_agrmnt_id = cfin.agr_cred_id) AND ((dt.start_dt >= cfin.start_dt) AND (dt.start_dt <= cfin.end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_port cport ON (((a2a.related_agrmnt_id = cport.agr_cred_id) AND ((dt.start_dt >= cport.start_dt) AND (dt.start_dt <= cport.end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc amtsrc ON ((((dt.id = amtsrc.agrmnt_id) AND ((dt.start_dt >= amtsrc.agrmnt_class_start_dt) AND (dt.start_dt <= amtsrc.agrmnt_class_end_dt))) AND (amtsrc.agrmnt_clsfctn_id = '-1946'::integer))));"
d_agr_cred_f_prt_f3_cnd_tmp," SELECT dt.id,
    dt.start_dt,
    dt.end_dt,
    dt.f303_cond_type_cd,
    cor.info_system_id
   FROM (( SELECT ""Window"".id,
            ""Window"".f303_cond_type_cd,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.f303_cond_type_cd,
                    dt_1.start_dt
                   FROM ( SELECT d.agr_cred_id AS id,
                            d.f303_cond_type_cd,
                                CASE
                                    WHEN (m.i = 1) THEN d.start_dt
                                    WHEN ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)) THEN (d.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM (( SELECT d_1.agr_cred_id,
                                    d_1.start_dt,
                                    d_1.end_dt,
                                    s.f303_cond_type_cd,
                                    row_number() OVER (PARTITION BY d_1.agr_cred_id ORDER BY s.f303_cond_type_cd, d_1.start_dt) AS rw_nbr
                                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_f303_cond d_1
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_f303_cond_type_s s ON ((d_1.f303_cond_type_id = s.f303_cond_type_id)))) d
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)))))) dt_1
                  GROUP BY dt_1.id, dt_1.f303_cond_type_cd, dt_1.start_dt) ""Window""(id, f303_cond_type_cd, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = dt.id)));"
d_agr_cred_f_prt_f3_ins_tmp," SELECT dt.id,
    dt.start_dt,
    dt.end_dt,
    dt.f303_ins_type_cd,
    cor.info_system_id
   FROM (( SELECT ""Window"".id,
            ""Window"".f303_ins_type_cd,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.f303_ins_type_cd,
                    dt_1.start_dt
                   FROM ( SELECT d.agr_cred_id AS id,
                            d.f303_ins_type_cd,
                                CASE
                                    WHEN (m.i = 1) THEN d.start_dt
                                    WHEN ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)) THEN (d.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM (( SELECT d_1.agr_cred_id,
                                    d_1.start_dt,
                                    d_1.end_dt,
                                    s.f303_ins_type_cd,
                                    row_number() OVER (PARTITION BY d_1.agr_cred_id ORDER BY s.f303_ins_type_cd, d_1.start_dt) AS rw_nbr
                                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_f303_ins d_1
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_f303_ins_type_s s ON ((d_1.f303_ins_type_id = s.f303_ins_type_id)))) d
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)))))) dt_1
                  GROUP BY dt_1.id, dt_1.f303_ins_type_cd, dt_1.start_dt) ""Window""(id, f303_ins_type_cd, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = dt.id)));"
d_agr_cred_f_prt_f3_inf_tmp," SELECT dt.id,
    dt.start_dt,
    dt.end_dt,
    dt.f303_inf_type_cd,
    cor.info_system_id
   FROM (( SELECT ""Window"".id,
            ""Window"".f303_inf_type_cd,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.f303_inf_type_cd,
                    dt_1.start_dt
                   FROM ( SELECT d.agr_cred_id AS id,
                            d.f303_inf_type_cd,
                                CASE
                                    WHEN (m.i = 1) THEN d.start_dt
                                    WHEN ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)) THEN (d.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM (( SELECT d_1.agr_cred_id,
                                    d_1.start_dt,
                                    d_1.end_dt,
                                    s.f303_inf_type_cd,
                                    row_number() OVER (PARTITION BY d_1.agr_cred_id ORDER BY s.f303_inf_type_cd, d_1.start_dt) AS rw_nbr
                                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_f303_inf d_1
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_f303_inf_type_s s ON ((d_1.f303_inf_type_id = s.f303_inf_type_id)))) d
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (d.end_dt <> '9999-12-31'::date)))))) dt_1
                  GROUP BY dt_1.id, dt_1.f303_inf_type_cd, dt_1.start_dt) ""Window""(id, f303_inf_type_cd, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = dt.id)));"
d_agr_cred_rate_var_rule," SELECT rat.agrmnt_id AS agr_cred_id,
    rat.start_dt,
    rat.end_dt,
    rat.mkt_idx_id,
    rat.mkt_idx_floor_rate,
    rat.mkt_idx_cap_rate,
    rat.mkt_idx_rvsn_time_period_id,
    rat.mkt_idx_rvsn_time_period_cnt,
    rat.margin_rvsn_time_period_id,
    rat.margin_rvsn_time_period_cnt,
    rat.margin_reprice_flag,
    rat.mkt_idx_quote_offset_qty,
    agr.info_system_id,
    rat.fin_meas_id
   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rat
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((rat.agrmnt_id = agr.agr_cred_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas fm ON (((rat.fin_meas_id = fm.fin_meas_id) AND (fm.fin_meas_cd = '_'::text))))
  WHERE ((rat.agrmnt_rate_var_rule_type_id = '-1001'::integer) AND (rat.fin_meas_id <> '-1001'::integer))
UNION ALL
 SELECT rat.agrmnt_id AS agr_cred_id,
    rat.start_dt,
    rat.end_dt,
    rat.mkt_idx_id,
    rat.mkt_idx_floor_rate,
    rat.mkt_idx_cap_rate,
    rat.mkt_idx_rvsn_time_period_id,
    rat.mkt_idx_rvsn_time_period_cnt,
    rat.margin_rvsn_time_period_id,
    rat.margin_rvsn_time_period_cnt,
    rat.margin_reprice_flag,
    rat.mkt_idx_quote_offset_qty,
    agr.info_system_id,
    rat.fin_meas_id
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.c_agrmnt_rate_var_rule rat
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((rat.agrmnt_id = agr.agr_cred_id)));"
d_agr_cred_fin_tmp," SELECT t.agr_cred_id,
    t.start_dt,
    t.end_dt,
    t.bus_line_type_id,
    t.restruct_cnt,
    t.last_expiration_dt,
    t.agr_cred_rate,
    t.last_prolong_dt,
    t.last_restruct_dt,
    t.prolong_cnt,
    t.bki_grant_flag,
    t.bki_query_flag,
    t.grntee_claim_notice_flag,
    t.eks_grntee_claim_noticed_flag,
    t.f303_ins_types_cd,
    t.f303_inf_types_cd,
    t.cond_prec_flag,
    t.f26_asset_collat_type_id,
    t.extrajudicial_appeal_flag,
    t.agr_cred_purpose_ext_id,
    t.adjust_fund_factor,
        CASE
            WHEN ((t.cond_prec_flag = 'Y'::text) AND (COALESCE(t.f303_cond_types_cd, '?'::text) !~~ '%%'::text)) THEN (COALESCE((t.f303_cond_types_cd || ','::text), ''::text) || ''::text)
            ELSE t.f303_cond_types_cd
        END AS f303_cond_types_cd,
    t.agr_cred_rate_type_cd,
        CASE
            WHEN ((((t.agrmnt_id_flg_esc IS NOT NULL) OR (t.agrmnt_id_flg_acc IS NOT NULL)) AND (t.agrmnt_id_vrl IS NOT NULL)) AND (t.agrmnt_rate_var_rule_type_id = '-1001'::integer)) THEN t.vrl_mkt_idx_id
            WHEN (((((t.agrmnt_id_flg_esc IS NOT NULL) OR (t.agrmnt_id_flg_acc IS NOT NULL)) AND (t.agrmnt_id_vrl IS NOT NULL)) AND (t.agrmnt_rate_var_rule_type_id = '-1002'::integer)) AND (t.agr_cred_rate_type_cd = ''::text)) THEN NULL::bigint
            ELSE t.frat_mkt_idx_id
        END AS mkt_idx_id,
    t.mkt_idx_next_rvsn_dt,
    t.mkt_idx_rvsn_dt,
    t.mkt_idx_quote_dt,
    t.rate_rvsn_time_period_id,
    t.rate_rvsn_month_cnt,
    t.agr_cred_current_rate,
    t.agr_cred_compens_rate,
    t.agr_cred_deferral_rate,
    t.grntee_spec_id,
    t.security_for_cb_loan_flag,
    t.info_system_id,
    t.escrow_flag,
    t.escrow_margin_rate,
    t.prvsn_med_rate,
    t.rate_irremovable_bia_flag
   FROM ( SELECT dt.id AS agr_cred_id,
            dt.start_dt,
            dt.end_dt,
            blt.agrmnt_class_val_id AS bus_line_type_id,
                CASE
                    WHEN (COALESCE(arh2.normal_restruct_cnt, (0)::bigint) > 0) THEN arh2.normal_restruct_cnt
                    ELSE (COALESCE((agr.eks_old_restruct_cnt)::integer, 0))::bigint
                END AS restruct_cnt,
                CASE
                    WHEN (agr.agr_cred_type_id = '-1006'::integer) THEN COALESCE(lst_exp_grn.acct_bal_metric_dt, agr.expiration_dt)
                    ELSE COALESCE(arh2.last_expiration_dt, agr.expiration_dt)
                END AS last_expiration_dt,
            NULL::numeric(38,12) AS agr_cred_rate,
            arh2.last_prolong_dt,
            arh2.last_restruct_dt,
            (COALESCE(arh2.normal_prolong_cnt, (0)::bigint) + COALESCE((agr.eks_old_prolong_cnt)::integer, 0)) AS prolong_cnt,
                CASE bki.agrmnt_class_val_id
                    WHEN '-1001'::integer THEN 'Y'::text
                    WHEN '-1002'::integer THEN 'N'::text
                    ELSE NULL::text
                END AS bki_grant_flag,
                CASE bki_q.agrmnt_class_val_id
                    WHEN '-1001'::integer THEN 'Y'::text
                    WHEN '-1002'::integer THEN 'N'::text
                    ELSE NULL::text
                END AS bki_query_flag,
                CASE grnt_flg.agrmnt_class_val_id
                    WHEN '-1001'::integer THEN 'Y'::text
                    WHEN '-1002'::integer THEN 'N'::text
                    ELSE NULL::text
                END AS grntee_claim_notice_flag,
                CASE not_req_flg.agrmnt_class_val_id
                    WHEN '-1001'::integer THEN 'Y'::text
                    WHEN '-1002'::integer THEN 'N'::text
                    ELSE NULL::text
                END AS eks_grntee_claim_noticed_flag,
            f303_ins.f303_ins_types_cd,
            f303_inf.f303_inf_types_cd,
                CASE delayed_cnd.agrmnt_class_val_id
                    WHEN '-1001'::integer THEN 'Y'::text
                    ELSE 'N'::text
                END AS cond_prec_flag,
            f26act.agrmnt_class_val_id AS f26_asset_collat_type_id,
                CASE ea_flag.agrmnt_class_val_id
                    WHEN '-1001'::integer THEN 'Y'::text
                    WHEN '-1002'::integer THEN 'N'::text
                    ELSE NULL::text
                END AS extrajudicial_appeal_flag,
            agrextp.agrmnt_class_val_id AS agr_cred_purpose_ext_id,
            (adj_ff.acct_rate / (100)::numeric) AS adjust_fund_factor,
                CASE
                    WHEN ((((flg_esc.agrmnt_id IS NOT NULL) OR (flg_acc.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_rate_var_rule_type_id = '-1001'::integer)) THEN ''::text
                    WHEN (rl_mkt.id IS NOT NULL) THEN ''::text
                    WHEN (rl_otl.id IS NOT NULL) THEN ''::text
                    WHEN (float_otl.id IS NOT NULL) THEN ''::text
                    WHEN (rl_cap_otl.id IS NOT NULL) THEN ''::text
                    WHEN (rl_subs.id IS NOT NULL) THEN ''::text
                    WHEN ((frat.agr_cred_id IS NULL) AND (uvdo_rt.agr_cred_id IS NULL)) THEN ''::text
                    WHEN ((frat.mkt_idx_id = '-1'::bigint) AND (frat.margin_reprice_flag = 'N'::text)) THEN ''::text
                    WHEN ((frat.mkt_idx_id = '-1'::bigint) AND (frat.margin_reprice_flag = 'Y'::text)) THEN ''::text
                    WHEN ((frat.mkt_idx_id <> '-1'::bigint) AND (frat.margin_reprice_flag = 'N'::text)) THEN ''::text
                    WHEN ((frat.mkt_idx_id <> '-1'::bigint) AND (frat.margin_reprice_flag = 'Y'::text)) THEN ''::text
                    WHEN (uvdo_rt.agr_cred_id IS NOT NULL) THEN ''::text
                    ELSE NULL::text
                END AS agr_cred_rate_type_cd,
                CASE
                    WHEN ((((flg_esc.agrmnt_id IS NOT NULL) OR (flg_acc.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_rate_var_rule_type_id = '-1001'::integer)) THEN NULL::date
                    WHEN (frvt.end_dt = '9999-12-31'::date) THEN NULL::date
                    ELSE (frvt.end_dt + 1)
                END AS mkt_idx_next_rvsn_dt,
                CASE
                    WHEN ((((flg_esc.agrmnt_id IS NOT NULL) OR (flg_acc.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_rate_var_rule_type_id = '-1001'::integer)) THEN NULL::date
                    ELSE frvt.start_dt
                END AS mkt_idx_rvsn_dt,
            frvt.mkt_idx_quote_dt,
            tpt.time_period_type_id AS rate_rvsn_time_period_id,
            tpt.month_qty AS rate_rvsn_month_cnt,
            new_rate.acct_rate AS agr_cred_current_rate,
            new_rate.agr_cred_compens_rate,
            new_rate.agr_cred_deferral_rate,
            clc1059.agrmnt_class_val_id AS grntee_spec_id,
                CASE
                    WHEN (clc1061.agrmnt_id IS NOT NULL) THEN 'Y'::text
                    ELSE 'N'::text
                END AS security_for_cb_loan_flag,
            agr.info_system_id,
                CASE
                    WHEN ((((flg_esc.agrmnt_id IS NOT NULL) OR (flg_acc.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_rate_var_rule_type_id = '-1001'::integer)) THEN 1
                    ELSE 0
                END AS escrow_flag,
                CASE
                    WHEN ((((flg_esc.agrmnt_id IS NOT NULL) OR (flg_acc.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_id IS NOT NULL)) AND (vrl.agrmnt_rate_var_rule_type_id = '-1001'::integer)) THEN vrl.eks_margin_rate
                    ELSE (0)::numeric
                END AS escrow_margin_rate,
            ar_mep.acct_rate AS prvsn_med_rate,
            NULL::text AS rate_irremovable_bia_flag,
            f303_cnd.f303_cond_types_cd,
            flg_esc.agrmnt_id AS agrmnt_id_flg_esc,
            flg_acc.agrmnt_id AS agrmnt_id_flg_acc,
            vrl.agrmnt_id AS agrmnt_id_vrl,
            vrl.agrmnt_rate_var_rule_type_id,
            vrl.mkt_idx_id AS vrl_mkt_idx_id,
            frat.mkt_idx_id AS frat_mkt_idx_id
           FROM ((((((((((((((((((((((((((((((((( SELECT ""Window"".id,
                    ""Window"".start_dt,
                    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                   FROM ( SELECT dt_1.id,
                            dt_1.start_dt
                           FROM ( SELECT aaca.agrmnt_id AS id,
                                    aaca.agrmnt_class_start_dt AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca
                                  WHERE (aaca.agrmnt_clsfctn_id = ANY (ARRAY[8, '-1004'::integer, '-1023'::integer, '-1026'::integer, '-1027'::integer, '-1033'::integer, '-1054'::integer, '-1056'::integer, '-1057'::integer, '-1059'::integer, '-1061'::integer]))
                                UNION ALL
                                 SELECT aaca.agrmnt_id AS id,
                                    (aaca.agrmnt_class_end_dt + 1) AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca
                                  WHERE ((aaca.agrmnt_clsfctn_id = ANY (ARRAY[8, '-1004'::integer, '-1023'::integer, '-1026'::integer, '-1027'::integer, '-1033'::integer, '-1054'::integer, '-1056'::integer, '-1057'::integer, '-1059'::integer, '-1061'::integer])) AND (aaca.agrmnt_class_end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT t_1.agrmnt_id,
                                    (t_1.calc_end_dt + 1) AS start_dt
                                   FROM ( SELECT v_agmt_agmt_class_assoc.agrmnt_id,
  CASE
   WHEN (v_agmt_agmt_class_assoc.agrmnt_class_end_dt > COALESCE((max(v_agmt_agmt_class_assoc.agrmnt_class_start_dt) OVER (PARTITION BY v_agmt_agmt_class_assoc.agrmnt_id ORDER BY v_agmt_agmt_class_assoc.agrmnt_class_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date)) THEN COALESCE((max(v_agmt_agmt_class_assoc.agrmnt_class_start_dt) OVER (PARTITION BY v_agmt_agmt_class_assoc.agrmnt_id ORDER BY v_agmt_agmt_class_assoc.agrmnt_class_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date)
   ELSE v_agmt_agmt_class_assoc.agrmnt_class_end_dt
  END AS calc_end_dt
   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
  WHERE (v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1061'::integer)) t_1
                                  WHERE (t_1.calc_end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT arh.agrmnt_id AS id,
                                    arh.contract_start_dt AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist arh
                                UNION ALL
                                 SELECT arh.agrmnt_id AS id,
                                    (arh.contract_end_dt + 1) AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist arh
                                  WHERE (arh.contract_end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT d_agr_cred_rate_tmp.agr_cred_id AS id,
                                    d_agr_cred_rate_tmp.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_tmp
                                UNION ALL
                                 SELECT d_agr_cred_rate_tmp.agr_cred_id AS id,
                                    (d_agr_cred_rate_tmp.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_tmp
                                  WHERE (d_agr_cred_rate_tmp.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT ai.agr_cred_id AS id,
                                    ai.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_ins_tmp ai
                                UNION ALL
                                 SELECT ai.agr_cred_id AS id,
                                    (ai.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_ins_tmp ai
                                  WHERE (ai.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT ai.agr_cred_id AS id,
                                    ai.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_inf_tmp ai
                                UNION ALL
                                 SELECT ai.agr_cred_id AS id,
                                    (ai.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_inf_tmp ai
                                  WHERE (ai.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT ai.agr_cred_id AS id,
                                    ai.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_cnd_tmp ai
                                UNION ALL
                                 SELECT ai.agr_cred_id AS id,
                                    (ai.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_cnd_tmp ai
                                  WHERE (ai.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT frat_1.agr_cred_id AS id,
                                    frat_1.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rule frat_1
                                UNION ALL
                                 SELECT frat_1.agr_cred_id AS id,
                                    (frat_1.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rule frat_1
                                  WHERE (frat_1.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT frvt_1.agr_cred_id AS id,
                                    frvt_1.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rvsn frvt_1
                                UNION ALL
                                 SELECT frvt_1.agr_cred_id AS id,
                                    (frvt_1.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rvsn frvt_1
                                  WHERE (frvt_1.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT adj_ff_1.agrmnt_id AS id,
                                    adj_ff_1.acct_rate_start_dt AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate adj_ff_1
                                  WHERE (((((((((adj_ff_1.fin_meas_id = '-1'::integer) AND (adj_ff_1.bal_cat_type_id = 5)) AND (adj_ff_1.acct_rate_time_period_id = '-1'::integer)) AND (adj_ff_1.intrst_calc_type_id = '-1'::integer)) AND (adj_ff_1.term_compliance_type_id = 1)) AND (adj_ff_1.intrst_rate_type_id = 1)) AND (adj_ff_1.intrst_calc_rule_type_id = '-1'::integer)) AND (adj_ff_1.intrst_calc_type_id = '-1'::integer)) AND (adj_ff_1.rate_type_id = '-1004'::integer))
                                UNION ALL
                                 SELECT adj_ff_1.agrmnt_id AS id,
                                    (adj_ff_1.acct_rate_end_dt + 1) AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate adj_ff_1
                                  WHERE ((((((((((adj_ff_1.fin_meas_id = '-1'::integer) AND (adj_ff_1.bal_cat_type_id = 5)) AND (adj_ff_1.acct_rate_time_period_id = '-1'::integer)) AND (adj_ff_1.intrst_calc_type_id = '-1'::integer)) AND (adj_ff_1.term_compliance_type_id = 1)) AND (adj_ff_1.intrst_rate_type_id = 1)) AND (adj_ff_1.intrst_calc_rule_type_id = '-1'::integer)) AND (adj_ff_1.intrst_calc_type_id = '-1'::integer)) AND (adj_ff_1.rate_type_id = '-1004'::integer)) AND (adj_ff_1.acct_rate_end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT ar_mep_1.agrmnt_id AS id,
                                    ar_mep_1.acct_rate_start_dt AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate ar_mep_1
                                  WHERE (((((((((ar_mep_1.fin_meas_id = '-1'::integer) AND (ar_mep_1.bal_cat_type_id = '-1'::integer)) AND (ar_mep_1.acct_rate_time_period_id = '-1'::integer)) AND (ar_mep_1.intrst_calc_type_id = '-1'::integer)) AND (ar_mep_1.term_compliance_type_id = 1)) AND (ar_mep_1.intrst_rate_type_id = 1)) AND (ar_mep_1.intrst_calc_rule_type_id = '-1'::integer)) AND (ar_mep_1.intrst_calc_type_id = '-1'::integer)) AND (ar_mep_1.rate_type_id = '-1005'::integer))
                                UNION ALL
                                 SELECT ar_mep_1.agrmnt_id AS id,
                                    (ar_mep_1.acct_rate_end_dt + 1) AS start_dt
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate ar_mep_1
                                  WHERE ((((((((((ar_mep_1.fin_meas_id = '-1'::integer) AND (ar_mep_1.bal_cat_type_id = '-1'::integer)) AND (ar_mep_1.acct_rate_time_period_id = '-1'::integer)) AND (ar_mep_1.intrst_calc_type_id = '-1'::integer)) AND (ar_mep_1.term_compliance_type_id = 1)) AND (ar_mep_1.intrst_rate_type_id = 1)) AND (ar_mep_1.intrst_calc_rule_type_id = '-1'::integer)) AND (ar_mep_1.intrst_calc_type_id = '-1'::integer)) AND (ar_mep_1.rate_type_id = '-1005'::integer)) AND (ar_mep_1.acct_rate_end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT cor.agr_cred_id AS id,
                                    '1900-01-01'::date AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor
                                UNION ALL
                                 SELECT rl.agrmnt_id AS id,
                                    rl.start_dt
                                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                                  WHERE (rl.agrmnt_rate_var_rule_type_id = ANY (ARRAY['-1002'::integer, '-1001'::integer]))
                                UNION ALL
                                 SELECT rl.agrmnt_id AS id,
                                    (rl.end_dt + 1)
                                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                                  WHERE ((rl.agrmnt_rate_var_rule_type_id = ANY (ARRAY['-1002'::integer, '-1001'::integer])) AND (rl.end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT c_agrmnt_rate_var_rule.agrmnt_id,
                                    c_agrmnt_rate_var_rule.start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agrmnt_rate_var_rule
                                UNION ALL
                                 SELECT c_agrmnt_rate_var_rule.agrmnt_id,
                                    (c_agrmnt_rate_var_rule.end_dt + 1) AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agrmnt_rate_var_rule
                                  WHERE (c_agrmnt_rate_var_rule.end_dt <> '9999-12-31'::date)
                                UNION ALL
                                 SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                                    c_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                                  WHERE ((c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY['-1065'::integer, '-1066'::integer])) AND (c_agmt_agmt_class_assoc.agrmnt_class_val_id = '-1001'::integer))
                                UNION ALL
                                 SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                                    (c_agmt_agmt_class_assoc.agrmnt_class_end_dt + 1) AS end_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                                  WHERE (((c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = ANY (ARRAY['-1065'::integer, '-1066'::integer])) AND (c_agmt_agmt_class_assoc.agrmnt_class_val_id = '-1001'::integer)) AND (c_agmt_agmt_class_assoc.agrmnt_class_end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                                    c_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                                  WHERE ((1 = 0) AND (c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1070'::integer))
                                UNION ALL
                                 SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                                    (c_agmt_agmt_class_assoc.agrmnt_class_end_dt + 1) AS end_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                                  WHERE (((1 = 0) AND (c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1070'::integer)) AND (c_agmt_agmt_class_assoc.agrmnt_class_end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT hst.agrmnt_id AS id,
                                    hst.acct_bal_metric_start_dt AS start_dt
                                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist hst
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt ff ON (((hst.agrmnt_id = ff.agrmnt_id) AND (ff.fin_agrmnt_type_id = '-1006'::integer))))
                                  WHERE (hst.acct_metric_type_id = '-1046'::integer)
                                UNION ALL
                                 SELECT hst.agrmnt_id AS id,
                                    (hst.acct_bal_metric_end_dt + 1)
                                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist hst
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt ff ON (((hst.agrmnt_id = ff.agrmnt_id) AND (ff.fin_agrmnt_type_id = '-1006'::integer))))
                                  WHERE ((hst.acct_metric_type_id = '-1046'::integer) AND (hst.acct_bal_metric_end_dt <> '9999-12-31'::date))
                                UNION ALL
                                 SELECT agr_1.agr_cred_id,
                                    '1900-01-01'::date AS start_dt
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo agr_1) dt_1
                          GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
             JOIN ( SELECT agr_1.agr_cred_id,
                    agr_1.eks_old_restruct_cnt,
                    agr_1.expiration_dt,
                    agr_1.eks_old_prolong_cnt,
                    agr_1.agr_cred_type_id,
                    agr_1.info_system_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr_1
                UNION ALL
                 SELECT agr_1.agr_cred_id,
                    NULL::smallint AS int2,
                    NULL::date AS date,
                    NULL::smallint AS int2,
                    NULL::bigint AS int8,
                    agr_1.info_system_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo agr_1) agr ON ((agr.agr_cred_id = dt.id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc blt ON (((((blt.agrmnt_id = dt.id) AND (dt.start_dt >= blt.agrmnt_class_start_dt)) AND (dt.start_dt <= blt.agrmnt_class_end_dt)) AND (blt.agrmnt_clsfctn_id = 8))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc bki ON (((((bki.agrmnt_id = dt.id) AND (dt.start_dt >= bki.agrmnt_class_start_dt)) AND (dt.start_dt <= bki.agrmnt_class_end_dt)) AND (bki.agrmnt_clsfctn_id = '-1004'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc bki_q ON (((((bki_q.agrmnt_id = dt.id) AND (dt.start_dt >= bki_q.agrmnt_class_start_dt)) AND (dt.start_dt <= bki_q.agrmnt_class_end_dt)) AND (bki_q.agrmnt_clsfctn_id = '-1023'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc grnt_flg ON (((((grnt_flg.agrmnt_id = dt.id) AND (dt.start_dt >= grnt_flg.agrmnt_class_start_dt)) AND (dt.start_dt <= grnt_flg.agrmnt_class_end_dt)) AND (grnt_flg.agrmnt_clsfctn_id = '-1026'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc not_req_flg ON (((((not_req_flg.agrmnt_id = dt.id) AND (dt.start_dt >= not_req_flg.agrmnt_class_start_dt)) AND (dt.start_dt <= not_req_flg.agrmnt_class_end_dt)) AND (not_req_flg.agrmnt_clsfctn_id = '-1027'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc delayed_cnd ON (((((delayed_cnd.agrmnt_id = dt.id) AND (dt.start_dt >= delayed_cnd.agrmnt_class_start_dt)) AND (dt.start_dt <= delayed_cnd.agrmnt_class_end_dt)) AND (delayed_cnd.agrmnt_clsfctn_id = '-1033'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc f26act ON (((((f26act.agrmnt_id = dt.id) AND (dt.start_dt >= f26act.agrmnt_class_start_dt)) AND (dt.start_dt <= f26act.agrmnt_class_end_dt)) AND (f26act.agrmnt_clsfctn_id = '-1054'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc ea_flag ON (((((ea_flag.agrmnt_id = dt.id) AND (dt.start_dt >= ea_flag.agrmnt_class_start_dt)) AND (dt.start_dt <= ea_flag.agrmnt_class_end_dt)) AND (ea_flag.agrmnt_clsfctn_id = '-1056'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc agrextp ON (((((agrextp.agrmnt_id = dt.id) AND (dt.start_dt >= agrextp.agrmnt_class_start_dt)) AND (dt.start_dt <= agrextp.agrmnt_class_end_dt)) AND (agrextp.agrmnt_clsfctn_id = '-1057'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc clc1059 ON (((((clc1059.agrmnt_id = dt.id) AND (dt.start_dt >= clc1059.agrmnt_class_start_dt)) AND (dt.start_dt <= clc1059.agrmnt_class_end_dt)) AND (clc1059.agrmnt_clsfctn_id = '-1059'::integer))))
             LEFT JOIN ( SELECT v_agmt_agmt_class_assoc.agrmnt_id,
                    v_agmt_agmt_class_assoc.agrmnt_class_start_dt,
                        CASE
                            WHEN (v_agmt_agmt_class_assoc.agrmnt_class_end_dt > COALESCE((max(v_agmt_agmt_class_assoc.agrmnt_class_start_dt) OVER (PARTITION BY v_agmt_agmt_class_assoc.agrmnt_id ORDER BY v_agmt_agmt_class_assoc.agrmnt_class_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date)) THEN COALESCE((max(v_agmt_agmt_class_assoc.agrmnt_class_start_dt) OVER (PARTITION BY v_agmt_agmt_class_assoc.agrmnt_id ORDER BY v_agmt_agmt_class_assoc.agrmnt_class_start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date)
                            ELSE v_agmt_agmt_class_assoc.agrmnt_class_end_dt
                        END AS agrmnt_class_end_dt
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
                  WHERE (v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1061'::integer)) clc1061 ON ((((clc1061.agrmnt_id = dt.id) AND (dt.start_dt >= clc1061.agrmnt_class_start_dt)) AND (dt.start_dt <= clc1061.agrmnt_class_end_dt))))
             LEFT JOIN ( SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                    c_agmt_agmt_class_assoc.agrmnt_class_val_id,
                    c_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt,
                    c_agmt_agmt_class_assoc.agrmnt_class_end_dt AS end_dt
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                  WHERE ((1 = 0) AND (c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1070'::integer))) clc1070 ON ((((dt.id = clc1070.agrmnt_id) AND (dt.start_dt >= clc1070.start_dt)) AND (dt.start_dt <= clc1070.end_dt))))
             LEFT JOIN ( SELECT dst2.agr_cred_id,
                    dst2.start_dt,
                    dst2.end_dt,
                    dst2.normal_restruct_cnt,
                    dst2.last_restruct_dt,
                    dst2.last_expiration_dt,
                    dst2.last_prolong_dt,
                    dst2.normal_prolong_cnt
                   FROM ( SELECT dt_1.id AS agr_cred_id,
                            dt_1.start_dt,
                            max(dt_1.end_dt) AS end_dt,
                            sum(
                                CASE
                                    WHEN (COALESCE(addend.restruct_flag, 'N'::text) = 'Y'::text) THEN 1
                                    ELSE 0
                                END) AS normal_restruct_cnt,
                            max(
                                CASE
                                    WHEN (COALESCE(addend.restruct_flag, 'N'::text) = 'Y'::text) THEN addend.signed_dt
                                    ELSE NULL::date
                                END) AS last_restruct_dt,
                            max(
                                CASE
                                    WHEN (addend.signed_dt = dt_1.start_dt) THEN addend.expiration_dt
                                    ELSE NULL::date
                                END) AS last_expiration_dt,
                            max(
                                CASE
                                    WHEN (COALESCE(addend.prolong_flag, 'N'::text) = 'Y'::text) THEN addend.signed_dt
                                    ELSE NULL::date
                                END) AS last_prolong_dt,
                            sum(
                                CASE
                                    WHEN (COALESCE(addend.prolong_flag, 'N'::text) = 'Y'::text) THEN 1
                                    ELSE 0
                                END) AS normal_prolong_cnt
                           FROM (( SELECT ""Window"".id,
                                    ""Window"".start_dt,
                                    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                                   FROM ( SELECT dt_2.id,
    dt_2.start_dt
   FROM ( SELECT arh.agrmnt_id AS id,
      arh.contract_start_dt AS start_dt
     FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist arh
    WHERE ((arh.contract_start_dt <> '9999-12-31'::date) AND (arh.acct_renewal_categ_id = '-1001'::integer))
  UNION ALL
   SELECT arh.agrmnt_id AS id,
      (arh.contract_end_dt + 1) AS start_dt
     FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist arh
    WHERE ((arh.contract_end_dt <> '9999-12-31'::date) AND (arh.acct_renewal_categ_id = '-1001'::integer))) dt_2
  GROUP BY dt_2.id, dt_2.start_dt) ""Window""(id, start_dt)) dt_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_addendum addend ON (((addend.agr_cred_id = dt_1.id) AND (addend.signed_dt <= dt_1.start_dt))))
                          GROUP BY dt_1.id, dt_1.start_dt) dst2) arh2 ON ((((dt.id = arh2.agr_cred_id) AND (dt.start_dt >= arh2.start_dt)) AND (dt.start_dt <= arh2.end_dt))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_tmp new_rate ON ((((dt.id = new_rate.agr_cred_id) AND (dt.start_dt >= new_rate.start_dt)) AND (dt.start_dt <= new_rate.end_dt))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_ins_tmp f303_ins ON ((((f303_ins.agr_cred_id = dt.id) AND (dt.start_dt >= f303_ins.start_dt)) AND (dt.start_dt <= f303_ins.end_dt))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_inf_tmp f303_inf ON ((((f303_inf.agr_cred_id = dt.id) AND (dt.start_dt >= f303_inf.start_dt)) AND (dt.start_dt <= f303_inf.end_dt))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_f_prt_f3_cnd_tmp f303_cnd ON ((((f303_cnd.agr_cred_id = dt.id) AND (dt.start_dt >= f303_cnd.start_dt)) AND (dt.start_dt <= f303_cnd.end_dt))))
             LEFT JOIN (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rule frat
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_time_period_type tpt ON (((
                CASE
                    WHEN (frat.margin_reprice_flag = 'Y'::text) THEN frat.margin_rvsn_time_period_id
                    ELSE frat.mkt_idx_rvsn_time_period_id
                END = tpt.unit_of_time_id) AND (
                CASE
                    WHEN (frat.margin_reprice_flag = 'Y'::text) THEN frat.margin_rvsn_time_period_cnt
                    ELSE frat.mkt_idx_rvsn_time_period_cnt
                END = tpt.unit_of_time_qty)))) ON (((((frat.agr_cred_id = dt.id) AND (frat.fin_meas_id <> '-1001'::integer)) AND (dt.start_dt >= frat.start_dt)) AND (dt.start_dt <= frat.end_dt))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_rate_var_rvsn frvt ON ((((frvt.agr_cred_id = dt.id) AND (dt.start_dt >= frvt.start_dt)) AND (dt.start_dt <= frvt.end_dt))))
             LEFT JOIN ( SELECT adj_ff_1.agrmnt_id AS id,
                    adj_ff_1.acct_rate_start_dt AS start_dt,
                    adj_ff_1.acct_rate_end_dt AS end_dt,
                    adj_ff_1.acct_rate
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate adj_ff_1
                  WHERE (((((((((adj_ff_1.fin_meas_id = '-1'::integer) AND (adj_ff_1.bal_cat_type_id = 5)) AND (adj_ff_1.acct_rate_time_period_id = '-1'::integer)) AND (adj_ff_1.intrst_calc_type_id = '-1'::integer)) AND (adj_ff_1.term_compliance_type_id = 1)) AND (adj_ff_1.intrst_rate_type_id = 1)) AND (adj_ff_1.intrst_calc_rule_type_id = '-1'::integer)) AND (adj_ff_1.intrst_calc_type_id = '-1'::integer)) AND (adj_ff_1.rate_type_id = '-1004'::integer))) adj_ff ON ((((adj_ff.id = dt.id) AND (dt.start_dt >= adj_ff.start_dt)) AND (dt.start_dt <= adj_ff.end_dt))))
             LEFT JOIN ( SELECT ar_mep_1.agrmnt_id AS id,
                    ar_mep_1.acct_rate_start_dt AS start_dt,
                    ar_mep_1.acct_rate_end_dt AS end_dt,
                    ar_mep_1.acct_rate
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_rate ar_mep_1
                  WHERE (((((((((ar_mep_1.fin_meas_id = '-1'::integer) AND (ar_mep_1.bal_cat_type_id = '-1'::integer)) AND (ar_mep_1.acct_rate_time_period_id = '-1'::integer)) AND (ar_mep_1.intrst_calc_type_id = '-1'::integer)) AND (ar_mep_1.term_compliance_type_id = 1)) AND (ar_mep_1.intrst_rate_type_id = 1)) AND (ar_mep_1.intrst_calc_rule_type_id = '-1'::integer)) AND (ar_mep_1.intrst_calc_type_id = '-1'::integer)) AND (ar_mep_1.rate_type_id = '-1005'::integer))) ar_mep ON ((((ar_mep.id = dt.id) AND (dt.start_dt >= ar_mep.start_dt)) AND (dt.start_dt <= ar_mep.end_dt))))
             LEFT JOIN ( SELECT rl.agrmnt_id AS id,
                    rl.start_dt,
                    rl.end_dt
                   FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas vfm ON (((vfm.fin_meas_id = rl.fin_meas_id) AND (vfm.fin_meas_cd = '_'::text))))
                  WHERE ((rl.agrmnt_rate_var_rule_type_id = '-1002'::integer) AND (rl.fin_meas_id <> '-1001'::integer))) rl_mkt ON ((((rl_mkt.id = dt.id) AND (dt.start_dt >= rl_mkt.start_dt)) AND (dt.start_dt <= rl_mkt.end_dt))))
             LEFT JOIN ( SELECT rl.agrmnt_id AS id,
                    rl.start_dt,
                    rl.end_dt,
                    vfm.fin_meas_id,
                    vfm.fin_meas_cd,
                    vfm.fin_meas_name,
                    vfm.info_system_id,
                    vfm.agr_coa_role_id
                   FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas vfm ON (((vfm.fin_meas_id = rl.fin_meas_id) AND (vfm.fin_meas_cd = '__N'::text))))
                  WHERE (rl.agrmnt_rate_var_rule_type_id = '-1002'::integer)) rl_otl ON ((((rl_otl.id = dt.id) AND (dt.start_dt >= rl_otl.start_dt)) AND (dt.start_dt <= rl_otl.end_dt))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.c_agrmnt_rate_var_rule vrl ON ((((dt.id = vrl.agrmnt_id) AND (dt.start_dt >= vrl.start_dt)) AND (dt.start_dt <= vrl.end_dt))))
             LEFT JOIN ( SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                    c_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt,
                    c_agmt_agmt_class_assoc.agrmnt_class_end_dt AS end_dt
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                  WHERE ((c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1065'::integer) AND (c_agmt_agmt_class_assoc.agrmnt_class_val_id = '-1001'::integer))) flg_esc ON ((((dt.id = flg_esc.agrmnt_id) AND (dt.start_dt >= flg_esc.start_dt)) AND (dt.start_dt <= flg_esc.end_dt))))
             LEFT JOIN ( SELECT c_agmt_agmt_class_assoc.agrmnt_id,
                    c_agmt_agmt_class_assoc.agrmnt_class_start_dt AS start_dt,
                    c_agmt_agmt_class_assoc.agrmnt_class_end_dt AS end_dt
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.c_agmt_agmt_class_assoc
                  WHERE ((c_agmt_agmt_class_assoc.agrmnt_clsfctn_id = '-1066'::integer) AND (c_agmt_agmt_class_assoc.agrmnt_class_val_id = '-1001'::integer))) flg_acc ON ((((dt.id = flg_acc.agrmnt_id) AND (dt.start_dt >= flg_acc.start_dt)) AND (dt.start_dt <= flg_acc.end_dt))))
             LEFT JOIN ( SELECT hst.agrmnt_id,
                    hst.acct_bal_metric_start_dt AS start_dt,
                    hst.acct_bal_metric_end_dt AS end_dt,
                    hst.acct_bal_metric_dt
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist hst
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt ff ON (((hst.agrmnt_id = ff.agrmnt_id) AND (ff.fin_agrmnt_type_id = '-1006'::integer))))
                  WHERE (hst.acct_metric_type_id = '-1046'::integer)) lst_exp_grn ON ((((dt.id = lst_exp_grn.agrmnt_id) AND (dt.start_dt >= lst_exp_grn.start_dt)) AND (dt.start_dt <= lst_exp_grn.end_dt))))
             LEFT JOIN ( SELECT rl.agrmnt_id AS id,
                    rl.start_dt,
                    rl.end_dt,
                    vfm.fin_meas_id,
                    vfm.fin_meas_cd,
                    vfm.fin_meas_name,
                    vfm.info_system_id,
                    vfm.agr_coa_role_id
                   FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas vfm ON (((vfm.fin_meas_id = rl.fin_meas_id) AND (vfm.fin_meas_cd = '__N'::text))))
                  WHERE (rl.agrmnt_rate_var_rule_type_id = '-1001'::integer)) float_otl ON ((((float_otl.id = dt.id) AND (dt.start_dt >= float_otl.start_dt)) AND (dt.start_dt <= float_otl.end_dt))))
             LEFT JOIN ( SELECT rl.agrmnt_id AS id,
                    rl.start_dt,
                    rl.end_dt,
                    vfm.fin_meas_id,
                    vfm.fin_meas_cd,
                    vfm.fin_meas_name,
                    vfm.info_system_id,
                    vfm.agr_coa_role_id
                   FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas vfm ON (((vfm.fin_meas_id = rl.fin_meas_id) AND (vfm.fin_meas_cd = '____'::text))))
                  WHERE (rl.agrmnt_rate_var_rule_type_id = '-1002'::integer)) rl_cap_otl ON ((((rl_cap_otl.id = dt.id) AND (dt.start_dt >= rl_cap_otl.start_dt)) AND (dt.start_dt <= rl_cap_otl.end_dt))))
             LEFT JOIN ( SELECT rl.agrmnt_id AS id,
                    rl.start_dt,
                    rl.end_dt,
                    vfm.fin_meas_id,
                    vfm.fin_meas_cd,
                    vfm.fin_meas_name,
                    vfm.info_system_id,
                    vfm.agr_coa_role_id
                   FROM (((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_rate_var_rule rl
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx mkt ON ((mkt.mkt_idx_id = rl.mkt_idx_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_mkt_idx_type mkt_tp ON (((mkt.mkt_idx_type_id = mkt_tp.mkt_idx_type_id) AND (mkt_tp.mkt_idx_type_cd = '   '::text))))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas vfm ON (((vfm.fin_meas_id = rl.fin_meas_id) AND (vfm.fin_meas_cd = '_'::text))))
                  WHERE (rl.agrmnt_rate_var_rule_type_id = '-1002'::integer)) rl_subs ON ((((rl_subs.id = dt.id) AND (dt.start_dt >= rl_subs.start_dt)) AND (dt.start_dt <= rl_subs.end_dt))))
             LEFT JOIN ( SELECT agr_1.agr_cred_id,
                    us.uvdo_accred_scheme_cd
                   FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_1
                     JOIN s_grnplm_as_t_didsd_029_vd_dwh.""v_$uvdo_accred_scheme"" us ON ((agr_1.uvdo_accred_scheme_id = us.uvdo_accred_scheme_id)))
                  WHERE ((agr_1.cover_accred_flag = 'N'::text) AND ((lower(us.uvdo_accred_scheme_cd) ~~ '%%'::text) OR (lower(us.uvdo_accred_scheme_cd) ~~ '% %'::text)))) uvdo_rt ON ((uvdo_rt.agr_cred_id = dt.id)))) t;"
d_agr_cred_rate_var_rvsn," SELECT rvt.agrmnt_id AS agr_cred_id,
    rvt.start_dt,
    rvt.end_dt,
    rvt.mkt_idx_flag AS mkt_idx_rvsn_flag,
    rvt.margin_flag AS margin_rvsn_flag,
    rvt.mkt_idx_quote_dt,
    agr.info_system_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.c_agrmnt_rate_var_rvsn rvt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core agr ON ((rvt.agrmnt_id = agr.agr_cred_id)))
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_meas fm ON (((rvt.fin_meas_id = fm.fin_meas_id) AND (fm.fin_meas_cd = '_'::text))));"
d_agr_cred_mis_prod," SELECT dt.id AS agr_cred_id,
    dt.start_dt,
    dt.end_dt,
        CASE
            WHEN ((dt.start_dt >= (fin_dt.ovr_dt + 89)) OR (upper(prod_val.f26_prod_cd) = ANY (ARRAY['TYPE_'::text, 'TYPE_'::text]))) THEN 11
            WHEN (upper(agr.eks_overdraft_flag) = 'Y'::text) THEN 4
            WHEN (upper(prod_val.f26_prod_cd) = 'TYPE_'::text) THEN 5
            WHEN (upper(prod_val.f26_prod_cd) = 'TYPE_'::text) THEN 6
            WHEN (upper(prod_val.f26_prod_cd) = 'TYPE_'::text) THEN 7
            WHEN (okved_65_21.agr_cred_id IS NOT NULL) THEN 8
            WHEN ((upper(prod_val.f26_prod_cd) = 'RSB_'::text) AND (is_regl.agr_regls_type_name ~ similar_escape('(1221|)%'::text, NULL::text))) THEN 7
            WHEN (eks_agr_cred_type.agr_cred_type_cd = '2'::text) THEN 2
            ELSE 1
        END AS mis_prod_id,
    agr.info_system_id
   FROM ((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt
                   FROM ( SELECT d_agr_cred_core.agr_cred_id AS id,
                            '1900-01-01'::date AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core
                        UNION ALL
                         SELECT prod_1.agr_cred_id AS id,
                                CASE mult.i
                                    WHEN 1 THEN prod_1.start_dt
                                    WHEN 2 THEN (prod_1.end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod prod_1
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_f26_prod_s val ON (((
                                CASE
                                    WHEN (COALESCE(prod_1.eks_a_f26_prod_id, ('-1'::integer)::bigint) = '-1'::integer) THEN prod_1.eks_b_f26_prod_id
                                    ELSE prod_1.eks_a_f26_prod_id
                                END = val.f26_prod_id) AND (upper(val.f26_prod_cd) = ANY (ARRAY['TYPE_'::text, 'TYPE_'::text, 'TYPE_'::text, 'TYPE_'::text, 'TYPE_'::text, 'RSB_'::text])))))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) mult ON (((mult.i = 1) OR (prod_1.end_dt <> '9999-12-31'::date))))
                        UNION ALL
                         SELECT d_agr_cred_fin_dp.agr_cred_id AS id,
                            d_agr_cred_fin_dp.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp
                        UNION ALL
                         SELECT d_agr_cred_fin_dp.agr_cred_id AS id,
                            (d_agr_cred_fin_dp.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp
                          WHERE (d_agr_cred_fin_dp.end_dt <> '9999-12-31'::date)
                        UNION ALL
                         SELECT d_agr_cred_fin_dp.agr_cred_id AS id,
                            d_agr_cred_fin_dp.ovr_dt AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp
                        UNION ALL
                         SELECT d_agr_cred_fin_dp.agr_cred_id AS id,
                            (d_agr_cred_fin_dp.ovr_dt + 89) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp
                        UNION ALL
                         SELECT cust.agr_cred_id,
                                CASE mult.i
                                    WHEN 1 THEN cust.gen_start_dt
                                    WHEN 2 THEN (cust.gen_end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt
                           FROM (( SELECT t.agr_cred_id,
                                    t.gen_start_dt,
                                    t.gen_end_dt,
                                    t.prim_okved_id
                                   FROM ( SELECT agr_1.agr_cred_id,
  CASE
   WHEN (agr_1.start_dt > cust_1.start_dt) THEN agr_1.start_dt
   ELSE cust_1.start_dt
  END AS gen_start_dt,
  CASE
   WHEN (agr_1.end_dt < cust_1.end_dt) THEN agr_1.end_dt
   ELSE cust_1.end_dt
  END AS gen_end_dt,
    cust_1.prim_okved_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust agr_1
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_org_clsfctn cust_1 ON ((agr_1.cust_id = cust_1.cust_id)))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_okved_s val ON (((cust_1.prim_okved_id = val.okved_id) AND (val.okved_cd = '65.21'::text))))) t
                                  WHERE (t.gen_start_dt <= t.gen_end_dt)) cust
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) mult ON (((mult.i = 1) OR (cust.gen_end_dt <> '9999-12-31'::date))))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr ON ((dt.id = agr.agr_cred_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_fin_dp fin_dt ON ((((dt.id = fin_dt.agr_cred_id) AND (dt.start_dt >= fin_dt.start_dt)) AND (dt.start_dt <= fin_dt.end_dt))))
     LEFT JOIN (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod prod
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_f26_prod_s prod_val ON (((
        CASE
            WHEN (COALESCE(prod.eks_a_f26_prod_id, ('-1'::integer)::bigint) = '-1'::integer) THEN prod.eks_b_f26_prod_id
            ELSE prod.eks_a_f26_prod_id
        END = prod_val.f26_prod_id) AND (upper(prod_val.f26_prod_cd) = ANY (ARRAY['TYPE_'::text, 'TYPE_'::text, 'TYPE_'::text, 'TYPE_'::text, 'TYPE_'::text, 'RSB_'::text]))))) ON ((((dt.id = prod.agr_cred_id) AND (dt.start_dt >= prod.start_dt)) AND (dt.start_dt <= prod.end_dt))))
     LEFT JOIN ( SELECT t.agr_cred_id,
            t.gen_start_dt,
            t.gen_end_dt
           FROM ( SELECT agr_1.agr_cred_id,
                        CASE
                            WHEN (agr_1.start_dt > cust.start_dt) THEN agr_1.start_dt
                            ELSE cust.start_dt
                        END AS gen_start_dt,
                        CASE
                            WHEN (agr_1.end_dt < cust.end_dt) THEN agr_1.end_dt
                            ELSE cust.end_dt
                        END AS gen_end_dt
                   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust agr_1
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_org_clsfctn cust ON ((agr_1.cust_id = cust.cust_id)))
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_okved_s val ON (((cust.prim_okved_id = val.okved_id) AND (val.okved_name = '65.21'::text))))) t
          WHERE (t.gen_start_dt <= t.gen_end_dt)) okved_65_21 ON ((((dt.id = okved_65_21.agr_cred_id) AND (dt.start_dt >= okved_65_21.gen_start_dt)) AND (dt.start_dt <= okved_65_21.gen_end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_agr_regls_type_s is_regl ON (((is_regl.agr_regls_type_id = agr.agr_regls_type_id) AND (upper(is_regl.agr_regls_type_name) ~ similar_escape('(1221|)%'::text, NULL::text)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_type eks_agr_cred_type ON (((eks_agr_cred_type.agr_cred_type_id = agr.eks_agr_cred_type_id) AND (eks_agr_cred_type.agr_cred_type_cd = '2'::text))));"
d_cust_org_cont," SELECT dt.id AS cust_id,
    dt.start_dt,
    dt.end_dt,
    ptl.pty_loc_id AS addr_reg_cntry_id,
    dt.info_system_id,
        CASE
            WHEN (ac.cntry_code = 'RUS'::text) THEN 'Y'::text
            WHEN (ac.cntry_code IS NOT NULL) THEN 'N'::text
            ELSE NULL::text
        END AS rsd_rus_flag
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT ptl_1.pty_id AS id,
                                CASE mult.i
                                    WHEN 1 THEN ptl_1.pty_loc_start_dt
                                    WHEN 2 THEN (ptl_1.pty_loc_end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt,
                            ptl_1.info_system_id
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_pty_loc ptl_1
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_geog_area geo_1 ON (((geo_1.geog_area_id = ptl_1.pty_loc_id) AND (geo_1.geog_area_type_id = 1))))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) mult ON (((mult.i = 1) OR (ptl_1.pty_loc_end_dt <> '9999-12-31'::date))))
                          WHERE (ptl_1.pty_loc_usage_id = 5)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((dt.id = cor.cust_id) AND (cor.crm_flag = 'N'::text))))
     LEFT JOIN (s_grnplm_as_t_didsd_010_vd_dwh.v_pty_loc ptl
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_geog_area geo ON ((((geo.geog_area_id = ptl.pty_loc_id) AND (geo.geog_area_type_id = 1)) AND (ptl.pty_loc_usage_id = 5)))) ON (((ptl.pty_id = dt.id) AND ((dt.start_dt >= ptl.pty_loc_start_dt) AND (dt.start_dt <= ptl.pty_loc_end_dt)))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_cntry ac ON (((ac.cntry_id = ptl.pty_loc_id) AND (ac.gregor_dt = ('now'::text)::date))))
UNION ALL
 SELECT pl.pty_id AS cust_id,
    pl.pty_loc_start_dt AS start_dt,
    pl.pty_loc_end_dt AS end_dt,
    pl.pty_loc_id AS addr_reg_cntry_id,
    pl.info_system_id,
        CASE
            WHEN (ac.cntry_code = 'RUS'::text) THEN 'Y'::text
            WHEN (ac.cntry_code IS NOT NULL) THEN 'N'::text
            ELSE NULL::text
        END AS rsd_rus_flag
   FROM ((s_grnplm_as_t_didsd_039_vd_dwh.v_pty_loc pl
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((pl.pty_id = cor.cust_id) AND (cor.crm_flag = 'Y'::text))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_cntry ac ON (((ac.cntry_id = pl.pty_loc_id) AND (ac.gregor_dt = ('now'::text)::date))))
  WHERE (pl.pty_loc_usage_id = 5)
UNION ALL
 SELECT cce.cust_id,
    dt.start_dt,
    dt.end_dt,
    coi.rsd_rgn_cntry_id AS addr_reg_cntry_id,
    dt.info_system_id,
        CASE
            WHEN (tc.cntry_name = ''::text) THEN 'Y'::text
            ELSE 'N'::text
        END AS rsd_rus_flag
   FROM (((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_cust_org_idfn.cust_id AS id,
                            v_cust_org_idfn.start_dt,
                            v_cust_org_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_idfn
                          WHERE (v_cust_org_idfn.info_system_inst_cd = '000002'::text)
                        UNION ALL
                         SELECT org.cust_id,
                            (org.end_dt + 1) AS start_dt,
                            org.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_idfn org
                          WHERE ((org.end_dt <> '9999-12-31'::date) AND (org.info_system_inst_cd = '000002'::text))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_epk cce ON ((cce.cust_id = dt.id)))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_idfn coi ON ((((coi.cust_id = dt.id) AND ((dt.start_dt >= coi.start_dt) AND (dt.start_dt <= coi.end_dt))) AND (coi.info_system_inst_cd = '000002'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cntry tc ON (((tc.cntry_id = coi.rsd_rgn_cntry_id) AND (tc.info_system_inst_cd = '000002'::text))));"
d_cust_org_idfn," SELECT dt.id AS cust_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(
        CASE
            WHEN (onh.org_name <> '   - '::text) THEN onh.org_name
            ELSE onh2.org_name
        END, inh.individ_full_name) AS full_name,
    onh2.org_name AS short_name,
    pid_inn.pty_idfn_val AS inn_num,
    pid_kpp.pty_idfn_val AS kpp_num,
    bol.backbone_indus_type_mk AS backbone_indus_type_id,
    pid_kio.pty_idfn_val AS kio_num,
    COALESCE(pid_ogrn.pty_id_receipt_dt, crm_ogrn.ogrn_dt) AS ogrn_dt,
    COALESCE(pid_ogrn.pty_idfn_val, crm_ogrn.ogrn_num) AS ogrn_num,
    pid_okpo.pty_idfn_val AS okpo_num,
    pid_swift.pty_idfn_val AS swift_cd,
    ass.pty_class_val_id AS okopf_id,
    NULL::bigint AS crm_cust_org_card_type_id,
    dt.info_system_id,
    pid_bik.pty_idfn_val AS rcbic_cd,
    NULL::text AS rsd_rus_flag
   FROM ((((((((((((((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_org_name_hist.org_pty_id AS id,
                            v_org_name_hist.org_name_start_dt AS start_dt,
                            v_org_name_hist.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_org_name_hist
                          WHERE (v_org_name_hist.name_type_id = ANY (ARRAY[1, '-1001'::integer]))
                        UNION ALL
                         SELECT v_org_name_hist.org_pty_id AS id,
                            (v_org_name_hist.org_name_end_dt + 1) AS start_dt,
                            v_org_name_hist.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_org_name_hist
                          WHERE ((v_org_name_hist.name_type_id = ANY (ARRAY[1, '-1001'::integer])) AND (v_org_name_hist.org_name_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT inh_1.individ_pty_id AS id,
                            inh_1.individ_name_start_dt AS start_dt,
                            inh_1.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_individ_name_hist inh_1
                          WHERE (inh_1.name_type_id = 1)
                        UNION ALL
                         SELECT inh_1.individ_pty_id AS id,
                            (inh_1.individ_name_end_dt + 1) AS start_dt,
                            inh_1.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_individ_name_hist inh_1
                          WHERE ((inh_1.individ_name_end_dt <> '9999-12-31'::date) AND (inh_1.name_type_id = 1))
                        UNION ALL
                         SELECT v_pty_idfn.pty_id,
                            v_pty_idfn.pty_idfn_start_dt AS start_dt,
                            v_pty_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn
                          WHERE ((v_pty_idfn.pty_id_categ_id = 1) AND (v_pty_idfn.pty_idfn_type_id = ANY (ARRAY['-1002'::integer, '-1003'::integer, '-1004'::integer, '-1005'::integer, '-1006'::integer, '-1020'::integer, '-1008'::integer])))
                        UNION ALL
                         SELECT v_pty_idfn.pty_id,
                            (v_pty_idfn.pty_idfn_end_dt + 1) AS start_dt,
                            v_pty_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn
                          WHERE (((v_pty_idfn.pty_id_categ_id = 1) AND (v_pty_idfn.pty_idfn_type_id = ANY (ARRAY['-1002'::integer, '-1003'::integer, '-1004'::integer, '-1005'::integer, '-1006'::integer, '-1020'::integer, '-1008'::integer]))) AND (v_pty_idfn.pty_idfn_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_pty_pty_class_assoc.pty_id,
                            v_pty_pty_class_assoc.pty_class_start_dt AS start_dt,
                            v_pty_pty_class_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc
                          WHERE (v_pty_pty_class_assoc.pty_clsfctn_id = 7)
                        UNION ALL
                         SELECT v_pty_pty_class_assoc.pty_id,
                            (v_pty_pty_class_assoc.pty_class_end_dt + 1) AS start_dt,
                            v_pty_pty_class_assoc.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc
                          WHERE ((v_pty_pty_class_assoc.pty_clsfctn_id = 7) AND (v_pty_pty_class_assoc.pty_class_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT v_pty_demog.pty_id,
                            v_pty_demog.pty_demog_start_dt AS start_dt,
                            v_pty_demog.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_demog
                          WHERE (v_pty_demog.demog_id = 2)
                        UNION ALL
                         SELECT v_pty_demog.pty_id,
                            (v_pty_demog.pty_demog_end_dt + 1) AS start_dt,
                            v_pty_demog.info_system_id
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_demog
                          WHERE ((v_pty_demog.demog_id = 2) AND (v_pty_demog.pty_demog_end_dt <> '9999-12-31'::date))
                        UNION ALL
                         SELECT vp.pty_id,
                                CASE
                                    WHEN (m.i = 1) THEN bol_1.gen_start_dt
                                    WHEN ((m.i = 2) AND (bol_1.gen_end_dt = '9999-12-31'::date)) THEN bol_1.gen_end_dt
                                    ELSE (bol_1.gen_end_dt + 1)
                                END AS start_dt,
                            vp.info_system_id
                           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn vp
                             JOIN ( SELECT bol_2.inn,
CASE
 WHEN (bol_2.start_dt > bol_ind.start_dt) THEN bol_2.start_dt
 ELSE bol_ind.start_dt
END AS gen_start_dt,
CASE
 WHEN (bol_2.end_dt < bol_ind.end_dt) THEN bol_2.end_dt
 ELSE bol_ind.end_dt
END AS gen_end_dt,
                                    bol_ind.backbone_indus_type_mk
                                   FROM (s_grnplm_as_t_didsd_vd_rdm.rdm_backbone_org_lst_mast_v bol_2
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_backbone_indus_type_d bol_ind ON ((bol_ind.backbone_indus_type_name = bol_2.nm)))
                                  WHERE (
CASE
 WHEN (bol_2.start_dt > bol_ind.start_dt) THEN bol_2.start_dt
 ELSE bol_ind.start_dt
END <=
CASE
 WHEN (bol_2.end_dt < bol_ind.end_dt) THEN bol_2.end_dt
 ELSE bol_ind.end_dt
END)) bol_1 ON ((bol_1.inn = vp.pty_idfn_val)))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) m ON (((m.i = 1) OR ((m.i = 2) AND (bol_1.gen_end_dt <> '9999-12-31'::date)))))
                          WHERE ((vp.pty_id_categ_id = 1) AND (vp.pty_idfn_type_id = '-1004'::integer))
                        UNION ALL
                         SELECT p.pty_id,
                                CASE mult.i
                                    WHEN 1 THEN crm_ogrn_1.pty_idfn_start_dt
                                    WHEN 2 THEN (crm_ogrn_1.pty_idfn_end_dt + 1)
                                    ELSE NULL::date
                                END AS start_dt,
                            p.info_system_id
                           FROM ((((s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn crm_ogrn_1
                             JOIN s_grnplm_as_t_didsd_039_db_tmd.k_pty kcrm ON ((crm_ogrn_1.pty_id = kcrm.tgt_id)))
                             JOIN s_grnplm_as_t_didsd_vd_rdm.rdm_cust_eks2crm_mast_v ec_link ON (((kcrm.nk26_party_id_crm = ec_link.code) AND (ec_link.end_dt = '9999-12-31'::date))))
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty p ON ((ec_link.eks_pty_id = p.pty_id)))
                             JOIN ( SELECT a.i
                                   FROM ( SELECT 1 AS i) a
                                UNION ALL
                                 SELECT a.i
                                   FROM ( SELECT 2 AS i) a) mult ON (((mult.i = 1) OR (crm_ogrn_1.pty_idfn_end_dt <> '9999-12-31'::date))))
                          WHERE (crm_ogrn_1.pty_idfn_type_id = '-1003'::integer)) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((dt.id = cor.cust_id) AND (cor.crm_flag = 'N'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_org_name_hist onh ON ((((onh.org_pty_id = dt.id) AND ((dt.start_dt >= onh.org_name_start_dt) AND (dt.start_dt <= onh.org_name_end_dt))) AND (onh.name_type_id = 1))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_org_name_hist onh2 ON ((((onh2.org_pty_id = dt.id) AND ((dt.start_dt >= onh2.org_name_start_dt) AND (dt.start_dt <= onh2.org_name_end_dt))) AND (onh2.name_type_id = '-1001'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_individ_name_hist inh ON ((((inh.individ_pty_id = dt.id) AND ((dt.start_dt >= inh.individ_name_start_dt) AND (dt.start_dt <= inh.individ_name_end_dt))) AND (inh.name_type_id = 1))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_inn ON (((((pid_inn.pty_id = dt.id) AND ((dt.start_dt >= pid_inn.pty_idfn_start_dt) AND (dt.start_dt <= pid_inn.pty_idfn_end_dt))) AND (pid_inn.pty_id_categ_id = 1)) AND (pid_inn.pty_idfn_type_id = '-1004'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_kpp ON (((((pid_kpp.pty_id = dt.id) AND ((dt.start_dt >= pid_kpp.pty_idfn_start_dt) AND (dt.start_dt <= pid_kpp.pty_idfn_end_dt))) AND (pid_kpp.pty_id_categ_id = 1)) AND (pid_kpp.pty_idfn_type_id = '-1005'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_kio ON (((((pid_kio.pty_id = dt.id) AND ((dt.start_dt >= pid_kio.pty_idfn_start_dt) AND (dt.start_dt <= pid_kio.pty_idfn_end_dt))) AND (pid_kio.pty_id_categ_id = 1)) AND (pid_kio.pty_idfn_type_id = '-1006'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_ogrn ON (((((pid_ogrn.pty_id = dt.id) AND ((dt.start_dt >= pid_ogrn.pty_idfn_start_dt) AND (dt.start_dt <= pid_ogrn.pty_idfn_end_dt))) AND (pid_ogrn.pty_id_categ_id = 1)) AND (pid_ogrn.pty_idfn_type_id = '-1003'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_okpo ON (((((pid_okpo.pty_id = dt.id) AND ((dt.start_dt >= pid_okpo.pty_idfn_start_dt) AND (dt.start_dt <= pid_okpo.pty_idfn_end_dt))) AND (pid_okpo.pty_id_categ_id = 1)) AND (pid_okpo.pty_idfn_type_id = '-1002'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_pty_class_assoc ass ON ((((ass.pty_id = dt.id) AND ((dt.start_dt >= ass.pty_class_start_dt) AND (dt.start_dt <= ass.pty_class_end_dt))) AND (ass.pty_clsfctn_id = 7))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_swift ON (((((pid_swift.pty_id = dt.id) AND ((dt.start_dt >= pid_swift.pty_idfn_start_dt) AND (dt.start_dt <= pid_swift.pty_idfn_end_dt))) AND (pid_swift.pty_id_categ_id = 1)) AND (pid_swift.pty_idfn_type_id = '-1020'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_pty_idfn pid_bik ON (((((pid_bik.pty_id = dt.id) AND ((dt.start_dt >= pid_bik.pty_idfn_start_dt) AND (dt.start_dt <= pid_bik.pty_idfn_end_dt))) AND (pid_bik.pty_id_categ_id = 1)) AND (pid_bik.pty_idfn_type_id = '-1008'::integer))))
     LEFT JOIN ( SELECT bol_1.inn,
                CASE
                    WHEN (bol_1.start_dt > bol_ind.start_dt) THEN bol_1.start_dt
                    ELSE bol_ind.start_dt
                END AS gen_start_dt,
                CASE
                    WHEN (bol_1.end_dt < bol_ind.end_dt) THEN bol_1.end_dt
                    ELSE bol_ind.end_dt
                END AS gen_end_dt,
            bol_ind.backbone_indus_type_mk
           FROM (( SELECT t.inn,
                    t.start_dt,
                    t.end_dt,
                    t.nm
                   FROM ( SELECT bol_2.inn,
                            dt_1.start_dt,
                            dt_1.end_dt,
                            bol_2.nm,
                            row_number() OVER (PARTITION BY dt_1.id, dt_1.start_dt ORDER BY bol_2.mk DESC) AS rn
                           FROM (( SELECT ""Window"".id,
                                    ""Window"".start_dt,
                                    COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
                                   FROM ( SELECT dt_2.id,
    dt_2.start_dt
   FROM ( SELECT rdm_backbone_org_lst_mast_v.inn AS id,
      rdm_backbone_org_lst_mast_v.start_dt
     FROM s_grnplm_as_t_didsd_vd_rdm.rdm_backbone_org_lst_mast_v
  UNION ALL
   SELECT rdm_backbone_org_lst_mast_v.inn AS id,
      (rdm_backbone_org_lst_mast_v.end_dt + 1) AS start_dt
     FROM s_grnplm_as_t_didsd_vd_rdm.rdm_backbone_org_lst_mast_v
    WHERE (rdm_backbone_org_lst_mast_v.end_dt <> '9999-12-31'::date)) dt_2
  GROUP BY dt_2.id, dt_2.start_dt) ""Window""(id, start_dt)) dt_1
                             JOIN s_grnplm_as_t_didsd_vd_rdm.rdm_backbone_org_lst_mast_v bol_2 ON (((dt_1.id = bol_2.inn) AND ((dt_1.start_dt >= bol_2.start_dt) AND (dt_1.start_dt <= bol_2.end_dt)))))) t
                  WHERE (t.rn = 1)) bol_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_backbone_indus_type_d bol_ind ON ((bol_ind.backbone_indus_type_name = bol_1.nm)))
          WHERE ((
                CASE
                    WHEN (bol_1.start_dt > bol_ind.start_dt) THEN bol_1.start_dt
                    ELSE bol_ind.start_dt
                END <=
                CASE
                    WHEN (bol_1.end_dt < bol_ind.end_dt) THEN bol_1.end_dt
                    ELSE bol_ind.end_dt
                END) AND (bol_1.inn IS NOT NULL))) bol ON (((bol.inn = pid_inn.pty_idfn_val) AND ((dt.start_dt >= bol.gen_start_dt) AND (dt.start_dt <= bol.gen_end_dt)))))
     LEFT JOIN ( SELECT src.pty_id,
            src.start_dt,
            COALESCE((max(src.start_dt) OVER (PARTITION BY src.pty_id ORDER BY src.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            src.ogrn_num,
            src.ogrn_dt
           FROM ( SELECT t.pty_id,
                    t.start_dt,
                    t.ogrn_num,
                    t.ogrn_dt
                   FROM ( SELECT ec_link.eks_pty_id AS pty_id,
                            dt_1.start_dt,
                            pid.pty_idfn_val AS ogrn_num,
                            pid.pty_idfn_start_dt AS ogrn_dt,
                            row_number() OVER (PARTITION BY ec_link.eks_pty_id, dt_1.start_dt ORDER BY pid.pty_idfn_start_dt DESC NULLS LAST, pid.pty_idfn_val DESC NULLS LAST) AS rn
                           FROM (((( SELECT v_pty_idfn.pty_id AS id,
                                    v_pty_idfn.pty_idfn_start_dt AS start_dt
                                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn
                                  WHERE (v_pty_idfn.pty_idfn_type_id = '-1003'::integer)) dt_1
                             JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn pid ON ((((dt_1.id = pid.pty_id) AND ((dt_1.start_dt >= pid.pty_idfn_start_dt) AND (dt_1.start_dt <= pid.pty_idfn_end_dt))) AND (pid.pty_idfn_type_id = '-1003'::integer))))
                             JOIN s_grnplm_as_t_didsd_039_db_tmd.k_pty kcrm ON ((dt_1.id = kcrm.tgt_id)))
                             JOIN s_grnplm_as_t_didsd_vd_rdm.rdm_cust_eks2crm_mast_v ec_link ON (((kcrm.nk26_party_id_crm = ec_link.code) AND (ec_link.end_dt = '9999-12-31'::date))))) t
                  WHERE (t.rn = 1)) src) crm_ogrn ON (((dt.id = crm_ogrn.pty_id) AND ((dt.start_dt >= crm_ogrn.start_dt) AND (dt.start_dt <= crm_ogrn.end_dt)))))
UNION ALL
 SELECT pty.pty_id AS cust_id,
    dt.start_dt,
    COALESCE((max(dt.start_dt) OVER (PARTITION BY pty.pty_id ORDER BY dt.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    onh.org_name AS full_name,
    NULL::text AS short_name,
    idfn.pty_idfn_val AS inn_num,
    NULL::text AS kpp_num,
    NULL::integer AS backbone_indus_type_id,
    NULL::text AS kio_num,
    NULL::date AS ogrn_dt,
    NULL::text AS ogrn_num,
    NULL::text AS okpo_num,
    pid_swift.pty_idfn_val AS swift_cd,
    NULL::bigint AS okopf_id,
    ppca2.pty_class_val_id AS crm_cust_org_card_type_id,
    pty.info_system_id,
    NULL::text AS rcbic_cd,
    NULL::text AS rsd_rus_flag
   FROM (((((((( SELECT dt_1.id,
            dt_1.start_dt
           FROM ( SELECT pty_1.pty_id AS id,
                    '1900-01-01'::date AS start_dt
                   FROM ((s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty_1
                     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_ext_org eorg_1 ON (((eorg_1.ext_org_pty_id = pty_1.pty_id) AND (eorg_1.ext_org_type_id IS NULL))))
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_info_systems_crm sys ON ((sys.info_system_id = pty_1.info_system_id)))
                  WHERE (pty_1.org_ind = 'YES'::text)
                UNION ALL
                 SELECT onh_1.org_pty_id AS id,
                    onh_1.org_name_start_dt AS start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist onh_1
                  WHERE (onh_1.name_type_id = 1)
                UNION ALL
                 SELECT onh_1.org_pty_id,
                    (onh_1.org_name_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist onh_1
                  WHERE ((onh_1.org_name_end_dt <> '9999-12-31'::date) AND (onh_1.name_type_id = 1))
                UNION ALL
                 SELECT idfn_1.pty_id,
                    idfn_1.pty_idfn_start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn idfn_1
                  WHERE (idfn_1.pty_idfn_type_id = '-1004'::integer)
                UNION ALL
                 SELECT idfn_1.pty_id,
                    (idfn_1.pty_idfn_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn idfn_1
                  WHERE ((idfn_1.pty_idfn_end_dt <> '9999-12-31'::date) AND (idfn_1.pty_idfn_type_id = '-1004'::integer))
                UNION ALL
                 SELECT ppca2_1.pty_id,
                    ppca2_1.pty_class_start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca2_1
                  WHERE (ppca2_1.pty_clsfctn_id = '-1015'::integer)
                UNION ALL
                 SELECT ppca2_1.pty_id,
                    (ppca2_1.pty_class_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca2_1
                  WHERE ((ppca2_1.pty_class_end_dt <> '9999-12-31'::date) AND (ppca2_1.pty_clsfctn_id = '-1015'::integer))
                UNION ALL
                 SELECT pid_swift_1.pty_id,
                    pid_swift_1.pty_idfn_start_dt
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn pid_swift_1
                  WHERE ((pid_swift_1.pty_idfn_type_id = '-1020'::integer) AND (pid_swift_1.pty_id_categ_id = '-1'::integer))
                UNION ALL
                 SELECT pid_swift_1.pty_id,
                    (pid_swift_1.pty_idfn_end_dt + 1)
                   FROM s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn pid_swift_1
                  WHERE (((pid_swift_1.pty_idfn_end_dt <> '9999-12-31'::date) AND (pid_swift_1.pty_idfn_type_id = '-1020'::integer)) AND (pid_swift_1.pty_id_categ_id = '-1'::integer))) dt_1
          GROUP BY dt_1.id, dt_1.start_dt) dt
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty pty ON (((pty.org_ind = 'YES'::text) AND (dt.id = pty.pty_id))))
     JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_ext_org eorg ON (((eorg.ext_org_pty_id = pty.pty_id) AND (eorg.ext_org_type_id IS NULL))))
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core cor ON (((dt.id = cor.cust_id) AND (cor.crm_flag = 'Y'::text))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_org_name_hist onh ON ((((onh.org_pty_id = pty.pty_id) AND ((dt.start_dt >= onh.org_name_start_dt) AND (dt.start_dt <= onh.org_name_end_dt))) AND (onh.name_type_id = 1))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn idfn ON ((((idfn.pty_id = pty.pty_id) AND ((dt.start_dt >= idfn.pty_idfn_start_dt) AND (dt.start_dt <= idfn.pty_idfn_end_dt))) AND (idfn.pty_idfn_type_id = '-1004'::integer))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_pty_class_assoc ppca2 ON ((((ppca2.pty_id = pty.pty_id) AND (ppca2.pty_clsfctn_id = '-1015'::integer)) AND ((dt.start_dt >= ppca2.pty_class_start_dt) AND (dt.start_dt <= ppca2.pty_class_end_dt)))))
     LEFT JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_pty_idfn pid_swift ON (((((pid_swift.pty_id = dt.id) AND ((dt.start_dt >= pid_swift.pty_idfn_start_dt) AND (dt.start_dt <= pid_swift.pty_idfn_end_dt))) AND (pid_swift.pty_id_categ_id = '-1'::integer)) AND (pid_swift.pty_idfn_type_id = '-1020'::integer))))
UNION ALL
 SELECT cce.cust_id,
    dt.start_dt,
    dt.end_dt,
    COALESCE(coi.full_name, coi.short_name, '  -'::text) AS full_name,
    COALESCE(coi.short_name, '  -'::text) AS short_name,
    coi.inn_num,
    coi.kpp_num,
    NULL::integer AS backbone_indus_type_id,
    coi.kio_num,
    coi.ogrn_dt,
    coi.ogrn_num,
    coi.okpo_num,
    coi.swift_num AS swift_cd,
    coi.okopf_id,
    NULL::bigint AS crm_cust_org_card_type_id,
    dt.info_system_id,
    coi.bic_num AS rcbic_cd,
        CASE coi.rsd_rgn_cntry_id
            WHEN IS NOT DISTINCT FROM '1000000000001099'::bigint THEN 'Y'::text
            ELSE 'N'::text
        END AS rsd_rus_flag
   FROM ((( SELECT ""Window"".id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
            ""Window"".info_system_id
           FROM ( SELECT dt_1.id,
                    dt_1.start_dt,
                    max(dt_1.info_system_id) AS info_system_id
                   FROM ( SELECT v_cust_org_idfn.cust_id AS id,
                            v_cust_org_idfn.start_dt,
                            v_cust_org_idfn.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_idfn
                          WHERE (v_cust_org_idfn.info_system_inst_cd = '000002'::text)
                        UNION ALL
                         SELECT org.cust_id,
                            (org.end_dt + 1) AS start_dt,
                            org.info_system_id
                           FROM s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_idfn org
                          WHERE ((org.end_dt <> '9999-12-31'::date) AND (org.info_system_inst_cd = '000002'::text))) dt_1
                  GROUP BY dt_1.id, dt_1.start_dt) ""Window""(id, start_dt, info_system_id)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_cust_core_epk cce ON ((cce.cust_id = dt.id)))
     LEFT JOIN s_grnplm_as_t_didsd_200_vd_dwh.v_cust_org_idfn coi ON ((((coi.cust_id = dt.id) AND ((dt.start_dt >= coi.start_dt) AND (dt.start_dt <= coi.end_dt))) AND (coi.info_system_inst_cd = '000002'::text))));"
d_acct_crncy," SELECT cr.agrmnt_id,
    cr.acct_crncy_start_dt AS start_dt,
    cr.acct_crncy_end_dt AS end_dt,
    cr.acct_crncy_id,
    vcr.crncy_cd,
    vcr.crncy_iso_cd,
    cr.info_system_id
   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_acct_crncy cr
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s vcr ON ((vcr.crncy_id = cr.acct_crncy_id)))
  WHERE ((cr.agrmnt_id IN ( SELECT d_agr_cred_core.agr_cred_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core)) AND (cr.crncy_use_id = 4))
UNION ALL
 SELECT cr.agr_cred_id AS agrmnt_id,
    '1900-01-01'::date AS start_dt,
    '9999-12-31'::date AS end_dt,
    c.crncy_id AS acct_crncy_id,
    vcr.crncy_cd,
    vcr.crncy_iso_cd,
    cr.info_system_id
   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core cr
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c ON ((cr.coa_id = c.coa_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s vcr ON ((vcr.crncy_id = c.crncy_id)));"
d_agr_cred_f303_type_prt," SELECT agr.agr_cred_id,
    bycoac.start_dt,
    bycoac.end_dt,
        CASE
            WHEN ((agr.has_higher_flag = 'Y'::text) AND (agr.agr_cred_type_cd = ANY (ARRAY['0'::text, '1'::text, '4'::text]))) THEN NULL::text
            WHEN ((bycoac.bycoac_type_id = 9) OR (agr.cess_deferred_flag = 'Y'::text)) THEN '7'::text
            WHEN (agr.cession_buy_flag = 'Y'::text) THEN '5'::text
            WHEN (agr.overdraft_flag = 'Y'::text) THEN '1.2'::text
            WHEN (agr.agr_cred_type_id = 1) THEN
            CASE
                WHEN (bycoac.bycoac_type_id = 0) THEN '7.1'::text
                WHEN (agr.rvlng_flag = 'Y'::text) THEN '1.3'::text
                WHEN (agr.rvlng_flag = 'N'::text) THEN '1.4'::text
                ELSE NULL::text
            END
            ELSE 'ERR'::text
        END AS f303_agr_cred_type_cd,
    agr.info_system_id
   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr
     JOIN ( SELECT agr_1.agr_cred_id,
            agr_1.start_dt,
            agr_1.end_dt,
            max(
                CASE
                    WHEN (agr_1.coa_num ~ similar_escape('(47423|60315)%'::text, NULL::text)) THEN 9
                    ELSE 0
                END) AS bycoac_type_id
           FROM (s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period agr_1
             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((agr_1.agr_cred_id = cor.agr_cred_id)))
          WHERE ((agr_1.meas_cd = 'AGRA_L001'::text) AND (agr_1.end_dt = '9999-12-31'::date))
          GROUP BY agr_1.agr_cred_id, agr_1.start_dt, agr_1.end_dt) bycoac ON ((agr.agr_cred_id = bycoac.agr_cred_id)));"
d_coa_s," WITH c AS (
         SELECT c.coa_id,
            max(c.coa_n_id) AS coa_n_id
           FROM ( SELECT ls.coa_id,
                    NULL::bigint AS coa_n_id
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_coa ls
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_inst_int_org org ON ((ls.gl_int_org_pty_id = org.int_org_pty_id)))
                  WHERE (org.org_num ~~ '0000-84-18-02%'::text)
                UNION ALL
                 SELECT a_agr_cred_coa_period.coa_id,
                    a_agr_cred_coa_period.coa_n_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period) c
          GROUP BY c.coa_id
        )
 SELECT c.coa_id AS coa_n_id,
    'N'::text AS n_flag,
    coa.coa_num AS coa_n_num,
    coa.coa_start_dt,
    coa.gl_int_org_pty_id AS coa_bal_int_org_id,
    NULL::text AS asset_liab_cd,
        CASE
            WHEN (org.org_num ~~ '0000-84-18-02%'::text) THEN 'Y'::text
            ELSE 'N'::text
        END AS gm_flag
   FROM ((c
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa ON ((c.coa_id = coa.coa_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_inst_int_org org ON ((coa.gl_int_org_pty_id = org.int_org_pty_id)))
UNION ALL
 SELECT c.coa_n_id,
    'Y'::text AS n_flag,
    max(g.gl_main_acct_num) AS coa_n_num,
    NULL::date AS coa_start_dt,
    NULL::bigint AS coa_bal_int_org_id,
    max(g.asset_liab_cd) AS asset_liab_cd,
    NULL::text AS gm_flag
   FROM (c
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct g ON ((g.gl_main_acct_id = c.coa_n_id)))
  GROUP BY c.coa_n_id;"
d_agr_cred," SELECT agr.agr_cred_id,
    agr.prnt_agr_cred_id,
    agr.info_system_id,
    agr.agr_num,
    agr.grntee_agr_num,
    agr.signed_dt,
    agr.issue_crncy_id,
    agr.eks_overdraft_flag,
    agr.agr_regls_type_id,
        CASE
            WHEN (agr.eks_issue_dt IS NOT NULL) THEN agr.eks_issue_dt
            WHEN ((agr.agr_cred_type_cd = '1'::text) AND (agr.eks_transhes_issue_dt IS NOT NULL)) THEN agr.eks_transhes_issue_dt
            ELSE aco_fst_iss.optn_issue_dt
        END AS issue_dt,
    agr.close_dt,
    agr.expiration_dt,
    agr.host_agr_cred_id,
    agr.host_crm_id,
    agr.eks_agr_cred_type_id,
    agr.agr_frame_id,
    agr.eks_rvlng_flag,
    agr.issue_int_org_id,
    agr.multi_crncy_flag,
    agr.eks_old_restruct_cnt,
    agr.eks_old_prolong_cnt,
    agr.eks_contract_expiration_dt,
    NULL::text AS diff_intst_rate_flag,
    agr.grntee_claim_notice_dt,
    agr.restruct_refin_default_flag,
    agr.restruct_refin_default_dt,
    coa_crncy.agra_l001_crncy_id AS debt_due_acc_crncy_id,
    coa_crncy.agra_l007_crncy_id AS unused_limit_acc_crncy_id,
    coa_crncy.agra_l009_crncy_id AS grntee_acc_crncy_id,
    agr.has_higher_flag,
    agr.zero_id,
    agr.four_id,
    agr.eks_cession_dt,
    agr.agr_cession_id,
    agr.cession_sell_got_cess_amt,
    agr.cession_sell_debt_cess_amt,
    agr.cession_sell_intrst_cess_amt,
    agr.cession_sell_cess_amt,
        CASE
            WHEN (agr.f26_agr_cred_type_cd = ''::text) THEN COALESCE(coa_crncy.agra_l009_crncy_id, agr.issue_crncy_id)
            WHEN (agr.agr_cred_type_cd = '0'::text) THEN COALESCE(coa_crncy.agra_l001_crncy_id, agr.issue_crncy_id)
            WHEN (agr.agr_cred_type_cd = '4'::text) THEN COALESCE(coa_crncy.agra_l001_crncy_id, agr.issue_crncy_id)
            WHEN (agr.agr_cred_type_cd = '1'::text) THEN COALESCE(coa_crncy.agra_l007_crncy_id, agr.issue_crncy_id)
            ELSE agr.issue_crncy_id
        END AS crncy_id,
    agr.agr_cred_type_id,
    agr.agr_cred_type_cd,
    agr.f26_agr_cred_type_id,
    agr.f26_agr_cred_type_cd,
    agr.rvlng_flag,
    agr.overdraft_flag,
        CASE
            WHEN (cess_buy_coa.agr_cred_id IS NOT NULL) THEN cess_buy_coa.cess_buy_coa_open_dt
            ELSE COALESCE(agr.eks_cession_dt,
            CASE
                WHEN (cess_sell_debt_coa.cess_debt_coa_open_dt >= COALESCE(cess_sell_debt_coa.coa_bind_dt, '1900-01-01'::date)) THEN cess_sell_debt_coa.cess_debt_coa_open_dt
                ELSE cess_sell_debt_coa.coa_bind_dt
            END, agr.cess_last_reg_dt)
        END AS cession_dt,
        CASE
            WHEN (cess_buy_coa.agr_cred_id IS NOT NULL) THEN 'Y'::text
            ELSE 'N'::text
        END AS cession_buy_flag,
        CASE
            WHEN (((cess_sell_debt_coa.agr_cred_id IS NOT NULL) OR (agr.cess_last_reg_dt IS NOT NULL)) AND (cess_buy_coa.agr_cred_id IS NULL)) THEN 'Y'::text
            ELSE 'N'::text
        END AS cess_deferred_flag,
    rat_first.agr_cred_rate_first_dt,
    agr.cess_crncy_id,
    agr.k7m_flag,
    agr.poci_flag,
    agr.fin_guarantee_flag,
    agr.fin_guarantee_loan_flag,
    agr.limit_use_end_dt,
    agr.open_dt,
    agr.eks_grntee_amt,
    agr.grntee_ast_flag,
    NULL::bigint AS crncy_id_uvdo,
    NULL::text AS crncy_cd_uvdo,
    NULL::text AS iso_crncy_cd_uvdo,
    NULL::bigint AS cust_id_uvdo,
    NULL::bigint AS letter_of_credit_type_id,
    NULL::text AS let_of_cred_revoce_flag,
    NULL::text AS let_of_cred_cover_flag,
    NULL::bigint AS host_let_of_cred_cover_id,
    NULL::numeric(38,8) AS agr_cred_start_amt,
    agr.k7m_pl_flag,
    NULL::bigint AS coa_cred_f26_prod_id,
    cst.subject_area_type_id,
    NULL::bigint AS let_of_cred_acc_scheme_id
   FROM ((((((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_tmp agr
     LEFT JOIN ( SELECT eatc.agrmnt_id AS agr_cred_id,
            min(eatc.agrmnt_gl_acct_start_dt) AS coa_bind_dt,
            min(c.coa_start_dt) AS cess_debt_coa_open_dt
           FROM ((s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_agrmnt_to_coa_3"" eatc
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa c ON ((c.coa_id = eatc.coa_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_gl_main_acct glma ON ((glma.gl_main_acct_id = c.gl_main_acct_id)))
          WHERE (substr(glma.gl_main_acct_num, 1, 7) = '4742325'::text)
          GROUP BY eatc.agrmnt_id) cess_sell_debt_coa ON ((cess_sell_debt_coa.agr_cred_id = agr.agr_cred_id)))
     LEFT JOIN ( SELECT c.agr_cred_id,
            min(c.start_dt) AS cess_buy_coa_open_dt
           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period c
          WHERE ((((1 = 1) AND ((c.coa_num ~~ '478%'::text) OR (substr(c.coa_num, 1, 5) = ANY (ARRAY['44111'::text, '44211'::text, '44311'::text, '44411'::text, '44511'::text, '44611'::text, '44711'::text, '44811'::text, '44911'::text, '45011'::text, '45111'::text, '45211'::text, '45311'::text, '45411'::text, '45611'::text])))) AND (substr(c.meas_cd, 1, 6) = 'AGRA_L'::text)) AND (c.meas_rub > (0)::numeric))
          GROUP BY c.agr_cred_id) cess_buy_coa ON ((cess_buy_coa.agr_cred_id = agr.agr_cred_id)))
     LEFT JOIN ( SELECT coa_crncs_sub.agr_cred_id,
            max(
                CASE
                    WHEN (coa_crncs_sub.meas_cd = 'AGRA_L001'::text) THEN coa_crncs_sub.crncy_id
                    ELSE NULL::bigint
                END) AS agra_l001_crncy_id,
            max(
                CASE
                    WHEN (coa_crncs_sub.meas_cd = 'AGRA_L007'::text) THEN coa_crncs_sub.crncy_id
                    ELSE NULL::bigint
                END) AS agra_l007_crncy_id,
            max(
                CASE
                    WHEN (coa_crncs_sub.meas_cd = 'AGRA_L009'::text) THEN coa_crncs_sub.crncy_id
                    ELSE NULL::bigint
                END) AS agra_l009_crncy_id
           FROM ( SELECT t.agr_cred_id,
                    t.meas_cd,
                    t.crncy_id
                   FROM ( SELECT a_agr_cred_coa_period.agr_cred_id,
                            a_agr_cred_coa_period.meas_cd,
                            a_agr_cred_coa_period.crncy_id,
                            row_number() OVER (PARTITION BY a_agr_cred_coa_period.agr_cred_id, a_agr_cred_coa_period.meas_cd ORDER BY NULL::text) AS rn,
                            min(a_agr_cred_coa_period.crncy_id) OVER (PARTITION BY a_agr_cred_coa_period.agr_cred_id, a_agr_cred_coa_period.meas_cd) AS mn,
                            max(a_agr_cred_coa_period.crncy_id) OVER (PARTITION BY a_agr_cred_coa_period.agr_cred_id, a_agr_cred_coa_period.meas_cd) AS mx
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_coa_period
                          WHERE (a_agr_cred_coa_period.meas_cd = ANY (ARRAY['AGRA_L001'::text, 'AGRA_L007'::text, 'AGRA_L009'::text]))) t
                  WHERE ((t.rn = 1) AND (t.mx = t.mn))) coa_crncs_sub
          GROUP BY coa_crncs_sub.agr_cred_id) coa_crncy ON ((coa_crncy.agr_cred_id = agr.agr_cred_id)))
     LEFT JOIN ( SELECT t.agr_cred_id,
            t.optn_issue_dt
           FROM ( SELECT aco_fst_iss_1.agr_cred_id,
                    aco_fst_iss_1.optn_dt AS optn_issue_dt,
                    row_number() OVER (PARTITION BY aco_fst_iss_1.agr_cred_id ORDER BY aco_fst_iss_1.optn_dt) AS rn
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn aco_fst_iss_1
                  WHERE (((aco_fst_iss_1.issue_flag = 'Y'::text) OR (aco_fst_iss_1.move_flag = 'Y'::text)) AND (aco_fst_iss_1.optn_rub <> (0)::numeric))) t
          WHERE (t.rn = 1)) aco_fst_iss ON ((aco_fst_iss.agr_cred_id = agr.agr_cred_id)))
     LEFT JOIN ( SELECT rat.agrmnt_id AS agr_cred_id,
            min(rat.loan_agrmnt_rate_start_dt) AS agr_cred_rate_first_dt
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_loan_agrmnt_rate rat
          WHERE ((rat.rate_val > (0)::numeric) AND (rat.rate_calc_rule_id = ANY (ARRAY[37004, 13104, 45804, 67904, 35204])))
          GROUP BY rat.agrmnt_id) rat_first ON ((rat_first.agr_cred_id = agr.agr_cred_id)))
     LEFT JOIN ( SELECT v_cust.agr_cred_id,
            max(
                CASE
                    WHEN ((COALESCE(v_cust.ind_flag, 'N'::text) = 'Y'::text) AND (COALESCE(v_cust.org_flag, 'N'::text) = 'N'::text)) THEN 2
                    WHEN (COALESCE(v_cust.bank_flag, 'N'::text) = 'Y'::text) THEN 3
                    ELSE 1
                END) AS subject_area_type_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_cust v_cust
          WHERE ((('now'::text)::date >= v_cust.start_dt) AND (('now'::text)::date <= v_cust.end_dt))
          GROUP BY v_cust.agr_cred_id) cst ON ((agr.agr_cred_id = cst.agr_cred_id)))
UNION ALL
 SELECT agr_cred.agr_cred_id,
    NULL::bigint AS prnt_agr_cred_id,
    agr_cred.info_system_id,
    agr_cred.agr_num,
    NULL::text AS grntee_agr_num,
    agr_cred.open_dt AS signed_dt,
    NULL::bigint AS issue_crncy_id,
    NULL::text AS eks_overdraft_flag,
    agr_cred.uvdo_accred_scheme_id AS agr_regls_type_id,
    NULL::date AS issue_dt,
    agr_cred.close_dt,
    agr_cred.expiration_dt,
    (agr_cred.host_agr_cred_id)::text AS host_agr_cred_id,
    NULL::text AS host_crm_id,
    NULL::bigint AS eks_agr_cred_type_id,
        CASE
            WHEN (flt.agr_cred_type_id = '-1034'::integer) THEN agr_cred.agr_cred_id
            ELSE gen.agr_frame_id
        END AS agr_frame_id,
    NULL::text AS eks_rvlng_flag,
    NULL::bigint AS issue_int_org_id,
    NULL::text AS multi_crncy_flag,
    NULL::smallint AS eks_old_restruct_cnt,
    NULL::smallint AS eks_old_prolong_cnt,
    NULL::date AS eks_contract_expiration_dt,
    NULL::text AS diff_intst_rate_flag,
    NULL::date AS grntee_claim_notice_dt,
    NULL::text AS restruct_refin_default_flag,
    NULL::date AS restruct_refin_default_dt,
    NULL::bigint AS debt_due_acc_crncy_id,
    NULL::bigint AS unused_limit_acc_crncy_id,
    NULL::bigint AS grntee_acc_crncy_id,
    'N'::text AS has_higher_flag,
    NULL::bigint AS zero_id,
    NULL::bigint AS four_id,
    NULL::date AS eks_cession_dt,
    NULL::bigint AS agr_cession_id,
    NULL::numeric(38,8) AS cession_sell_got_cess_amt,
    NULL::numeric(38,8) AS cession_sell_debt_cess_amt,
    NULL::numeric(38,8) AS cession_sell_intrst_cess_amt,
    NULL::numeric(38,8) AS cession_sell_cess_amt,
    agr_crncy.crncy_id_eks AS crncy_id,
    flt.agr_cred_type_id,
    NULL::text AS agr_cred_type_cd,
    NULL::bigint AS f26_agr_cred_type_id,
    NULL::text AS f26_agr_cred_type_cd,
    rvlng.rvlng_flag,
    NULL::text AS overdraft_flag,
    NULL::date AS cession_dt,
    NULL::text AS cession_buy_flag,
    NULL::text AS cess_deferred_flag,
    NULL::date AS agr_cred_rate_first_dt,
    NULL::bigint AS cess_crncy_id,
    NULL::text AS k7m_flag,
    NULL::text AS poci_flag,
    NULL::text AS fin_guarantee_flag,
    NULL::text AS fin_guarantee_loan_flag,
    NULL::date AS limit_use_end_dt,
    agr_cred.open_dt,
    NULL::numeric(38,8) AS eks_grntee_amt,
    NULL::text AS grntee_ast_flag,
    agr_crncy.crncy_id AS crncy_id_uvdo,
    agr_crncy.crncy_cd AS crncy_cd_uvdo,
    agr_crncy.iso_crncy_cd AS iso_crncy_cd_uvdo,
    agr_cred.payer_cust_id AS cust_id_uvdo,
    agr_cred.agr_cred_type_id AS letter_of_credit_type_id,
    agr_cred.revocable_accred_flag AS let_of_cred_revoce_flag,
        CASE
            WHEN ((gen.agr_frame_id IS NOT NULL) OR (flt.agr_cred_type_id = '-1034'::integer)) THEN 'N'::text
            ELSE 'Y'::text
        END AS let_of_cred_cover_flag,
    agr_cred.host_eks_agrmnt_id AS host_let_of_cred_cover_id,
    agr_cred.start_sum_crncy_amt AS agr_cred_start_amt,
    NULL::text AS k7m_pl_flag,
    NULL::bigint AS coa_cred_f26_prod_id,
    (1)::smallint AS subject_area_type_id,
    rvlng.accounting_scheme_id AS let_of_cred_acc_scheme_id
   FROM ((((s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr_cred
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo flt ON ((agr_cred.agr_cred_id = flt.agr_cred_id)))
     LEFT JOIN ( SELECT curu.crncy_id,
            max(cure.crncy_id) AS crncy_id_eks,
            max(COALESCE(cure.crncy_cd, '-1'::text)) AS crncy_cd,
            max(COALESCE(cure.crncy_name, ''::text)) AS crncy_name,
            max(curu.iso_crncy_cd) AS iso_crncy_cd,
            max(curu.info_system_id) AS info_system_id
           FROM (s_grnplm_as_t_didsd_029_vd_dwh.v_crncy curu
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_crncy cure ON ((cure.iso_crncy_cd = curu.iso_crncy_cd)))
          GROUP BY curu.crncy_id) agr_crncy ON ((agr_crncy.crncy_id = agr_cred.crncy_id)))
     LEFT JOIN ( SELECT t1.agr_cred_id,
            max(t2.agr_cred_id) AS agr_frame_id
           FROM (( SELECT ""v_agr_cred_metric_hist$$$"".agr_cred_id,
                    max(""v_agr_cred_metric_hist$$$"".agr_cred_metric_txt) AS frame_host_agr_cred_id
                   FROM s_grnplm_as_t_didsd_029_vd_dwh.""v_agr_cred_metric_hist$$$""
                  WHERE ((((""v_agr_cred_metric_hist$$$"".agr_cred_metric_type_id = '-1007'::integer) AND (""v_agr_cred_metric_hist$$$"".agr_cred_metric_txt <> '-1'::text)) AND (btrim(""v_agr_cred_metric_hist$$$"".agr_cred_metric_txt) >= '0'::text)) AND (btrim(""v_agr_cred_metric_hist$$$"".agr_cred_metric_txt) <= '99999999999999999999'::text))
                  GROUP BY ""v_agr_cred_metric_hist$$$"".agr_cred_id) t1
             JOIN ( SELECT d_agr_cred_core_uvdo.agr_cred_id,
                    d_agr_cred_core_uvdo.host_agr_cred_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core_uvdo
                  WHERE (d_agr_cred_core_uvdo.agr_cred_type_id = '-1034'::integer)) t2 ON ((t1.frame_host_agr_cred_id = t2.host_agr_cred_id)))
          GROUP BY t1.agr_cred_id) gen ON ((agr_cred.agr_cred_id = gen.agr_cred_id)))
     LEFT JOIN ( SELECT agr.agr_cred_id,
            agr.accounting_scheme_id,
                CASE
                    WHEN ((aty.host_agr_cred_type_id = (12)::numeric) AND (ttt.uvdo_ttovarlc_name = ' '::text)) THEN 'Y'::text
                    ELSE 'N'::text
                END AS rvlng_flag
           FROM ((s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred agr
             LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.""v_$uvdo_ttovarlc"" ttt ON ((ttt.uvdo_ttovarlc_id = agr.uvdo_ttovarlc_id)))
             LEFT JOIN s_grnplm_as_t_didsd_029_vd_dwh.v_agr_cred_type aty ON ((aty.agr_cred_type_id = agr.agr_cred_type_id)))) rvlng ON ((agr_cred.agr_cred_id = rvlng.agr_cred_id)))
UNION ALL
 SELECT core.agr_cred_id,
    NULL::bigint AS prnt_agr_cred_id,
    core.info_system_id,
    coa.coa_num AS agr_num,
    NULL::text AS grntee_agr_num,
    coa.coa_start_dt AS signed_dt,
    coa.crncy_id AS issue_crncy_id,
    NULL::text AS eks_overdraft_flag,
    NULL::bigint AS agr_regls_type_id,
    NULL::date AS issue_dt,
    coa.coa_end_dt AS close_dt,
    NULL::date AS expiration_dt,
    '-1'::text AS host_agr_cred_id,
    NULL::text AS host_crm_id,
    NULL::bigint AS eks_agr_cred_type_id,
    NULL::bigint AS agr_frame_id,
    NULL::text AS eks_rvlng_flag,
    xref.coa_int_org_pty_id AS issue_int_org_id,
    NULL::text AS multi_crncy_flag,
    NULL::smallint AS eks_old_restruct_cnt,
    NULL::smallint AS eks_old_prolong_cnt,
    NULL::date AS eks_contract_expiration_dt,
    NULL::text AS diff_intst_rate_flag,
    NULL::date AS grntee_claim_notice_dt,
    NULL::text AS restruct_refin_default_flag,
    NULL::date AS restruct_refin_default_dt,
    NULL::bigint AS debt_due_acc_crncy_id,
    NULL::bigint AS unused_limit_acc_crncy_id,
    NULL::bigint AS grntee_acc_crncy_id,
    NULL::text AS has_higher_flag,
    NULL::bigint AS zero_id,
    NULL::bigint AS four_id,
    NULL::date AS eks_cession_dt,
    NULL::bigint AS agr_cession_id,
    NULL::numeric(38,8) AS cession_sell_got_cess_amt,
    NULL::numeric(38,8) AS cession_sell_debt_cess_amt,
    NULL::numeric(38,8) AS cession_sell_intrst_cess_amt,
    NULL::numeric(38,8) AS cession_sell_cess_amt,
    coa.crncy_id,
    core.agr_cred_type_id,
    NULL::text AS agr_cred_type_cd,
    (4)::bigint AS f26_agr_cred_type_id,
    '1'::text AS f26_agr_cred_type_cd,
    NULL::text AS rvlng_flag,
    NULL::text AS overdraft_flag,
    NULL::date AS cession_dt,
    NULL::text AS cession_buy_flag,
    NULL::text AS cess_deferred_flag,
    NULL::date AS agr_cred_rate_first_dt,
    NULL::bigint AS cess_crncy_id,
    NULL::text AS k7m_flag,
    NULL::text AS poci_flag,
    NULL::text AS fin_guarantee_flag,
    NULL::text AS fin_guarantee_loan_flag,
    NULL::date AS limit_use_end_dt,
    coa.coa_start_dt AS open_dt,
    NULL::numeric(38,8) AS eks_grntee_amt,
    NULL::text AS grntee_ast_flag,
    NULL::bigint AS crncy_id_uvdo,
    NULL::text AS crncy_cd_uvdo,
    NULL::text AS iso_crncy_cd_uvdo,
    NULL::bigint AS cust_id_uvdo,
    NULL::bigint AS letter_of_credit_type_id,
    NULL::text AS let_of_cred_revoce_flag,
    NULL::text AS let_of_cred_cover_flag,
    NULL::bigint AS host_let_of_cred_cover_id,
    NULL::numeric(38,8) AS agr_cred_start_amt,
    NULL::text AS k7m_pl_flag,
    type1.agrmnt_class_val_id AS coa_cred_f26_prod_id,
    core.subject_area_type_id,
    NULL::bigint AS let_of_cred_acc_scheme_id
   FROM ((((s_grnplm_vd_t_bvd_db_dmslcl.d_coa_cred_core core
     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa coa ON ((core.coa_id = coa.coa_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_coa_int_org_xref xref ON (((((coa.coa_id = xref.coa_id) AND (xref.coa_int_org_type_id = '-1001'::integer)) AND (coa.coa_start_dt >= xref.coa_int_org_start_dt)) AND (coa.coa_start_dt <= xref.coa_int_org_end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_crncy_s s ON ((coa.crncy_id = s.crncy_id)))
     LEFT JOIN ( SELECT max(o.agrmnt_class_val_id) AS agrmnt_class_val_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val o
          WHERE ((o.agrmnt_clsfctn_id = ANY (ARRAY['-1024'::integer, '-1025'::integer])) AND (upper(o.agrmnt_clsfctn_val_cd) = 'TYPE_'::text))) type1 ON ((1 = 1)));"
d_agr_cred_tmp," SELECT t.agr_cred_id,
    t.prnt_agr_cred_id,
    t.info_system_id,
    t.agrmnt_num,
    t.grntee_agr_num,
    t.acct_signed_dt,
    t.issue_crncy_id,
    t.eks_overdraft_flag,
    t.agr_regls_type_id,
    t.eks_issue_dt,
    t.eks_transhes_issue_dt,
    t.close_dt,
        CASE
            WHEN (agra_a088.agr_cred_type_id = '-1006'::integer) THEN t.acct_bal_metric_dt_arh3
            ELSE COALESCE(t.eks_contract_expiration_dt_arh, t.acct_bal_metric_dt_arh2)
        END AS expiration_dt,
    t.host_agr_cred_id,
    t.host_crm_id,
    t.eks_agr_cred_type_id,
    t.agr_frame_id,
    t.eks_rvlng_flag,
    t.issue_int_org_id,
    t.multi_crncy_flag,
    t.eks_old_restruct_cnt,
    t.eks_old_prolong_cnt,
    t.eks_contract_expiration_dt,
    t.grntee_claim_notice_dt,
    t.restruct_refin_default_flag,
    t.restruct_refin_default_dt,
    t.has_higher_flag,
    t.zero_id,
    t.four_id,
    t.eks_cession_dt,
    t.agr_cession_id,
    t.cession_sell_got_cess_amt,
    t.cession_sell_debt_cess_amt,
    t.cession_sell_intrst_cess_amt,
    (t.cession_sell_debt_cess_amt + t.cession_sell_intrst_cess_amt) AS cession_sell_cess_amt,
    agra_a088.agr_cred_type_id,
    agra_a088.agr_cred_type_cd,
    agra_a086.f26_agr_cred_type_id,
    agra_a086.f26_agr_cred_type_cd,
        CASE
            WHEN ((t.has_higher_flag = 'Y'::text) AND (t.eks_overdraft_flag = 'N'::text)) THEN 'N'::text
            WHEN (t.f26_agr_cred_type_cd = '10'::text) THEN 'N'::text
            WHEN (t.eks_overdraft_flag = 'Y'::text) THEN 'Y'::text
            WHEN (t.agr_cred_type_cd = ANY (ARRAY['1'::text, '6'::text])) THEN COALESCE(t.eks_rvlng_flag, 'N'::text)
            ELSE 'N'::text
        END AS rvlng_flag,
        CASE
            WHEN ((t.eks_overdraft_flag = 'Y'::text) AND (COALESCE(t.f26_agr_cred_type_cd, '0'::text) <> '10'::text)) THEN 'Y'::text
            ELSE 'N'::text
        END AS overdraft_flag,
    cess_last_reg.cess_last_reg_dt,
    agr_cession.crncy_id AS cess_crncy_id,
        CASE
            WHEN (aaca_k7m.agr_cred_id IS NULL) THEN 'N'::text
            ELSE 'Y'::text
        END AS k7m_flag,
    fgt.eks_loan_poci_flag AS poci_flag,
        CASE
            WHEN (fgtd.eks_fin_guarantee_type_id IS NULL) THEN 'N'::text
            ELSE 'Y'::text
        END AS fin_guarantee_flag,
    fgt.eks_fin_guarantee_loan_flag AS fin_guarantee_loan_flag,
    lmt_mtrc.limit_use_end_dt,
    t.open_dt,
    grntee_amt_mtrc.eks_grntee_amt,
        CASE
            WHEN (gaflg.agrmnt_clsfctn_val_cd = 'GUAR_PREF_022'::text) THEN 'Y'::text
            ELSE 'N'::text
        END AS grntee_ast_flag,
        CASE
            WHEN (ap_k7m.c_bool = '1'::text) THEN 'Y'::text
            ELSE 'N'::text
        END AS k7m_pl_flag
   FROM (((((((((((( SELECT agr.agrmnt_id AS agr_cred_id,
            agr.prnt_agr_cred_id,
            agr.info_system_id,
            agr.agrmnt_num,
            grnt.agrmnt_txt AS grntee_agr_num,
            agr.acct_signed_dt,
            ac.acct_crncy_id AS issue_crncy_id,
                CASE
                    WHEN ((COALESCE(ife.feature_ind, 'NO'::text) = 'YES'::text) AND (fag.fin_agrmnt_type_id <> '-1007'::integer)) THEN 'Y'::text
                    ELSE 'N'::text
                END AS eks_overdraft_flag,
            ass.agrmnt_class_val_id AS agr_regls_type_id,
            iss_dt.acct_bal_metric_dt AS eks_issue_dt,
            trn_iss_dt.trn_acct_bal_metric_dt AS eks_transhes_issue_dt,
            agr.acct_close_dt AS close_dt,
            agr.host_agrmnt_cd AS host_agr_cred_id,
            crm.appl_num AS host_crm_id,
            fag.fin_agrmnt_type_id AS eks_agr_cred_type_id,
                CASE
                    WHEN (fag.fin_agrmnt_type_id = ANY (ARRAY[('-1007'::integer)::bigint, ('-1024'::integer)::bigint, ('-1025'::integer)::bigint])) THEN agr.agrmnt_id
                    ELSE COALESCE(agr_frame.related_agrmnt_id, ('-1'::integer)::bigint)
                END AS agr_frame_id,
            COALESCE(
                CASE rvlng.feature_ind
                    WHEN IS NOT DISTINCT FROM 'YES'::text THEN 'Y'::text
                    WHEN IS NOT DISTINCT FROM 'NO'::text THEN 'N'::text
                    ELSE NULL::text
                END, 'N'::text) AS eks_rvlng_flag,
            issue_io.srv_int_org_id AS issue_int_org_id,
            NULL::unknown AS multi_crncy_flag,
            eks_old_res.eks_old_restruct_cnt,
            eks_old_res_sec.acct_bal_metric_cnt AS eks_old_prolong_cnt,
            agr.contract_expiration_dt AS eks_contract_expiration_dt,
            not_dt.acct_bal_metric_dt AS grntee_claim_notice_dt,
                CASE aaca_rrdf.agrmnt_class_val_id
                    WHEN IS NOT DISTINCT FROM '-1001'::integer THEN 'Y'::text
                    WHEN IS NOT DISTINCT FROM '-1002'::integer THEN 'N'::text
                    ELSE NULL::text
                END AS restruct_refin_default_flag,
            amh_rrdd.acct_bal_metric_dt AS restruct_refin_default_dt,
            agr.has_higher_flag,
            cust_fin_pos_type_is.zero_id,
            cust_fin_pos_type_is.four_id,
            cess_la.cession_dt AS eks_cession_dt,
            cessa.related_agrmnt_id AS agr_cession_id,
            COALESCE(cess_get.acct_bal_metric_amt, (0)::numeric) AS cession_sell_got_cess_amt,
            COALESCE(cess_give_pri.acct_bal_metric_amt, (0)::numeric) AS cession_sell_debt_cess_amt,
            COALESCE(cess_give_int.acct_bal_metric_amt, (0)::numeric) AS cession_sell_intrst_cess_amt,
            agr.acct_open_dt AS open_dt,
            fag.fin_agrmnt_type_id,
            agra_e086_1.f26_agr_cred_type_cd,
            agra_e088.agr_cred_type_cd,
            agr_frame.related_agrmnt_id,
            cessa.related_agrmnt_id AS related_agrmnt_id_cess,
            arh3.acct_bal_metric_dt AS acct_bal_metric_dt_arh3,
            arh2.acct_bal_metric_dt AS acct_bal_metric_dt_arh2,
            arh.eks_contract_expiration_dt AS eks_contract_expiration_dt_arh
           FROM (((((((((((((((((((((((((((((( SELECT agr_1.agrmnt_id,
                    agr_1.acct_open_dt,
                    agr_1.contract_expiration_dt,
                    agr_1.acct_src_id,
                    agr_1.info_system_id,
                    agr_1.acct_close_dt,
                    agr_1.acct_signed_dt,
                    agr_1.agrmnt_num,
                    agr_1.host_agrmnt_cd,
                    agr_1.host_agrmnt_guid,
                    agr_1.asset_liab_cd,
                    agr_1.agrmnt_categ_id,
                    agr_1.agrmnt_rec_start_dt,
                    agr_1.agrmnt_rec_end_dt,
                    agr_1.bal_sheet_cd,
                    agr_1.acct_current_stts_type_id,
                    agr_1.alternate_agrmnt_name,
                    agr_1.alternate_agrmnt_signed_dt,
                    agr_1.crm_appl_id,
                    agr_1.eks_host_murex_agr_id,
                    agr_1.eks_del_dt,
                    agr_1.host_pprb_agr_dep_id,
                    agr_1.host_pprb_agr_rko_id,
                    agr_1.online_flag,
                    agr_1.offer_flag,
                    agr_1.frame_agrmnt_type_id,
                    agr_1.eks_visible_flag,
                    agr_1.master_info_system_id,
                    agr_1.host_calypso_agrmnt_id,
                    agr_1.eks_transfer_to_sol_flag,
                    agr_1.eks_transfer_to_pprb_flag,
                    COALESCE(prnt.prnt_agr_cred_id, agr_1.agrmnt_id) AS prnt_agr_cred_id,
                        CASE
                            WHEN (COALESCE(prnt.prnt_agr_cred_id, agr_1.agrmnt_id) <> agr_1.agrmnt_id) THEN 'Y'::text
                            ELSE 'N'::text
                        END AS has_higher_flag
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt agr_1
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp prnt ON ((prnt.agr_cred_id = agr_1.agrmnt_id)))
                  WHERE (((1 = 1) AND (agr_1.agrmnt_categ_id = 1)) AND (agr_1.agrmnt_id <> '-1'::integer))) agr
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_info_system i ON ((((i.info_system_id = agr.info_system_id) AND (i.info_system_type_cd = '010'::text)) AND (i.info_system_inst_cd = '910002'::text))))
             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fag ON ((fag.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT a2f.agrmnt_id,
                    max(ife_1.feature_ind) AS feature_ind
                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_feature a2f
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_feature fea ON ((((fea.feature_id = a2f.feature_id) AND (fea.feature_type_id = 4)) AND (fea.feature_clsfctn_id = '-1014'::integer))))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_ind_feature ife_1 ON ((ife_1.feature_id = fea.feature_id)))
                  WHERE (a2f.acct_feature_role_id = 1)
                  GROUP BY a2f.agrmnt_id) ife ON ((ife.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_text_hist grnt ON (((grnt.agrmnt_id = agr.agrmnt_id) AND (grnt.agrmnt_text_type_id = '-1004'::integer))))
             LEFT JOIN ( SELECT a2f.agrmnt_id,
                    max(ife_1.feature_ind) AS feature_ind
                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_acct_feature a2f
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_feature fea ON ((fea.feature_id = a2f.feature_id)))
                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_ind_feature ife_1 ON ((ife_1.feature_id = fea.feature_id)))
                  WHERE (((a2f.acct_feature_role_id = 1) AND (fea.feature_type_id = 4)) AND (fea.feature_clsfctn_id = '-1015'::integer))
                  GROUP BY a2f.agrmnt_id) rvlng ON ((rvlng.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT v_agmt_agmt_class_assoc.agrmnt_id,
                    max(v_agmt_agmt_class_assoc.agrmnt_class_val_id) AS agrmnt_class_val_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc
                  WHERE (v_agmt_agmt_class_assoc.agrmnt_clsfctn_id = 12)
                  GROUP BY v_agmt_agmt_class_assoc.agrmnt_id) ass ON ((ass.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.acct_crncy_id
                   FROM ( SELECT v_acct_crncy.agrmnt_id,
                            v_acct_crncy.acct_crncy_id,
                            row_number() OVER (PARTITION BY v_acct_crncy.agrmnt_id ORDER BY v_acct_crncy.acct_crncy_start_dt DESC) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_crncy
                          WHERE (v_acct_crncy.crncy_use_id = 4)) t_1
                  WHERE (t_1.rn = 1)) ac ON ((ac.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.eks_contract_expiration_dt
                   FROM ( SELECT v_acct_renewal_hist.agrmnt_id,
                            v_acct_renewal_hist.eks_contract_expiration_dt,
                            row_number() OVER (PARTITION BY v_acct_renewal_hist.agrmnt_id ORDER BY v_acct_renewal_hist.contract_start_dt) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_acct_renewal_hist
                          WHERE (v_acct_renewal_hist.eks_contract_expiration_dt IS NOT NULL)) t_1
                  WHERE (t_1.rn = 1)) arh ON ((arh.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.acct_bal_metric_dt
                   FROM ( SELECT v_agrmnt_metric_hist.agrmnt_id,
                            v_agrmnt_metric_hist.acct_bal_metric_dt,
                            row_number() OVER (PARTITION BY v_agrmnt_metric_hist.agrmnt_id ORDER BY v_agrmnt_metric_hist.acct_bal_metric_start_dt DESC) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist
                          WHERE (((v_agrmnt_metric_hist.acct_metric_type_id = '-1046'::integer) AND (v_agrmnt_metric_hist.bal_cat_type_id = '-1'::integer)) AND (v_agrmnt_metric_hist.acct_bal_metric_dt IS NOT NULL))) t_1
                  WHERE (t_1.rn = 1)) arh2 ON ((arh2.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.acct_bal_metric_dt
                   FROM ( SELECT v_agrmnt_metric_hist.agrmnt_id,
                            v_agrmnt_metric_hist.acct_bal_metric_dt,
                            row_number() OVER (PARTITION BY v_agrmnt_metric_hist.agrmnt_id ORDER BY v_agrmnt_metric_hist.acct_bal_metric_start_dt) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist
                          WHERE (((v_agrmnt_metric_hist.acct_metric_type_id = '-1046'::integer) AND (v_agrmnt_metric_hist.bal_cat_type_id = '-1'::integer)) AND (v_agrmnt_metric_hist.acct_bal_metric_dt IS NOT NULL))) t_1
                  WHERE (t_1.rn = 1)) arh3 ON ((arh3.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.related_agrmnt_id,
                    t_1.agrmnt_id
                   FROM ( SELECT rel.related_agrmnt_id,
                            rel.agrmnt_id,
                            row_number() OVER (PARTITION BY rel.agrmnt_id ORDER BY rel.agrmnt_related_start_dt, rel.related_agrmnt_id DESC) AS rn
                           FROM (( SELECT rel_1.related_agrmnt_id,
                                    rel_1.agrmnt_id,
                                    rel_1.agrmnt_related_start_dt
                                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related rel_1
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fag_1 ON ((fag_1.agrmnt_id = rel_1.related_agrmnt_id)))
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor_1 ON ((cor_1.agr_cred_id = rel_1.related_agrmnt_id)))
                                  WHERE ((rel_1.agrmnt_related_type_id = 1) AND (fag_1.fin_agrmnt_type_id = ANY (ARRAY[('-1024'::integer)::bigint, ('-1025'::integer)::bigint])))
                                UNION ALL
                                 SELECT rel_1.agrmnt_id AS related_agrmnt_id,
                                    rel_1.related_agrmnt_id AS agrmnt_id,
                                    rel_1.agrmnt_related_start_dt
                                   FROM ((s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related rel_1
                                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor_1 ON ((rel_1.agrmnt_id = cor_1.agr_cred_id)))
                                     JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_fin_agrmnt fag_1 ON ((fag_1.agrmnt_id = rel_1.agrmnt_id)))
                                  WHERE ((rel_1.agrmnt_related_type_id = '-1004'::integer) AND (fag_1.fin_agrmnt_type_id = '-1007'::integer))) rel
                             JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core cor ON ((cor.agr_cred_id = rel.related_agrmnt_id)))) t_1
                  WHERE (t_1.rn = 1)) agr_frame ON (((agr_frame.agrmnt_id = agr.agrmnt_id) AND (agr.prnt_agr_cred_id = agr.agrmnt_id))))
             LEFT JOIN ( SELECT t_1.agr_cred_id,
                    count(1) AS eks_old_restruct_cnt
                   FROM ( SELECT mh.agrmnt_id AS agr_cred_id,
                            mh.acct_bal_metric_start_dt
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist mh
                          WHERE (((mh.acct_metric_type_id = '-1004'::integer) AND (mh.acct_bal_metric_start_dt <> '1900-01-01'::date)) AND (mh.acct_bal_metric_cnt > 0))) t_1
                  GROUP BY t_1.agr_cred_id) eks_old_res ON ((eks_old_res.agr_cred_id = agr.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.acct_bal_metric_cnt
                   FROM ( SELECT eks_old_res_sec_1.agrmnt_id,
                            eks_old_res_sec_1.acct_bal_metric_cnt,
                            row_number() OVER (PARTITION BY eks_old_res_sec_1.agrmnt_id ORDER BY eks_old_res_sec_1.acct_bal_metric_start_dt) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist eks_old_res_sec_1
                          WHERE (((eks_old_res_sec_1.acct_metric_type_id = '-1005'::integer) AND (eks_old_res_sec_1.bal_cat_type_id = '-1'::integer)) AND (eks_old_res_sec_1.acct_bal_metric_crncy_id IS NULL))) t_1
                  WHERE (t_1.rn = 1)) eks_old_res_sec ON ((eks_old_res_sec.agrmnt_id = agr.agrmnt_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist not_dt ON ((((not_dt.agrmnt_id = agr.agrmnt_id) AND (not_dt.acct_metric_type_id = '-1044'::integer)) AND (not_dt.bal_cat_type_id = '-1'::integer))))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.acct_bal_metric_dt
                   FROM ( SELECT a_m_t.agrmnt_id,
                            a_m_t.acct_bal_metric_dt,
                            row_number() OVER (PARTITION BY a_m_t.agrmnt_id ORDER BY a_m_t.acct_bal_metric_start_dt DESC NULLS LAST, a_m_t.acct_bal_metric_end_dt DESC NULLS LAST, a_m_t.acct_bal_metric_dt DESC NULLS LAST) AS rn
                           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist a_m_t
                          WHERE ((a_m_t.bal_cat_type_id = '-1'::integer) AND (a_m_t.acct_metric_type_id = '-1043'::integer))) t_1
                  WHERE (t_1.rn = 1)) iss_dt ON ((agr.agrmnt_id = iss_dt.agrmnt_id)))
             LEFT JOIN ( SELECT prnt.prnt_agr_cred_id,
                    min(iss_dt_1.acct_bal_metric_dt) AS trn_acct_bal_metric_dt
                   FROM (( SELECT t_1.agrmnt_id,
                            t_1.acct_bal_metric_dt
                           FROM ( SELECT a_m_t.agrmnt_id,
                                    a_m_t.acct_bal_metric_dt,
                                    row_number() OVER (PARTITION BY a_m_t.agrmnt_id ORDER BY a_m_t.acct_bal_metric_start_dt DESC NULLS LAST, a_m_t.acct_bal_metric_end_dt DESC NULLS LAST) AS rn
                                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist a_m_t
                                  WHERE ((a_m_t.bal_cat_type_id = '-1'::integer) AND (a_m_t.acct_metric_type_id = '-1043'::integer))) t_1
                          WHERE (t_1.rn = 1)) iss_dt_1
                     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp prnt ON ((prnt.prnt_agr_cred_id = iss_dt_1.agrmnt_id)))
                  GROUP BY prnt.prnt_agr_cred_id) trn_iss_dt ON ((agr.agrmnt_id = trn_iss_dt.prnt_agr_cred_id)))
             LEFT JOIN ( SELECT t_1.agr_cred_id,
                    t_1.srv_int_org_id
                   FROM ( SELECT d_agr_cred_int_org_tmp.agr_cred_id,
                            d_agr_cred_int_org_tmp.srv_int_org_id,
                            row_number() OVER (PARTITION BY d_agr_cred_int_org_tmp.agr_cred_id ORDER BY d_agr_cred_int_org_tmp.start_dt) AS rn
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_int_org_tmp) t_1
                  WHERE (t_1.rn = 1)) issue_io ON ((agr.agrmnt_id = issue_io.agr_cred_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.appl_num
                   FROM ( SELECT ata.agrmnt_id,
                            a.appl_num,
                            row_number() OVER (PARTITION BY ata.agrmnt_id ORDER BY ata.agmt_to_appl_start_dt DESC, a.appl_num) AS rn
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_to_appl ata
                             JOIN s_grnplm_as_t_didsd_039_vd_dwh.v_appl a ON ((a.appl_id = ata.appl_id)))
                          WHERE (ata.agrmnt_appl_role_id = '-1004'::integer)) t_1
                  WHERE (t_1.rn = 1)) crm ON ((agr.agrmnt_id = crm.agrmnt_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_rrdf ON (((agr.agrmnt_id = aaca_rrdf.agrmnt_id) AND (aaca_rrdf.agrmnt_clsfctn_id = '-1031'::integer))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist amh_rrdd ON ((((agr.agrmnt_id = amh_rrdd.agrmnt_id) AND (amh_rrdd.bal_cat_type_id = '-1'::integer)) AND (amh_rrdd.acct_metric_type_id = '-1045'::integer))))
             LEFT JOIN ( SELECT v_pty_class_val.info_system_id,
                    max(
                        CASE
                            WHEN (v_pty_class_val.pty_class_val_cd = '0'::text) THEN v_pty_class_val.pty_class_val_id
                            ELSE NULL::bigint
                        END) AS zero_id,
                    max(
                        CASE
                            WHEN (v_pty_class_val.pty_class_val_cd = '4'::text) THEN v_pty_class_val.pty_class_val_id
                            ELSE NULL::bigint
                        END) AS four_id
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_pty_class_val
                  WHERE ((v_pty_class_val.pty_clsfctn_id = 5) AND (v_pty_class_val.pty_class_val_cd = ANY (ARRAY['0'::text, '4'::text])))
                  GROUP BY v_pty_class_val.info_system_id) cust_fin_pos_type_is ON ((cust_fin_pos_type_is.info_system_id = agr.info_system_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_loan_acct cess_la ON ((agr.agrmnt_id = cess_la.agrmnt_id)))
             LEFT JOIN ( SELECT t_1.agrmnt_id,
                    t_1.related_agrmnt_id
                   FROM ( SELECT cessa_1.agrmnt_id,
                            cessa_1.related_agrmnt_id,
                            row_number() OVER (PARTITION BY cessa_1.agrmnt_id ORDER BY agr_cess.acct_open_dt DESC) AS rn
                           FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_related cessa_1
                             JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt agr_cess ON ((agr_cess.agrmnt_id = cessa_1.related_agrmnt_id)))
                          WHERE (((cessa_1.agrmnt_related_type_id = '-1009'::integer) AND (cessa_1.agrmnt_related_end_dt = '9999-12-31'::date)) AND (cessa_1.related_agrmnt_id IS NOT NULL))) t_1
                  WHERE (t_1.rn = 1)) cessa ON ((agr.agrmnt_id = cessa.agrmnt_id)))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist cess_get ON (((((agr.agrmnt_id = cess_get.agrmnt_id) AND (cess_get.acct_metric_type_id = '-1054'::integer)) AND (cess_get.bal_cat_type_id = '-1'::integer)) AND (cess_get.acct_bal_metric_end_dt = '9999-12-31'::date))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist cess_give_pri ON (((((agr.agrmnt_id = cess_give_pri.agrmnt_id) AND (cess_give_pri.acct_metric_type_id = '-1053'::integer)) AND (cess_give_pri.bal_cat_type_id = '-1'::integer)) AND (cess_give_pri.acct_bal_metric_end_dt = '9999-12-31'::date))))
             LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist cess_give_int ON (((((agr.agrmnt_id = cess_give_int.agrmnt_id) AND (cess_give_int.acct_metric_type_id = '-1052'::integer)) AND (cess_give_int.bal_cat_type_id = '-1'::integer)) AND (cess_give_int.acct_bal_metric_end_dt = '9999-12-31'::date))))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_type agra_e088 ON ((agra_e088.agr_cred_type_id = fag.fin_agrmnt_type_id)))
             LEFT JOIN ( SELECT t_1.agr_cred_id,
                    t_1.eks_a_f26_agr_cred_type_id
                   FROM ( SELECT d_agr_cred_prod.agr_cred_id,
                            d_agr_cred_prod.eks_a_f26_agr_cred_type_id,
                            row_number() OVER (PARTITION BY d_agr_cred_prod.agr_cred_id ORDER BY d_agr_cred_prod.start_dt DESC) AS rn
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod
                          WHERE (NOT (d_agr_cred_prod.eks_a_f26_agr_cred_type_id IN ( SELECT a_f26_agr_cred_type.f26_agr_cred_type_id
                                   FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type
                                  WHERE (a_f26_agr_cred_type.f26_agr_cred_type_cd = '9'::text))))) t_1
                  WHERE (t_1.rn = 1)) agr_cred_prod ON ((agr_cred_prod.agr_cred_id = agr.agrmnt_id)))
             LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type agra_e086_1 ON ((agr_cred_prod.eks_a_f26_agr_cred_type_id = agra_e086_1.f26_agr_cred_type_id)))) t
     LEFT JOIN ( SELECT a.f26_agr_cred_type_cd,
            max(a.f26_agr_cred_type_id) AS f26_agr_cred_type_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type a
          GROUP BY a.f26_agr_cred_type_cd) agra_a086 ON ((agra_a086.f26_agr_cred_type_cd =
        CASE
            WHEN (t.has_higher_flag = 'Y'::text) THEN ''::text
            WHEN (t.fin_agrmnt_type_id = ANY (ARRAY[('-1007'::integer)::bigint, ('-1024'::integer)::bigint, ('-1025'::integer)::bigint, ('-1028'::integer)::bigint, ('-1031'::integer)::bigint])) THEN ' .'::text
            WHEN (t.f26_agr_cred_type_cd = '10'::text) THEN '10'::text
            WHEN (COALESCE(t.eks_overdraft_flag, 'N'::text) = 'Y'::text) THEN ('4'::text ||
            CASE
                WHEN (t.f26_agr_cred_type_cd = '4.1'::text) THEN '.1'::text
                ELSE ''::text
            END)
            WHEN (t.agr_cred_type_cd = '4'::text) THEN ''::text
            WHEN (t.agr_cred_type_cd = '2'::text) THEN ''::text
            WHEN ((t.agr_cred_type_cd = '0'::text) AND (t.f26_agr_cred_type_cd = '7'::text)) THEN '7'::text
            WHEN (((COALESCE(t.related_agrmnt_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (t.agr_cred_type_cd = '0'::text)) AND (t.f26_agr_cred_type_cd = '6.1'::text)) THEN '6.1'::text
            WHEN ((COALESCE(t.related_agrmnt_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (t.agr_cred_type_cd = '0'::text)) THEN '5.1'::text
            WHEN (t.agr_cred_type_cd = '0'::text) THEN '1'::text
            WHEN (((COALESCE(t.related_agrmnt_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (t.agr_cred_type_cd = '1'::text)) AND (t.eks_rvlng_flag = 'N'::text)) THEN '5.2'::text
            WHEN ((t.agr_cred_type_cd = '1'::text) AND (t.eks_rvlng_flag = 'N'::text)) THEN ('2'::text ||
            CASE
                WHEN (t.f26_agr_cred_type_cd = '2.1'::text) THEN '.1'::text
                ELSE ''::text
            END)
            WHEN ((COALESCE(t.related_agrmnt_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (t.eks_rvlng_flag = 'Y'::text)) THEN ('5.3'::text ||
            CASE
                WHEN (t.f26_agr_cred_type_cd = '5.3-'::text) THEN '-'::text
                ELSE ''::text
            END)
            WHEN (t.eks_rvlng_flag = 'Y'::text) THEN ('3'::text ||
            CASE
                WHEN (t.f26_agr_cred_type_cd = '3-'::text) THEN '-'::text
                WHEN (t.f26_agr_cred_type_cd = '3-'::text) THEN '-'::text
                ELSE ''::text
            END)
            ELSE NULL::text
        END)))
     LEFT JOIN ( SELECT a.agr_cred_type_cd,
            max(a.agr_cred_type_id) AS agr_cred_type_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_type a
          GROUP BY a.agr_cred_type_cd) agra_a088 ON ((agra_a088.agr_cred_type_cd =
        CASE
            WHEN (t.has_higher_flag = 'Y'::text) THEN '4'::text
            WHEN (t.f26_agr_cred_type_cd = '10'::text) THEN '-'::text
            WHEN ((t.eks_overdraft_flag = 'Y'::text) AND (t.fin_agrmnt_type_id <> '-1007'::integer)) THEN '1'::text
            WHEN ((t.agr_cred_type_cd = '1'::text) AND (t.f26_agr_cred_type_cd = '7'::text)) THEN '-'::text
            ELSE COALESCE(t.agr_cred_type_cd, '-'::text)
        END)))
     LEFT JOIN ( SELECT d_agr_cred_prod.agr_cred_id,
            max(d_agr_cred_prod.start_dt) AS cess_last_reg_dt
           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod
          WHERE (d_agr_cred_prod.eks_a_f26_agr_cred_type_id IN ( SELECT a_f26_agr_cred_type.f26_agr_cred_type_id
                   FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type
                  WHERE (a_f26_agr_cred_type.f26_agr_cred_type_cd = '9'::text)))
          GROUP BY d_agr_cred_prod.agr_cred_id) cess_last_reg ON ((cess_last_reg.agr_cred_id = t.agr_cred_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cession agr_cession ON ((agr_cession.agr_cession_id = t.related_agrmnt_id_cess)))
     LEFT JOIN ( SELECT aaca_k7m_1.agrmnt_id AS agr_cred_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aaca_k7m_1
          WHERE ((aaca_k7m_1.agrmnt_clsfctn_id = '-1038'::integer) AND (aaca_k7m_1.agrmnt_class_val_id = '-1001'::integer))
          GROUP BY aaca_k7m_1.agrmnt_id) aaca_k7m ON ((t.agr_cred_id = aaca_k7m.agr_cred_id)))
     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_loan_term_acct fgt ON ((t.agr_cred_id = fgt.agrmnt_id)))
     LEFT JOIN ( SELECT max(fgtd_1.eks_fin_guarantee_type_id) AS eks_fin_guarantee_type_id
           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_$eks_fin_guarantee_type"" fgtd_1
          WHERE (fgtd_1.eks_fin_guarantee_type_cd = 'FIN'::text)) fgtd ON ((fgt.eks_fin_guarantee_type_id = fgtd.eks_fin_guarantee_type_id)))
     LEFT JOIN ( SELECT t_1.agrmnt_id,
            t_1.limit_use_end_dt
           FROM ( SELECT v_agrmnt_metric_hist.agrmnt_id,
                    v_agrmnt_metric_hist.acct_bal_metric_dt AS limit_use_end_dt,
                    row_number() OVER (PARTITION BY v_agrmnt_metric_hist.agrmnt_id ORDER BY v_agrmnt_metric_hist.acct_bal_metric_start_dt DESC) AS rn
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist
                  WHERE (((v_agrmnt_metric_hist.acct_metric_type_id = '-1060'::integer) AND (v_agrmnt_metric_hist.bal_cat_type_id = '-1'::integer)) AND (v_agrmnt_metric_hist.acct_bal_metric_dt IS NOT NULL))) t_1
          WHERE (t_1.rn = 1)) lmt_mtrc ON ((t.agr_cred_id = lmt_mtrc.agrmnt_id)))
     LEFT JOIN ( SELECT t_1.agrmnt_id,
            t_1.eks_grntee_amt
           FROM ( SELECT v_agrmnt_metric_hist.agrmnt_id,
                    v_agrmnt_metric_hist.acct_bal_metric_amt AS eks_grntee_amt,
                    row_number() OVER (PARTITION BY v_agrmnt_metric_hist.agrmnt_id ORDER BY v_agrmnt_metric_hist.acct_bal_metric_start_dt DESC) AS rn
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist
                  WHERE (((v_agrmnt_metric_hist.acct_metric_type_id = '-1017'::integer) AND (v_agrmnt_metric_hist.bal_cat_type_id = '-1'::integer)) AND (v_agrmnt_metric_hist.acct_metric_type_id IS NOT NULL))) t_1
          WHERE (t_1.rn = 1)) grntee_amt_mtrc ON ((t.agr_cred_id = grntee_amt_mtrc.agrmnt_id)))
     LEFT JOIN ( SELECT t_1.agrmnt_id,
            t_1.agrmnt_clsfctn_val_cd
           FROM ( SELECT aa.agrmnt_id,
                    ac.agrmnt_clsfctn_val_cd,
                    row_number() OVER (PARTITION BY aa.agrmnt_id ORDER BY aa.agrmnt_class_start_dt DESC, ac.agmt_class_val_start_dt) AS rn
                   FROM (s_grnplm_as_t_didsd_010_vd_dwh.v_agmt_agmt_class_assoc aa
                     LEFT JOIN s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_class_val ac ON (((ac.agrmnt_class_val_id = aa.agrmnt_class_val_id) AND (aa.agrmnt_clsfctn_id = ac.agrmnt_clsfctn_id))))
                  WHERE (((1 = 1) AND (aa.agrmnt_clsfctn_id = '-1039'::integer)) AND (aa.info_system_id = 1108))) t_1
          WHERE (t_1.rn = 1)) gaflg ON ((t.agr_cred_id = gaflg.agrmnt_id)))
     LEFT JOIN ( SELECT ap_k7m_1.agrmnt_id AS agr_cred_id,
            max(ap_k7m_1.c_bool) AS c_bool
           FROM s_grnplm_as_t_didsd_010_vd_dwh.""v_agrmnt_$$properties"" ap_k7m_1
          WHERE ((1 = 1) AND (ap_k7m_1.c_code = 'DealType'::text))
          GROUP BY ap_k7m_1.agrmnt_id) ap_k7m ON ((t.agr_cred_id = ap_k7m.agr_cred_id)))
  WHERE ((1 = 1) AND (t.fin_agrmnt_type_id = ANY (ARRAY[('-1006'::integer)::bigint, ('-1007'::integer)::bigint, ('-1008'::integer)::bigint, ('-1009'::integer)::bigint, ('-1010'::integer)::bigint, ('-1024'::integer)::bigint, ('-1025'::integer)::bigint, ('-1028'::integer)::bigint, ('-1031'::integer)::bigint])));"
d_agr_cred_dt," SELECT agr_cred.agr_cred_id,
    dt.start_dt,
    dt.end_dt,
    agra_a088.agr_cred_type_id,
    agra_a088.agr_cred_type_cd,
    agra_a086.f26_agr_cred_type_id,
    agra_a086.f26_agr_cred_type_cd,
        CASE
            WHEN ((agr_cred.has_higher_flag = 'Y'::text) AND (agr_cred.eks_overdraft_flag = 'N'::text)) THEN 'N'::text
            WHEN (('Y'::text = 'Y'::text) OR (agra_e086_1.f26_agr_cred_type_cd = '9'::text)) THEN 'N'::text
            WHEN (agra_e086_1.f26_agr_cred_type_cd = '10'::text) THEN 'N'::text
            WHEN (agr_cred.eks_overdraft_flag = 'Y'::text) THEN 'Y'::text
            WHEN (agra_e088.agr_cred_type_cd = '1'::text) THEN COALESCE(agr_cred.eks_rvlng_flag, 'N'::text)
            ELSE 'N'::text
        END AS rvlng_flag,
        CASE
            WHEN ((((agr_cred.eks_overdraft_flag = 'Y'::text) AND ('Y'::text = 'N'::text)) AND (COALESCE(agra_e086_1.f26_agr_cred_type_cd, '0'::text) <> '9'::text)) AND (COALESCE(agra_e086_1.f26_agr_cred_type_cd, '0'::text) <> '10'::text)) THEN 'Y'::text
            ELSE 'N'::text
        END AS overdraft_flag,
        CASE
            WHEN (agra_a086.f26_agr_cred_type_cd = ''::text) THEN COALESCE(agr_cred.grntee_acc_crncy_id, agr_cred.issue_crncy_id)
            WHEN (agra_a088.agr_cred_type_cd = '0'::text) THEN COALESCE(agr_cred.debt_due_acc_crncy_id, agr_cred.issue_crncy_id)
            WHEN (agra_a088.agr_cred_type_cd = '4'::text) THEN COALESCE(agr_cred.debt_due_acc_crncy_id, agr_cred.issue_crncy_id)
            WHEN (agra_a088.agr_cred_type_cd = '1'::text) THEN COALESCE(agr_cred.unused_limit_acc_crncy_id, agr_cred.issue_crncy_id)
            ELSE agr_cred.issue_crncy_id
        END AS crncy_id,
        CASE
            WHEN (agra_a088.agr_cred_type_cd = '2'::text) THEN agr_cred_prod.grntee_prod_id
            ELSE NULL::bigint
        END AS grntee_prod_id,
    agr_cred.info_system_id
   FROM ((((((( SELECT ""Window"".agr_cred_id,
            ""Window"".start_dt,
            COALESCE((max(""Window"".start_dt) OVER (PARTITION BY ""Window"".agr_cred_id ORDER BY ""Window"".start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt
           FROM ( SELECT dt_1.agr_cred_id,
                    dt_1.start_dt
                   FROM ( SELECT d_agr_cred_core.agr_cred_id,
                            '1900-01-01'::date AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_core
                        UNION ALL
                         SELECT d_agr_cred_prod.agr_cred_id,
                            d_agr_cred_prod.start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod
                        UNION ALL
                         SELECT d_agr_cred_prod.agr_cred_id,
                            (d_agr_cred_prod.end_dt + 1) AS start_dt
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod
                          WHERE (d_agr_cred_prod.end_dt <> '9999-12-31'::date)) dt_1
                  GROUP BY dt_1.agr_cred_id, dt_1.start_dt) ""Window""(agr_cred_id, start_dt)) dt
     JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred agr_cred ON ((agr_cred.agr_cred_id = dt.agr_cred_id)))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prod agr_cred_prod ON ((((agr_cred_prod.agr_cred_id = agr_cred.agr_cred_id) AND (dt.start_dt >= agr_cred_prod.start_dt)) AND (dt.start_dt <= agr_cred_prod.end_dt))))
     LEFT JOIN s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_type agra_e088 ON ((agra_e088.agr_cred_type_id = agr_cred.eks_agr_cred_type_id)))
     LEFT JOIN ( SELECT a.f26_agr_cred_type_cd,
            max(a.f26_agr_cred_type_id) AS f26_agr_cred_type_id_tmp
           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type a
          GROUP BY a.f26_agr_cred_type_cd) agra_e086_1 ON ((agr_cred_prod.eks_a_f26_agr_cred_type_id = agra_e086_1.f26_agr_cred_type_id_tmp)))
     LEFT JOIN ( SELECT a.f26_agr_cred_type_cd,
            max(a.f26_agr_cred_type_id) AS f26_agr_cred_type_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type a
          GROUP BY a.f26_agr_cred_type_cd) agra_a086 ON ((agra_a086.f26_agr_cred_type_cd =
        CASE
            WHEN ((agr_cred.has_higher_flag = 'Y'::text) AND (agr_cred.eks_overdraft_flag = 'N'::text)) THEN ''::text
            WHEN (COALESCE('Y'::text, 'N'::text) = 'Y'::text) THEN '9'::text
            WHEN (agra_e086_1.f26_agr_cred_type_cd = '9'::text) THEN '9'::text
            WHEN (agra_e086_1.f26_agr_cred_type_cd = '10'::text) THEN '10'::text
            WHEN (COALESCE(agr_cred.eks_overdraft_flag, 'N'::text) = 'Y'::text) THEN ('4'::text ||
            CASE
                WHEN (agra_e086_1.f26_agr_cred_type_cd = '4.1'::text) THEN '.1'::text
                ELSE ''::text
            END)
            WHEN (agra_e088.agr_cred_type_cd = '4'::text) THEN ''::text
            WHEN (agra_e088.agr_cred_type_cd = '2'::text) THEN ''::text
            WHEN ((agra_e088.agr_cred_type_cd = '0'::text) AND (agra_e086_1.f26_agr_cred_type_cd = '7'::text)) THEN '7'::text
            WHEN (((COALESCE(agr_cred.agr_frame_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (agra_e088.agr_cred_type_cd = '0'::text)) AND (agra_e086_1.f26_agr_cred_type_cd = '6.1'::text)) THEN '6.1'::text
            WHEN ((COALESCE(agr_cred.agr_frame_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (agra_e088.agr_cred_type_cd = '0'::text)) THEN '5.1'::text
            WHEN (agra_e088.agr_cred_type_cd = '0'::text) THEN '1'::text
            WHEN (((COALESCE(agr_cred.agr_frame_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (agra_e088.agr_cred_type_cd = '1'::text)) AND (agr_cred.eks_rvlng_flag = 'N'::text)) THEN '5.2'::text
            WHEN ((agra_e088.agr_cred_type_cd = '1'::text) AND (agr_cred.eks_rvlng_flag = 'N'::text)) THEN ('2'::text ||
            CASE
                WHEN (agra_e086_1.f26_agr_cred_type_cd = '2.1'::text) THEN '.1'::text
                ELSE ''::text
            END)
            WHEN ((COALESCE(agr_cred.agr_frame_id, ('-1'::integer)::bigint) <> '-1'::integer) AND (agr_cred.eks_rvlng_flag = 'Y'::text)) THEN ('5.3'::text ||
            CASE
                WHEN (agra_e086_1.f26_agr_cred_type_cd = '5.3-'::text) THEN '-'::text
                ELSE ''::text
            END)
            WHEN (agr_cred.eks_rvlng_flag = 'Y'::text) THEN ('3'::text ||
            CASE
                WHEN (agra_e086_1.f26_agr_cred_type_cd = '3-'::text) THEN '-'::text
                WHEN (agra_e086_1.f26_agr_cred_type_cd = '3-'::text) THEN '-'::text
                ELSE ''::text
            END)
            ELSE NULL::text
        END)))
     LEFT JOIN ( SELECT a.agr_cred_type_cd,
            max(a.agr_cred_type_id) AS agr_cred_type_id
           FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_type a
          GROUP BY a.agr_cred_type_cd) agra_a088 ON ((agra_a088.agr_cred_type_cd =
        CASE
            WHEN ((agr_cred.has_higher_flag = 'Y'::text) AND (agr_cred.eks_overdraft_flag = 'N'::text)) THEN '4'::text
            WHEN (('Y'::text = 'Y'::text) OR (agra_e086_1.f26_agr_cred_type_cd = '9'::text)) THEN '0'::text
            WHEN (agra_e086_1.f26_agr_cred_type_cd = '10'::text) THEN '-'::text
            WHEN (agr_cred.eks_overdraft_flag = 'Y'::text) THEN '1'::text
            WHEN ((agra_e088.agr_cred_type_cd = '1'::text) AND (agra_e086_1.f26_agr_cred_type_cd = '7'::text)) THEN '-'::text
            ELSE COALESCE(agra_e088.agr_cred_type_cd, '-'::text)
        END)));"
d_agr_cred_by_cess_prm_prt," SELECT t.agr_cred_id,
    t.start_dt,
    COALESCE((max(t.start_dt) OVER (PARTITION BY t.agr_cred_id ORDER BY t.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    t.issue_dt,
    t.rvlng_flag,
    t.overdraft_flag,
    t.f26_agr_cred_type_id,
    t.f26_agr_cred_type_cd,
    t.agr_cred_f26_type_id,
    t.agr_cred_type_id,
    t.agr_cred_type_cd,
    t.cession_sell_flag,
    t.cession_deferred_flag,
    t.info_system_id,
    t.cession_buy_flag
   FROM ( SELECT ac.agr_cred_id,
                CASE
                    WHEN (mult.i = 1) THEN '1900-01-01'::date
                    ELSE ac.cession_dt
                END AS start_dt,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN ac.cession_dt
                    ELSE ac.issue_dt
                END AS issue_dt,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN 'N'::text
                    ELSE ac.rvlng_flag
                END AS rvlng_flag,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN 'N'::text
                    ELSE ac.overdraft_flag
                END AS overdraft_flag,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN ( SELECT max(a_f26_agr_cred_type.f26_agr_cred_type_id) AS max
                       FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type
                      WHERE (a_f26_agr_cred_type.f26_agr_cred_type_cd = '9'::text))
                    ELSE ac.f26_agr_cred_type_id
                END AS f26_agr_cred_type_id,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN '9'::text
                    ELSE ac.f26_agr_cred_type_cd
                END AS f26_agr_cred_type_cd,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN ( SELECT max(a_f26_agr_cred_type.f26_agr_cred_type_id) AS max
                       FROM s_grnplm_vd_t_bvd_db_dmslcl.a_f26_agr_cred_type
                      WHERE (a_f26_agr_cred_type.f26_agr_cred_type_cd = '9'::text))
                    ELSE ac.f26_agr_cred_type_id
                END AS agr_cred_f26_type_id,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN ( SELECT max(a_agr_cred_type.agr_cred_type_id) AS max
                       FROM s_grnplm_vd_t_bvd_db_dmslcl.a_agr_cred_type
                      WHERE (a_agr_cred_type.agr_cred_type_cd = '0'::text))
                    ELSE ac.agr_cred_type_id
                END AS agr_cred_type_id,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN '0'::text
                    ELSE ac.agr_cred_type_cd
                END AS agr_cred_type_cd,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cession_buy_flag = 'N'::text)) THEN 'Y'::text
                    ELSE 'N'::text
                END AS cession_sell_flag,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cess_deferred_flag = 'Y'::text)) THEN 'Y'::text
                    ELSE 'N'::text
                END AS cession_deferred_flag,
            ac.info_system_id,
                CASE
                    WHEN ((mult.i = 2) AND (ac.cession_buy_flag = 'Y'::text)) THEN 'Y'::text
                    ELSE 'N'::text
                END AS cession_buy_flag
           FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred ac
             JOIN ( SELECT a.i
                   FROM ( SELECT 1 AS i) a
                UNION ALL
                 SELECT a.i
                   FROM ( SELECT 2 AS i) a) mult ON (((mult.i = 1) OR (ac.cession_dt <> '9999-12-31'::date))))) t;"
d_agr_cred_optn_sum," WITH iss_dt AS (
         SELECT t_1.agrmnt_id,
            t_1.acct_bal_metric_dt
           FROM ( SELECT a_m_t.agrmnt_id,
                    a_m_t.acct_bal_metric_dt,
                    row_number() OVER (PARTITION BY a_m_t.agrmnt_id ORDER BY a_m_t.acct_bal_metric_start_dt DESC NULLS LAST, a_m_t.acct_bal_metric_end_dt DESC NULLS LAST, a_m_t.acct_bal_metric_dt DESC NULLS LAST) AS rn
                   FROM s_grnplm_as_t_didsd_010_vd_dwh.v_agrmnt_metric_hist a_m_t
                  WHERE ((a_m_t.bal_cat_type_id = '-1'::integer) AND (a_m_t.acct_metric_type_id = '-1043'::integer))) t_1
          WHERE (t_1.rn = 1)
        ), eks_issue_dt AS (
         SELECT t_1.agr_cred_id,
            max(
                CASE
                    WHEN (t_1.line_eks_issue_dt IS NOT NULL) THEN t_1.line_eks_issue_dt
                    ELSE t_1.eks_issue_dt
                END) AS eks_issue_dt
           FROM ( SELECT agr.prnt_agr_cred_id AS agr_cred_id,
                    min(iss_dt.acct_bal_metric_dt) AS line_eks_issue_dt,
                    NULL::date AS eks_issue_dt
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr
                     LEFT JOIN iss_dt ON ((agr.agr_cred_id = iss_dt.agrmnt_id)))
                  GROUP BY agr.prnt_agr_cred_id
                UNION ALL
                 SELECT agr.agr_cred_id,
                    NULL::date AS line_eks_issue_dt,
                    iss_dt.acct_bal_metric_dt AS eks_issue_dt
                   FROM (s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_prnt_tmp agr
                     JOIN iss_dt ON ((agr.agr_cred_id = iss_dt.agrmnt_id)))
                  WHERE (agr.agr_cred_id <> agr.prnt_agr_cred_id)) t_1
          GROUP BY t_1.agr_cred_id
        ), agr_cred_issue_dt AS (
         SELECT agr.agr_cred_id,
            COALESCE(agr.eks_issue_dt, aco_fst_iss.optn_issue_dt) AS issue_dt
           FROM (eks_issue_dt agr
             LEFT JOIN ( SELECT t_1.agr_cred_id,
                    t_1.optn_issue_dt
                   FROM ( SELECT aco_fst_iss_1.agr_cred_id,
                            aco_fst_iss_1.optn_dt AS optn_issue_dt,
                            row_number() OVER (PARTITION BY aco_fst_iss_1.agr_cred_id ORDER BY aco_fst_iss_1.optn_dt) AS rn
                           FROM s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn aco_fst_iss_1
                          WHERE (((aco_fst_iss_1.issue_flag = 'Y'::text) OR (aco_fst_iss_1.move_flag = 'Y'::text)) AND (aco_fst_iss_1.optn_rub <> (0)::numeric))) t_1
                  WHERE (t_1.rn = 1)) aco_fst_iss ON ((aco_fst_iss.agr_cred_id = agr.agr_cred_id)))
          WHERE (COALESCE(agr.eks_issue_dt, aco_fst_iss.optn_issue_dt) IS NULL)
        )
 SELECT t.agr_cred_id,
    t.optn_crncy_id,
    t.start_dt,
    COALESCE((max(t.start_dt) OVER (PARTITION BY t.agr_cred_id, t.meas_cd, t.optn_crncy_id ORDER BY t.start_dt ROWS BETWEEN 1 FOLLOWING AND 1 FOLLOWING) - 1), '9999-12-31'::date) AS end_dt,
    t.meas_cd,
    sum(t.att_5) OVER (PARTITION BY t.agr_cred_id, t.optn_crncy_id, t.meas_cd ORDER BY t.start_dt ROWS UNBOUNDED PRECEDING) AS calc_amt,
    sum(t.att_6) OVER (PARTITION BY t.agr_cred_id, t.optn_crncy_id, t.meas_cd ORDER BY t.start_dt ROWS UNBOUNDED PRECEDING) AS own_calc_amt,
    sum(t.att_7) OVER (PARTITION BY t.agr_cred_id, t.optn_crncy_id, t.meas_cd ORDER BY t.start_dt ROWS UNBOUNDED PRECEDING) AS issued_issue_amt,
    sum(t.att_8) OVER (PARTITION BY t.agr_cred_id, t.optn_crncy_id, t.meas_cd ORDER BY t.start_dt ROWS UNBOUNDED PRECEDING) AS issued_amt,
    sum((t.att_8 + t.att_9)) OVER (PARTITION BY t.agr_cred_id, t.optn_crncy_id ORDER BY t.start_dt ROWS UNBOUNDED PRECEDING) AS corr_issued_amt,
    t.grntee_comiss_flag,
    t.info_system_id
   FROM ( SELECT a.agr_cred_id,
            a.optn_crncy_id,
            a.optn_dt AS start_dt,
            a.meas_cd,
            sum(((a.coef_sign)::numeric * a.optn_crncy_amt)) AS att_5,
            sum((((a.coef_sign)::numeric * a.optn_crncy_amt) * (a.coef_own)::numeric)) AS att_6,
            sum((((a.coef_sign)::numeric * a.optn_issue_crncy_amt) * (a.coef_iss)::numeric)) AS att_7,
            sum((((a.coef_sign)::numeric * a.optn_agr_cred_crncy_amt) * (a.coef_iss)::numeric)) AS att_8,
            sum(((((a.coef_migr_tranche)::numeric * a.optn_agr_cred_crncy_amt) * (a.coef_own)::numeric) * (a.coef_issue_dt)::numeric)) AS att_9,
            min(a.grntee_comiss_flag) AS grntee_comiss_flag,
            max(a.info_system_id) AS info_system_id
           FROM ( SELECT optn.agr_cred_id,
                    optn.optn_dt,
                    optn.meas_cd,
                    optn.crncy_id AS optn_crncy_id,
                    optn.optn_rub,
                    optn.optn_agr_cred_crncy_amt,
                    optn.optn_crncy_amt,
                    optn.optn_issue_crncy_amt,
                        CASE
                            WHEN (optn.inc_flag = 'N'::text) THEN '-1'::integer
                            ELSE (+ 1)
                        END AS coef_sign,
                        CASE
                            WHEN (optn.own_flag = 'Y'::text) THEN 1
                            ELSE 0
                        END AS coef_own,
                        CASE
                            WHEN ((optn.issue_flag = 'Y'::text) OR (optn.move_flag = 'Y'::text)) THEN 1
                            ELSE 0
                        END AS coef_iss,
                        CASE
                            WHEN (ot.optn_type_cd = '___'::text) THEN '-1'::integer
                            WHEN (ot.optn_type_cd = '___'::text) THEN 1
                            ELSE 0
                        END AS coef_migr_tranche,
                        CASE
                            WHEN (iss_dt.agr_cred_id IS NOT NULL) THEN 0
                            ELSE 1
                        END AS coef_issue_dt,
                    optn.info_system_id,
                    optn.grntee_comiss_flag
                   FROM ((s_grnplm_vd_t_bvd_db_dmslcl.d_agr_cred_optn optn
                     LEFT JOIN s_grnplm_vd_t_bvd_vd_dmslcl.v_optn_type_s ot ON ((optn.optn_type_id = ot.optn_type_id)))
                     LEFT JOIN agr_cred_issue_dt iss_dt ON ((optn.agr_cred_id = iss_dt.agr_cred_id)))) a
          GROUP BY a.agr_cred_id, a.optn_crncy_id, a.optn_dt, a.meas_cd) t;"
